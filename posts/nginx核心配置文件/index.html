<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶ | Hopeful</title>
<meta name="keywords" content="">
<meta name="description" content="nginx å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼Œhttp://nginx.org/en/docs/">
<meta name="author" content="Hopeful">
<link rel="canonical" href="https://xyenvy.github.io/posts/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://xyenvy.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://xyenvy.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://xyenvy.github.io/img/Q.gif">
<link rel="apple-touch-icon" href="https://xyenvy.github.io/img/Q.gif">
<link rel="mask-icon" href="https://xyenvy.github.io/img/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶" />
<meta property="og:description" content="nginx å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼Œhttp://nginx.org/en/docs/" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xyenvy.github.io/posts/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" />
<meta property="og:image" content="https://xyenvy.github.io/posts.images/banner/25.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-10T09:58:09+00:00" />
<meta property="article:modified_time" content="2023-01-10T09:58:09+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://xyenvy.github.io/posts.images/banner/25.jpg" />
<meta name="twitter:title" content="Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶"/>
<meta name="twitter:description" content="nginx å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼Œhttp://nginx.org/en/docs/"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "ğŸ“šæ–‡ç« ",
          "item": "https://xyenvy.github.io/posts/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶",
      "item": "https://xyenvy.github.io/posts/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶",
  "name": "Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶",
  "description": "nginx å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼Œhttp://nginx.org/en/docs/",
  "keywords": [
    
  ],
  "articleBody": "Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶ é…ç½®æ–‡ä»¶è¯´æ˜ nginxå®˜ç½‘æ–‡æ¡£è¯´æ˜\nhttp://nginx.org/en/docs/ tengineå¸®åŠ©æ–‡æ¡£\nhttp://tengine.taobao.org/nginx_docs/cn/docs Nginxçš„é…ç½®æ–‡ä»¶çš„ç»„æˆéƒ¨åˆ†\nä¸»é…ç½®æ–‡ä»¶ï¼šnginx.conf\nå­é…ç½®æ–‡ä»¶: include conf.d/*.conf\nfastcgiï¼Œ uwsgiï¼Œscgi ç­‰åè®®ç›¸å…³çš„é…ç½®æ–‡ä»¶ mime.typesï¼šæ”¯æŒçš„mimeç±»å‹ï¼ŒMIME(Multipurpose Internet Mail Extensions)å¤šç”¨é€”äº’è”ç½‘é‚® ä»¶æ‰©å±•ç±»å‹ï¼ŒMIMEæ¶ˆæ¯èƒ½åŒ…å«æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ä»¥åŠå…¶ä»–åº”ç”¨ç¨‹åºä¸“ç”¨çš„æ•°æ®ï¼Œæ˜¯è®¾å®šæŸ ç§æ‰©å±•åçš„æ–‡ä»¶ç”¨ä¸€ç§åº”ç”¨ç¨‹åºæ¥æ‰“å¼€çš„æ–¹å¼ç±»å‹ï¼Œå½“è¯¥æ‰©å±•åæ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ ä½¿ç”¨æŒ‡å®šåº”ç”¨ç¨‹åºæ¥æ‰“å¼€ã€‚å¤šç”¨äºæŒ‡å®šä¸€äº›å®¢æˆ·ç«¯è‡ªå®šä¹‰çš„æ–‡ä»¶åï¼Œä»¥åŠä¸€äº›åª’ä½“æ–‡ä»¶æ‰“å¼€æ–¹å¼ã€‚ MIMEå‚è€ƒæ–‡æ¡£ï¼š å‚è€ƒæ–‡æ¡£\nnginx é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜\né…ç½®æ–‡ä»¶ç”±æŒ‡ä»¤ä¸æŒ‡ä»¤å—æ„æˆ æ¯æ¡æŒ‡ä»¤ä»¥;åˆ†å·ç»“å°¾ï¼ŒæŒ‡ä»¤ä¸å€¼ä¹‹é—´ä»¥ç©ºæ ¼ç¬¦å·åˆ†éš” å¯ä»¥å°†å¤šæ¡æŒ‡ä»¤æ”¾åœ¨åŒä¸€è¡Œ,ç”¨åˆ†å·åˆ†éš”å³å¯,ä½†å¯è¯»æ€§å·®,ä¸æ¨è æŒ‡ä»¤å—ä»¥{ }å¤§æ‹¬å·å°†å¤šæ¡æŒ‡ä»¤ç»„ç»‡åœ¨ä¸€èµ·,ä¸”å¯ä»¥åµŒå¥—æŒ‡ä»¤å— includeè¯­å¥å…è®¸ç»„åˆå¤šä¸ªé…ç½®æ–‡ä»¶ä»¥æå‡å¯ç»´æŠ¤æ€§ ä½¿ç”¨#ç¬¦å·æ·»åŠ æ³¨é‡Šï¼Œæé«˜å¯è¯»æ€§ ä½¿ç”¨$ç¬¦å·ä½¿ç”¨å˜é‡ éƒ¨åˆ†æŒ‡ä»¤çš„å‚æ•°æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ Nginxä¸»é…ç½®æ–‡ä»¶çš„é…ç½®æŒ‡ä»¤æ–¹å¼\ndirective value [value2 ...]; æ³¨æ„ (1) æŒ‡ä»¤å¿…é¡»ä»¥åˆ†å·ç»“å°¾ (2) æ”¯æŒä½¿ç”¨é…ç½®å˜é‡ å†…å»ºå˜é‡ï¼šç”±Nginxæ¨¡å—å¼•å…¥ï¼Œå¯ç›´æ¥å¼•ç”¨ è‡ªå®šä¹‰å˜é‡ï¼šç”±ç”¨æˆ·ä½¿ç”¨setå‘½ä»¤å®šä¹‰,æ ¼å¼: set variable_name value; å¼•ç”¨å˜é‡ï¼š$variable_name ä¸»é…ç½®æ–‡ä»¶ç»“æ„ï¼šå››éƒ¨åˆ†\nmain blockï¼šä¸»é…ç½®æ®µï¼Œå³å…¨å±€é…ç½®æ®µï¼Œå¯¹http,mailéƒ½æœ‰æ•ˆ #äº‹ä»¶é©±åŠ¨ç›¸å…³çš„é…ç½® event { ... } #http/https åè®®ç›¸å…³é…ç½®æ®µ http { ... } #é»˜è®¤é…ç½®æ–‡ä»¶ä¸åŒ…æ‹¬ä¸‹é¢ä¸¤ä¸ªå— #mail åè®®ç›¸å…³é…ç½®æ®µ mail { ... } #stream æœåŠ¡å™¨ç›¸å…³é…ç½®æ®µ stream { ... } é»˜è®¤çš„nginx.confé…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜\n#å…¨å±€é…ç½®ç«¯ï¼Œå¯¹å…¨å±€ç”Ÿæ•ˆï¼Œä¸»è¦è®¾ç½®nginxçš„å¯åŠ¨ç”¨æˆ·/ç»„ï¼Œå¯åŠ¨çš„å·¥ä½œè¿›ç¨‹æ•°é‡ï¼Œå·¥ä½œæ¨¡å¼ï¼ŒNginxçš„PID è·¯å¾„ï¼Œæ—¥å¿—è·¯å¾„ç­‰ã€‚ user nginx nginx; worker_processes 1; #å¯åŠ¨å·¥ä½œè¿›ç¨‹æ•°æ•°é‡ events { #eventsè®¾ç½®å¿«ï¼Œä¸»è¦å½±å“nginxæœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼Œæ¯”å¦‚æ˜¯å¦å…è®¸åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿ æ¥ï¼Œä½¿ç”¨å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹å¤„ç†è¯·æ±‚ï¼Œæ¯ä¸ªå·¥ä½œè¿›ç¨‹å¯ä»¥åŒæ—¶æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ï¼Œæ˜¯å¦å¼€å¯å¯¹å¤šå·¥ä½œè¿›ç¨‹ä¸‹çš„ ç½‘ç»œè¿æ¥è¿›è¡Œåºåˆ—åŒ–ç­‰ã€‚ worker_connections 1024; #è®¾ç½®å•ä¸ªnginxå·¥ä½œè¿›ç¨‹å¯ä»¥æ¥å—çš„æœ€å¤§å¹¶å‘ï¼Œä½œä¸ºwebæœåŠ¡å™¨ çš„æ—¶å€™æœ€å¤§å¹¶å‘æ•°ä¸ºworker_connections * worker_processesï¼Œä½œä¸ºåå‘ä»£ç†çš„æ—¶å€™ä¸º (worker_connections * worker_processes)/2 } http { #httpå—æ˜¯NginxæœåŠ¡å™¨é…ç½®ä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œç¼“å­˜ã€ä»£ç†å’Œæ—¥å¿—æ ¼å¼å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡ å—éƒ½å¯ä»¥åœ¨è¿™è®¾ç½®ï¼Œhttpå—å¯ä»¥åŒ…å«å¤šä¸ªserverå—ï¼Œè€Œä¸€ä¸ªserverå—ä¸­åˆå¯ä»¥åŒ…å«å¤šä¸ªlocationå—ï¼Œ serverå—å¯ä»¥é…ç½®æ–‡ä»¶å¼•å…¥ã€MIME-Typeå®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€æ˜¯å¦å¯ç”¨sendfileã€è¿æ¥è¶…æ—¶æ—¶é—´å’Œå•ä¸ªé“¾ æ¥çš„è¯·æ±‚ä¸Šé™ç­‰ã€‚ include mime.types; default_type application/octet-stream; sendfile on; #ä½œä¸ºwebæœåŠ¡å™¨çš„æ—¶å€™æ‰“å¼€sendfileåŠ å¿«é™æ€æ–‡ä»¶ä¼ è¾“ï¼ŒæŒ‡å®šæ˜¯å¦ä½¿ç”¨ sendfileç³»ç»Ÿè°ƒç”¨æ¥ä¼ è¾“æ–‡ä»¶,sendfileç³»ç»Ÿè°ƒç”¨åœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´ç›´æ¥ä¼ é€’æ•°æ®(å®Œå…¨åœ¨å†…æ ¸ä¸­æ“ ä½œ)ï¼Œä»è€Œé¿å…äº†æ•°æ®åœ¨å†…æ ¸ç¼“å†²åŒºå’Œç”¨æˆ·ç¼“å†²åŒºä¹‹é—´çš„æ‹·è´ï¼Œæ“ä½œæ•ˆç‡å¾ˆé«˜ï¼Œè¢«ç§°ä¹‹ä¸ºé›¶æ‹·è´ï¼Œç¡¬ç›˜ \u003e\u003e kernel buffer (å¿«é€Ÿæ‹·è´åˆ°kernelsocket buffer) \u003e\u003eåè®®æ ˆã€‚ keepalive_timeout 65; #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ server { #è®¾ç½®ä¸€ä¸ªè™šæ‹Ÿæœºä¸»æœºï¼Œå¯ä»¥åŒ…å«è‡ªå·±çš„å…¨å±€å¿«ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ªlocationæ¨¡å—ã€‚æ¯”å¦‚ æœ¬è™šæ‹Ÿæœºç›‘å¬çš„ç«¯å£ã€æœ¬è™šæ‹Ÿæœºçš„åç§°å’ŒIPé…ç½®ï¼Œå¤šä¸ªserver å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç«¯å£ï¼Œæ¯”å¦‚éƒ½ä½¿ç”¨80ç«¯å£æä¾› webæœåŠ¡ã€ listen 80; #é…ç½®serverç›‘å¬çš„ç«¯å£ server_name localhost; #æœ¬serverçš„åç§°ï¼Œå½“è®¿é—®æ­¤åç§°çš„æ—¶å€™nginxä¼šè°ƒç”¨å½“å‰ serevrå†…éƒ¨çš„é…ç½®è¿›ç¨‹åŒ¹é…ã€‚ location / { #locationå…¶å®æ˜¯serverçš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œä¸ºnginxæœåŠ¡å™¨æä¾›æ¯”è¾ƒå¤šè€Œä¸”çµæ´»çš„æŒ‡ ä»¤ï¼Œéƒ½æ˜¯åœ¨locationä¸­ä½“ç°çš„ï¼Œä¸»è¦æ˜¯åŸºäºnginxæ¥å—åˆ°çš„è¯·æ±‚å­—ç¬¦ä¸²ï¼Œå¯¹ç”¨æˆ·è¯·æ±‚çš„UILè¿›è¡ŒåŒ¹é…ï¼Œå¹¶å¯¹ç‰¹ å®šçš„æŒ‡ä»¤è¿›è¡Œå¤„ç†ï¼ŒåŒ…æ‹¬åœ°å€é‡å®šå‘ã€æ•°æ®ç¼“å­˜å’Œåº”ç­”æ§åˆ¶ç­‰åŠŸèƒ½éƒ½æ˜¯åœ¨è¿™éƒ¨åˆ†å®ç°ï¼Œå¦å¤–å¾ˆå¤šç¬¬ä¸‰æ–¹æ¨¡å—çš„ é…ç½®ä¹Ÿæ˜¯åœ¨locationæ¨¡å—ä¸­é…ç½®ã€‚ root html; #ç›¸å½“äºé»˜è®¤é¡µé¢çš„ç›®å½•åç§°ï¼Œé»˜è®¤æ˜¯å®‰è£…ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨ç»å¯¹è·¯ å¾„é…ç½®ã€‚ index index.html index.htm; #é»˜è®¤çš„é¡µé¢æ–‡ä»¶åç§° } error_page 500 502 503 504 /50x.html; #é”™è¯¯é¡µé¢çš„æ–‡ä»¶åç§° location = /50x.html { #locationå¤„ç†å¯¹åº”çš„ä¸åŒé”™è¯¯ç çš„é¡µé¢å®šä¹‰åˆ°/50x.htmlï¼Œè¿™ä¸ª è·Ÿå¯¹åº”å…¶serverä¸­å®šä¹‰çš„ç›®å½•ä¸‹ã€‚ root html; #å®šä¹‰é»˜è®¤é¡µé¢æ‰€åœ¨çš„ç›®å½• } } #å’Œé‚®ä»¶ç›¸å…³çš„é…ç½® #mail { # ... # } mail åè®®ç›¸å…³é…ç½®æ®µ #tcpä»£ç†é…ç½®ï¼Œ1.9ç‰ˆæœ¬ä»¥ä¸Šæ”¯æŒ #stream { # ... # } stream æœåŠ¡å™¨ç›¸å…³é…ç½®æ®µ #å¯¼å…¥å…¶ä»–è·¯å¾„çš„é…ç½®æ–‡ä»¶ #include /apps/nginx/conf.d/*.conf } å…¨å±€é…ç½® Main å…¨å±€é…ç½®æ®µå¸¸è§çš„é…ç½®æŒ‡ä»¤åˆ†ç±»\næ­£å¸¸è¿è¡Œå¿…å¤‡çš„é…ç½® ä¼˜åŒ–æ€§èƒ½ç›¸å…³çš„é…ç½® ç”¨äºè°ƒè¯•åŠå®šä½é—®é¢˜ç›¸å…³çš„é…ç½® äº‹ä»¶é©±åŠ¨ç›¸å…³çš„é…ç½® å…¨å±€é…ç½®è¯´æ˜:\nuser nginx nginx; #å¯åŠ¨Nginxå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·å’Œç»„ worker_processes [number | auto]; #å¯åŠ¨Nginxå·¥ä½œè¿›ç¨‹çš„æ•°é‡,ä¸€èˆ¬è®¾ä¸ºå’ŒCPUæ ¸å¿ƒæ•°ç›¸åŒ worker_cpu_affinity 00000001 00000010 00000100 00001000 | auto ; #å°†Nginxå·¥ä½œè¿›ç¨‹ç»‘ å®šåˆ°æŒ‡å®šçš„CPUæ ¸å¿ƒï¼Œé»˜è®¤Nginxæ˜¯ä¸è¿›è¡Œè¿›ç¨‹ç»‘å®šçš„ï¼Œç»‘å®šå¹¶ä¸æ˜¯æ„å‘³ç€å½“å‰nginxè¿›ç¨‹ç‹¬å ä»¥ä¸€æ ¸å¿ƒCPUï¼Œ ä½†æ˜¯å¯ä»¥ä¿è¯æ­¤è¿›ç¨‹ä¸ä¼šè¿è¡Œåœ¨å…¶ä»–æ ¸å¿ƒä¸Šï¼Œè¿™å°±æå¤§å‡å°‘äº†nginxçš„å·¥ä½œè¿›ç¨‹åœ¨ä¸åŒçš„cpuæ ¸å¿ƒä¸Šçš„æ¥å›è·³ è½¬ï¼Œå‡å°‘äº†CPUå¯¹è¿›ç¨‹çš„èµ„æºåˆ†é…ä¸å›æ”¶ä»¥åŠå†…å­˜ç®¡ç†ç­‰ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆçš„æå‡nginxæœåŠ¡å™¨çš„æ€§èƒ½ã€‚ CPU MASK: 00000001ï¼š0å·CPU 00000010ï¼š1å·CPU 10000000ï¼š7å·CPU #ç¤ºä¾‹: worker_cpu_affinity 0001 0010 0100 1000;ç¬¬0å·---ç¬¬3å·CPU worker_cpu_affinity 0101 1010; #ç¤ºä¾‹ worker_processes 4; worker_cpu_affinity 00000010 00001000 00100000 10000000; [root@centos8 ~]# ps axo pid,cmd,psr | grep nginx 31093 nginx: master process /apps 1 34474 nginx: worker process 1 34475 nginx: worker process 3 34476 nginx: worker process 5 34477 nginx: worker process 7 35751 grep nginx #auto ç»‘å®šCPU #The special value auto (1.9.10) allows binding worker processes automatically to available CPUs: worker_processes auto; worker_cpu_affinity auto; #The optional mask parameter can be used to limit the CPUs available for automatic binding: worker_cpu_affinity auto 01010101; #é”™è¯¯æ—¥å¿—è®°å½•é…ç½®ï¼Œè¯­æ³•ï¼šerror_log file [debug | info | notice | warn | error | crit | alert | emerg] #error_log logs/error.log; #error_log logs/error.log notice; error_log /usr/local/src/nginx/logs/error.log error; #pidæ–‡ä»¶ä¿å­˜è·¯å¾„ pid /usr/local/src/nginx/logs/nginx.pid; worker_priority 0; #å·¥ä½œè¿›ç¨‹ä¼˜å…ˆçº§ï¼Œ-20~20(19) worker_rlimit_nofile 65536; #æ‰€æœ‰workerè¿›ç¨‹èƒ½æ‰“å¼€çš„æ–‡ä»¶æ•°é‡ä¸Šé™,åŒ…æ‹¬:Nginxçš„æ‰€æœ‰è¿æ¥ï¼ˆä¾‹ å¦‚ä¸ä»£ç†æœåŠ¡å™¨çš„è¿æ¥ç­‰ï¼‰ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸å®¢æˆ·ç«¯çš„è¿æ¥,å¦ä¸€ä¸ªè€ƒè™‘å› ç´ æ˜¯å®é™…çš„å¹¶å‘è¿æ¥æ•°ä¸èƒ½è¶…è¿‡ç³»ç»Ÿçº§ åˆ«çš„æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°çš„é™åˆ¶.æœ€å¥½ä¸ulimit -n æˆ–è€…limits.confçš„å€¼ä¿æŒä¸€è‡´, daemon off; #å‰å°è¿è¡ŒNginxæœåŠ¡ç”¨äºæµ‹è¯•ã€æˆ–è€…ä»¥å®¹å™¨è¿è¡Œæ—¶ï¼Œéœ€è¦è®¾ä¸ºoff master_process off|on; #æ˜¯å¦å¼€å¯Nginxçš„master-workerå·¥ä½œæ¨¡å¼ï¼Œä»…ç”¨äºå¼€å‘è°ƒè¯•åœºæ™¯,é»˜è®¤ä¸º on events { worker_connections 65536; #è®¾ç½®å•ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§å¹¶å‘è¿æ¥æ•° use epoll; #ä½¿ç”¨epolläº‹ä»¶é©±åŠ¨ï¼ŒNginxæ”¯æŒä¼—å¤šçš„äº‹ä»¶é©±åŠ¨ï¼Œæ¯”å¦‚:selectã€pollã€epollï¼Œåª èƒ½è®¾ç½®åœ¨eventsæ¨¡å—ä¸­è®¾ç½®ã€‚ accept_mutex on; #onä¸ºåŒä¸€æ—¶åˆ»ä¸€ä¸ªè¯·æ±‚è½®æµç”±workerè¿›ç¨‹å¤„ç†,è€Œé˜²æ­¢è¢«åŒæ—¶å”¤é†’æ‰€æœ‰ worker,é¿å…å¤šä¸ªç¡çœ è¿›ç¨‹è¢«å”¤é†’çš„è®¾ç½®ï¼Œé»˜è®¤ä¸ºoffï¼Œæ–°è¯·æ±‚ä¼šå”¤é†’æ‰€æœ‰workerè¿›ç¨‹,æ­¤è¿‡ç¨‹ä¹Ÿç§°ä¸º\"æƒŠ ç¾¤\"ï¼Œå› æ­¤nginxåˆšå®‰è£…å®Œä»¥åè¦è¿›è¡Œé€‚å½“çš„ä¼˜åŒ–ã€‚å»ºè®®è®¾ç½®ä¸ºon multi_accept on; #onæ—¶NginxæœåŠ¡å™¨çš„æ¯ä¸ªå·¥ä½œè¿›ç¨‹å¯ä»¥åŒæ—¶æ¥å—å¤šä¸ªæ–°çš„ç½‘ç»œè¿æ¥ï¼Œæ­¤æŒ‡ä»¤é»˜è®¤ ä¸ºoffï¼Œå³é»˜è®¤ä¸ºä¸€ä¸ªå·¥ä½œè¿›ç¨‹åªèƒ½ä¸€æ¬¡æ¥å—ä¸€ä¸ªæ–°çš„ç½‘ç»œè¿æ¥ï¼Œæ‰“å¼€åå‡ ä¸ªåŒæ—¶æ¥å—å¤šä¸ªã€‚å»ºè®®è®¾ç½®ä¸ºon } èŒƒä¾‹ï¼šå®ç°nginxé«˜å¹¶å‘é…ç½®\n[root@centos7 ~]#ulimit -n 102400 [root@centos7 ~]#while true;do ab -c 5000 -n 10000 http://10.0.0.8/;sleep 0.5;done #é»˜è®¤é…ç½®ä¸æ”¯æŒé«˜å¹¶å‘,ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯æ—¥å¿— [root@centos8 conf]#tail /usr/local/src/nginx/logs/error.log 2020/09/24 21:19:33 [crit] 41006#0: *1105860 open() \"/apps/nginx/html/50x.html\" failed (24: Too many open files), client: 10.0.0.7, server: localhost, request: \"GET / HTTP/1.0\", host: \"10.0.0.8\" 2020/09/24 21:19:33 [crit] 41006#0: accept4() failed (24: Too many open files) 2020/09/24 21:19:33 [crit] 41006#0: *1114177 open() \"/apps/nginx/html/index.html\" failed (24: Too many open files), client: 10.0.0.7, server: localhost, request: \"GET / HTTP/1.0\", host: \"10.0.0.8\" #å¦‚æœsystemdå¯åŠ¨,åˆ™éœ€è¦ä¿®æ”¹nginx.serviceæ–‡ä»¶ä¸­åŠ LimitNOFILE=100000,æ‰èƒ½æœ‰æ•ˆ #å¦‚æœésystemdå¯åŠ¨,å¯ä»¥ä¿®æ”¹ä¸‹é¢pamé™åˆ¶ [root@centos8 ~]#vim /etc/security/limits.conf * soft nofile 1000000 * hard nofile 1000000 [root@centos8 ~]#vim /apps/nginx/conf/nginx.conf worker_rlimit_nofile 100000; [root@centos8 ~]#systemctl restart nginx [root@centos8 ~]# watch -n1 'ps -axo pid,cmd,nice | grep nginx #éªŒè¯è¿›ç¨‹ä¼˜å…ˆçº§ httpé…ç½®å— http { ... ... #å„serverçš„å…¬å…±é…ç½® server { #æ¯ä¸ªserverç”¨äºå®šä¹‰ä¸€ä¸ªè™šæ‹Ÿä¸»æœº,ç¬¬ä¸€ä¸ªserverä¸ºé»˜è®¤è™šæ‹ŸæœåŠ¡å™¨ ... } server { ... server_name #è™šæ‹Ÿä¸»æœºå root #ä¸»ç›®å½• alias #è·¯å¾„åˆ«å location [OPERATOR] URL { #æŒ‡å®šURLçš„ç‰¹æ€§ ... if CONDITION { ... } } } } httpé…ç½®åè®®è¯´æ˜\nhttp { include mime.types; #å¯¼å…¥æ”¯æŒçš„æ–‡ä»¶ç±»å‹,æ˜¯ç›¸å¯¹äº/usr/local/src/nginx/confçš„ç›®å½• default_type application/octet-stream; #é™¤mime.typesä¸­æ–‡ä»¶ç±»å‹å¤–,è®¾ç½®å…¶å®ƒæ–‡ä»¶é»˜è®¤ ç±»å‹ï¼Œè®¿é—®å…¶å®ƒç±»å‹æ—¶ä¼šæç¤ºä¸‹è½½ä¸åŒ¹é…çš„ç±»å‹æ–‡ä»¶ #æ—¥å¿—é…ç½®éƒ¨åˆ† #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; #è‡ªå®šä¹‰ä¼˜åŒ–å‚æ•° sendfile on; #tcp_nopush on; #åœ¨å¼€å¯äº†sendfileçš„æƒ…å†µä¸‹ï¼Œåˆå¹¶è¯·æ±‚åç»Ÿä¸€å‘é€ç»™å®¢æˆ·ç«¯,å¿…é¡»å¼€å¯ sendfile #tcp_nodelay off; #åœ¨å¼€å¯äº†keepalivedæ¨¡å¼ä¸‹çš„è¿æ¥æ˜¯å¦å¯ç”¨TCP_NODELAYé€‰é¡¹ï¼Œå½“ä¸º offæ—¶ï¼Œå»¶è¿Ÿ0.2så‘é€ï¼Œé»˜è®¤Onæ—¶ï¼Œä¸å»¶è¿Ÿå‘é€ï¼Œç«‹å³å‘é€ç”¨æˆ·å“åº”æŠ¥æ–‡ã€‚ #keepalive_timeout 0; keepalive_timeout 65 65; #è®¾ç½®ä¼šè¯ä¿æŒæ—¶é—´,ç¬¬äºŒä¸ªå€¼ä¸ºå“åº”é¦–éƒ¨:keepAlived:timeout=65,å¯ä»¥å’Œç¬¬ä¸€ä¸ªå€¼ä¸åŒ #gzip on; #å¼€å¯æ–‡ä»¶å‹ç¼© server { listen 80; #è®¾ç½®ç›‘å¬åœ°å€å’Œç«¯å£ server_name localhost; #è®¾ç½®server nameï¼Œå¯ä»¥ä»¥ç©ºæ ¼éš”å¼€å†™å¤šä¸ªå¹¶æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œ å¦‚:*.magedu.com www.magedu.* ~^www\\d+\\.magedu\\.com$ default_server #charset koi8-r; #è®¾ç½®ç¼–ç æ ¼å¼ï¼Œé»˜è®¤æ˜¯ä¿„è¯­æ ¼å¼ï¼Œå»ºè®®æ”¹ä¸ºutf-8 #access_log logs/host.access.log main; location / { root html; index index.html index.htm; } #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; #å®šä¹‰é”™è¯¯é¡µé¢ location = /50x.html { root html; } # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \\.php$ { #ä»¥httpçš„æ–¹å¼è½¬å‘phpè¯·æ±‚åˆ°æŒ‡å®šwebæœåŠ¡å™¨ # proxy_pass http://127.0.0.1; #} # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \\.php$ { #ä»¥fastcgiçš„æ–¹å¼è½¬å‘phpè¯·æ±‚åˆ°phpå¤„ç† # root html; # fastcgi_pass 127.0.0.1:9000; # fastcgi_index index.php; # fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; # include fastcgi_params; #} # deny access to .htaccess files, if Apache's document root # concurs with nginx's one # #location ~ /\\.ht { #æ‹’ç»webå½¢å¼è®¿é—®æŒ‡å®šæ–‡ä»¶ï¼Œå¦‚å¾ˆå¤šçš„ç½‘ç«™éƒ½æ˜¯é€šè¿‡.htaccessæ–‡ä»¶æ¥ æ”¹å˜è‡ªå·±çš„é‡å®šå‘ç­‰åŠŸèƒ½ã€‚ # deny all; #} location ~ /passwd.html { deny all; } } # another virtual host using mix of IP-, name-, and port-based configuration # #server { #è‡ªå®šä¹‰è™šæ‹Ÿserver # listen 8000; # listen somename:8080; # server_name somename alias another.alias; # location / { # root html; # index index.html index.htm; #æŒ‡å®šé»˜è®¤ç½‘é¡µæ–‡ä»¶ï¼Œæ­¤æŒ‡ä»¤ç”± ngx_http_index_moduleæ¨¡å—æä¾› # } #} # HTTPS server # #server { #httpsæœåŠ¡å™¨é…ç½® # listen 443 ssl; # server_name localhost; # ssl_certificate cert.pem; # ssl_certificate_key cert.key; # ssl_session_cache shared:SSL:1m; # ssl_session_timeout 5m; # ssl_ciphers HIGH:!aNULL:!MD5; # ssl_prefer_server_ciphers on; # location / { # root html; # index index.html index.htm; # } #} MIME #åœ¨å“åº”æŠ¥æ–‡ä¸­å°†æŒ‡å®šçš„æ–‡ä»¶æ‰©å±•åæ˜ å°„è‡³MIMEå¯¹åº”çš„ç±»å‹ include /etc/nginx/mime.types; default_type application/octet-stream;#é™¤mime.typesä¸­çš„ç±»å‹å¤–ï¼ŒæŒ‡å®šå…¶å®ƒæ–‡ä»¶çš„é»˜è®¤ MIMEç±»å‹ï¼Œæµè§ˆå™¨ä¸€èˆ¬ä¼šæç¤ºä¸‹è½½ types { text/html html; image/gif gif; image/jpeg jpg; } #MIMEå‚è€ƒæ–‡æ¡£ï¼š https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types èŒƒä¾‹ï¼šè¯†åˆ«PHPä¸ºtext\n[root@centos7 conf]# vim /usr/local/src/nginx/html/test.php \u003c?php phpinfo(); ?\u003e # ä¿®æ”¹é…ç½®æ–‡ä»¶ [root@centos7 conf]# vim /usr/local/src/nginx/conf/nginx.conf http { include mime.types; default_type text/html; # åŠ å…¥æ¬¡è¡Œ ...... #æˆ–è€…ä¿®æ”¹ä¸ºä¸‹é¢ include mime.types; default_type application/octet-stream; types{ text/plain php; #åŠ æ­¤è¡Œ } æŒ‡å®šå“åº”æŠ¥æ–‡serveré¦–éƒ¨ #æ˜¯å¦åœ¨å“åº”æŠ¥æ–‡ä¸­çš„Content-Typeæ˜¾ç¤ºæŒ‡å®šçš„å­—ç¬¦é›†ï¼Œé»˜è®¤offä¸æ˜¾ç¤º charset charset | off; #ç¤ºä¾‹ charset utf-8; #æ˜¯å¦åœ¨å“åº”æŠ¥æ–‡çš„Serveré¦–éƒ¨æ˜¾ç¤ºnginxç‰ˆæœ¬ server_tokens on | off | build | string; ä¿®æ”¹serverå­—æ®µ\nå¦‚æœæƒ³è‡ªå®šä¹‰å“åº”æŠ¥æ–‡çš„nginxç‰ˆæœ¬ä¿¡æ¯ï¼Œéœ€è¦ä¿®æ”¹æºç æ–‡ä»¶ï¼Œé‡æ–°ç¼–è¯‘ å¦‚æœserver_tokens onï¼Œä¿®æ”¹ src/core/nginx.h ä¿®æ”¹ç¬¬13-14è¡Œï¼Œå¦‚ä¸‹ç¤ºä¾‹ #define NGINX_VERSION \"1.68.9\" #define NGINX_VER \"test/\" NGINX_VERSION å¦‚æœserver_tokens offï¼Œä¿®æ”¹ src/http/ngx_http_header_filter_module.c ç¬¬49è¡Œï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š static char ngx_http_server_string[] = \"Server: nginx\" CRLF; æŠŠå…¶ä¸­çš„nginxæ”¹ä¸ºè‡ªå·±æƒ³è¦çš„æ–‡å­—å³å¯,å¦‚ï¼štest root ä¸ alias rootï¼šæŒ‡å®šwebçš„å®¶ç›®å½•ï¼Œåœ¨å®šä¹‰locationçš„æ—¶å€™ï¼Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ç­‰äº root+location\naliasï¼šå®šä¹‰è·¯å¾„åˆ«åï¼Œä¼šæŠŠè®¿é—®çš„è·¯å¾„é‡æ–°å®šä¹‰åˆ°å…¶æŒ‡å®šçš„è·¯å¾„,æ–‡æ¡£æ˜ å°„çš„å¦ä¸€ç§æœºåˆ¶;ä»…èƒ½ç”¨äº locationä¸Šä¸‹æ–‡,æ­¤æŒ‡ä»¤ä½¿ç”¨è¾ƒå°‘\næ³¨æ„ï¼šlocationä¸­ä½¿ç”¨rootæŒ‡ä»¤å’ŒaliasæŒ‡ä»¤çš„æ„ä¹‰ä¸åŒ\nroot ç»™å®šçš„è·¯å¾„å¯¹åº”äºlocationä¸­çš„/uri å·¦ä¾§çš„/ alias ç»™å®šçš„è·¯å¾„å¯¹åº”äºlocationä¸­çš„/uri çš„å®Œæ•´è·¯å¾„ location çš„è¯¦ç»†ä½¿ç”¨ åœ¨ä¸€ä¸ªserverä¸­locationé…ç½®æ®µå¯å­˜åœ¨å¤šä¸ªï¼Œç”¨äºå®ç°ä»uriåˆ°æ–‡ä»¶ç³»ç»Ÿçš„è·¯å¾„æ˜ å°„ï¼›ngnixä¼šæ ¹æ®ç”¨æˆ·è¯· æ±‚çš„URIæ¥æ£€æŸ¥å®šä¹‰çš„æ‰€æœ‰locationï¼ŒæŒ‰ä¸€å®šçš„ä¼˜å…ˆçº§æ‰¾å‡ºä¸€ä¸ªæœ€ä½³åŒ¹é…ï¼Œè€Œååº”ç”¨å…¶é…ç½®\nåœ¨æ²¡æœ‰ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æ—¶å€™ï¼Œnginxä¼šå…ˆåœ¨serverä¸­çš„å¤šä¸ªlocationé€‰å–åŒ¹é…åº¦æœ€é«˜çš„ä¸€ä¸ªuriï¼Œuriæ˜¯ ç”¨æˆ·è¯·æ±‚çš„å­—ç¬¦ä¸²ï¼Œå³åŸŸååé¢çš„webæ–‡ä»¶è·¯å¾„ï¼Œç„¶åä½¿ç”¨è¯¥locationæ¨¡å—ä¸­çš„æ­£åˆ™urlå’Œå­—ç¬¦ä¸²ï¼Œå¦‚æœ åŒ¹é…æˆåŠŸå°±ç»“æŸæœç´¢ï¼Œå¹¶ä½¿ç”¨æ­¤locationå¤„ç†æ­¤è¯·æ±‚ã€‚\nlocation å®˜æ–¹å¸®åŠ©:\nhttps://nginx.org/en/docs/http/ngx_http_core_module.html#location è¯­æ³•è§„åˆ™\n#è¯­æ³•è§„åˆ™ï¼š location [ = | ~ | ~* | ^~ ] uri { ... } = #ç”¨äºæ ‡å‡†uriå‰ï¼Œéœ€è¦è¯·æ±‚å­—ä¸²ä¸uriç²¾ç¡®åŒ¹é…ï¼Œå¤§å°æ•æ„Ÿ,å¦‚æœåŒ¹é…æˆåŠŸå°±åœæ­¢å‘ä¸‹åŒ¹é…å¹¶ç«‹å³å¤„ç†è¯· æ±‚ ^~ #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼,å¹¶ä¸”åŒ¹é…ä»¥æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼å¼€å¤´,å¯¹uriçš„æœ€å·¦è¾¹éƒ¨åˆ†åšåŒ¹é… æ£€æŸ¥ï¼Œä¸åŒºåˆ†å­—ç¬¦å¤§å°å†™ ~ #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼,å¹¶ä¸”åŒºåˆ†å¤§å°å†™ ~* #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼,å¹¶ä¸”ä¸åŒºåˆ†å¤§å†™ ä¸å¸¦ç¬¦å· #åŒ¹é…èµ·å§‹äºæ­¤uriçš„æ‰€æœ‰çš„uri \\ #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼å¹¶ä¸”è½¬ä¹‰å­—ç¬¦ã€‚å¯ä»¥å°† . * ?ç­‰è½¬ä¹‰ä¸ºæ™®é€šç¬¦å· #åŒ¹é…ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š =, ^~, ~/~*, ä¸å¸¦ç¬¦å· å®˜ç½‘æ¡ˆä¾‹\nlocation = / { [ configuration A ] } location / { [ configuration B ] } location /documents/ { [ configuration C ] } location ^~ /images/ { [ configuration D ] } location ~* \\.(gif|jpg|jpeg)$ { [ configuration E ] } The â€œ/â€ request will match configuration A(?), the â€œ/index.htmlâ€ request will match configuration B, the â€œ/documents/document.htmlâ€ request will match configuration C, the â€œ/images/1.gifâ€ request will match configuration D, and the â€œ/documents/1.jpgâ€ request will match configuration E. ç²¾ç¡®åŒ¹é…å›¾ç‰‡ server{ listen 80; server_name localhost; root /data/web; index index.html *.html; location = /test.jpg { root /data/image; } } åŒ¹é…æ¡ˆä¾‹-æ–‡ä»¶ååç¼€ server{ listen 80; server_name localhost; root /data/web; index index.html *.html; location ~* \\.(gif|jpg|jpeg|bmp|png|tiff|tif|ico|wmf|js|css)$ { root /data/web1; } } åŒ¹é…æ¡ˆä¾‹-ä¼˜å…ˆçº§ server{ listen 80; server_name localhost; root /data/web; index index.html *.html; location = /test2.jpg { root /data/web2; index index.html; } location ~* \\.(gif|jpg|jpeg|bmp|png|tiff|tif|ico|wmf|js|css)$ { root /data/web1; index index.html; } } #åŒ¹é…ä¼˜å…ˆçº§ï¼š=, ^~, ï½/ï½*ï¼Œ/ locationä¼˜å…ˆçº§ï¼š(location =) \u003e (location ^~ è·¯å¾„) \u003e (location ~,~* æ­£åˆ™é¡ºåº) \u003e (location å®Œæ•´è·¯å¾„) \u003e (location éƒ¨åˆ†èµ·å§‹è·¯å¾„) \u003e (/) Nginx å››å±‚è®¿é—®æ§åˆ¶ è®¿é—®æ§åˆ¶åŸºäºæ¨¡å—ngx_http_access_moduleå®ç°ï¼Œå¯ä»¥é€šè¿‡åŒ¹é…å®¢æˆ·ç«¯æºIPåœ°å€è¿›è¡Œé™åˆ¶ æ³¨æ„: å¦‚æœèƒ½åœ¨é˜²ç«å¢™è®¾å¤‡æ§åˆ¶,æœ€å¥½å°±ä¸è¦åœ¨nginxä¸Šé…ç½®,å¯ä»¥æ›´å¥½çš„èŠ‚çº¦èµ„æº\nå®˜æ–¹å¸®åŠ©:\nhttp://nginx.org/en/docs/http/ngx_http_access_module.html èŒƒä¾‹ï¼š\nlocation = /login/ { root /data/nginx/html/pc; allow 10.0.0.0/24; deny all; } location /about { alias /data/nginx/html/pc; index index.html; deny 192.168.1.1; # ç¦æ­¢è¯¥IPè®¿é—® allow 192.168.1.0/24; # å…è®¸è¯¥ç½‘æ®µè®¿é—® allow 10.1.1.0/16; allow 2001:0db8::/32; deny all; #æŒ‰å…ˆå°èŒƒå›´åˆ°å¤§èŒƒå›´æ’åº } Nginx è´¦æˆ·è®¤è¯åŠŸèƒ½ ç”± ngx_http_auth_basic_module æ¨¡å—æä¾›æ­¤åŠŸèƒ½\nå®˜æ–¹å¸®åŠ©:\nhttps://nginx.org/en/docs/http/ngx_http_auth_basic_module.html#auth_basic èŒƒä¾‹ï¼š\n#CentOSå®‰è£…åŒ… [root@centos7 ~]#yum -y install httpd-tools #Ubuntuå®‰è£…åŒ… [root@Ubuntu ~]#apt -y install apache2-utils #åˆ›å»ºç”¨æˆ· #-b éäº¤äº’å¼æ–¹å¼æäº¤å¯†ç  [root@centos7 ~]# htpasswd -cb /usr/local/src/nginx/conf.d/passwd admin 123456 Adding password for user admin [root@centos7 conf.d]# cat passwd admin:$apr1$/MugqAsJ$MbWcOmC5U9WTZlgK5MJeU. [root@centos7 conf.d]# #å®‰å…¨åŠ å›º [root@centos7 ~]# chown nginx.nginx /usr/local/src/nginx/conf.d/passwd [root@centos7 ~]# chmod 600 /usr/local/src/nginx/conf.d/passwd # ä¿®æ”¹é…ç½®æ–‡ä»¶ server{ listen 80; server_name localhost; root /data/web; index index.html *.html; location /about { alias /data/web1; index index.html *.html; auth_basic \"login password\"; auth_basic_user_file /usr/local/src/nginx/conf.d/passwd; } } æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ try_files ä¼šæŒ‰é¡ºåºæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè¿”å›ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼ˆç»“å°¾åŠ æ–œçº¿è¡¨ç¤ºä¸ºæ–‡ä»¶å¤¹ï¼‰ï¼Œ å¦‚æœæ‰€æœ‰æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹éƒ½æ‰¾ä¸åˆ°ï¼Œä¼šè¿›è¡Œä¸€ä¸ªå†…éƒ¨é‡å®šå‘åˆ°æœ€åä¸€ä¸ªå‚æ•°ã€‚åªæœ‰æœ€åä¸€ä¸ªå‚æ•°å¯ä»¥å¼•èµ· ä¸€ä¸ªå†…éƒ¨é‡å®šå‘ï¼Œä¹‹å‰çš„å‚æ•°åªè®¾ç½®å†…éƒ¨URIçš„æŒ‡å‘ã€‚æœ€åä¸€ä¸ªå‚æ•°æ˜¯å›é€€URIä¸”å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™ä¼šå‡ºç° å†…éƒ¨500é”™è¯¯ã€‚\nè¯­æ³•æ ¼å¼\nSyntax: try_files file ... uri; try_files file ... =code; Default: â€” Context: server, location èŒƒä¾‹ï¼š å¦‚æœä¸å­˜åœ¨é¡µé¢, å°±è½¬åˆ°default.htmlé¡µé¢\nserver{ listen 80; server_name localhost; root /data/web; index index.html *.html; location / { #å¦‚æœä¸å­˜åœ¨é¡µé¢, å°±è½¬åˆ°default.htmlé¡µé¢ # try_files $uri $uri.html $uri/index.html /about/default.html; # è¿”å›è‡ªå®šä¹‰çŠ¶æ€ç  489 try_files $uri $uri/index.html $uri.html =489; index index.html *.html; } } é•¿è¿æ¥é…ç½® keepalive_timeout timeout [header_timeout]; #è®¾å®šä¿æŒè¿æ¥è¶…æ—¶æ—¶é•¿ï¼Œ0è¡¨ç¤ºç¦æ­¢é•¿è¿æ¥ï¼Œé»˜ è®¤ä¸º75sï¼Œé€šå¸¸é…ç½®åœ¨httpå­—æ®µä½œä¸ºç«™ç‚¹å…¨å±€é…ç½® keepalive_requests number; #åœ¨ä¸€æ¬¡é•¿è¿æ¥ä¸Šæ‰€å…è®¸è¯·æ±‚çš„èµ„æºçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º1000æ¬¡,å»ºè®®é€‚ å½“è°ƒå¤§,æ¯”å¦‚:500 èŒƒä¾‹ï¼š\nkeepalive_requests 3; keepalive_timeout 65 60; #å¼€å¯é•¿è¿æ¥åï¼Œè¿”å›å®¢æˆ·ç«¯çš„ä¼šè¯ä¿æŒæ—¶é—´ä¸º60sï¼Œå•æ¬¡é•¿è¿æ¥ç´¯è®¡è¯·æ±‚è¾¾åˆ°æŒ‡å®šæ¬¡æ•°è¯·æ±‚æˆ–65ç§’å°±ä¼šè¢«æ–­ å¼€ï¼Œç¬¬äºŒä¸ªæ•°å­—60ä¸ºå‘é€ç»™å®¢æˆ·ç«¯åº”ç­”æŠ¥æ–‡å¤´éƒ¨ä¸­æ˜¾ç¤ºçš„è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º60sï¼šå¦‚ä¸è®¾ç½®å®¢æˆ·ç«¯å°†ä¸æ˜¾ç¤ºè¶…æ—¶ æ—¶é—´ã€‚ Keep-Alive:timeout=60 #æµè§ˆå™¨æ”¶åˆ°çš„æœåŠ¡å™¨è¿”å›çš„æŠ¥æ–‡ #å¦‚æœè®¾ç½®ä¸º0è¡¨ç¤ºå…³é—­ä¼šè¯ä¿æŒåŠŸèƒ½ï¼Œå°†å¦‚ä¸‹æ˜¾ç¤ºï¼š Connection:close #æµè§ˆå™¨æ”¶åˆ°çš„æœåŠ¡å™¨è¿”å›çš„æŠ¥æ–‡ ä½œä¸ºä¸‹è½½æœåŠ¡å™¨é…ç½® nginx_http_autoindex_module æ¨¡å—å¤„ç†ä»¥æ–œæ å­—ç¬¦ â€œ/â€ ç»“å°¾çš„è¯·æ±‚ï¼Œå¹¶ç”Ÿæˆç›®å½•åˆ—è¡¨,å¯ä»¥åšä¸ºä¸‹è½½æœåŠ¡ é…ç½®ä½¿ç”¨ å®˜æ–¹æ–‡æ¡£:\nhttps://nginx.org/en/docs/http/ngx_http_autoindex_module.html#autoindex Syntax: autoindex on | off; Default: autoindex off; Context: http, server, location ç›¸å…³æŒ‡ä»¤\nautoindex on | off;#è‡ªåŠ¨æ–‡ä»¶ç´¢å¼•åŠŸèƒ½ï¼Œé»˜ä¸ºoff autoindex_exact_size on | off; #è®¡ç®—æ–‡ä»¶ç¡®åˆ‡å¤§å°ï¼ˆå•ä½bytesï¼‰ï¼Œoff æ˜¾ç¤ºå¤§æ¦‚å¤§å°ï¼ˆå•ä½ Kã€M)ï¼Œé»˜è®¤on autoindex_localtime on | off ; #æ˜¾ç¤ºæœ¬æœºæ—¶é—´è€ŒéGMT(æ ¼æ—å¨æ²»)æ—¶é—´ï¼Œé»˜è®¤off autoindex_format html | xml | json | jsonp; #æ˜¾ç¤ºç´¢å¼•çš„é¡µé¢æ–‡ä»¶é£æ ¼ï¼Œé»˜è®¤html limit_rate rate; #é™åˆ¶å“åº”å®¢æˆ·ç«¯ä¼ è¾“é€Ÿç‡(é™¤GETå’ŒHEADä»¥å¤–çš„æ‰€æœ‰æ–¹æ³•)ï¼Œå•ä½B/s,å³ bytes/secondï¼Œé»˜è®¤å€¼0,è¡¨ç¤ºæ— é™åˆ¶,æ­¤æŒ‡ä»¤ç”±ngx_http_core_moduleæä¾› set $limit_rate 4k; #ä¹Ÿå¯ä»¥é€šå˜é‡é™é€Ÿ,å•ä½B/s,åŒæ—¶è®¾ç½®,æ­¤é¡¹ä¼˜çº§é«˜.Rate limit can also be set in the $limit_rate variable, however, since version 1.17.0, this method is not recommended: èŒƒä¾‹ï¼š\n# é…ç½®æ–‡ä»¶ location /download { autoindex on; #è‡ªåŠ¨ç´¢å¼•åŠŸèƒ½ autoindex_exact_size on; #è®¡ç®—æ–‡ä»¶ç¡®åˆ‡å¤§å°ï¼ˆå•ä½bytesï¼‰ï¼Œæ­¤ä¸ºé»˜è®¤å€¼,offåªæ˜¾ç¤ºå¤§æ¦‚å¤§ å°ï¼ˆå•ä½kbã€mbã€gbï¼‰ autoindex_localtime on; #onè¡¨ç¤ºæ˜¾ç¤ºæœ¬æœºæ—¶é—´è€ŒéGMT(æ ¼æ—å¨æ²»)æ—¶é—´,é»˜ä¸ºä¸ºoffæ˜¾ç¤ºGMT æ—¶é—´ limit_rate 1024k; #é™é€Ÿ,é»˜è®¤ä¸é™é€Ÿ root /data/web/download; } å…¶ä»–é…ç½® keepalive_disable none | browser ...; #å¯¹å“ªç§æµè§ˆå™¨ç¦ç”¨é•¿è¿æ¥ limit_except method ... { ... }ï¼Œä»…ç”¨äºlocation #ç¦æ­¢å®¢æˆ·ç«¯ä½¿ç”¨é™¤äº†æŒ‡å®šçš„è¯·æ±‚æ–¹æ³•ä¹‹å¤–çš„å…¶å®ƒæ–¹æ³•,å¦‚æœä½¿ç”¨ä¼šå‡ºç°403é”™è¯¯ method:GET, HEAD, POST, PUT, DELETEï¼ŒMKCOL, COPY, MOVE, OPTIONS, PROPFIND, PROPPATCH, LOCK, UNLOCK, PATCH limit_except GET { allow 192.168.0.0/24; allow 10.0.0.1; deny all; } #é™¤äº†GETå’ŒHEAD ä¹‹å¤–å…¶å®ƒæ–¹æ³•ä»…å…è®¸192.168.1.0/24ç½‘æ®µä¸»æœºä½¿ç”¨ location /upload { root /data/nginx/html/pc; index index.html; limit_except GET { allow 10.0.0.6; deny all; } } ",
  "wordCount" : "7021",
  "inLanguage": "en",
  "image":"https://xyenvy.github.io/posts.images/banner/25.jpg","datePublished": "2023-01-10T09:58:09Z",
  "dateModified": "2023-01-10T09:58:09Z",
  "author":[{
    "@type": "Person",
    "name": "Hopeful"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://xyenvy.github.io/posts/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Hopeful",
    "logo": {
      "@type": "ImageObject",
      "url": "https://xyenvy.github.io/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://xyenvy.github.io" accesskey="h" title="Hopeful (Alt + H)">
            <img src="https://xyenvy.github.io/img/Q.gif" alt="logo" aria-label="logo"
                 height="35">Hopeful</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://xyenvy.github.io/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                <span>ğŸ” æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/" title="ğŸ  ä¸»é¡µ">
                <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/posts" title="ğŸ“š æ–‡ç« ">
                <span>ğŸ“š æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/tags" title="ğŸ§© æ ‡ç­¾">
                <span>ğŸ§© æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/archives/" title="â±ï¸ æ—¶é—´è½´">
                <span>â±ï¸ æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº">
                <span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://xyenvy.github.io">ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://xyenvy.github.io/posts/">ğŸ“šæ–‡ç« </a></div>
            <h1 class="post-title">
                Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶
            </h1>
            <div class="post-description">
                nginx å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼Œhttp://nginx.org/en/docs/
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-01-10
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>7021å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>15åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>Hopeful
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "https://xyenvy.github.io"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="https://xyenvy.github.io/posts.images/banner/25.jpg" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">æ–‡ç« ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#nginx%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶">Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e8%af%b4%e6%98%8e" aria-label="é…ç½®æ–‡ä»¶è¯´æ˜">é…ç½®æ–‡ä»¶è¯´æ˜</a></li>
                <li>
                    <a href="#%e5%85%a8%e5%b1%80%e9%85%8d%e7%bd%ae" aria-label="å…¨å±€é…ç½®">å…¨å±€é…ç½®</a></li>
                <li>
                    <a href="#http%e9%85%8d%e7%bd%ae%e5%9d%97" aria-label="httpé…ç½®å—">httpé…ç½®å—</a></li>
                <li>
                    <a href="#mime" aria-label="MIME">MIME</a></li>
                <li>
                    <a href="#%e6%8c%87%e5%ae%9a%e5%93%8d%e5%ba%94%e6%8a%a5%e6%96%87server%e9%a6%96%e9%83%a8" aria-label="æŒ‡å®šå“åº”æŠ¥æ–‡serveré¦–éƒ¨">æŒ‡å®šå“åº”æŠ¥æ–‡serveré¦–éƒ¨</a></li>
                <li>
                    <a href="#root-%e4%b8%8e-alias" aria-label="root ä¸ alias">root ä¸ alias</a></li>
                <li>
                    <a href="#location-%e7%9a%84%e8%af%a6%e7%bb%86%e4%bd%bf%e7%94%a8" aria-label="location çš„è¯¦ç»†ä½¿ç”¨">location çš„è¯¦ç»†ä½¿ç”¨</a></li>
                <li>
                    <a href="#nginx-%e5%9b%9b%e5%b1%82%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6" aria-label="Nginx å››å±‚è®¿é—®æ§åˆ¶">Nginx å››å±‚è®¿é—®æ§åˆ¶</a></li>
                <li>
                    <a href="#nginx-%e8%b4%a6%e6%88%b7%e8%ae%a4%e8%af%81%e5%8a%9f%e8%83%bd" aria-label="Nginx è´¦æˆ·è®¤è¯åŠŸèƒ½">Nginx è´¦æˆ·è®¤è¯åŠŸèƒ½</a></li>
                <li>
                    <a href="#%e6%a3%80%e6%b5%8b%e6%96%87%e4%bb%b6%e6%98%af%e5%90%a6%e5%ad%98%e5%9c%a8" aria-label="æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨">æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨</a></li>
                <li>
                    <a href="#%e9%95%bf%e8%bf%9e%e6%8e%a5%e9%85%8d%e7%bd%ae" aria-label="é•¿è¿æ¥é…ç½®">é•¿è¿æ¥é…ç½®</a></li>
                <li>
                    <a href="#%e4%bd%9c%e4%b8%ba%e4%b8%8b%e8%bd%bd%e6%9c%8d%e5%8a%a1%e5%99%a8%e9%85%8d%e7%bd%ae" aria-label="ä½œä¸ºä¸‹è½½æœåŠ¡å™¨é…ç½®">ä½œä¸ºä¸‹è½½æœåŠ¡å™¨é…ç½®</a></li>
                <li>
                    <a href="#%e5%85%b6%e4%bb%96%e9%85%8d%e7%bd%ae" aria-label="å…¶ä»–é…ç½®">å…¶ä»–é…ç½®</a>
                </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h2 id="nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶">Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶">#</a></h2>
<h2 id="é…ç½®æ–‡ä»¶è¯´æ˜">é…ç½®æ–‡ä»¶è¯´æ˜<a hidden class="anchor" aria-hidden="true" href="#é…ç½®æ–‡ä»¶è¯´æ˜">#</a></h2>
<p>nginxå®˜ç½‘æ–‡æ¡£è¯´æ˜</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>http://nginx.org/en/docs/
</span></span></code></pre></div><p>tengineå¸®åŠ©æ–‡æ¡£</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>http://tengine.taobao.org/nginx_docs/cn/docs
</span></span></code></pre></div><p>Nginxçš„é…ç½®æ–‡ä»¶çš„ç»„æˆéƒ¨åˆ†</p>
<p>ä¸»é…ç½®æ–‡ä»¶ï¼šnginx.conf</p>
<p>å­é…ç½®æ–‡ä»¶: include conf.d/*.conf</p>
<p>fastcgiï¼Œ uwsgiï¼Œscgi ç­‰åè®®ç›¸å…³çš„é…ç½®æ–‡ä»¶ mime.typesï¼šæ”¯æŒçš„mimeç±»å‹ï¼ŒMIME(Multipurpose Internet Mail Extensions)å¤šç”¨é€”äº’è”ç½‘é‚® ä»¶æ‰©å±•ç±»å‹ï¼ŒMIMEæ¶ˆæ¯èƒ½åŒ…å«æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ä»¥åŠå…¶ä»–åº”ç”¨ç¨‹åºä¸“ç”¨çš„æ•°æ®ï¼Œæ˜¯è®¾å®šæŸ ç§æ‰©å±•åçš„æ–‡ä»¶ç”¨ä¸€ç§åº”ç”¨ç¨‹åºæ¥æ‰“å¼€çš„æ–¹å¼ç±»å‹ï¼Œå½“è¯¥æ‰©å±•åæ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ ä½¿ç”¨æŒ‡å®šåº”ç”¨ç¨‹åºæ¥æ‰“å¼€ã€‚å¤šç”¨äºæŒ‡å®šä¸€äº›å®¢æˆ·ç«¯è‡ªå®šä¹‰çš„æ–‡ä»¶åï¼Œä»¥åŠä¸€äº›åª’ä½“æ–‡ä»¶æ‰“å¼€æ–¹å¼ã€‚ MIMEå‚è€ƒæ–‡æ¡£ï¼š
<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME">å‚è€ƒæ–‡æ¡£</a></p>
<p>nginx é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>é…ç½®æ–‡ä»¶ç”±æŒ‡ä»¤ä¸æŒ‡ä»¤å—æ„æˆ
</span></span><span style="display:flex;"><span>æ¯æ¡æŒ‡ä»¤ä»¥;åˆ†å·ç»“å°¾ï¼ŒæŒ‡ä»¤ä¸å€¼ä¹‹é—´ä»¥ç©ºæ ¼ç¬¦å·åˆ†éš”
</span></span><span style="display:flex;"><span>å¯ä»¥å°†å¤šæ¡æŒ‡ä»¤æ”¾åœ¨åŒä¸€è¡Œ,ç”¨åˆ†å·åˆ†éš”å³å¯,ä½†å¯è¯»æ€§å·®,ä¸æ¨è
</span></span><span style="display:flex;"><span>æŒ‡ä»¤å—ä»¥{ }å¤§æ‹¬å·å°†å¤šæ¡æŒ‡ä»¤ç»„ç»‡åœ¨ä¸€èµ·,ä¸”å¯ä»¥åµŒå¥—æŒ‡ä»¤å—
</span></span><span style="display:flex;"><span>includeè¯­å¥å…è®¸ç»„åˆå¤šä¸ªé…ç½®æ–‡ä»¶ä»¥æå‡å¯ç»´æŠ¤æ€§
</span></span><span style="display:flex;"><span>ä½¿ç”¨#ç¬¦å·æ·»åŠ æ³¨é‡Šï¼Œæé«˜å¯è¯»æ€§
</span></span><span style="display:flex;"><span>ä½¿ç”¨$ç¬¦å·ä½¿ç”¨å˜é‡
</span></span><span style="display:flex;"><span>éƒ¨åˆ†æŒ‡ä»¤çš„å‚æ•°æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼
</span></span></code></pre></div><p>Nginxä¸»é…ç½®æ–‡ä»¶çš„é…ç½®æŒ‡ä»¤æ–¹å¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>directive value [value2 ...];
</span></span><span style="display:flex;"><span>æ³¨æ„
</span></span><span style="display:flex;"><span>(1) æŒ‡ä»¤å¿…é¡»ä»¥åˆ†å·ç»“å°¾
</span></span><span style="display:flex;"><span>(2) æ”¯æŒä½¿ç”¨é…ç½®å˜é‡
</span></span><span style="display:flex;"><span> å†…å»ºå˜é‡ï¼šç”±Nginxæ¨¡å—å¼•å…¥ï¼Œå¯ç›´æ¥å¼•ç”¨
</span></span><span style="display:flex;"><span> è‡ªå®šä¹‰å˜é‡ï¼šç”±ç”¨æˆ·ä½¿ç”¨setå‘½ä»¤å®šä¹‰,æ ¼å¼: set variable_name value;
</span></span><span style="display:flex;"><span> å¼•ç”¨å˜é‡ï¼š$variable_name
</span></span></code></pre></div><p>ä¸»é…ç½®æ–‡ä»¶ç»“æ„ï¼šå››éƒ¨åˆ†</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>main blockï¼šä¸»é…ç½®æ®µï¼Œå³å…¨å±€é…ç½®æ®µï¼Œå¯¹http,mailéƒ½æœ‰æ•ˆ
</span></span><span style="display:flex;"><span>#äº‹ä»¶é©±åŠ¨ç›¸å…³çš„é…ç½®
</span></span><span style="display:flex;"><span>event {
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span>}  
</span></span><span style="display:flex;"><span>#http/https åè®®ç›¸å…³é…ç½®æ®µ
</span></span><span style="display:flex;"><span>http {
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span>}          
</span></span><span style="display:flex;"><span>#é»˜è®¤é…ç½®æ–‡ä»¶ä¸åŒ…æ‹¬ä¸‹é¢ä¸¤ä¸ªå—
</span></span><span style="display:flex;"><span>#mail åè®®ç›¸å…³é…ç½®æ®µ
</span></span><span style="display:flex;"><span>mail {
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span>}    
</span></span><span style="display:flex;"><span>#stream æœåŠ¡å™¨ç›¸å…³é…ç½®æ®µ
</span></span><span style="display:flex;"><span>stream {
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span>} 
</span></span></code></pre></div><p>é»˜è®¤çš„nginx.confé…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#å…¨å±€é…ç½®ç«¯ï¼Œå¯¹å…¨å±€ç”Ÿæ•ˆï¼Œä¸»è¦è®¾ç½®nginxçš„å¯åŠ¨ç”¨æˆ·/ç»„ï¼Œå¯åŠ¨çš„å·¥ä½œè¿›ç¨‹æ•°é‡ï¼Œå·¥ä½œæ¨¡å¼ï¼ŒNginxçš„PID
</span></span><span style="display:flex;"><span>è·¯å¾„ï¼Œæ—¥å¿—è·¯å¾„ç­‰ã€‚
</span></span><span style="display:flex;"><span>user nginx nginx;
</span></span><span style="display:flex;"><span>worker_processes  1;   #å¯åŠ¨å·¥ä½œè¿›ç¨‹æ•°æ•°é‡
</span></span><span style="display:flex;"><span>events { #eventsè®¾ç½®å¿«ï¼Œä¸»è¦å½±å“nginxæœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼Œæ¯”å¦‚æ˜¯å¦å…è®¸åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿
</span></span><span style="display:flex;"><span>æ¥ï¼Œä½¿ç”¨å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹å¤„ç†è¯·æ±‚ï¼Œæ¯ä¸ªå·¥ä½œè¿›ç¨‹å¯ä»¥åŒæ—¶æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ï¼Œæ˜¯å¦å¼€å¯å¯¹å¤šå·¥ä½œè¿›ç¨‹ä¸‹çš„
</span></span><span style="display:flex;"><span>ç½‘ç»œè¿æ¥è¿›è¡Œåºåˆ—åŒ–ç­‰ã€‚
</span></span><span style="display:flex;"><span>     worker_connections  1024;   #è®¾ç½®å•ä¸ªnginxå·¥ä½œè¿›ç¨‹å¯ä»¥æ¥å—çš„æœ€å¤§å¹¶å‘ï¼Œä½œä¸ºwebæœåŠ¡å™¨
</span></span><span style="display:flex;"><span>çš„æ—¶å€™æœ€å¤§å¹¶å‘æ•°ä¸ºworker_connections * worker_processesï¼Œä½œä¸ºåå‘ä»£ç†çš„æ—¶å€™ä¸º
</span></span><span style="display:flex;"><span>(worker_connections * worker_processes)/2
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>http { #httpå—æ˜¯NginxæœåŠ¡å™¨é…ç½®ä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œç¼“å­˜ã€ä»£ç†å’Œæ—¥å¿—æ ¼å¼å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡
</span></span><span style="display:flex;"><span>å—éƒ½å¯ä»¥åœ¨è¿™è®¾ç½®ï¼Œhttpå—å¯ä»¥åŒ…å«å¤šä¸ªserverå—ï¼Œè€Œä¸€ä¸ªserverå—ä¸­åˆå¯ä»¥åŒ…å«å¤šä¸ªlocationå—ï¼Œ
</span></span><span style="display:flex;"><span>serverå—å¯ä»¥é…ç½®æ–‡ä»¶å¼•å…¥ã€MIME-Typeå®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€æ˜¯å¦å¯ç”¨sendfileã€è¿æ¥è¶…æ—¶æ—¶é—´å’Œå•ä¸ªé“¾
</span></span><span style="display:flex;"><span>æ¥çš„è¯·æ±‚ä¸Šé™ç­‰ã€‚
</span></span><span style="display:flex;"><span>   include       mime.types;
</span></span><span style="display:flex;"><span>   default_type application/octet-stream;
</span></span><span style="display:flex;"><span>   sendfile       on; #ä½œä¸ºwebæœåŠ¡å™¨çš„æ—¶å€™æ‰“å¼€sendfileåŠ å¿«é™æ€æ–‡ä»¶ä¼ è¾“ï¼ŒæŒ‡å®šæ˜¯å¦ä½¿ç”¨
</span></span><span style="display:flex;"><span>sendfileç³»ç»Ÿè°ƒç”¨æ¥ä¼ è¾“æ–‡ä»¶,sendfileç³»ç»Ÿè°ƒç”¨åœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´ç›´æ¥ä¼ é€’æ•°æ®(å®Œå…¨åœ¨å†…æ ¸ä¸­æ“
</span></span><span style="display:flex;"><span>ä½œ)ï¼Œä»è€Œé¿å…äº†æ•°æ®åœ¨å†…æ ¸ç¼“å†²åŒºå’Œç”¨æˆ·ç¼“å†²åŒºä¹‹é—´çš„æ‹·è´ï¼Œæ“ä½œæ•ˆç‡å¾ˆé«˜ï¼Œè¢«ç§°ä¹‹ä¸ºé›¶æ‹·è´ï¼Œç¡¬ç›˜ &gt;&gt;
</span></span><span style="display:flex;"><span>kernel buffer (å¿«é€Ÿæ‹·è´åˆ°kernelsocket buffer) &gt;&gt;åè®®æ ˆã€‚
</span></span><span style="display:flex;"><span>   keepalive_timeout  65;  #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’
</span></span><span style="display:flex;"><span>   server { #è®¾ç½®ä¸€ä¸ªè™šæ‹Ÿæœºä¸»æœºï¼Œå¯ä»¥åŒ…å«è‡ªå·±çš„å…¨å±€å¿«ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ªlocationæ¨¡å—ã€‚æ¯”å¦‚
</span></span><span style="display:flex;"><span>æœ¬è™šæ‹Ÿæœºç›‘å¬çš„ç«¯å£ã€æœ¬è™šæ‹Ÿæœºçš„åç§°å’ŒIPé…ç½®ï¼Œå¤šä¸ªserver å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç«¯å£ï¼Œæ¯”å¦‚éƒ½ä½¿ç”¨80ç«¯å£æä¾›
</span></span><span style="display:flex;"><span>webæœåŠ¡ã€
</span></span><span style="display:flex;"><span>       listen       80;  #é…ç½®serverç›‘å¬çš„ç«¯å£
</span></span><span style="display:flex;"><span>       server_name localhost; #æœ¬serverçš„åç§°ï¼Œå½“è®¿é—®æ­¤åç§°çš„æ—¶å€™nginxä¼šè°ƒç”¨å½“å‰
</span></span><span style="display:flex;"><span>serevrå†…éƒ¨çš„é…ç½®è¿›ç¨‹åŒ¹é…ã€‚
</span></span><span style="display:flex;"><span>       location / { #locationå…¶å®æ˜¯serverçš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œä¸ºnginxæœåŠ¡å™¨æä¾›æ¯”è¾ƒå¤šè€Œä¸”çµæ´»çš„æŒ‡
</span></span><span style="display:flex;"><span>ä»¤ï¼Œéƒ½æ˜¯åœ¨locationä¸­ä½“ç°çš„ï¼Œä¸»è¦æ˜¯åŸºäºnginxæ¥å—åˆ°çš„è¯·æ±‚å­—ç¬¦ä¸²ï¼Œå¯¹ç”¨æˆ·è¯·æ±‚çš„UILè¿›è¡ŒåŒ¹é…ï¼Œå¹¶å¯¹ç‰¹
</span></span><span style="display:flex;"><span>å®šçš„æŒ‡ä»¤è¿›è¡Œå¤„ç†ï¼ŒåŒ…æ‹¬åœ°å€é‡å®šå‘ã€æ•°æ®ç¼“å­˜å’Œåº”ç­”æ§åˆ¶ç­‰åŠŸèƒ½éƒ½æ˜¯åœ¨è¿™éƒ¨åˆ†å®ç°ï¼Œå¦å¤–å¾ˆå¤šç¬¬ä¸‰æ–¹æ¨¡å—çš„
</span></span><span style="display:flex;"><span>é…ç½®ä¹Ÿæ˜¯åœ¨locationæ¨¡å—ä¸­é…ç½®ã€‚
</span></span><span style="display:flex;"><span>           root   html; #ç›¸å½“äºé»˜è®¤é¡µé¢çš„ç›®å½•åç§°ï¼Œé»˜è®¤æ˜¯å®‰è£…ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨ç»å¯¹è·¯
</span></span><span style="display:flex;"><span>å¾„é…ç½®ã€‚
</span></span><span style="display:flex;"><span>           index index.html index.htm; #é»˜è®¤çš„é¡µé¢æ–‡ä»¶åç§°
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>       error_page   500 502 503 504 /50x.html; #é”™è¯¯é¡µé¢çš„æ–‡ä»¶åç§°
</span></span><span style="display:flex;"><span>       location = /50x.html { #locationå¤„ç†å¯¹åº”çš„ä¸åŒé”™è¯¯ç çš„é¡µé¢å®šä¹‰åˆ°/50x.htmlï¼Œè¿™ä¸ª
</span></span><span style="display:flex;"><span>è·Ÿå¯¹åº”å…¶serverä¸­å®šä¹‰çš„ç›®å½•ä¸‹ã€‚
</span></span><span style="display:flex;"><span>           root   html;  #å®šä¹‰é»˜è®¤é¡µé¢æ‰€åœ¨çš„ç›®å½•
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>#å’Œé‚®ä»¶ç›¸å…³çš„é…ç½®
</span></span><span style="display:flex;"><span>#mail {
</span></span><span style="display:flex;"><span>#               ...
</span></span><span style="display:flex;"><span>#       }         mail åè®®ç›¸å…³é…ç½®æ®µ
</span></span><span style="display:flex;"><span>#tcpä»£ç†é…ç½®ï¼Œ1.9ç‰ˆæœ¬ä»¥ä¸Šæ”¯æŒ
</span></span><span style="display:flex;"><span>#stream {
</span></span><span style="display:flex;"><span>#               ...
</span></span><span style="display:flex;"><span>#       }       stream æœåŠ¡å™¨ç›¸å…³é…ç½®æ®µ
</span></span><span style="display:flex;"><span>#å¯¼å…¥å…¶ä»–è·¯å¾„çš„é…ç½®æ–‡ä»¶
</span></span><span style="display:flex;"><span>#include /apps/nginx/conf.d/*.conf
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="å…¨å±€é…ç½®">å…¨å±€é…ç½®<a hidden class="anchor" aria-hidden="true" href="#å…¨å±€é…ç½®">#</a></h2>
<p>Main å…¨å±€é…ç½®æ®µå¸¸è§çš„é…ç½®æŒ‡ä»¤åˆ†ç±»</p>
<ul>
<li>æ­£å¸¸è¿è¡Œå¿…å¤‡çš„é…ç½®</li>
<li>ä¼˜åŒ–æ€§èƒ½ç›¸å…³çš„é…ç½®</li>
<li>ç”¨äºè°ƒè¯•åŠå®šä½é—®é¢˜ç›¸å…³çš„é…ç½®</li>
<li>äº‹ä»¶é©±åŠ¨ç›¸å…³çš„é…ç½®</li>
</ul>
<p>å…¨å±€é…ç½®è¯´æ˜:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>user nginx nginx; #å¯åŠ¨Nginxå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·å’Œç»„
</span></span><span style="display:flex;"><span>worker_processes [number | auto]; #å¯åŠ¨Nginxå·¥ä½œè¿›ç¨‹çš„æ•°é‡,ä¸€èˆ¬è®¾ä¸ºå’ŒCPUæ ¸å¿ƒæ•°ç›¸åŒ
</span></span><span style="display:flex;"><span>worker_cpu_affinity 00000001 00000010 00000100 00001000 | auto ; #å°†Nginxå·¥ä½œè¿›ç¨‹ç»‘
</span></span><span style="display:flex;"><span>å®šåˆ°æŒ‡å®šçš„CPUæ ¸å¿ƒï¼Œé»˜è®¤Nginxæ˜¯ä¸è¿›è¡Œè¿›ç¨‹ç»‘å®šçš„ï¼Œç»‘å®šå¹¶ä¸æ˜¯æ„å‘³ç€å½“å‰nginxè¿›ç¨‹ç‹¬å ä»¥ä¸€æ ¸å¿ƒCPUï¼Œ
</span></span><span style="display:flex;"><span>ä½†æ˜¯å¯ä»¥ä¿è¯æ­¤è¿›ç¨‹ä¸ä¼šè¿è¡Œåœ¨å…¶ä»–æ ¸å¿ƒä¸Šï¼Œè¿™å°±æå¤§å‡å°‘äº†nginxçš„å·¥ä½œè¿›ç¨‹åœ¨ä¸åŒçš„cpuæ ¸å¿ƒä¸Šçš„æ¥å›è·³
</span></span><span style="display:flex;"><span>è½¬ï¼Œå‡å°‘äº†CPUå¯¹è¿›ç¨‹çš„èµ„æºåˆ†é…ä¸å›æ”¶ä»¥åŠå†…å­˜ç®¡ç†ç­‰ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆçš„æå‡nginxæœåŠ¡å™¨çš„æ€§èƒ½ã€‚
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CPU MASK: 00000001ï¼š0å·CPU
</span></span><span style="display:flex;"><span>          00000010ï¼š1å·CPU
</span></span><span style="display:flex;"><span>  10000000ï¼š7å·CPU
</span></span><span style="display:flex;"><span>#ç¤ºä¾‹:
</span></span><span style="display:flex;"><span>worker_cpu_affinity 0001 0010 0100 1000;ç¬¬0å·---ç¬¬3å·CPU
</span></span><span style="display:flex;"><span>worker_cpu_affinity 0101 1010;
</span></span><span style="display:flex;"><span>#ç¤ºä¾‹
</span></span><span style="display:flex;"><span>worker_processes  4;
</span></span><span style="display:flex;"><span>worker_cpu_affinity 00000010 00001000 00100000 10000000;
</span></span><span style="display:flex;"><span>[root@centos8 ~]# ps axo pid,cmd,psr | grep nginx
</span></span><span style="display:flex;"><span>31093 nginx: master process /apps   1
</span></span><span style="display:flex;"><span>34474 nginx: worker process         1
</span></span><span style="display:flex;"><span>34475 nginx: worker process         3
</span></span><span style="display:flex;"><span>34476 nginx: worker process         5
</span></span><span style="display:flex;"><span>34477 nginx: worker process         7
</span></span><span style="display:flex;"><span>35751 grep nginx
</span></span><span style="display:flex;"><span>#auto ç»‘å®šCPU
</span></span><span style="display:flex;"><span>#The special value auto (1.9.10) allows binding worker processes automatically to
</span></span><span style="display:flex;"><span>available CPUs:
</span></span><span style="display:flex;"><span>worker_processes auto;
</span></span><span style="display:flex;"><span>worker_cpu_affinity auto;
</span></span><span style="display:flex;"><span>#The optional mask parameter can be used to limit the CPUs available for
</span></span><span style="display:flex;"><span>automatic binding:
</span></span><span style="display:flex;"><span>worker_cpu_affinity auto 01010101;
</span></span><span style="display:flex;"><span>#é”™è¯¯æ—¥å¿—è®°å½•é…ç½®ï¼Œè¯­æ³•ï¼šerror_log file [debug | info | notice | warn | error | crit
</span></span><span style="display:flex;"><span>| alert | emerg]
</span></span><span style="display:flex;"><span>#error_log logs/error.log;
</span></span><span style="display:flex;"><span>#error_log logs/error.log notice;
</span></span><span style="display:flex;"><span>error_log /usr/local/src/nginx/logs/error.log error;
</span></span><span style="display:flex;"><span>#pidæ–‡ä»¶ä¿å­˜è·¯å¾„
</span></span><span style="display:flex;"><span>pid       /usr/local/src/nginx/logs/nginx.pid;
</span></span><span style="display:flex;"><span>worker_priority 0; #å·¥ä½œè¿›ç¨‹ä¼˜å…ˆçº§ï¼Œ-20~20(19)
</span></span><span style="display:flex;"><span>worker_rlimit_nofile 65536; #æ‰€æœ‰workerè¿›ç¨‹èƒ½æ‰“å¼€çš„æ–‡ä»¶æ•°é‡ä¸Šé™,åŒ…æ‹¬:Nginxçš„æ‰€æœ‰è¿æ¥ï¼ˆä¾‹
</span></span><span style="display:flex;"><span>å¦‚ä¸ä»£ç†æœåŠ¡å™¨çš„è¿æ¥ç­‰ï¼‰ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸å®¢æˆ·ç«¯çš„è¿æ¥,å¦ä¸€ä¸ªè€ƒè™‘å› ç´ æ˜¯å®é™…çš„å¹¶å‘è¿æ¥æ•°ä¸èƒ½è¶…è¿‡ç³»ç»Ÿçº§
</span></span><span style="display:flex;"><span>åˆ«çš„æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°çš„é™åˆ¶.æœ€å¥½ä¸ulimit -n æˆ–è€…limits.confçš„å€¼ä¿æŒä¸€è‡´,
</span></span><span style="display:flex;"><span>daemon off;  #å‰å°è¿è¡ŒNginxæœåŠ¡ç”¨äºæµ‹è¯•ã€æˆ–è€…ä»¥å®¹å™¨è¿è¡Œæ—¶ï¼Œéœ€è¦è®¾ä¸ºoff
</span></span><span style="display:flex;"><span>master_process off|on; #æ˜¯å¦å¼€å¯Nginxçš„master-workerå·¥ä½œæ¨¡å¼ï¼Œä»…ç”¨äºå¼€å‘è°ƒè¯•åœºæ™¯,é»˜è®¤ä¸º
</span></span><span style="display:flex;"><span>on
</span></span><span style="display:flex;"><span>events {
</span></span><span style="display:flex;"><span>   worker_connections  65536;  #è®¾ç½®å•ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°
</span></span><span style="display:flex;"><span>   use epoll; #ä½¿ç”¨epolläº‹ä»¶é©±åŠ¨ï¼ŒNginxæ”¯æŒä¼—å¤šçš„äº‹ä»¶é©±åŠ¨ï¼Œæ¯”å¦‚:selectã€pollã€epollï¼Œåª
</span></span><span style="display:flex;"><span>èƒ½è®¾ç½®åœ¨eventsæ¨¡å—ä¸­è®¾ç½®ã€‚
</span></span><span style="display:flex;"><span>   accept_mutex on; #onä¸ºåŒä¸€æ—¶åˆ»ä¸€ä¸ªè¯·æ±‚è½®æµç”±workerè¿›ç¨‹å¤„ç†,è€Œé˜²æ­¢è¢«åŒæ—¶å”¤é†’æ‰€æœ‰
</span></span><span style="display:flex;"><span>worker,é¿å…å¤šä¸ªç¡çœ è¿›ç¨‹è¢«å”¤é†’çš„è®¾ç½®ï¼Œé»˜è®¤ä¸ºoffï¼Œæ–°è¯·æ±‚ä¼šå”¤é†’æ‰€æœ‰workerè¿›ç¨‹,æ­¤è¿‡ç¨‹ä¹Ÿç§°ä¸º&#34;æƒŠ
</span></span><span style="display:flex;"><span>ç¾¤&#34;ï¼Œå› æ­¤nginxåˆšå®‰è£…å®Œä»¥åè¦è¿›è¡Œé€‚å½“çš„ä¼˜åŒ–ã€‚å»ºè®®è®¾ç½®ä¸ºon
</span></span><span style="display:flex;"><span>   multi_accept on; #onæ—¶NginxæœåŠ¡å™¨çš„æ¯ä¸ªå·¥ä½œè¿›ç¨‹å¯ä»¥åŒæ—¶æ¥å—å¤šä¸ªæ–°çš„ç½‘ç»œè¿æ¥ï¼Œæ­¤æŒ‡ä»¤é»˜è®¤
</span></span><span style="display:flex;"><span>ä¸ºoffï¼Œå³é»˜è®¤ä¸ºä¸€ä¸ªå·¥ä½œè¿›ç¨‹åªèƒ½ä¸€æ¬¡æ¥å—ä¸€ä¸ªæ–°çš„ç½‘ç»œè¿æ¥ï¼Œæ‰“å¼€åå‡ ä¸ªåŒæ—¶æ¥å—å¤šä¸ªã€‚å»ºè®®è®¾ç½®ä¸ºon
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šå®ç°nginxé«˜å¹¶å‘é…ç½®</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7 ~]#ulimit -n 102400
</span></span><span style="display:flex;"><span>[root@centos7 ~]#while true;do ab -c 5000 -n 10000 http://10.0.0.8/;sleep
</span></span><span style="display:flex;"><span>0.5;done
</span></span><span style="display:flex;"><span>#é»˜è®¤é…ç½®ä¸æ”¯æŒé«˜å¹¶å‘,ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯æ—¥å¿—
</span></span><span style="display:flex;"><span>[root@centos8 conf]#tail /usr/local/src/nginx/logs/error.log
</span></span><span style="display:flex;"><span>2020/09/24 21:19:33 [crit] 41006#0: *1105860 open() &#34;/apps/nginx/html/50x.html&#34;
</span></span><span style="display:flex;"><span>failed (24: Too many open files), client: 10.0.0.7, server: localhost, request:
</span></span><span style="display:flex;"><span>&#34;GET / HTTP/1.0&#34;, host: &#34;10.0.0.8&#34;
</span></span><span style="display:flex;"><span>2020/09/24 21:19:33 [crit] 41006#0: accept4() failed (24: Too many open files)
</span></span><span style="display:flex;"><span>2020/09/24 21:19:33 [crit] 41006#0: *1114177 open()
</span></span><span style="display:flex;"><span>&#34;/apps/nginx/html/index.html&#34; failed (24: Too many open files), client: 10.0.0.7,
</span></span><span style="display:flex;"><span>server: localhost, request: &#34;GET / HTTP/1.0&#34;, host: &#34;10.0.0.8&#34;
</span></span><span style="display:flex;"><span>#å¦‚æœsystemdå¯åŠ¨,åˆ™éœ€è¦ä¿®æ”¹nginx.serviceæ–‡ä»¶ä¸­åŠ LimitNOFILE=100000,æ‰èƒ½æœ‰æ•ˆ
</span></span><span style="display:flex;"><span>#å¦‚æœésystemdå¯åŠ¨,å¯ä»¥ä¿®æ”¹ä¸‹é¢pamé™åˆ¶
</span></span><span style="display:flex;"><span>[root@centos8 ~]#vim /etc/security/limits.conf
</span></span><span style="display:flex;"><span>*               soft   nofile          1000000
</span></span><span style="display:flex;"><span>*               hard   nofile          1000000
</span></span><span style="display:flex;"><span>[root@centos8 ~]#vim /apps/nginx/conf/nginx.conf
</span></span><span style="display:flex;"><span>worker_rlimit_nofile 100000;
</span></span><span style="display:flex;"><span>[root@centos8 ~]#systemctl restart nginx
</span></span><span style="display:flex;"><span>[root@centos8 ~]# watch -n1 &#39;ps -axo pid,cmd,nice | grep nginx #éªŒè¯è¿›ç¨‹ä¼˜å…ˆçº§
</span></span></code></pre></div><h2 id="httpé…ç½®å—">httpé…ç½®å—<a hidden class="anchor" aria-hidden="true" href="#httpé…ç½®å—">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>http {
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span> ...  #å„serverçš„å…¬å…±é…ç½®
</span></span><span style="display:flex;"><span> server {    #æ¯ä¸ªserverç”¨äºå®šä¹‰ä¸€ä¸ªè™šæ‹Ÿä¸»æœº,ç¬¬ä¸€ä¸ªserverä¸ºé»˜è®¤è™šæ‹ŸæœåŠ¡å™¨
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span> server {    
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span> server_name   #è™šæ‹Ÿä¸»æœºå
</span></span><span style="display:flex;"><span> root     #ä¸»ç›®å½•
</span></span><span style="display:flex;"><span> alias     #è·¯å¾„åˆ«å
</span></span><span style="display:flex;"><span> location [OPERATOR] URL {     #æŒ‡å®šURLçš„ç‰¹æ€§
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span> if CONDITION {
</span></span><span style="display:flex;"><span> ...
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>httpé…ç½®åè®®è¯´æ˜</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>http {
</span></span><span style="display:flex;"><span>   include       mime.types; #å¯¼å…¥æ”¯æŒçš„æ–‡ä»¶ç±»å‹,æ˜¯ç›¸å¯¹äº/usr/local/src/nginx/confçš„ç›®å½•
</span></span><span style="display:flex;"><span>   default_type application/octet-stream; #é™¤mime.typesä¸­æ–‡ä»¶ç±»å‹å¤–,è®¾ç½®å…¶å®ƒæ–‡ä»¶é»˜è®¤
</span></span><span style="display:flex;"><span>ç±»å‹ï¼Œè®¿é—®å…¶å®ƒç±»å‹æ—¶ä¼šæç¤ºä¸‹è½½ä¸åŒ¹é…çš„ç±»å‹æ–‡ä»¶
</span></span><span style="display:flex;"><span>#æ—¥å¿—é…ç½®éƒ¨åˆ†
</span></span><span style="display:flex;"><span>    #log_format main &#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39;
</span></span><span style="display:flex;"><span>    #                 &#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39;
</span></span><span style="display:flex;"><span>    #                 &#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;;
</span></span><span style="display:flex;"><span>    #access_log logs/access.log main;
</span></span><span style="display:flex;"><span>#è‡ªå®šä¹‰ä¼˜åŒ–å‚æ•°
</span></span><span style="display:flex;"><span>   sendfile       on;
</span></span><span style="display:flex;"><span>    #tcp_nopush     on; #åœ¨å¼€å¯äº†sendfileçš„æƒ…å†µä¸‹ï¼Œåˆå¹¶è¯·æ±‚åç»Ÿä¸€å‘é€ç»™å®¢æˆ·ç«¯,å¿…é¡»å¼€å¯
</span></span><span style="display:flex;"><span>sendfile
</span></span><span style="display:flex;"><span>    #tcp_nodelay   off; #åœ¨å¼€å¯äº†keepalivedæ¨¡å¼ä¸‹çš„è¿æ¥æ˜¯å¦å¯ç”¨TCP_NODELAYé€‰é¡¹ï¼Œå½“ä¸º
</span></span><span style="display:flex;"><span>offæ—¶ï¼Œå»¶è¿Ÿ0.2så‘é€ï¼Œé»˜è®¤Onæ—¶ï¼Œä¸å»¶è¿Ÿå‘é€ï¼Œç«‹å³å‘é€ç”¨æˆ·å“åº”æŠ¥æ–‡ã€‚
</span></span><span style="display:flex;"><span>    #keepalive_timeout 0;
</span></span><span style="display:flex;"><span>   keepalive_timeout  65 65; #è®¾ç½®ä¼šè¯ä¿æŒæ—¶é—´,ç¬¬äºŒä¸ªå€¼ä¸ºå“åº”é¦–éƒ¨:keepAlived:timeout=65,å¯ä»¥å’Œç¬¬ä¸€ä¸ªå€¼ä¸åŒ
</span></span><span style="display:flex;"><span>    #gzip on; #å¼€å¯æ–‡ä»¶å‹ç¼©
</span></span><span style="display:flex;"><span>   server {
</span></span><span style="display:flex;"><span>       listen       80; #è®¾ç½®ç›‘å¬åœ°å€å’Œç«¯å£
</span></span><span style="display:flex;"><span>       server_name localhost; #è®¾ç½®server nameï¼Œå¯ä»¥ä»¥ç©ºæ ¼éš”å¼€å†™å¤šä¸ªå¹¶æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œ
</span></span><span style="display:flex;"><span>å¦‚:*.magedu.com www.magedu.* ~^www\d+\.magedu\.com$ default_server
</span></span><span style="display:flex;"><span>        #charset koi8-r; #è®¾ç½®ç¼–ç æ ¼å¼ï¼Œé»˜è®¤æ˜¯ä¿„è¯­æ ¼å¼ï¼Œå»ºè®®æ”¹ä¸ºutf-8
</span></span><span style="display:flex;"><span>        #access_log logs/host.access.log main;
</span></span><span style="display:flex;"><span>       location / {
</span></span><span style="display:flex;"><span>           root   html;
</span></span><span style="display:flex;"><span>           index index.html index.htm;
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>        #error_page 404             /404.html;
</span></span><span style="display:flex;"><span>        # redirect server error pages to the static page /50x.html
</span></span><span style="display:flex;"><span>        #
</span></span><span style="display:flex;"><span>       error_page   500 502 503 504 /50x.html; #å®šä¹‰é”™è¯¯é¡µé¢
</span></span><span style="display:flex;"><span>       location = /50x.html {
</span></span><span style="display:flex;"><span>           root   html;
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
</span></span><span style="display:flex;"><span>        #
</span></span><span style="display:flex;"><span>        #location ~ \.php$ { #ä»¥httpçš„æ–¹å¼è½¬å‘phpè¯·æ±‚åˆ°æŒ‡å®šwebæœåŠ¡å™¨
</span></span><span style="display:flex;"><span>        #   proxy_pass   http://127.0.0.1;
</span></span><span style="display:flex;"><span>        #}
</span></span><span style="display:flex;"><span>        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
</span></span><span style="display:flex;"><span>        #
</span></span><span style="display:flex;"><span>        #location ~ \.php$ { #ä»¥fastcgiçš„æ–¹å¼è½¬å‘phpè¯·æ±‚åˆ°phpå¤„ç†
</span></span><span style="display:flex;"><span>        #   root           html;
</span></span><span style="display:flex;"><span>        #   fastcgi_pass   127.0.0.1:9000;
</span></span><span style="display:flex;"><span>        #   fastcgi_index index.php;
</span></span><span style="display:flex;"><span>        #   fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name;
</span></span><span style="display:flex;"><span>        #   include       fastcgi_params;
</span></span><span style="display:flex;"><span>        #}
</span></span><span style="display:flex;"><span>         # deny access to .htaccess files, if Apache&#39;s document root
</span></span><span style="display:flex;"><span>        # concurs with nginx&#39;s one
</span></span><span style="display:flex;"><span>        #
</span></span><span style="display:flex;"><span>        #location ~ /\.ht { #æ‹’ç»webå½¢å¼è®¿é—®æŒ‡å®šæ–‡ä»¶ï¼Œå¦‚å¾ˆå¤šçš„ç½‘ç«™éƒ½æ˜¯é€šè¿‡.htaccessæ–‡ä»¶æ¥
</span></span><span style="display:flex;"><span>æ”¹å˜è‡ªå·±çš„é‡å®šå‘ç­‰åŠŸèƒ½ã€‚
</span></span><span style="display:flex;"><span>        #   deny all;
</span></span><span style="display:flex;"><span>        #}
</span></span><span style="display:flex;"><span>       location ~ /passwd.html {
</span></span><span style="display:flex;"><span>           deny all;
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>    # another virtual host using mix of IP-, name-, and port-based configuration
</span></span><span style="display:flex;"><span>    #
</span></span><span style="display:flex;"><span>    #server { #è‡ªå®šä¹‰è™šæ‹Ÿserver
</span></span><span style="display:flex;"><span>    #   listen       8000;
</span></span><span style="display:flex;"><span>    #   listen       somename:8080;
</span></span><span style="display:flex;"><span>    #   server_name somename alias another.alias;
</span></span><span style="display:flex;"><span>    #   location / {
</span></span><span style="display:flex;"><span>    #       root   html;
</span></span><span style="display:flex;"><span>    #       index index.html index.htm; #æŒ‡å®šé»˜è®¤ç½‘é¡µæ–‡ä»¶ï¼Œæ­¤æŒ‡ä»¤ç”±
</span></span><span style="display:flex;"><span>ngx_http_index_moduleæ¨¡å—æä¾›
</span></span><span style="display:flex;"><span>    #   }
</span></span><span style="display:flex;"><span>    #}
</span></span><span style="display:flex;"><span>    # HTTPS server
</span></span><span style="display:flex;"><span>    #
</span></span><span style="display:flex;"><span>    #server { #httpsæœåŠ¡å™¨é…ç½®
</span></span><span style="display:flex;"><span>    #   listen       443 ssl;
</span></span><span style="display:flex;"><span>    #   server_name localhost;
</span></span><span style="display:flex;"><span>    #   ssl_certificate     cert.pem;
</span></span><span style="display:flex;"><span>    #   ssl_certificate_key cert.key;
</span></span><span style="display:flex;"><span>    #   ssl_session_cache   shared:SSL:1m;
</span></span><span style="display:flex;"><span>    #   ssl_session_timeout 5m;
</span></span><span style="display:flex;"><span>    #   ssl_ciphers HIGH:!aNULL:!MD5;
</span></span><span style="display:flex;"><span>    #   ssl_prefer_server_ciphers on;
</span></span><span style="display:flex;"><span>    #   location / {
</span></span><span style="display:flex;"><span>    #       root   html;
</span></span><span style="display:flex;"><span>    #       index index.html index.htm;
</span></span><span style="display:flex;"><span>    #   }
</span></span><span style="display:flex;"><span>    #}
</span></span></code></pre></div><h2 id="mime">MIME<a hidden class="anchor" aria-hidden="true" href="#mime">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#åœ¨å“åº”æŠ¥æ–‡ä¸­å°†æŒ‡å®šçš„æ–‡ä»¶æ‰©å±•åæ˜ å°„è‡³MIMEå¯¹åº”çš„ç±»å‹
</span></span><span style="display:flex;"><span>include           /etc/nginx/mime.types;
</span></span><span style="display:flex;"><span>default_type     application/octet-stream;#é™¤mime.typesä¸­çš„ç±»å‹å¤–ï¼ŒæŒ‡å®šå…¶å®ƒæ–‡ä»¶çš„é»˜è®¤
</span></span><span style="display:flex;"><span>MIMEç±»å‹ï¼Œæµè§ˆå™¨ä¸€èˆ¬ä¼šæç¤ºä¸‹è½½
</span></span><span style="display:flex;"><span>types {
</span></span><span style="display:flex;"><span>   text/html html;
</span></span><span style="display:flex;"><span>   image/gif gif;
</span></span><span style="display:flex;"><span>   image/jpeg jpg;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>#MIMEå‚è€ƒæ–‡æ¡£ï¼š
</span></span><span style="display:flex;"><span>https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šè¯†åˆ«PHPä¸ºtext</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 conf<span style="color:#f92672">]</span><span style="color:#75715e"># vim /usr/local/src/nginx/html/test.php</span>
</span></span><span style="display:flex;"><span>&lt;?php
</span></span><span style="display:flex;"><span>phpinfo<span style="color:#f92672">()</span>;
</span></span><span style="display:flex;"><span>?&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 conf<span style="color:#f92672">]</span><span style="color:#75715e"># vim /usr/local/src/nginx/conf/nginx.conf</span>
</span></span><span style="display:flex;"><span>http <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>   include       mime.types;
</span></span><span style="display:flex;"><span>   default_type text/html; <span style="color:#75715e"># åŠ å…¥æ¬¡è¡Œ</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æˆ–è€…ä¿®æ”¹ä¸ºä¸‹é¢</span>
</span></span><span style="display:flex;"><span>   include       mime.types;
</span></span><span style="display:flex;"><span>   default_type application/octet-stream;
</span></span><span style="display:flex;"><span>   types<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>       text/plain php;  <span style="color:#75715e">#åŠ æ­¤è¡Œ</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span></code></pre></div><h2 id="æŒ‡å®šå“åº”æŠ¥æ–‡serveré¦–éƒ¨">æŒ‡å®šå“åº”æŠ¥æ–‡serveré¦–éƒ¨<a hidden class="anchor" aria-hidden="true" href="#æŒ‡å®šå“åº”æŠ¥æ–‡serveré¦–éƒ¨">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#æ˜¯å¦åœ¨å“åº”æŠ¥æ–‡ä¸­çš„Content-Typeæ˜¾ç¤ºæŒ‡å®šçš„å­—ç¬¦é›†ï¼Œé»˜è®¤offä¸æ˜¾ç¤º
</span></span><span style="display:flex;"><span>charset charset | off;
</span></span><span style="display:flex;"><span>#ç¤ºä¾‹
</span></span><span style="display:flex;"><span>charset utf-8;
</span></span><span style="display:flex;"><span>#æ˜¯å¦åœ¨å“åº”æŠ¥æ–‡çš„Serveré¦–éƒ¨æ˜¾ç¤ºnginxç‰ˆæœ¬
</span></span><span style="display:flex;"><span>server_tokens on | off | build | string;
</span></span></code></pre></div><p>ä¿®æ”¹serverå­—æ®µ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>å¦‚æœæƒ³è‡ªå®šä¹‰å“åº”æŠ¥æ–‡çš„nginxç‰ˆæœ¬ä¿¡æ¯ï¼Œéœ€è¦ä¿®æ”¹æºç æ–‡ä»¶ï¼Œé‡æ–°ç¼–è¯‘
</span></span><span style="display:flex;"><span>å¦‚æœserver_tokens onï¼Œä¿®æ”¹ src/core/nginx.h ä¿®æ”¹ç¬¬13-14è¡Œï¼Œå¦‚ä¸‹ç¤ºä¾‹
</span></span><span style="display:flex;"><span>#define NGINX_VERSION     &#34;1.68.9&#34;
</span></span><span style="display:flex;"><span>#define NGINX_VER         &#34;test/&#34; NGINX_VERSION
</span></span><span style="display:flex;"><span>å¦‚æœserver_tokens offï¼Œä¿®æ”¹ src/http/ngx_http_header_filter_module.c
</span></span><span style="display:flex;"><span>ç¬¬49è¡Œï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š
</span></span><span style="display:flex;"><span>static char ngx_http_server_string[] = &#34;Server: nginx&#34; CRLF;
</span></span><span style="display:flex;"><span>æŠŠå…¶ä¸­çš„nginxæ”¹ä¸ºè‡ªå·±æƒ³è¦çš„æ–‡å­—å³å¯,å¦‚ï¼štest
</span></span></code></pre></div><h2 id="root-ä¸-alias">root ä¸ alias<a hidden class="anchor" aria-hidden="true" href="#root-ä¸-alias">#</a></h2>
<p>rootï¼šæŒ‡å®šwebçš„å®¶ç›®å½•ï¼Œåœ¨å®šä¹‰locationçš„æ—¶å€™ï¼Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ç­‰äº root+location</p>
<p>aliasï¼šå®šä¹‰è·¯å¾„åˆ«åï¼Œä¼šæŠŠè®¿é—®çš„è·¯å¾„é‡æ–°å®šä¹‰åˆ°å…¶æŒ‡å®šçš„è·¯å¾„,æ–‡æ¡£æ˜ å°„çš„å¦ä¸€ç§æœºåˆ¶;ä»…èƒ½ç”¨äº locationä¸Šä¸‹æ–‡,æ­¤æŒ‡ä»¤ä½¿ç”¨è¾ƒå°‘</p>
<p>æ³¨æ„ï¼šlocationä¸­ä½¿ç”¨rootæŒ‡ä»¤å’ŒaliasæŒ‡ä»¤çš„æ„ä¹‰ä¸åŒ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>root ç»™å®šçš„è·¯å¾„å¯¹åº”äºlocationä¸­çš„/uri å·¦ä¾§çš„/
</span></span><span style="display:flex;"><span>alias ç»™å®šçš„è·¯å¾„å¯¹åº”äºlocationä¸­çš„/uri çš„å®Œæ•´è·¯å¾„
</span></span></code></pre></div><h2 id="location-çš„è¯¦ç»†ä½¿ç”¨">location çš„è¯¦ç»†ä½¿ç”¨<a hidden class="anchor" aria-hidden="true" href="#location-çš„è¯¦ç»†ä½¿ç”¨">#</a></h2>
<p>åœ¨ä¸€ä¸ªserverä¸­locationé…ç½®æ®µå¯å­˜åœ¨å¤šä¸ªï¼Œç”¨äºå®ç°ä»uriåˆ°æ–‡ä»¶ç³»ç»Ÿçš„è·¯å¾„æ˜ å°„ï¼›ngnixä¼šæ ¹æ®ç”¨æˆ·è¯· æ±‚çš„URIæ¥æ£€æŸ¥å®šä¹‰çš„æ‰€æœ‰locationï¼ŒæŒ‰ä¸€å®šçš„ä¼˜å…ˆçº§æ‰¾å‡ºä¸€ä¸ªæœ€ä½³åŒ¹é…ï¼Œè€Œååº”ç”¨å…¶é…ç½®</p>
<p>åœ¨æ²¡æœ‰ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„æ—¶å€™ï¼Œnginxä¼šå…ˆåœ¨serverä¸­çš„å¤šä¸ªlocationé€‰å–åŒ¹é…åº¦æœ€é«˜çš„ä¸€ä¸ªuriï¼Œuriæ˜¯ ç”¨æˆ·è¯·æ±‚çš„å­—ç¬¦ä¸²ï¼Œå³åŸŸååé¢çš„webæ–‡ä»¶è·¯å¾„ï¼Œç„¶åä½¿ç”¨è¯¥locationæ¨¡å—ä¸­çš„æ­£åˆ™urlå’Œå­—ç¬¦ä¸²ï¼Œå¦‚æœ åŒ¹é…æˆåŠŸå°±ç»“æŸæœç´¢ï¼Œå¹¶ä½¿ç”¨æ­¤locationå¤„ç†æ­¤è¯·æ±‚ã€‚</p>
<p>location å®˜æ–¹å¸®åŠ©:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>https://nginx.org/en/docs/http/ngx_http_core_module.html#location
</span></span></code></pre></div><p>è¯­æ³•è§„åˆ™</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#è¯­æ³•è§„åˆ™ï¼š
</span></span><span style="display:flex;"><span>location [ = | ~ | ~* | ^~ ] uri { ... }
</span></span><span style="display:flex;"><span>=   #ç”¨äºæ ‡å‡†uriå‰ï¼Œéœ€è¦è¯·æ±‚å­—ä¸²ä¸uriç²¾ç¡®åŒ¹é…ï¼Œå¤§å°æ•æ„Ÿ,å¦‚æœåŒ¹é…æˆåŠŸå°±åœæ­¢å‘ä¸‹åŒ¹é…å¹¶ç«‹å³å¤„ç†è¯·
</span></span><span style="display:flex;"><span>æ±‚
</span></span><span style="display:flex;"><span>^~  #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼,å¹¶ä¸”åŒ¹é…ä»¥æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼å¼€å¤´,å¯¹uriçš„æœ€å·¦è¾¹éƒ¨åˆ†åšåŒ¹é…
</span></span><span style="display:flex;"><span>æ£€æŸ¥ï¼Œä¸åŒºåˆ†å­—ç¬¦å¤§å°å†™
</span></span><span style="display:flex;"><span>~   #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼,å¹¶ä¸”åŒºåˆ†å¤§å°å†™
</span></span><span style="display:flex;"><span>~*  #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼,å¹¶ä¸”ä¸åŒºåˆ†å¤§å†™
</span></span><span style="display:flex;"><span>ä¸å¸¦ç¬¦å· #åŒ¹é…èµ·å§‹äºæ­¤uriçš„æ‰€æœ‰çš„uri
</span></span><span style="display:flex;"><span>\   #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼å¹¶ä¸”è½¬ä¹‰å­—ç¬¦ã€‚å¯ä»¥å°† . * ?ç­‰è½¬ä¹‰ä¸ºæ™®é€šç¬¦å·
</span></span><span style="display:flex;"><span>#åŒ¹é…ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š
</span></span><span style="display:flex;"><span>=, ^~, ~/~*, ä¸å¸¦ç¬¦å·
</span></span></code></pre></div><p>å®˜ç½‘æ¡ˆä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>location = / {
</span></span><span style="display:flex;"><span>   [ configuration A ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>location / {
</span></span><span style="display:flex;"><span>   [ configuration B ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>location /documents/ {
</span></span><span style="display:flex;"><span>   [ configuration C ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>location ^~ /images/ {
</span></span><span style="display:flex;"><span>   [ configuration D ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>location ~* \.(gif|jpg|jpeg)$ {
</span></span><span style="display:flex;"><span>   [ configuration E ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>The â€œ/â€ request will match configuration A(?), the â€œ/index.htmlâ€ request will
</span></span><span style="display:flex;"><span>match configuration B,
</span></span><span style="display:flex;"><span>the â€œ/documents/document.htmlâ€ request will match configuration C, the
</span></span><span style="display:flex;"><span>â€œ/images/1.gifâ€ request will match configuration D, and the â€œ/documents/1.jpgâ€
</span></span><span style="display:flex;"><span>request will match configuration E.
</span></span></code></pre></div><ul>
<li>ç²¾ç¡®åŒ¹é…å›¾ç‰‡</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>server{
</span></span><span style="display:flex;"><span>   listen 80;
</span></span><span style="display:flex;"><span>   server_name localhost;
</span></span><span style="display:flex;"><span>   root /data/web;
</span></span><span style="display:flex;"><span>   index index.html *.html;
</span></span><span style="display:flex;"><span>   location = /test.jpg {
</span></span><span style="display:flex;"><span>     root /data/image;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>åŒ¹é…æ¡ˆä¾‹-æ–‡ä»¶ååç¼€</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>server{
</span></span><span style="display:flex;"><span>   listen 80;
</span></span><span style="display:flex;"><span>   server_name localhost;
</span></span><span style="display:flex;"><span>   root /data/web;
</span></span><span style="display:flex;"><span>   index index.html *.html;
</span></span><span style="display:flex;"><span>   location ~* \.(gif|jpg|jpeg|bmp|png|tiff|tif|ico|wmf|js|css)$ {
</span></span><span style="display:flex;"><span>     root /data/web1;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>åŒ¹é…æ¡ˆä¾‹-ä¼˜å…ˆçº§</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>server{
</span></span><span style="display:flex;"><span>        listen 80;
</span></span><span style="display:flex;"><span>        server_name localhost;
</span></span><span style="display:flex;"><span>        root /data/web;
</span></span><span style="display:flex;"><span>        index index.html *.html;
</span></span><span style="display:flex;"><span>        location = /test2.jpg {
</span></span><span style="display:flex;"><span>          root /data/web2;
</span></span><span style="display:flex;"><span>          index index.html;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>        location ~* \.(gif|jpg|jpeg|bmp|png|tiff|tif|ico|wmf|js|css)$ {
</span></span><span style="display:flex;"><span>          root /data/web1;
</span></span><span style="display:flex;"><span>          index index.html;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>#åŒ¹é…ä¼˜å…ˆçº§ï¼š=, ^~, ï½/ï½*ï¼Œ/
</span></span><span style="display:flex;"><span>locationä¼˜å…ˆçº§ï¼š(location =) &gt; (location ^~ è·¯å¾„) &gt; (location ~,~* æ­£åˆ™é¡ºåº) &gt;
</span></span><span style="display:flex;"><span>(location å®Œæ•´è·¯å¾„) &gt; (location éƒ¨åˆ†èµ·å§‹è·¯å¾„) &gt; (/)
</span></span></code></pre></div><h2 id="nginx-å››å±‚è®¿é—®æ§åˆ¶">Nginx å››å±‚è®¿é—®æ§åˆ¶<a hidden class="anchor" aria-hidden="true" href="#nginx-å››å±‚è®¿é—®æ§åˆ¶">#</a></h2>
<p>è®¿é—®æ§åˆ¶åŸºäºæ¨¡å—ngx_http_access_moduleå®ç°ï¼Œå¯ä»¥é€šè¿‡åŒ¹é…å®¢æˆ·ç«¯æºIPåœ°å€è¿›è¡Œé™åˆ¶ æ³¨æ„: å¦‚æœèƒ½åœ¨é˜²ç«å¢™è®¾å¤‡æ§åˆ¶,æœ€å¥½å°±ä¸è¦åœ¨nginxä¸Šé…ç½®,å¯ä»¥æ›´å¥½çš„èŠ‚çº¦èµ„æº</p>
<p>å®˜æ–¹å¸®åŠ©:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>http://nginx.org/en/docs/http/ngx_http_access_module.html
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>location = /login/ {
</span></span><span style="display:flex;"><span>   root /data/nginx/html/pc;
</span></span><span style="display:flex;"><span>   allow 10.0.0.0/24;
</span></span><span style="display:flex;"><span>   deny all;
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>location /about {
</span></span><span style="display:flex;"><span>   alias /data/nginx/html/pc;
</span></span><span style="display:flex;"><span>   index index.html;  
</span></span><span style="display:flex;"><span>   deny  192.168.1.1;   # ç¦æ­¢è¯¥IPè®¿é—®
</span></span><span style="display:flex;"><span>   allow 192.168.1.0/24;  # å…è®¸è¯¥ç½‘æ®µè®¿é—®
</span></span><span style="display:flex;"><span>   allow 10.1.1.0/16;
</span></span><span style="display:flex;"><span>   allow 2001:0db8::/32;
</span></span><span style="display:flex;"><span>   deny all;  #æŒ‰å…ˆå°èŒƒå›´åˆ°å¤§èŒƒå›´æ’åº
</span></span><span style="display:flex;"><span> }
</span></span></code></pre></div><h2 id="nginx-è´¦æˆ·è®¤è¯åŠŸèƒ½">Nginx è´¦æˆ·è®¤è¯åŠŸèƒ½<a hidden class="anchor" aria-hidden="true" href="#nginx-è´¦æˆ·è®¤è¯åŠŸèƒ½">#</a></h2>
<p>ç”± ngx_http_auth_basic_module æ¨¡å—æä¾›æ­¤åŠŸèƒ½</p>
<p>å®˜æ–¹å¸®åŠ©:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html#auth_basic
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#CentOSå®‰è£…åŒ…
</span></span><span style="display:flex;"><span>[root@centos7 ~]#yum -y install httpd-tools
</span></span><span style="display:flex;"><span>#Ubuntuå®‰è£…åŒ…
</span></span><span style="display:flex;"><span>[root@Ubuntu ~]#apt -y install apache2-utils
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#åˆ›å»ºç”¨æˆ·
</span></span><span style="display:flex;"><span>#-b éäº¤äº’å¼æ–¹å¼æäº¤å¯†ç 
</span></span><span style="display:flex;"><span>[root@centos7 ~]# htpasswd -cb /usr/local/src/nginx/conf.d/passwd admin 123456
</span></span><span style="display:flex;"><span>Adding password for user admin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[root@centos7 conf.d]# cat passwd 
</span></span><span style="display:flex;"><span>admin:$apr1$/MugqAsJ$MbWcOmC5U9WTZlgK5MJeU.
</span></span><span style="display:flex;"><span>[root@centos7 conf.d]# 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#å®‰å…¨åŠ å›º
</span></span><span style="display:flex;"><span>[root@centos7 ~]# chown nginx.nginx /usr/local/src/nginx/conf.d/passwd
</span></span><span style="display:flex;"><span>[root@centos7 ~]# chmod 600 /usr/local/src/nginx/conf.d/passwd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># ä¿®æ”¹é…ç½®æ–‡ä»¶
</span></span><span style="display:flex;"><span>server{
</span></span><span style="display:flex;"><span>        listen 80;
</span></span><span style="display:flex;"><span>        server_name localhost;
</span></span><span style="display:flex;"><span>        root /data/web;
</span></span><span style="display:flex;"><span>        index index.html *.html;
</span></span><span style="display:flex;"><span>        location /about {
</span></span><span style="display:flex;"><span>          alias /data/web1;
</span></span><span style="display:flex;"><span>          index index.html *.html;
</span></span><span style="display:flex;"><span>          auth_basic           &#34;login password&#34;;
</span></span><span style="display:flex;"><span>          auth_basic_user_file /usr/local/src/nginx/conf.d/passwd;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨">æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨<a hidden class="anchor" aria-hidden="true" href="#æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨">#</a></h2>
<p>try_files ä¼šæŒ‰é¡ºåºæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè¿”å›ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼ˆç»“å°¾åŠ æ–œçº¿è¡¨ç¤ºä¸ºæ–‡ä»¶å¤¹ï¼‰ï¼Œ å¦‚æœæ‰€æœ‰æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹éƒ½æ‰¾ä¸åˆ°ï¼Œä¼šè¿›è¡Œä¸€ä¸ªå†…éƒ¨é‡å®šå‘åˆ°æœ€åä¸€ä¸ªå‚æ•°ã€‚åªæœ‰æœ€åä¸€ä¸ªå‚æ•°å¯ä»¥å¼•èµ· ä¸€ä¸ªå†…éƒ¨é‡å®šå‘ï¼Œä¹‹å‰çš„å‚æ•°åªè®¾ç½®å†…éƒ¨URIçš„æŒ‡å‘ã€‚æœ€åä¸€ä¸ªå‚æ•°æ˜¯å›é€€URIä¸”å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™ä¼šå‡ºç° å†…éƒ¨500é”™è¯¯ã€‚</p>
<p>è¯­æ³•æ ¼å¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Syntax: try_files file ... uri;
</span></span><span style="display:flex;"><span>try_files file ... =code;
</span></span><span style="display:flex;"><span>Default: â€”
</span></span><span style="display:flex;"><span>Context: server, location
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š å¦‚æœä¸å­˜åœ¨é¡µé¢, å°±è½¬åˆ°default.htmlé¡µé¢</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>server{
</span></span><span style="display:flex;"><span>   listen 80;
</span></span><span style="display:flex;"><span>   server_name localhost;
</span></span><span style="display:flex;"><span>   root /data/web;
</span></span><span style="display:flex;"><span>   index index.html *.html;
</span></span><span style="display:flex;"><span>   location / {
</span></span><span style="display:flex;"><span>   #å¦‚æœä¸å­˜åœ¨é¡µé¢, å°±è½¬åˆ°default.htmlé¡µé¢ 
</span></span><span style="display:flex;"><span>    # try_files $uri  $uri.html $uri/index.html /about/default.html;
</span></span><span style="display:flex;"><span>    # è¿”å›è‡ªå®šä¹‰çŠ¶æ€ç  489
</span></span><span style="display:flex;"><span>     try_files $uri $uri/index.html $uri.html =489;
</span></span><span style="display:flex;"><span>     index index.html *.html;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="é•¿è¿æ¥é…ç½®">é•¿è¿æ¥é…ç½®<a hidden class="anchor" aria-hidden="true" href="#é•¿è¿æ¥é…ç½®">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>keepalive_timeout timeout [header_timeout];  #è®¾å®šä¿æŒè¿æ¥è¶…æ—¶æ—¶é•¿ï¼Œ0è¡¨ç¤ºç¦æ­¢é•¿è¿æ¥ï¼Œé»˜
</span></span><span style="display:flex;"><span>è®¤ä¸º75sï¼Œé€šå¸¸é…ç½®åœ¨httpå­—æ®µä½œä¸ºç«™ç‚¹å…¨å±€é…ç½®
</span></span><span style="display:flex;"><span>keepalive_requests number;  #åœ¨ä¸€æ¬¡é•¿è¿æ¥ä¸Šæ‰€å…è®¸è¯·æ±‚çš„èµ„æºçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º1000æ¬¡,å»ºè®®é€‚
</span></span><span style="display:flex;"><span>å½“è°ƒå¤§,æ¯”å¦‚:500
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>keepalive_requests 3;
</span></span><span style="display:flex;"><span>keepalive_timeout  65 60;
</span></span><span style="display:flex;"><span>#å¼€å¯é•¿è¿æ¥åï¼Œè¿”å›å®¢æˆ·ç«¯çš„ä¼šè¯ä¿æŒæ—¶é—´ä¸º60sï¼Œå•æ¬¡é•¿è¿æ¥ç´¯è®¡è¯·æ±‚è¾¾åˆ°æŒ‡å®šæ¬¡æ•°è¯·æ±‚æˆ–65ç§’å°±ä¼šè¢«æ–­
</span></span><span style="display:flex;"><span>å¼€ï¼Œç¬¬äºŒä¸ªæ•°å­—60ä¸ºå‘é€ç»™å®¢æˆ·ç«¯åº”ç­”æŠ¥æ–‡å¤´éƒ¨ä¸­æ˜¾ç¤ºçš„è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º60sï¼šå¦‚ä¸è®¾ç½®å®¢æˆ·ç«¯å°†ä¸æ˜¾ç¤ºè¶…æ—¶
</span></span><span style="display:flex;"><span>æ—¶é—´ã€‚
</span></span><span style="display:flex;"><span>Keep-Alive:timeout=60  #æµè§ˆå™¨æ”¶åˆ°çš„æœåŠ¡å™¨è¿”å›çš„æŠ¥æ–‡
</span></span><span style="display:flex;"><span>#å¦‚æœè®¾ç½®ä¸º0è¡¨ç¤ºå…³é—­ä¼šè¯ä¿æŒåŠŸèƒ½ï¼Œå°†å¦‚ä¸‹æ˜¾ç¤ºï¼š
</span></span><span style="display:flex;"><span>Connection:close  #æµè§ˆå™¨æ”¶åˆ°çš„æœåŠ¡å™¨è¿”å›çš„æŠ¥æ–‡
</span></span></code></pre></div><h2 id="ä½œä¸ºä¸‹è½½æœåŠ¡å™¨é…ç½®">ä½œä¸ºä¸‹è½½æœåŠ¡å™¨é…ç½®<a hidden class="anchor" aria-hidden="true" href="#ä½œä¸ºä¸‹è½½æœåŠ¡å™¨é…ç½®">#</a></h2>
<p>nginx_http_autoindex_module æ¨¡å—å¤„ç†ä»¥æ–œæ å­—ç¬¦ &ldquo;/&rdquo; ç»“å°¾çš„è¯·æ±‚ï¼Œå¹¶ç”Ÿæˆç›®å½•åˆ—è¡¨,å¯ä»¥åšä¸ºä¸‹è½½æœåŠ¡ é…ç½®ä½¿ç”¨ å®˜æ–¹æ–‡æ¡£:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>https://nginx.org/en/docs/http/ngx_http_autoindex_module.html#autoindex
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Syntax: autoindex on | off;
</span></span><span style="display:flex;"><span>Default:
</span></span><span style="display:flex;"><span>autoindex off;
</span></span><span style="display:flex;"><span>Context: http, server, location
</span></span></code></pre></div><p>ç›¸å…³æŒ‡ä»¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>autoindex on | off;#è‡ªåŠ¨æ–‡ä»¶ç´¢å¼•åŠŸèƒ½ï¼Œé»˜ä¸ºoff
</span></span><span style="display:flex;"><span>autoindex_exact_size on | off;  #è®¡ç®—æ–‡ä»¶ç¡®åˆ‡å¤§å°ï¼ˆå•ä½bytesï¼‰ï¼Œoff æ˜¾ç¤ºå¤§æ¦‚å¤§å°ï¼ˆå•ä½
</span></span><span style="display:flex;"><span>Kã€M)ï¼Œé»˜è®¤on
</span></span><span style="display:flex;"><span>autoindex_localtime on | off ; #æ˜¾ç¤ºæœ¬æœºæ—¶é—´è€ŒéGMT(æ ¼æ—å¨æ²»)æ—¶é—´ï¼Œé»˜è®¤off
</span></span><span style="display:flex;"><span>autoindex_format html | xml | json | jsonp; #æ˜¾ç¤ºç´¢å¼•çš„é¡µé¢æ–‡ä»¶é£æ ¼ï¼Œé»˜è®¤html
</span></span><span style="display:flex;"><span>limit_rate rate; #é™åˆ¶å“åº”å®¢æˆ·ç«¯ä¼ è¾“é€Ÿç‡(é™¤GETå’ŒHEADä»¥å¤–çš„æ‰€æœ‰æ–¹æ³•)ï¼Œå•ä½B/s,å³
</span></span><span style="display:flex;"><span>bytes/secondï¼Œé»˜è®¤å€¼0,è¡¨ç¤ºæ— é™åˆ¶,æ­¤æŒ‡ä»¤ç”±ngx_http_core_moduleæä¾›
</span></span><span style="display:flex;"><span>set $limit_rate 4k; #ä¹Ÿå¯ä»¥é€šå˜é‡é™é€Ÿ,å•ä½B/s,åŒæ—¶è®¾ç½®,æ­¤é¡¹ä¼˜çº§é«˜.Rate limit can also
</span></span><span style="display:flex;"><span>be set in the $limit_rate variable, however, since version 1.17.0, this method is
</span></span><span style="display:flex;"><span>not recommended:
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># é…ç½®æ–‡ä»¶
</span></span><span style="display:flex;"><span>location /download {
</span></span><span style="display:flex;"><span>   autoindex on;    #è‡ªåŠ¨ç´¢å¼•åŠŸèƒ½
</span></span><span style="display:flex;"><span>   autoindex_exact_size   on; #è®¡ç®—æ–‡ä»¶ç¡®åˆ‡å¤§å°ï¼ˆå•ä½bytesï¼‰ï¼Œæ­¤ä¸ºé»˜è®¤å€¼,offåªæ˜¾ç¤ºå¤§æ¦‚å¤§
</span></span><span style="display:flex;"><span>å°ï¼ˆå•ä½kbã€mbã€gbï¼‰  
</span></span><span style="display:flex;"><span>   autoindex_localtime   on; #onè¡¨ç¤ºæ˜¾ç¤ºæœ¬æœºæ—¶é—´è€ŒéGMT(æ ¼æ—å¨æ²»)æ—¶é—´,é»˜ä¸ºä¸ºoffæ˜¾ç¤ºGMT
</span></span><span style="display:flex;"><span>æ—¶é—´
</span></span><span style="display:flex;"><span>   limit_rate 1024k;   #é™é€Ÿ,é»˜è®¤ä¸é™é€Ÿ
</span></span><span style="display:flex;"><span>   root /data/web/download;
</span></span><span style="display:flex;"><span> }
</span></span></code></pre></div><h2 id="å…¶ä»–é…ç½®">å…¶ä»–é…ç½®<a hidden class="anchor" aria-hidden="true" href="#å…¶ä»–é…ç½®">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>keepalive_disable none | browser ...;  
</span></span><span style="display:flex;"><span>#å¯¹å“ªç§æµè§ˆå™¨ç¦ç”¨é•¿è¿æ¥
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>limit_except method ... { ... }ï¼Œä»…ç”¨äºlocation
</span></span><span style="display:flex;"><span>#ç¦æ­¢å®¢æˆ·ç«¯ä½¿ç”¨é™¤äº†æŒ‡å®šçš„è¯·æ±‚æ–¹æ³•ä¹‹å¤–çš„å…¶å®ƒæ–¹æ³•,å¦‚æœä½¿ç”¨ä¼šå‡ºç°403é”™è¯¯
</span></span><span style="display:flex;"><span>method:GET, HEAD, POST, PUT, DELETEï¼ŒMKCOL, COPY, MOVE, OPTIONS, PROPFIND,
</span></span><span style="display:flex;"><span>PROPPATCH, LOCK, UNLOCK, PATCH
</span></span><span style="display:flex;"><span>limit_except GET {
</span></span><span style="display:flex;"><span> allow 192.168.0.0/24;
</span></span><span style="display:flex;"><span> allow 10.0.0.1;
</span></span><span style="display:flex;"><span> deny all;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#é™¤äº†GETå’ŒHEAD ä¹‹å¤–å…¶å®ƒæ–¹æ³•ä»…å…è®¸192.168.1.0/24ç½‘æ®µä¸»æœºä½¿ç”¨
</span></span><span style="display:flex;"><span>location /upload {
</span></span><span style="display:flex;"><span>       root /data/nginx/html/pc;
</span></span><span style="display:flex;"><span>       index index.html;
</span></span><span style="display:flex;"><span>       limit_except GET {
</span></span><span style="display:flex;"><span>           allow  10.0.0.6;
</span></span><span style="display:flex;"><span>           deny all;
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>

        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://xyenvy.github.io/posts/redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>Rediså­¦ä¹ ç¬”è®°</span>
  </a>
  <a class="next" href="https://xyenvy.github.io/posts/nginx%E5%B9%B3%E6%BB%91%E5%8D%87%E7%BA%A7/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>Nginxå¹³æ»‘å‡çº§</span>
  </a>
</nav>

        </footer>
    </div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        2022-2023
        <a href="https://xyenvy.github.io" style="color:#939393;">Hopeful</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;">é»”ICPå¤‡2022006994å·-2</a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="/img/beian.png" style="float:left;margin: 0px 5px 0px 0px;"/>
            é»”å…¬ç½‘å®‰å¤‡2022006994å·
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"Hopeful"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"Hopeful"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'ğŸ“„å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'ğŸ‘ŒğŸ»å·²å¤åˆ¶!';
            setTimeout(() => {
                copybutton.innerText = 'ğŸ“„å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"Hopeful"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>
</body>

</html>
