<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>OpenVPNå®‰è£…å’Œä½¿ç”¨ | Hopeful</title>
<meta name="keywords" content="OpenVPN, vip, vpn">
<meta name="description" content="OpenVPN æ˜¯Linuxä¸‹å¼€æºVPNçš„åº”ç”¨ï¼Œæä¾›äº†è‰¯å¥½çš„æ€§èƒ½å’Œå‹å¥½çš„ç”¨æˆ·GUI;OpenVPN æ˜¯ä¸€ä¸ªåŸºäº OpenSSL åº“çš„åº”ç”¨å±‚ VPN å®ç°ã€‚å’Œä¼ ç»Ÿ VPN ç›¸æ¯”ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•æ˜“ç”¨">
<meta name="author" content="Hopeful">
<link rel="canonical" href="https://xyenvy.github.io/posts/openvpn%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://xyenvy.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://xyenvy.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://xyenvy.github.io/img/Q.gif">
<link rel="apple-touch-icon" href="https://xyenvy.github.io/img/Q.gif">
<link rel="mask-icon" href="https://xyenvy.github.io/img/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="OpenVPNå®‰è£…å’Œä½¿ç”¨" />
<meta property="og:description" content="OpenVPN æ˜¯Linuxä¸‹å¼€æºVPNçš„åº”ç”¨ï¼Œæä¾›äº†è‰¯å¥½çš„æ€§èƒ½å’Œå‹å¥½çš„ç”¨æˆ·GUI;OpenVPN æ˜¯ä¸€ä¸ªåŸºäº OpenSSL åº“çš„åº”ç”¨å±‚ VPN å®ç°ã€‚å’Œä¼ ç»Ÿ VPN ç›¸æ¯”ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•æ˜“ç”¨" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xyenvy.github.io/posts/openvpn%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/" />
<meta property="og:image" content="https://xyenvy.github.io/posts.images/banner/28.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-17T21:51:21+00:00" />
<meta property="article:modified_time" content="2023-03-17T21:51:21+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://xyenvy.github.io/posts.images/banner/28.jpg" />
<meta name="twitter:title" content="OpenVPNå®‰è£…å’Œä½¿ç”¨"/>
<meta name="twitter:description" content="OpenVPN æ˜¯Linuxä¸‹å¼€æºVPNçš„åº”ç”¨ï¼Œæä¾›äº†è‰¯å¥½çš„æ€§èƒ½å’Œå‹å¥½çš„ç”¨æˆ·GUI;OpenVPN æ˜¯ä¸€ä¸ªåŸºäº OpenSSL åº“çš„åº”ç”¨å±‚ VPN å®ç°ã€‚å’Œä¼ ç»Ÿ VPN ç›¸æ¯”ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•æ˜“ç”¨"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "ğŸ“šæ–‡ç« ",
          "item": "https://xyenvy.github.io/posts/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "OpenVPNå®‰è£…å’Œä½¿ç”¨",
      "item": "https://xyenvy.github.io/posts/openvpn%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "OpenVPNå®‰è£…å’Œä½¿ç”¨",
  "name": "OpenVPNå®‰è£…å’Œä½¿ç”¨",
  "description": "OpenVPN æ˜¯Linuxä¸‹å¼€æºVPNçš„åº”ç”¨ï¼Œæä¾›äº†è‰¯å¥½çš„æ€§èƒ½å’Œå‹å¥½çš„ç”¨æˆ·GUI;OpenVPN æ˜¯ä¸€ä¸ªåŸºäº OpenSSL åº“çš„åº”ç”¨å±‚ VPN å®ç°ã€‚å’Œä¼ ç»Ÿ VPN ç›¸æ¯”ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•æ˜“ç”¨",
  "keywords": [
    "OpenVPN", "vip", "vpn"
  ],
  "articleBody": "å‡†å¤‡éƒ¨ç½²OpenVPNç¯å¢ƒ éƒ¨ç½²ç¯å¢ƒå¦‚ä¸‹ å…±å››å°ä¸»æœº 1 openvpn serverï¼š CentOS 7.9 ens33:192.168.1.110/24 NATæ¨¡å¼,æ¨¡æ‹Ÿå…¬ç½‘IP ens36:172.30.0.1/24 ä»…ä¸»æœºæ¨¡å¼,ç§ç½‘IP 2 å†…ç½‘ä¸»æœºä¸¤å° ç¬¬ä¸€å°ä¸»æœº ens33172.30.0.100/24 ä»…ä¸»æœºæ¨¡å¼,ç§ç½‘IPï¼Œæ— éœ€ç½‘å…³ ç¬¬äºŒå°ä¸»æœº ens33172.30.0.200/24 ä»…ä¸»æœºæ¨¡å¼,ç§ç½‘IPï¼Œæ— éœ€ç½‘å…³\n3 Windows å®¢æˆ·ç«¯ Windows 10/11\nå®‰è£… OpenVPN å®‰è£… OpenVPN å’Œè¯ä¹¦å·¥å…· #OpenVPNæœåŠ¡å™¨ç«¯ [root@openvpn-centos7 ~]#yum -y install openvpn #è¯ä¹¦ç®¡ç†å·¥å…· [root@openvpn-centos7 ~]#yum -y install easy-rsa # å®‰è£…ç‰ˆæœ¬ [root@openvpn-centos7 ~]# yum list openvpn Loaded plugins: fastestmirror Loading mirror speeds from cached hostfile * base: mirrors.ustc.edu.cn * epel: ftp.riken.jp * extras: mirrors.163.com * updates: mirrors.ustc.edu.cn Installed Packages openvpn.x86_64 2.4.12-1.el7 @epel å‡†å¤‡ç›¸å…³é…ç½®æ–‡ä»¶ # ç”ŸæˆæœåŠ¡å™¨é…ç½®æ–‡ä»¶ [root@openvpn-centos7 ~]# cp /usr/share/doc/openvpn-2.4.12/sample/sample-config-files/server.conf /etc/openvpn # å‡†å¤‡è¯ä¹¦é¢å‘ç›¸å…³æ–‡ä»¶ [root@openvpn-centos7 ~]# cp -r /usr/share/easy-rsa/ /etc/openvpn/easy-rsa-server # å‡†å¤‡é¢å‘è¯ä¹¦ç›¸å…³å˜é‡çš„é…ç½®æ–‡ä»¶ [root@openvpn-centos7 ~]# cp /usr/share/doc/easy-rsa-3.0.8/vars.example /etc/openvpn/easy-rsa-server/3/vars # å»ºè®®ä¿®æ”¹ç»™CAå’ŒOpenVPNæœåŠ¡å™¨é¢å‘çš„è¯ä¹¦çš„æœ‰æ•ˆæœŸ,å¯é€‚å½“åŠ é•¿ [root@openvpn-centos7 ~]# vim /etc/openvpn/easy-rsa-server/3/vars #CAçš„è¯ä¹¦é»˜è®¤æœ‰æ•ˆæœŸä¸º10å¹´,å¯ä»¥é€‚å½“å»¶é•¿,æ¯”å¦‚:36500å¤© #set_var EASYRSA_CA_EXPIRE 3650 set_var EASYRSA_CA_EXPIRE 36500 #æœåŠ¡å™¨è¯ä¹¦é»˜ä¸ºä¸º825å¤©,å¯é€‚å½“åŠ é•¿,æ¯”å¦‚:3650å¤© #set_var EASYRSA_CERT_EXPIRE 825 #å°†ä¸Šé¢è¡Œä¿®æ”¹ä¸ºä¸‹é¢ set_var EASYRSA_CERT_EXPIRE 3650 å‡†å¤‡è¯ä¹¦ç›¸å…³æ–‡ä»¶ åˆå§‹åŒ–PKIå’ŒCAé¢å‘æœºæ„ç¯å¢ƒ åˆå§‹åŒ–PKIç”ŸæˆPKIç›¸å…³ç›®å½•å’Œæ–‡ä»¶ # è¿›å…¥è¯¥ç›®å½•ä¸‹ [root@openvpn-centos7 3]# pwd /etc/openvpn/easy-rsa-server/3 #åˆå§‹åŒ–æ•°æ®,åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆpkiç›®å½•åŠç›¸å…³æ–‡ä»¶ [root@openvpn-centos7 3]# ./easyrsa init-pki Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: /etc/openvpn/easy-rsa-server/3/pki [root@openvpn-centos7 3]# tree . â”œâ”€â”€ easyrsa â”œâ”€â”€ openssl-easyrsa.cnf â”œâ”€â”€ pki #ç”Ÿæˆä¸€ä¸ªæ–°ç›®å½•åŠç›¸å…³æ–‡ä»¶ â”‚Â â”œâ”€â”€ openssl-easyrsa.cnf â”‚Â â”œâ”€â”€ private â”‚Â â”œâ”€â”€ reqs â”‚Â â””â”€â”€ safessl-easyrsa.cnf â”œâ”€â”€ vars â””â”€â”€ x509-types â”œâ”€â”€ ca â”œâ”€â”€ client â”œâ”€â”€ code-signing â”œâ”€â”€ COMMON â”œâ”€â”€ email â”œâ”€â”€ kdc â”œâ”€â”€ server â””â”€â”€ serverClient 4 directories, 13 files åˆ›å»º CA æœºæ„ç¯å¢ƒ # è¿›å…¥è¯¥ç›®å½•ä¸‹ [root@openvpn-centos7 3]# pwd /etc/openvpn/easy-rsa-server/3 [root@openvpn-centos7 3]# tree pki/ pki/ â”œâ”€â”€ openssl-easyrsa.cnf â”œâ”€â”€ private â”œâ”€â”€ reqs â””â”€â”€ safessl-easyrsa.cnf 2 directories, 2 files [root@openvpn-centos7 3]# ./easyrsa build-ca nopass # nopass ä¸éœ€è¦å¯†ç  Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars Using SSL: openssl OpenSSL 1.0.2k-fips 26 Jan 2017 Generating RSA private key, 2048 bit long modulus ....+++ ......+++ e is 65537 (0x10001) You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Common Name (eg: your user, host, or server name) [Easy-RSA CA]: # å›è½¦æ¥å—é»˜è®¤å€¼ CA creation complete and you may now import and sign cert requests. Your new CA certificate file for publishing is at: /etc/openvpn/easy-rsa-server/3/pki/ca.crt #ç”Ÿæˆè‡ªç­¾åçš„è¯ä¹¦æ–‡ä»¶ [root@openvpn-centos7 3]#tree pki pki â”œâ”€â”€ ca.crt #ç”Ÿæˆçš„è‡ªç­¾åçš„è¯ä¹¦æ–‡ä»¶ â”œâ”€â”€ certs_by_serial â”œâ”€â”€ index.txt â”œâ”€â”€ index.txt.attr â”œâ”€â”€ issued â”œâ”€â”€ openssl-easyrsa.cnf â”œâ”€â”€ private â”‚ â””â”€â”€ ca.key #ç”Ÿæˆçš„ç§é’¥æ–‡ä»¶ â”œâ”€â”€ renewed â”‚ â”œâ”€â”€ certs_by_serial â”‚ â”œâ”€â”€ private_by_serial â”‚ â””â”€â”€ reqs_by_serial â”œâ”€â”€ reqs â”œâ”€â”€ revoked â”‚ â”œâ”€â”€ certs_by_serial â”‚ â”œâ”€â”€ private_by_serial â”‚ â””â”€â”€ reqs_by_serial â”œâ”€â”€ safessl-easyrsa.cnf â””â”€â”€ serial 12 directories, 7 files åˆ›å»ºæœåŠ¡ç«¯è¯ä¹¦ç”³è¯· # è¿›å…¥è¯¥ç›®å½• [root@openvpn-centos7 3]# pwd /etc/openvpn/easy-rsa-server/3 [root@openvpn-centos7 3]# [root@openvpn-centos7 3]# ./easyrsa gen-req server nopass Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars Using SSL: openssl OpenSSL 1.0.2k-fips 26 Jan 2017 Generating a 2048 bit RSA private key ..........................................................................................................................................................+++ ......................+++ writing new private key to '/etc/openvpn/easy-rsa-server/3/pki/easy-rsa-1605.nDSXm1/tmp.2RnHiQ' ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Common Name (eg: your user, host, or server name) [server]: #æ¥å—Common Nameçš„é»˜è®¤ å€¼,ç›´æ¥å›è½¦ Keypair and certificate request completed. Your files are: req: /etc/openvpn/easy-rsa-server/3/pki/reqs/server.req #ç”Ÿæˆè¯·æ±‚æ–‡ä»¶ key: /etc/openvpn/easy-rsa-server/3/pki/private/server.key #ç”Ÿæˆç§é’¥æ–‡ä»¶ [root@openvpn-centos7 3]#tree pki pki â”œâ”€â”€ ca.crt â”œâ”€â”€ certs_by_serial â”œâ”€â”€ index.txt â”œâ”€â”€ index.txt.attr â”œâ”€â”€ issued â”œâ”€â”€ openssl-easyrsa.cnf â”œâ”€â”€ private â”‚ â”œâ”€â”€ ca.key â”‚ â””â”€â”€ server.key #ç”Ÿæˆç§é’¥æ–‡ä»¶ â”œâ”€â”€ renewed â”‚ â”œâ”€â”€ certs_by_serial â”‚ â”œâ”€â”€ private_by_serial â”‚ â””â”€â”€ reqs_by_serial â”œâ”€â”€ reqs â”‚ â””â”€â”€ server.req #ç”Ÿæˆè¯·æ±‚æ–‡ä»¶ â”œâ”€â”€ revoked â”‚ â”œâ”€â”€ certs_by_serial â”‚ â”œâ”€â”€ private_by_serial â”‚ â””â”€â”€ reqs_by_serial â”œâ”€â”€ safessl-easyrsa.cnf â””â”€â”€ serial 12 directories, 9 files é¢å‘æœåŠ¡ç«¯è¯ä¹¦ #å°†ä¸Šé¢server.reqçš„ç”³è¯·,é¢å‘serverç±»å‹çš„è¯ä¹¦ [root@openvpn-centos7 3]#cd /etc/openvpn/easy-rsa-server/3 #ç¬¬ä¸€ä¸ªserverè¡¨ç¤ºè¯ä¹¦çš„ç±»å‹,ç¬¬äºŒä¸ªserverè¡¨ç¤ºè¯·æ±‚æ–‡ä»¶åçš„å‰ç¼€ [root@openvpn-centos7 3]# ./easyrsa sign server server Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars Using SSL: openssl OpenSSL 1.0.2k-fips 26 Jan 2017 You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a server certificate for 3650 days: subject= commonName = server Type the word 'yes' to continue, or any other input to abort. Confirm request details: yes # è¾“å…¥yes Using configuration from /etc/openvpn/easy-rsa-server/3/pki/easy-rsa-1634.ZCYI5M/tmp.2SsU9O Check that the request matches the signature Signature ok The Subject's Distinguished Name is as follows commonName :ASN.1 12:'server' Certificate is to be certified until Mar 15 01:27:03 2033 GMT (3650 days) Write out database with 1 new entries Data Base Updated Certificate created at: /etc/openvpn/easy-rsa-server/3/pki/issued/server.crt #ç”Ÿ æˆæœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶ éªŒè¯ç»“æœ [root@openvpn-centos7 3]# tree pki/ pki/ â”œâ”€â”€ ca.crt â”œâ”€â”€ certs_by_serial â”‚Â â””â”€â”€ EAD7A4786FA803EDD9A7166D0EC694C3.pem #ç”Ÿæˆçš„æœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶ â”œâ”€â”€ index.txt â”œâ”€â”€ index.txt.attr â”œâ”€â”€ index.txt.attr.old â”œâ”€â”€ index.txt.old â”œâ”€â”€ issued â”‚Â â””â”€â”€ server.crt #ç”Ÿæˆçš„æœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶ â”œâ”€â”€ openssl-easyrsa.cnf â”œâ”€â”€ private â”‚Â â”œâ”€â”€ ca.key â”‚Â â””â”€â”€ server.key â”œâ”€â”€ renewed â”‚Â â”œâ”€â”€ certs_by_serial â”‚Â â”œâ”€â”€ private_by_serial â”‚Â â””â”€â”€ reqs_by_serial â”œâ”€â”€ reqs â”‚Â â””â”€â”€ server.req â”œâ”€â”€ revoked â”‚Â â”œâ”€â”€ certs_by_serial â”‚Â â”œâ”€â”€ private_by_serial â”‚Â â””â”€â”€ reqs_by_serial â”œâ”€â”€ safessl-easyrsa.cnf â”œâ”€â”€ serial â””â”€â”€ serial.old 12 directories, 14 files åˆ›å»º Diffie-Hellman å¯†é’¥ [root@openvpn-centos7 3]# ./easyrsa gen-dh Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars Using SSL: openssl OpenSSL 1.0.2k-fips 26 Jan 2017 Generating DH parameters, 2048 bit long safe prime, generator 2 This is going to take a long time ...............................................................................................................................................................................+. # å¾—ç­‰ä¸€ä¼š DH parameters of size 2048 created at /etc/openvpn/easy-rsa-server/3/pki/dh.pem #æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶ [root@openvpn-centos7 3]# ll pki/dh.pem -rw------- 1 root root 424 Mar 18 09:34 pki/dh.pem [root@openvpn-centos7 3]# å‡†å¤‡å®¢æˆ·ç«¯è¯ä¹¦ç¯å¢ƒ ä¸Šé¢æœåŠ¡ç«¯è¯ä¹¦é…ç½®å®Œæˆï¼Œä¸‹é¢æ˜¯é…ç½®å®¢æˆ·ç«¯è¯ä¹¦\n[root@openvpn-centos7 /]# cp -a /usr/share/easy-rsa/ /etc/openvpn/easy-rsa-client # è¿›å…¥è¯¥ç›®å½•ä¸‹ [root@openvpn-centos7 3]# pwd /etc/openvpn/easy-rsa-client/3 #ç”Ÿæˆè¯ä¹¦ç”³è¯·æ‰€éœ€ç›®å½•pkiå’Œæ–‡ä»¶ [root@openvpn-centos7 3]# ./easyrsa init-pki init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: /etc/openvpn/easy-rsa-client/3/pki åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ç”³è¯· # è¿›å…¥è¯¥ç›®å½•ä¸‹ [root@openvpn-centos7 3]# pwd /etc/openvpn/easy-rsa-client/3 #ç”Ÿæˆå®¢æˆ·ç«¯ç”¨æˆ·çš„è¯ä¹¦ç”³è¯·,devç”¨æˆ· [root@openvpn-centos7 3]# ./easyrsa gen-req dev nopass Using SSL: openssl OpenSSL 1.0.2k-fips 26 Jan 2017 Generating a 2048 bit RSA private key ......................................................+++ .........................................................................................................................................................................................................+++ writing new private key to '/etc/openvpn/easy-rsa-client/3/pki/easy-rsa-1749.UROzYa/tmp.HqONRu' ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Common Name (eg: your user, host, or server name) [dev]: # å›è½¦æ¥å—é»˜è®¤å€¼ Keypair and certificate request completed. Your files are: req: /etc/openvpn/easy-rsa-client/3/pki/reqs/dev.req #ç§é’¥æ–‡ä»¶ key: /etc/openvpn/easy-rsa-client/3/pki/private/dev.key #è¯ä¹¦ç”³è¯·æ–‡ä»¶ #ç”Ÿæˆä¸¤ä¸ªæ–°æ–‡ä»¶ [root@openvpn-centos7 3]# tree . â”œâ”€â”€ easyrsa â”œâ”€â”€ openssl-easyrsa.cnf â”œâ”€â”€ pki â”‚Â â”œâ”€â”€ openssl-easyrsa.cnf â”‚Â â”œâ”€â”€ private â”‚Â â”‚Â â””â”€â”€ dev.key #ç§é’¥æ–‡ä»¶ â”‚Â â”œâ”€â”€ reqs â”‚Â â”‚Â â””â”€â”€ dev.req #è¯ä¹¦ç”³è¯·æ–‡ä»¶ â”‚Â â””â”€â”€ safessl-easyrsa.cnf â””â”€â”€ x509-types â”œâ”€â”€ ca â”œâ”€â”€ client â”œâ”€â”€ code-signing â”œâ”€â”€ COMMON â”œâ”€â”€ email â”œâ”€â”€ kdc â”œâ”€â”€ server â””â”€â”€ serverClient 4 directories, 14 files é¢å‘å®¢æˆ·ç«¯è¯ä¹¦ # è¿›å…¥è¯¥ç›®å½•ä¸‹ [root@openvpn-centos7 3]# pwd /etc/openvpn/easy-rsa-server/3 [root@openvpn-centos7 3]# [root@openvpn-centos7 3]# ./easyrsa import-req /etc/openvpn/easy-rsa-client/3/pki/reqs/dev.req dev Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars Using SSL: openssl OpenSSL 1.0.2k-fips 26 Jan 2017 The request has been successfully imported with a short name of: dev You may now use this name to perform signing operations on this request. [root@openvpn-centos7 3]# tree pki/ pki/ â”œâ”€â”€ ca.crt â”œâ”€â”€ certs_by_serial â”‚Â â””â”€â”€ EAD7A4786FA803EDD9A7166D0EC694C3.pem â”œâ”€â”€ dh.pem â”œâ”€â”€ index.txt â”œâ”€â”€ index.txt.attr â”œâ”€â”€ index.txt.attr.old â”œâ”€â”€ index.txt.old â”œâ”€â”€ issued â”‚Â â””â”€â”€ server.crt â”œâ”€â”€ openssl-easyrsa.cnf â”œâ”€â”€ private â”‚Â â”œâ”€â”€ ca.key â”‚Â â””â”€â”€ server.key â”œâ”€â”€ renewed â”‚Â â”œâ”€â”€ certs_by_serial â”‚Â â”œâ”€â”€ private_by_serial â”‚Â â””â”€â”€ reqs_by_serial â”œâ”€â”€ reqs â”‚Â â”œâ”€â”€ dev.req # å¯¼å…¥çš„æ–‡ä»¶ â”‚Â â””â”€â”€ server.req â”œâ”€â”€ revoked â”‚Â â”œâ”€â”€ certs_by_serial â”‚Â â”œâ”€â”€ private_by_serial â”‚Â â””â”€â”€ reqs_by_serial â”œâ”€â”€ safessl-easyrsa.cnf â”œâ”€â”€ serial â””â”€â”€ serial.old 12 directories, 16 files #ä¿®æ”¹ç»™å®¢æˆ·ç«¯é¢å‘çš„è¯ä¹¦çš„æœ‰æ•ˆæœŸ [root@openvpn-centos7 3]##vim vars #å»ºè®®ä¿®æ”¹ç»™å®¢æˆ·ç«¯é¢å‘è¯ä¹¦çš„æœ‰æ•ˆæœŸ,å¯é€‚å½“å‡å°‘,æ¯”å¦‚:90å¤© #set_var EASYRSA_CERT_EXPIRE 825 #å°†ä¸Šé¢è¡Œä¿®æ”¹ä¸ºä¸‹é¢ set_var EASYRSA_CERT_EXPIRE 90 #é¢å‘å®¢æˆ·ç«¯è¯ä¹¦ [root@openvpn-centos7 3]# ./easyrsa sign client dev Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars Using SSL: openssl OpenSSL 1.0.2k-fips 26 Jan 2017 You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a client certificate for 3650 days: subject= commonName = dev Type the word 'yes' to continue, or any other input to abort. Confirm request details: yes # è¾“å…¥yes Using configuration from /etc/openvpn/easy-rsa-server/3/pki/easy-rsa-1998.yxi0PJ/tmp.IJUwSd Check that the request matches the signature Signature ok The Subject's Distinguished Name is as follows commonName :ASN.1 12:'dev' Certificate is to be certified until Mar 15 01:51:32 2033 GMT (3650 days) Write out database with 1 new entries Data Base Updated Certificate created at: /etc/openvpn/easy-rsa-server/3/pki/issued/dev.crt #è¯ä¹¦æ–‡ä»¶ å°†CAå’ŒæœåŠ¡å™¨è¯ä¹¦ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ç›¸åº”çš„ç›®å½• [root@openvpn-centos7 3]# mkdir /etc/openvpn/certs [root@openvpn-centos7 3]# cp /etc/openvpn/easy-rsa-server/3/pki/ca.crt /etc/openvpn/certs/ [root@openvpn-centos7 3]# cp /etc/openvpn/easy-rsa-server/3/pki/issued/server.crt /etc/openvpn/certs/ [root@openvpn-centos7 3]# cp /etc/openvpn/easy-rsa-server/3/pki/private/server.key [root@openvpn-centos7 3]# cp /etc/openvpn/easy-rsa-server/3/pki/dh.pem /etc/openvpn/certs/ [root@openvpn-centos7 3]# ll /etc/openvpn/certs/ total 20 -rw------- 1 root root 1176 Mar 18 09:54 ca.crt -rw------- 1 root root 424 Mar 18 09:57 dh.pem -rw------- 1 root root 4552 Mar 18 09:56 server.crt -rw------- 1 root root 1704 Mar 18 09:55 server.key å°†å®¢æˆ·ç«¯ç§é’¥ä¸è¯ä¹¦ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ç›¸å…³çš„ç›®å½• [root@openvpn-centos7 3]# mkdir /etc/openvpn/client/dev [root@openvpn-centos7 3]# cp /etc/openvpn/easy-rsa-server/3/pki/ca.crt /etc/openvpn/easy-rsa-server/3/pki/issued/dev.crt /etc/openvpn/easy-rsa-server/3/pki/reqs/dev.req /etc/openvpn/client/dev/ [root@openvpn-centos7 3]# ll /etc/openvpn/client/dev/ total 16 -rw------- 1 root root 1176 Mar 18 10:01 ca.crt -rw------- 1 root root 4425 Mar 18 10:01 dev.crt -rw------- 1 root root 883 Mar 18 10:01 dev.req [root@openvpn-centos7 3]# å‡†å¤‡ OpenVPN æœåŠ¡å™¨é…ç½®æ–‡ä»¶ ;local a.b.c.d #æœ¬æœºç›‘å¬IP,é»˜è®¤ä¸ºæœ¬æœºæ‰€æœ‰IP port 1194 #ç«¯å£ ;proto tcp #åè®®,ç”Ÿäº§æ¨èä½¿ç”¨TCP proto udp #é»˜è®¤åè®®udp ;dev tap #åˆ›å»ºä»¥å¤ªç½‘éš§é“è®¾å¤‡ï¼Œtapè®¾å¤‡å®ç°ä»¥å¤ªç½‘å¸§é€šè¿‡Openvpnéš§é“ï¼Œå¯æä¾›éIPåè®®å¦‚ IPXå’ŒAppleTalkç­‰çš„æ”¯æŒï¼Œtapç­‰å½“äºä¸€ä¸ªä»¥å¤ªç½‘è®¾å¤‡ï¼Œå®ƒæ“ä½œç¬¬äºŒå±‚æ•°æ®åŒ…å¦‚ä»¥å¤ªç½‘æ•°æ®å¸§ã€‚ dev tun #åˆ›å»ºIPè·¯ç”±éš§é“ï¼Œç”Ÿäº§æ¨å­˜ä½¿ç”¨tun.äº’è”ç½‘ä½¿ç”¨tun,ä¸€ä¸ªtunè®¾å¤‡å¤§å¤šæ—¶å€™è¢«ç”¨äºåŸº äºIPåè®®çš„é€šè®¯ã€‚tunæ¨¡æ‹Ÿäº†ç½‘ç»œå±‚è®¾å¤‡ï¼Œæ“ä½œç¬¬ä¸‰å±‚æ•°æ®åŒ…æ¯”å¦‚IPæ•°æ®å°åŒ…ã€‚ ;dev-node MyTap #TAP-Win32çš„è®¾å¤‡é©±åŠ¨ã€‚éwindowsç³»ç»Ÿä¸éœ€è¦ ca ca.crt #caè¯ä¹¦æ–‡ä»¶ cert server.crt #æœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶ key server.key #æœåŠ¡å™¨ç§é’¥æ–‡ä»¶ dh dh2048.pem #dhå‚æ•°æ–‡ä»¶ ;topology subnet server 10.8.0.0 255.255.255.0 #å®¢æˆ·ç«¯è¿æ¥åè‡ªåŠ¨åˆ†é…çš„IPç½‘æ®µï¼Œé»˜è®¤ä¼šç»™æœåŠ¡å™¨åˆ†é…æ­¤ç½‘æ®µçš„ç¬¬ ä¸€ä¸ªIPå°†åšä¸ºå®¢æˆ·ç«¯çš„ç½‘å…³,æ³¨æ„ä¸è¦å’Œå†…ç½‘ç½‘æ®µç›¸åŒ ifconfig-pool-persist ipp.txt #è®°å½•å®¢æˆ·ç«¯å’Œè™šæ‹Ÿipåœ°å€åˆ†é…çš„æ–‡ä»¶ ;server-bridge 10.8.0.4 255.255.255.0 10.8.0.50 10.8.0.100 #é…ç½®ç½‘æ¡¥æ¨¡å¼ï¼Œæ— éœ€é…ç½®, å»ºè®®æ³¨é‡Š ;server-bridge ;push \"route 192.168.10.0 255.255.255.0\" #æ¨é€ç»™å®¢æˆ·ç«¯çš„åˆ°è¾¾æœåŠ¡å™¨åé¢ç½‘æ®µçš„é™æ€è·¯ç”±ï¼Œ ç½‘å…³æ˜¯æœåŠ¡å™¨åœ°å€10.8.0.1 ;push \"route 192.168.10.100 255.255.255.255\" #ç”¨255.255.255.255å¯å®ç°åªèƒ½è®¿é—®å†…ç½‘å•ä¸ª ä¸»æœºçš„åŠŸèƒ½,æ¯”å¦‚:jumpserver ;push \"route 192.168.20.0 255.255.255.0\" #æ¨é€è·¯ç”±ä¿¡æ¯åˆ°å®¢æˆ·ç«¯ï¼Œä»¥å…è®¸å®¢æˆ·ç«¯èƒ½å¤Ÿè¿æ¥åˆ° æœåŠ¡å™¨èƒŒåçš„å…¶å®ƒç§æœ‰ç½‘ç»œ ;client-config-dir ccd #ä¸ºç‰¹å®šå®¢æˆ·ç«¯æ·»åŠ è·¯ç”±ä¿¡æ¯ï¼Œæ­¤è·¯ç”±æ˜¯å®¢æˆ·ç«¯åé¢çš„ç½‘æ®µè€ŒéæœåŠ¡ç«¯çš„ç½‘ æ®µï¼Œæ— éœ€è®¾ç½® ;route 192.168.40.128 255.255.255.248 ;client-config-dir ccd ;route 10.9.0.0 255.255.255.252 ;learn-address ./script #æŒ‡å®šå¤–éƒ¨è„šæœ¬æ–‡ä»¶ï¼Œå®ç°åˆ›å»ºä¸åŒç»„çš„iptablesè§„ åˆ™ï¼Œæ— éœ€é…ç½® ;push \"redirect-gateway def1 bypass-dhcp\" #å¯ç”¨æ­¤é…ç½®åå®¢æˆ·ç«¯æ‰€æœ‰æµé‡éƒ½å°†é€šè¿‡VPNæœåŠ¡å™¨è¿› è¡Œè½¬å‘ï¼Œå› æ­¤ç”Ÿäº§ä¸€èˆ¬æ— éœ€é…ç½®æ­¤é¡¹ ;push \"dhcp-option DNS 208.67.222.222\" #æ¨é€DNSæœåŠ¡å™¨åœ°å€ï¼Œæ— éœ€é…ç½® ;push \"dhcp-option DNS 208.67.220.220\" ;client-to-client #å…è®¸ä¸åŒçš„å®¢æˆ·ç«¯ç›´æ¥é€šä¿¡,ä¸å®‰å…¨,ç”Ÿäº§ç¯å¢ƒä¸€èˆ¬æ—  éœ€é…ç½® ;duplicate-cn #å¤šä¸ªç”¨æˆ·å…±ç”¨ä¸€ä¸ªè¯ä¹¦ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¸€ä¸ªç”¨æˆ·ä¸€ä¸ªè¯ ä¹¦,æ— éœ€å¼€å¯ keepalive 10 120 #è®¾ç½®æœåŠ¡ç«¯æ´»åŠ¨çš„æ£€æµ‹çš„é—´éš”å’Œè¶…æ—¶æ—¶é—´ï¼Œæ¯éš”10ç§’pingä¸€æ¬¡ï¼Œ120ç§’æ²¡æœ‰ å›åº”åˆ™è®¤ä¸ºå·²ç»æ–­çº¿ tls-auth ta.key 0 #è®¿æ­¢DoSç­‰æ”»å‡»çš„å®‰å…¨å¢å¼ºé…ç½®,æœåŠ¡å™¨å’Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦æ‹¥æœ‰æ­¤å¯†é’¥æ–‡ ä»¶ã€‚ç¬¬äºŒä¸ªå‚æ•°åœ¨æœåŠ¡å™¨ç«¯ä¸º0ï¼Œå®¢æˆ·ç«¯ä¸º1 cipher AES-256-CBC #åŠ å¯†ç®—æ³• ;compress lz4-v2 #å¯ç”¨Openvpn2.4.Xæ–°ç‰ˆå‹ç¼©ç®—æ³• ;push \"compress lz4-v2\" #æ¨é€å®¢æˆ·ç«¯ä½¿ç”¨æ–°ç‰ˆå‹ç¼©ç®—æ³•,å’Œä¸‹é¢çš„comp-lzoä¸è¦åŒæ—¶ä½¿ç”¨ ;comp-lzo #æ—§æˆ·ç«¯å…¼å®¹çš„å‹ç¼©é…ç½®ï¼Œéœ€è¦å®¢æˆ·ç«¯é…ç½®å¼€å¯å‹ç¼©,openvpn2.4.Xç­‰æ–°ç‰ˆå¯ä»¥ä¸ ç”¨å¼€å¯ ;max-clients 100 #æœ€å¤šæ”¯æŒçš„å®¢æˆ·ç«¯æ•°é‡ ;user nobody #æŒ‡å®šopenvpnæœåŠ¡çš„ç”¨æˆ· ;group nobody #æŒ‡å®šopenvpnæœåŠ¡çš„ç»„ persist-key #é‡å¯æœåŠ¡æ—¶é»˜è®¤ä¼šé‡æ–°è¯»å–keyæ–‡ä»¶ï¼Œå¼€å¯æ­¤é…ç½®åä¿æŒä½¿ç”¨ç¬¬ä¸€æ¬¡çš„keyæ–‡ä»¶, ç”Ÿäº§ç¯å¢ƒæ— éœ€å¼€å¯ persist-tun #Donâ€™t close and reopen TUN/TAP device or run up/down scripts across SIGUSR1 or --ping-restart restarts,ç”Ÿäº§ç¯å¢ƒå»ºè®®æ— éœ€å¼€å¯ status openvpn-status.log #æœåŠ¡å™¨çŠ¶æ€è®°å½•æ–‡ä»¶ï¼Œæ¯åˆ†é’Ÿè®°å½•ä¸€æ¬¡ç›¸å…³ä¿¡æ¯ ;log openvpn.log #ç¬¬ä¸€ç§æ—¥å¿—è®°å½•æ–¹å¼,å¹¶æŒ‡å®šæ—¥å¿—è·¯å¾„ï¼Œlogä¼šåœ¨openvpnå¯åŠ¨çš„æ—¶å€™æ¸… ç©ºæ—¥å¿—æ–‡ä»¶,ä¸å»ºè®®ä½¿ç”¨ ;log-append openvpn.log #ç¬¬äºŒç§æ—¥å¿—è®°å½•æ–¹å¼,å¹¶æŒ‡å®šæ—¥å¿—è·¯å¾„ï¼Œé‡å¯openvpnååœ¨ä¹‹å‰çš„æ—¥å¿—å é¢è¿½åŠ æ–°çš„æ—¥å¿—,ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ verb 3 #è®¾ç½®æ—¥å¿—çº§åˆ«ï¼Œ0-9ï¼Œçº§åˆ«è¶Šé«˜è®°å½•çš„å†…å®¹è¶Šè¯¦ç»†,0 è¡¨ç¤ºé™é»˜è¿è¡Œï¼Œåªè®° å½•è‡´å‘½é”™è¯¯,4 è¡¨ç¤ºåˆç†çš„å¸¸è§„ç”¨æ³•,5 å’Œ 6 å¯ä»¥å¸®åŠ©è°ƒè¯•è¿æ¥é”™è¯¯ã€‚9 è¡¨ç¤ºæåº¦å†—ä½™ï¼Œè¾“å‡ºéå¸¸è¯¦ç»†çš„æ—¥å¿— ä¿¡æ¯ ;mute 20 #å¯¹ç›¸åŒç±»åˆ«çš„ä¿¡æ¯åªè®°å½•å‰20æ¡åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ explicit-exit-notify 1 #å½“æœåŠ¡ç«¯é‡å¯åé€šçŸ¥å®¢æˆ·ç«¯è‡ªåŠ¨é‡æ–°è¿æ¥æœåŠ¡å™¨ï¼Œæ­¤é¡¹é…ç½®ä»…èƒ½ç”¨äºudpæ¨¡ å¼ï¼Œtcpæ¨¡å¼æ— éœ€é…ç½®å³èƒ½å®ç°é‡æ–°è¿æ¥åŠŸèƒ½,ä¸”å¼€å¯æ­¤é¡¹åtcpé…ç½®åå°†å¯¼è‡´openvpnæœåŠ¡æ— æ³•å¯åŠ¨,æ‰€ä»¥ tcpæ—¶å¿…é¡»ä¸èƒ½å¼€å¯æ­¤é¡¹ script-security 3 # å…è®¸ä½¿ç”¨è‡ªå®šä¹‰è„šæœ¬ auth-user-pass-verify /etc/openvpn/checkpsw.sh via-env #æŒ‡å®šè‡ªå®šä¹‰è„šæœ¬è·¯å¾„ username-as-common-name #å¼€å¯ç”¨æˆ·å¯†ç éªŒè¯ client-cert-not-required #åªæ”¯æŒç”¨æˆ·å’Œå¯†ç æ–¹å¼éªŒè¯,ä¸æ”¯æŒè¯ä¹¦,æ— æ­¤é…ç½®è¡¨ç¤ºéœ€è¦è¯ä¹¦å’Œç”¨æˆ·å¯† ç å¤šç§éªŒè¯ ä¿®æ”¹æœåŠ¡å™¨ç«¯é…ç½®æ–‡ä»¶ [root@openvpn-centos7 openvpn]# grep '^[a-Z].*' /etc/openvpn/server.conf port 1194 proto tcp dev tun ca /etc/openvpn/certs/ca.crt cert /etc/openvpn/certs/server.crt key /etc/openvpn/certs/server.key # This file should be kept secret dh /etc/openvpn/certs/dh.pem server 10.8.0.0 255.255.255.0 ifconfig-pool-persist ipp.txt push \"route 172.30.0.0 255.255.255.0\" keepalive 10 120 tls-auth ta.key 0 # This file is secret cipher AES-256-CBC compress lz4-v2 push \"compress lz4-v2\" max-clients 2048 user openvpn group openvpn persist-key persist-tun status /var/log/openvpn/openvpn-status.log log-append /var/log/openvpn/openvpn.log verb 3 mute 20 explicit-exit-notify 1 [root@openvpn-centos7 openvpn]# #å‡†å¤‡ç›®å¿—ç›¸å…³ç›®å½• [root@openvpn-centos7 openvpn]# getent passwd openvpn openvpnâŒ998:996:OpenVPN:/etc/openvpn:/sbin/nologin [root@openvpn-centos7 openvpn]# mkdir /var/log/openvpn [root@openvpn-centos7 openvpn]# chown openvpn.openvpn /var/log/openvpn [root@openvpn-centos7 openvpn]# ll -d /var/log/openvpn drwxr-xr-x 2 openvpn openvpn 6 Mar 18 10:16 /var/log/openvpn [root@openvpn-centos7 openvpn]# å¯åŠ¨ OpenVPN æœåŠ¡ [root@openvpn-centos7 server]# systemctl enable --now openvpn@server # å¯åŠ¨æŠ¥å¦‚ä¸‹é”™è¯¯è¯·åœ¨ç»ˆç«¯æ‰§è¡Œè¯¥å‘½ä»¤ openvpn --genkey --secret /etc/openvpn/ta.key Sat Mar 18 11:05:32 2023 WARNING: cannot stat file 'ta.key': No such file or directory (errno=2) Options error: --tls-auth fails with 'ta.key': No such file or directory (errno=2) Options error: Please correct these errors. Use --help for more information. # æŸ¥çœ‹çŠ¶æ€ [root@openvpn-centos7 server]# systemctl status openvpn@server â— openvpn@server.service - OpenVPN Robust And Highly Flexible Tunneling Application On server Loaded: loaded (/usr/lib/systemd/system/openvpn@.service; enabled; vendor preset: disabled) Active: active (running) since Sat 2023-03-18 11:23:23 CST; 1min 59s ago Main PID: 2769 (openvpn) Status: \"Initialization Sequence Completed\" CGroup: /system.slice/system-openvpn.slice/openvpn@server.service â””â”€2769 /usr/sbin/openvpn --cd /etc/openvpn/ --config server.conf Mar 18 11:23:23 openvpn-centos7 systemd[1]: Starting OpenVPN Robust And Highly Flexible Tunneling Application On server... Mar 18 11:23:23 openvpn-centos7 systemd[1]: Started OpenVPN Robust And Highly Flexible Tunneling Application On server å‡†å¤‡ OpenVPN å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ å®¢æˆ·ç«¯é»˜è®¤èŒƒä¾‹é…ç½®æ–‡ä»¶è¯´æ˜ [root@openvpn-centos7 server]#grep '^[[:alpha:]].*' /usr/share/doc/openvpn/sample/sample- config-files/client.conf client #æŒ‡æ˜å®¢æˆ·ç«¯ dev tun #æŒ‡å®šå’ŒæœåŠ¡ç«¯ä¸€è‡´çš„æ¥å£ç±»å‹ proto udp #æŒ‡å®šå’ŒæœåŠ¡ç«¯ä¸€è‡´çš„åè®®ç±»å‹ remote my-server-1 1194 #æœåŠ¡å™¨ç«¯çš„ipæˆ–FQDNåŠç«¯å£ resolv-retry infinite #æŒ‡å®šæœåŠ¡å™¨ç«¯FQDNè€ŒéIPæ—¶ï¼Œå½“å®¢æˆ·ç«¯é‡æ–°è¿æ¥åä¼šé‡æ–°è§£FQDNå¯¹åº”çš„IP nobind #å®¢æˆ·ç«¯ä¸ç»‘å®šç›‘å¬ç«¯å£ï¼Œéšæœºæ‰“å¼€ç«¯å£è¿æ¥åˆ°æœåŠ¡ç«¯çš„ç«¯å£ persist-key persist-tun ca ca.crt cert client.crt key client.key remote-cert-tls server #ä½¿ç”¨æœåŠ¡å™¨è¯ä¹¦æ ¡éªŒæ–¹å¼ tls-auth ta.key 1 #å®‰å…¨åŠ å¼º cipher AES-256-CBC verb 3 ç”Ÿæˆå®¢æˆ·ç«¯ç”¨æˆ·çš„é…ç½®æ–‡ä»¶ #ç”Ÿæˆå®¢æˆ·ç«¯æ–‡ä»¶,æ–‡ä»¶åç¼€å¿…é¡»ä¸º.ovpn [root@openvpn-centos7 server]#grep '^[[:alpha:]].*' /usr/share/doc/openvpn/sample/sample- config-files/client.conf \u003e /etc/openvpn/client/wangxiaochun/client.ovpn #ä¿®æ”¹é…ç½®æ–‡ä»¶,å†…å®¹å¦‚ä¸‹ [root@openvpn-centos7 server]#vim /etc/openvpn/client/wangxiaochun/client.ovpn [root@openvpn-centos7 server]#cat /etc/openvpn/client/wangxiaochun/client.ovpn client dev tun proto tcp remote 192.1681.110 1194 #ç”Ÿäº§ä¸­ä¸ºOpenVPNå…¬ç½‘IPæˆ–è€…FQDN resolv-retry infinite nobind #persist-key #persist-tun ca ca.crt cert dev.crt key dev.key remote-cert-tls server #tls-auth ta.key 1 cipher AES-256-CBC verb 3 #æ­¤å€¼ä¸èƒ½éšæ„æŒ‡å®š,å¦åˆ™æ— æ³•é€šä¿¡ compress lz4-v2 #æ­¤é¡¹åœ¨OpenVPN2.4.Xç‰ˆæœ¬ä½¿ç”¨,éœ€è¦å’ŒæœåŠ¡å™¨ç«¯ä¿æŒä¸€è‡´,å¦‚ä¸æŒ‡å®š,é»˜è®¤ä½¿ç”¨ comp-lzå‹ç¼© å®ç° OpenVPN å®¢æˆ·ç«¯ Windows å®¢æˆ·ç«¯å®‰è£…çœç•¥ Windows å®¢æˆ·ç«¯é…ç½®å‡†å¤‡ ä¿å­˜è¯ä¹¦åˆ°openvpn å®¢æˆ·ç«¯å®‰è£…ç›®å½•\n#åœ¨æœåŠ¡å™¨æ‰“åŒ…è¯ä¹¦å¹¶ä¸‹è½½å‘é€ç»™windowså®¢æˆ·ç«¯ [root@openvpn-centos7 dev]# pwd /etc/openvpn/client/dev [root@openvpn-centos7 dev]# ll total 20 -rw------- 1 root root 1176 Mar 18 10:01 ca.crt -rw------- 1 root root 4425 Mar 18 10:01 dev.crt -rw-r--r-- 1 root root 235 Mar 18 11:35 dev.ovpn -rw------- 1 root root 883 Mar 18 10:01 dev.req [root@openvpn-centos7 dev]# # æ”¾ç½®åˆ°windowså®¢æˆ·ç«¯é»˜è®¤å®‰è£…ç›®å½•ä¸‹ C:\\Program Files\\OpenVPN\\config ç›®å½• å®ç°è®¿é—®VPNæœåŠ¡å™¨çš„å†…ç½‘ä¸»æœº #åœ¨æœåŠ¡å™¨å¼€å¯ip_forwardè½¬å‘åŠŸèƒ½ [root@openvpn-centos7 dev]#echo net.ipv4.ip_forward = 1 \u003e\u003e /etc/sysctl.conf [root@openvpn-centos7 dev]#sysctl -p net.ipv4.ip_forward = 1 é…ç½®å®ç°å†…ç½‘æœåŠ¡å™¨å›åº”å¤–ç½‘çš„è¯·æ±‚çš„è·¯ç”± #é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸æ”¯æŒä¿®æ”¹è·¯ç”± [root@web1 ~]#route add -net 10.8.0.0/24 gw 172.30.0.1 åœ¨OpenVPNæœåŠ¡å™¨é…ç½® iptables è§„åˆ™ #æ·»åŠ SNATè§„åˆ™ #æ–¹æ³•1 [root@openvpn-centos7 ~]#echo 'iptables -t nat -A POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j MASQUERADE' \u003e\u003e /etc/rc.d/rc.local #æ–¹æ³•2 [root@openvpn-centos7 ~]#echo 'iptables -t nat -A POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to-source 172.30.0.1' \u003e\u003e /etc/rc.d/rc.local åŠé”€æŒ‡å®šçš„ç”¨æˆ·çš„è¯ä¹¦ [root@openvpn-centos7 ~]# cd /etc/openvpn/easy-rsa-server/3 [root@openvpn-centos7 3]#./easyrsa revoke dev ",
  "wordCount" : "5157",
  "inLanguage": "en",
  "image":"https://xyenvy.github.io/posts.images/banner/28.jpg","datePublished": "2023-03-17T21:51:21Z",
  "dateModified": "2023-03-17T21:51:21Z",
  "author":[{
    "@type": "Person",
    "name": "Hopeful"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://xyenvy.github.io/posts/openvpn%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Hopeful",
    "logo": {
      "@type": "ImageObject",
      "url": "https://xyenvy.github.io/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://xyenvy.github.io" accesskey="h" title="Hopeful (Alt + H)">
            <img src="https://xyenvy.github.io/img/Q.gif" alt="logo" aria-label="logo"
                 height="35">Hopeful</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://xyenvy.github.io/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                <span>ğŸ” æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/" title="ğŸ  ä¸»é¡µ">
                <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/posts" title="ğŸ“š æ–‡ç« ">
                <span>ğŸ“š æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/tags" title="ğŸ§© æ ‡ç­¾">
                <span>ğŸ§© æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/archives/" title="â±ï¸ æ—¶é—´è½´">
                <span>â±ï¸ æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº">
                <span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://xyenvy.github.io">ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://xyenvy.github.io/posts/">ğŸ“šæ–‡ç« </a></div>
            <h1 class="post-title">
                OpenVPNå®‰è£…å’Œä½¿ç”¨
            </h1>
            <div class="post-description">
                OpenVPN æ˜¯Linuxä¸‹å¼€æºVPNçš„åº”ç”¨ï¼Œæä¾›äº†è‰¯å¥½çš„æ€§èƒ½å’Œå‹å¥½çš„ç”¨æˆ·GUI;OpenVPN æ˜¯ä¸€ä¸ªåŸºäº OpenSSL åº“çš„åº”ç”¨å±‚ VPN å®ç°ã€‚å’Œä¼ ç»Ÿ VPN ç›¸æ¯”ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•æ˜“ç”¨
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-03-17
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>5157å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>11åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>Hopeful
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://xyenvy.github.io/tags/openvpn/" style="color: var(--secondary)!important;">OpenVPN</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "https://xyenvy.github.io"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="https://xyenvy.github.io/posts.images/banner/28.jpg" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">æ–‡ç« ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%87%86%e5%a4%87%e9%83%a8%e7%bd%b2openvpn%e7%8e%af%e5%a2%83" aria-label="å‡†å¤‡éƒ¨ç½²OpenVPNç¯å¢ƒ">å‡†å¤‡éƒ¨ç½²OpenVPNç¯å¢ƒ</a></li>
                <li>
                    <a href="#%e9%83%a8%e7%bd%b2%e7%8e%af%e5%a2%83%e5%a6%82%e4%b8%8b" aria-label="éƒ¨ç½²ç¯å¢ƒå¦‚ä¸‹">éƒ¨ç½²ç¯å¢ƒå¦‚ä¸‹</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-openvpn" aria-label="å®‰è£… OpenVPN">å®‰è£… OpenVPN</a><ul>
                        
                <li>
                    <a href="#%e5%ae%89%e8%a3%85-openvpn-%e5%92%8c%e8%af%81%e4%b9%a6%e5%b7%a5%e5%85%b7" aria-label="å®‰è£… OpenVPN å’Œè¯ä¹¦å·¥å…·">å®‰è£… OpenVPN å’Œè¯ä¹¦å·¥å…·</a></li>
                <li>
                    <a href="#%e5%87%86%e5%a4%87%e7%9b%b8%e5%85%b3%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="å‡†å¤‡ç›¸å…³é…ç½®æ–‡ä»¶">å‡†å¤‡ç›¸å…³é…ç½®æ–‡ä»¶</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%87%86%e5%a4%87%e8%af%81%e4%b9%a6%e7%9b%b8%e5%85%b3%e6%96%87%e4%bb%b6" aria-label="å‡†å¤‡è¯ä¹¦ç›¸å…³æ–‡ä»¶">å‡†å¤‡è¯ä¹¦ç›¸å…³æ–‡ä»¶</a><ul>
                        
                <li>
                    <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96pki%e5%92%8cca%e9%a2%81%e5%8f%91%e6%9c%ba%e6%9e%84%e7%8e%af%e5%a2%83" aria-label="åˆå§‹åŒ–PKIå’ŒCAé¢å‘æœºæ„ç¯å¢ƒ">åˆå§‹åŒ–PKIå’ŒCAé¢å‘æœºæ„ç¯å¢ƒ</a><ul>
                        
                <li>
                    <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96pki%e7%94%9f%e6%88%90pki%e7%9b%b8%e5%85%b3%e7%9b%ae%e5%bd%95%e5%92%8c%e6%96%87%e4%bb%b6" aria-label="åˆå§‹åŒ–PKIç”ŸæˆPKIç›¸å…³ç›®å½•å’Œæ–‡ä»¶">åˆå§‹åŒ–PKIç”ŸæˆPKIç›¸å…³ç›®å½•å’Œæ–‡ä»¶</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba-ca-%e6%9c%ba%e6%9e%84%e7%8e%af%e5%a2%83" aria-label="åˆ›å»º CA æœºæ„ç¯å¢ƒ">åˆ›å»º CA æœºæ„ç¯å¢ƒ</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e6%9c%8d%e5%8a%a1%e7%ab%af%e8%af%81%e4%b9%a6%e7%94%b3%e8%af%b7" aria-label="åˆ›å»ºæœåŠ¡ç«¯è¯ä¹¦ç”³è¯·">åˆ›å»ºæœåŠ¡ç«¯è¯ä¹¦ç”³è¯·</a></li>
                <li>
                    <a href="#%e9%a2%81%e5%8f%91%e6%9c%8d%e5%8a%a1%e7%ab%af%e8%af%81%e4%b9%a6" aria-label="é¢å‘æœåŠ¡ç«¯è¯ä¹¦">é¢å‘æœåŠ¡ç«¯è¯ä¹¦</a><ul>
                        
                <li>
                    <a href="#%e9%aa%8c%e8%af%81%e7%bb%93%e6%9e%9c" aria-label="éªŒè¯ç»“æœ">éªŒè¯ç»“æœ</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba-diffie-hellman-%e5%af%86%e9%92%a5" aria-label="åˆ›å»º Diffie-Hellman å¯†é’¥">åˆ›å»º Diffie-Hellman å¯†é’¥</a></li>
                <li>
                    <a href="#%e5%87%86%e5%a4%87%e5%ae%a2%e6%88%b7%e7%ab%af%e8%af%81%e4%b9%a6%e7%8e%af%e5%a2%83" aria-label="å‡†å¤‡å®¢æˆ·ç«¯è¯ä¹¦ç¯å¢ƒ">å‡†å¤‡å®¢æˆ·ç«¯è¯ä¹¦ç¯å¢ƒ</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e5%ae%a2%e6%88%b7%e7%ab%af%e8%af%81%e4%b9%a6%e7%94%b3%e8%af%b7" aria-label="åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ç”³è¯·">åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ç”³è¯·</a></li>
                <li>
                    <a href="#%e9%a2%81%e5%8f%91%e5%ae%a2%e6%88%b7%e7%ab%af%e8%af%81%e4%b9%a6" aria-label="é¢å‘å®¢æˆ·ç«¯è¯ä¹¦">é¢å‘å®¢æˆ·ç«¯è¯ä¹¦</a></li>
                <li>
                    <a href="#%e5%b0%86ca%e5%92%8c%e6%9c%8d%e5%8a%a1%e5%99%a8%e8%af%81%e4%b9%a6%e7%9b%b8%e5%85%b3%e6%96%87%e4%bb%b6%e5%a4%8d%e5%88%b6%e5%88%b0%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%9b%b8%e5%ba%94%e7%9a%84%e7%9b%ae%e5%bd%95" aria-label="å°†CAå’ŒæœåŠ¡å™¨è¯ä¹¦ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ç›¸åº”çš„ç›®å½•">å°†CAå’ŒæœåŠ¡å™¨è¯ä¹¦ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ç›¸åº”çš„ç›®å½•</a></li>
                <li>
                    <a href="#%e5%b0%86%e5%ae%a2%e6%88%b7%e7%ab%af%e7%a7%81%e9%92%a5%e4%b8%8e%e8%af%81%e4%b9%a6%e7%9b%b8%e5%85%b3%e6%96%87%e4%bb%b6%e5%a4%8d%e5%88%b6%e5%88%b0%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%9b%b8%e5%85%b3%e7%9a%84%e7%9b%ae%e5%bd%95" aria-label="å°†å®¢æˆ·ç«¯ç§é’¥ä¸è¯ä¹¦ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ç›¸å…³çš„ç›®å½•">å°†å®¢æˆ·ç«¯ç§é’¥ä¸è¯ä¹¦ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ç›¸å…³çš„ç›®å½•</a></li>
                <li>
                    <a href="#%e5%87%86%e5%a4%87-openvpn-%e6%9c%8d%e5%8a%a1%e5%99%a8%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="å‡†å¤‡ OpenVPN æœåŠ¡å™¨é…ç½®æ–‡ä»¶">å‡†å¤‡ OpenVPN æœåŠ¡å™¨é…ç½®æ–‡ä»¶</a><ul>
                        
                <li>
                    <a href="#%e4%bf%ae%e6%94%b9%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ab%af%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="ä¿®æ”¹æœåŠ¡å™¨ç«¯é…ç½®æ–‡ä»¶">ä¿®æ”¹æœåŠ¡å™¨ç«¯é…ç½®æ–‡ä»¶</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%90%af%e5%8a%a8-openvpn-%e6%9c%8d%e5%8a%a1" aria-label="å¯åŠ¨ OpenVPN æœåŠ¡">å¯åŠ¨ OpenVPN æœåŠ¡</a></li>
                <li>
                    <a href="#%e5%87%86%e5%a4%87-openvpn-%e5%ae%a2%e6%88%b7%e7%ab%af%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="å‡†å¤‡ OpenVPN å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶">å‡†å¤‡ OpenVPN å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶</a><ul>
                        
                <li>
                    <a href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e9%bb%98%e8%ae%a4%e8%8c%83%e4%be%8b%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e8%af%b4%e6%98%8e" aria-label="å®¢æˆ·ç«¯é»˜è®¤èŒƒä¾‹é…ç½®æ–‡ä»¶è¯´æ˜">å®¢æˆ·ç«¯é»˜è®¤èŒƒä¾‹é…ç½®æ–‡ä»¶è¯´æ˜</a></li>
                <li>
                    <a href="#%e7%94%9f%e6%88%90%e5%ae%a2%e6%88%b7%e7%ab%af%e7%94%a8%e6%88%b7%e7%9a%84%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="ç”Ÿæˆå®¢æˆ·ç«¯ç”¨æˆ·çš„é…ç½®æ–‡ä»¶">ç”Ÿæˆå®¢æˆ·ç«¯ç”¨æˆ·çš„é…ç½®æ–‡ä»¶</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0-openvpn-%e5%ae%a2%e6%88%b7%e7%ab%af" aria-label="å®ç° OpenVPN å®¢æˆ·ç«¯">å®ç° OpenVPN å®¢æˆ·ç«¯</a><ul>
                        
                <li>
                    <a href="#windows-%e5%ae%a2%e6%88%b7%e7%ab%af%e5%ae%89%e8%a3%85%e7%9c%81%e7%95%a5" aria-label="Windows å®¢æˆ·ç«¯å®‰è£…çœç•¥">Windows å®¢æˆ·ç«¯å®‰è£…çœç•¥</a></li>
                <li>
                    <a href="#windows-%e5%ae%a2%e6%88%b7%e7%ab%af%e9%85%8d%e7%bd%ae%e5%87%86%e5%a4%87" aria-label="Windows å®¢æˆ·ç«¯é…ç½®å‡†å¤‡">Windows å®¢æˆ·ç«¯é…ç½®å‡†å¤‡</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0%e8%ae%bf%e9%97%aevpn%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%9a%84%e5%86%85%e7%bd%91%e4%b8%bb%e6%9c%ba" aria-label="å®ç°è®¿é—®VPNæœåŠ¡å™¨çš„å†…ç½‘ä¸»æœº">å®ç°è®¿é—®VPNæœåŠ¡å™¨çš„å†…ç½‘ä¸»æœº</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae%e5%ae%9e%e7%8e%b0%e5%86%85%e7%bd%91%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%9b%9e%e5%ba%94%e5%a4%96%e7%bd%91%e7%9a%84%e8%af%b7%e6%b1%82%e7%9a%84%e8%b7%af%e7%94%b1" aria-label="é…ç½®å®ç°å†…ç½‘æœåŠ¡å™¨å›åº”å¤–ç½‘çš„è¯·æ±‚çš„è·¯ç”±">é…ç½®å®ç°å†…ç½‘æœåŠ¡å™¨å›åº”å¤–ç½‘çš„è¯·æ±‚çš„è·¯ç”±</a></li>
                <li>
                    <a href="#%e5%9c%a8openvpn%e6%9c%8d%e5%8a%a1%e5%99%a8%e9%85%8d%e7%bd%ae-iptables-%e8%a7%84%e5%88%99" aria-label="åœ¨OpenVPNæœåŠ¡å™¨é…ç½® iptables è§„åˆ™">åœ¨OpenVPNæœåŠ¡å™¨é…ç½® iptables è§„åˆ™</a></li>
                <li>
                    <a href="#%e5%90%8a%e9%94%80%e6%8c%87%e5%ae%9a%e7%9a%84%e7%94%a8%e6%88%b7%e7%9a%84%e8%af%81%e4%b9%a6" aria-label="åŠé”€æŒ‡å®šçš„ç”¨æˆ·çš„è¯ä¹¦">åŠé”€æŒ‡å®šçš„ç”¨æˆ·çš„è¯ä¹¦</a>
                </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h2 id="å‡†å¤‡éƒ¨ç½²openvpnç¯å¢ƒ">å‡†å¤‡éƒ¨ç½²OpenVPNç¯å¢ƒ<a hidden class="anchor" aria-hidden="true" href="#å‡†å¤‡éƒ¨ç½²openvpnç¯å¢ƒ">#</a></h2>
<h2 id="éƒ¨ç½²ç¯å¢ƒå¦‚ä¸‹">éƒ¨ç½²ç¯å¢ƒå¦‚ä¸‹<a hidden class="anchor" aria-hidden="true" href="#éƒ¨ç½²ç¯å¢ƒå¦‚ä¸‹">#</a></h2>
<p>å…±å››å°ä¸»æœº
1 openvpn serverï¼š
CentOS 7.9
ens33:192.168.1.110/24 NATæ¨¡å¼,æ¨¡æ‹Ÿå…¬ç½‘IP
ens36:172.30.0.1/24 ä»…ä¸»æœºæ¨¡å¼,ç§ç½‘IP
2 å†…ç½‘ä¸»æœºä¸¤å°
ç¬¬ä¸€å°ä¸»æœº
ens33172.30.0.100/24 ä»…ä¸»æœºæ¨¡å¼,ç§ç½‘IPï¼Œæ— éœ€ç½‘å…³
ç¬¬äºŒå°ä¸»æœº
ens33172.30.0.200/24 ä»…ä¸»æœºæ¨¡å¼,ç§ç½‘IPï¼Œæ— éœ€ç½‘å…³</p>
<p>3 Windows å®¢æˆ·ç«¯
Windows 10/11</p>
<h2 id="å®‰è£…-openvpn">å®‰è£… OpenVPN<a hidden class="anchor" aria-hidden="true" href="#å®‰è£…-openvpn">#</a></h2>
<h3 id="å®‰è£…-openvpn-å’Œè¯ä¹¦å·¥å…·">å®‰è£… OpenVPN å’Œè¯ä¹¦å·¥å…·<a hidden class="anchor" aria-hidden="true" href="#å®‰è£…-openvpn-å’Œè¯ä¹¦å·¥å…·">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#OpenVPNæœåŠ¡å™¨ç«¯</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 ~<span style="color:#f92672">]</span><span style="color:#75715e">#yum -y install openvpn</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¯ä¹¦ç®¡ç†å·¥å…·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 ~<span style="color:#f92672">]</span><span style="color:#75715e">#yum -y install easy-rsa</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…ç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 ~<span style="color:#f92672">]</span><span style="color:#75715e"># yum list openvpn</span>
</span></span><span style="display:flex;"><span>Loaded plugins: fastestmirror
</span></span><span style="display:flex;"><span>Loading mirror speeds from cached hostfile
</span></span><span style="display:flex;"><span> * base: mirrors.ustc.edu.cn
</span></span><span style="display:flex;"><span> * epel: ftp.riken.jp
</span></span><span style="display:flex;"><span> * extras: mirrors.163.com
</span></span><span style="display:flex;"><span> * updates: mirrors.ustc.edu.cn
</span></span><span style="display:flex;"><span>Installed Packages
</span></span><span style="display:flex;"><span>openvpn.x86_64                                                           2.4.12-1.el7                                                            @epel
</span></span></code></pre></div><h3 id="å‡†å¤‡ç›¸å…³é…ç½®æ–‡ä»¶">å‡†å¤‡ç›¸å…³é…ç½®æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#å‡†å¤‡ç›¸å…³é…ç½®æ–‡ä»¶">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># ç”ŸæˆæœåŠ¡å™¨é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cp /usr/share/doc/openvpn-2.4.12/sample/sample-config-files/server.conf /etc/openvpn</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‡†å¤‡è¯ä¹¦é¢å‘ç›¸å…³æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cp -r /usr/share/easy-rsa/ /etc/openvpn/easy-rsa-server</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‡†å¤‡é¢å‘è¯ä¹¦ç›¸å…³å˜é‡çš„é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cp /usr/share/doc/easy-rsa-3.0.8/vars.example /etc/openvpn/easy-rsa-server/3/vars</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å»ºè®®ä¿®æ”¹ç»™CAå’ŒOpenVPNæœåŠ¡å™¨é¢å‘çš„è¯ä¹¦çš„æœ‰æ•ˆæœŸ,å¯é€‚å½“åŠ é•¿</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim /etc/openvpn/easy-rsa-server/3/vars </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#CAçš„è¯ä¹¦é»˜è®¤æœ‰æ•ˆæœŸä¸º10å¹´,å¯ä»¥é€‚å½“å»¶é•¿,æ¯”å¦‚:36500å¤©</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#set_var EASYRSA_CA_EXPIRE 3650</span>
</span></span><span style="display:flex;"><span>set_var EASYRSA_CA_EXPIRE <span style="color:#ae81ff">36500</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æœåŠ¡å™¨è¯ä¹¦é»˜ä¸ºä¸º825å¤©,å¯é€‚å½“åŠ é•¿,æ¯”å¦‚:3650å¤©</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#set_var EASYRSA_CERT_EXPIRE 825</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å°†ä¸Šé¢è¡Œä¿®æ”¹ä¸ºä¸‹é¢</span>
</span></span><span style="display:flex;"><span>set_var EASYRSA_CERT_EXPIRE <span style="color:#ae81ff">3650</span>
</span></span></code></pre></div><h2 id="å‡†å¤‡è¯ä¹¦ç›¸å…³æ–‡ä»¶">å‡†å¤‡è¯ä¹¦ç›¸å…³æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#å‡†å¤‡è¯ä¹¦ç›¸å…³æ–‡ä»¶">#</a></h2>
<h3 id="åˆå§‹åŒ–pkiå’Œcaé¢å‘æœºæ„ç¯å¢ƒ">åˆå§‹åŒ–PKIå’ŒCAé¢å‘æœºæ„ç¯å¢ƒ<a hidden class="anchor" aria-hidden="true" href="#åˆå§‹åŒ–pkiå’Œcaé¢å‘æœºæ„ç¯å¢ƒ">#</a></h3>
<h4 id="åˆå§‹åŒ–pkiç”Ÿæˆpkiç›¸å…³ç›®å½•å’Œæ–‡ä»¶">åˆå§‹åŒ–PKIç”ŸæˆPKIç›¸å…³ç›®å½•å’Œæ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#åˆå§‹åŒ–pkiç”Ÿæˆpkiç›¸å…³ç›®å½•å’Œæ–‡ä»¶">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥è¯¥ç›®å½•ä¸‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>/etc/openvpn/easy-rsa-server/3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆå§‹åŒ–æ•°æ®,åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆpkiç›®å½•åŠç›¸å…³æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># ./easyrsa init-pki</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>init-pki complete; you may now create a CA or requests.
</span></span><span style="display:flex;"><span>Your newly created PKI dir is: /etc/openvpn/easy-rsa-server/3/pki
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># tree</span>
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>â”œâ”€â”€ easyrsa
</span></span><span style="display:flex;"><span>â”œâ”€â”€ openssl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ pki  <span style="color:#75715e">#ç”Ÿæˆä¸€ä¸ªæ–°ç›®å½•åŠç›¸å…³æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ openssl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ private
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ reqs
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ safessl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ vars
</span></span><span style="display:flex;"><span>â””â”€â”€ x509-types
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ ca
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ client
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ code-signing
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ COMMON
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ email
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ kdc
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ server
</span></span><span style="display:flex;"><span>    â””â”€â”€ serverClient
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span> directories, <span style="color:#ae81ff">13</span> files
</span></span></code></pre></div><h3 id="åˆ›å»º-ca-æœºæ„ç¯å¢ƒ">åˆ›å»º CA æœºæ„ç¯å¢ƒ<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»º-ca-æœºæ„ç¯å¢ƒ">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥è¯¥ç›®å½•ä¸‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>/etc/openvpn/easy-rsa-server/3
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># tree pki/</span>
</span></span><span style="display:flex;"><span>pki/
</span></span><span style="display:flex;"><span>â”œâ”€â”€ openssl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ private
</span></span><span style="display:flex;"><span>â”œâ”€â”€ reqs
</span></span><span style="display:flex;"><span>â””â”€â”€ safessl-easyrsa.cnf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> directories, <span style="color:#ae81ff">2</span> files
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># ./easyrsa build-ca nopass   # nopass ä¸éœ€è¦å¯†ç </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars
</span></span><span style="display:flex;"><span>Using SSL: openssl OpenSSL 1.0.2k-fips  <span style="color:#ae81ff">26</span> Jan <span style="color:#ae81ff">2017</span>
</span></span><span style="display:flex;"><span>Generating RSA private key, <span style="color:#ae81ff">2048</span> bit long modulus
</span></span><span style="display:flex;"><span>....+++
</span></span><span style="display:flex;"><span>......+++
</span></span><span style="display:flex;"><span>e is <span style="color:#ae81ff">65537</span> <span style="color:#f92672">(</span>0x10001<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>You are about to be asked to enter information that will be incorporated
</span></span><span style="display:flex;"><span>into your certificate request.
</span></span><span style="display:flex;"><span>What you are about to enter is what is called a Distinguished Name or a DN.
</span></span><span style="display:flex;"><span>There are quite a few fields but you can leave some blank
</span></span><span style="display:flex;"><span>For some fields there will be a default value,
</span></span><span style="display:flex;"><span>If you enter <span style="color:#e6db74">&#39;.&#39;</span>, the field will be left blank.
</span></span><span style="display:flex;"><span>-----
</span></span><span style="display:flex;"><span>Common Name <span style="color:#f92672">(</span>eg: your user, host, or server name<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Easy-RSA CA<span style="color:#f92672">]</span>: <span style="color:#75715e"># å›è½¦æ¥å—é»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CA creation complete and you may now import and sign cert requests.
</span></span><span style="display:flex;"><span>Your new CA certificate file <span style="color:#66d9ef">for</span> publishing is at:
</span></span><span style="display:flex;"><span>/etc/openvpn/easy-rsa-server/3/pki/ca.crt <span style="color:#75715e">#ç”Ÿæˆè‡ªç­¾åçš„è¯ä¹¦æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e">#tree pki</span>
</span></span><span style="display:flex;"><span>pki
</span></span><span style="display:flex;"><span>â”œâ”€â”€ ca.crt <span style="color:#75715e">#ç”Ÿæˆçš„è‡ªç­¾åçš„è¯ä¹¦æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”œâ”€â”€ certs_by_serial
</span></span><span style="display:flex;"><span>â”œâ”€â”€ index.txt
</span></span><span style="display:flex;"><span>â”œâ”€â”€ index.txt.attr
</span></span><span style="display:flex;"><span>â”œâ”€â”€ issued
</span></span><span style="display:flex;"><span>â”œâ”€â”€ openssl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ private
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ ca.key <span style="color:#75715e">#ç”Ÿæˆçš„ç§é’¥æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”œâ”€â”€ renewed
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ certs_by_serial
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ private_by_serial
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ reqs_by_serial
</span></span><span style="display:flex;"><span>â”œâ”€â”€ reqs
</span></span><span style="display:flex;"><span>â”œâ”€â”€ revoked
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ certs_by_serial
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ private_by_serial
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ reqs_by_serial
</span></span><span style="display:flex;"><span>â”œâ”€â”€ safessl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â””â”€â”€ serial
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">12</span> directories, <span style="color:#ae81ff">7</span> files
</span></span></code></pre></div><h3 id="åˆ›å»ºæœåŠ¡ç«¯è¯ä¹¦ç”³è¯·">åˆ›å»ºæœåŠ¡ç«¯è¯ä¹¦ç”³è¯·<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»ºæœåŠ¡ç«¯è¯ä¹¦ç”³è¯·">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥è¯¥ç›®å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>/etc/openvpn/easy-rsa-server/3
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># ./easyrsa gen-req server nopass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars
</span></span><span style="display:flex;"><span>Using SSL: openssl OpenSSL 1.0.2k-fips  <span style="color:#ae81ff">26</span> Jan <span style="color:#ae81ff">2017</span>
</span></span><span style="display:flex;"><span>Generating a <span style="color:#ae81ff">2048</span> bit RSA private key
</span></span><span style="display:flex;"><span>..........................................................................................................................................................+++
</span></span><span style="display:flex;"><span>......................+++
</span></span><span style="display:flex;"><span>writing new private key to <span style="color:#e6db74">&#39;/etc/openvpn/easy-rsa-server/3/pki/easy-rsa-1605.nDSXm1/tmp.2RnHiQ&#39;</span>
</span></span><span style="display:flex;"><span>-----
</span></span><span style="display:flex;"><span>You are about to be asked to enter information that will be incorporated
</span></span><span style="display:flex;"><span>into your certificate request.
</span></span><span style="display:flex;"><span>What you are about to enter is what is called a Distinguished Name or a DN.
</span></span><span style="display:flex;"><span>There are quite a few fields but you can leave some blank
</span></span><span style="display:flex;"><span>For some fields there will be a default value,
</span></span><span style="display:flex;"><span>If you enter <span style="color:#e6db74">&#39;.&#39;</span>, the field will be left blank.
</span></span><span style="display:flex;"><span>-----
</span></span><span style="display:flex;"><span>Common Name <span style="color:#f92672">(</span>eg: your user, host, or server name<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>server<span style="color:#f92672">]</span>: <span style="color:#75715e">#æ¥å—Common Nameçš„é»˜è®¤</span>
</span></span><span style="display:flex;"><span>å€¼,ç›´æ¥å›è½¦
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Keypair and certificate request completed. Your files are:
</span></span><span style="display:flex;"><span>req: /etc/openvpn/easy-rsa-server/3/pki/reqs/server.req <span style="color:#75715e">#ç”Ÿæˆè¯·æ±‚æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>key: /etc/openvpn/easy-rsa-server/3/pki/private/server.key <span style="color:#75715e">#ç”Ÿæˆç§é’¥æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e">#tree pki</span>
</span></span><span style="display:flex;"><span>pki
</span></span><span style="display:flex;"><span>â”œâ”€â”€ ca.crt
</span></span><span style="display:flex;"><span>â”œâ”€â”€ certs_by_serial
</span></span><span style="display:flex;"><span>â”œâ”€â”€ index.txt
</span></span><span style="display:flex;"><span>â”œâ”€â”€ index.txt.attr
</span></span><span style="display:flex;"><span>â”œâ”€â”€ issued
</span></span><span style="display:flex;"><span>â”œâ”€â”€ openssl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ private
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ ca.key
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ server.key <span style="color:#75715e">#ç”Ÿæˆç§é’¥æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”œâ”€â”€ renewed
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ certs_by_serial
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ private_by_serial
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ reqs_by_serial
</span></span><span style="display:flex;"><span>â”œâ”€â”€ reqs
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ server.req <span style="color:#75715e">#ç”Ÿæˆè¯·æ±‚æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”œâ”€â”€ revoked
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ certs_by_serial
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ private_by_serial
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ reqs_by_serial
</span></span><span style="display:flex;"><span>â”œâ”€â”€ safessl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â””â”€â”€ serial
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">12</span> directories, <span style="color:#ae81ff">9</span> files
</span></span></code></pre></div><h3 id="é¢å‘æœåŠ¡ç«¯è¯ä¹¦">é¢å‘æœåŠ¡ç«¯è¯ä¹¦<a hidden class="anchor" aria-hidden="true" href="#é¢å‘æœåŠ¡ç«¯è¯ä¹¦">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#å°†ä¸Šé¢server.reqçš„ç”³è¯·,é¢å‘serverç±»å‹çš„è¯ä¹¦</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e">#cd /etc/openvpn/easy-rsa-server/3</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ç¬¬ä¸€ä¸ªserverè¡¨ç¤ºè¯ä¹¦çš„ç±»å‹,ç¬¬äºŒä¸ªserverè¡¨ç¤ºè¯·æ±‚æ–‡ä»¶åçš„å‰ç¼€</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># ./easyrsa sign server server</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars
</span></span><span style="display:flex;"><span>Using SSL: openssl OpenSSL 1.0.2k-fips  <span style="color:#ae81ff">26</span> Jan <span style="color:#ae81ff">2017</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>You are about to sign the following certificate.
</span></span><span style="display:flex;"><span>Please check over the details shown below <span style="color:#66d9ef">for</span> accuracy. Note that this request
</span></span><span style="display:flex;"><span>has not been cryptographically verified. Please be sure it came from a trusted
</span></span><span style="display:flex;"><span>source or that you have verified the request checksum with the sender.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Request subject, to be signed as a server certificate <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">3650</span> days:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>subject<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    commonName                <span style="color:#f92672">=</span> server
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Type the word <span style="color:#e6db74">&#39;yes&#39;</span> to <span style="color:#66d9ef">continue</span>, or any other input to abort.
</span></span><span style="display:flex;"><span>  Confirm request details: yes  <span style="color:#75715e"># è¾“å…¥yes</span>
</span></span><span style="display:flex;"><span>Using configuration from /etc/openvpn/easy-rsa-server/3/pki/easy-rsa-1634.ZCYI5M/tmp.2SsU9O
</span></span><span style="display:flex;"><span>Check that the request matches the signature
</span></span><span style="display:flex;"><span>Signature ok
</span></span><span style="display:flex;"><span>The Subject<span style="color:#e6db74">&#39;s Distinguished Name is as follows
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">commonName            :ASN.1 12:&#39;</span>server<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>Certificate is to be certified <span style="color:#66d9ef">until</span> Mar <span style="color:#ae81ff">15</span> 01:27:03 <span style="color:#ae81ff">2033</span> GMT <span style="color:#f92672">(</span><span style="color:#ae81ff">3650</span> days<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Write out database with <span style="color:#ae81ff">1</span> new entries
</span></span><span style="display:flex;"><span>Data Base Updated
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Certificate created at: /etc/openvpn/easy-rsa-server/3/pki/issued/server.crt <span style="color:#75715e">#ç”Ÿ</span>
</span></span><span style="display:flex;"><span>æˆæœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶
</span></span></code></pre></div><h4 id="éªŒè¯ç»“æœ">éªŒè¯ç»“æœ<a hidden class="anchor" aria-hidden="true" href="#éªŒè¯ç»“æœ">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># tree pki/</span>
</span></span><span style="display:flex;"><span>pki/
</span></span><span style="display:flex;"><span>â”œâ”€â”€ ca.crt
</span></span><span style="display:flex;"><span>â”œâ”€â”€ certs_by_serial
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ EAD7A4786FA803EDD9A7166D0EC694C3.pem      <span style="color:#75715e">#ç”Ÿæˆçš„æœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”œâ”€â”€ index.txt
</span></span><span style="display:flex;"><span>â”œâ”€â”€ index.txt.attr
</span></span><span style="display:flex;"><span>â”œâ”€â”€ index.txt.attr.old
</span></span><span style="display:flex;"><span>â”œâ”€â”€ index.txt.old
</span></span><span style="display:flex;"><span>â”œâ”€â”€ issued
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ server.crt        <span style="color:#75715e">#ç”Ÿæˆçš„æœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”œâ”€â”€ openssl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ private
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ ca.key
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ server.key
</span></span><span style="display:flex;"><span>â”œâ”€â”€ renewed
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ certs_by_serial
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ private_by_serial
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ reqs_by_serial
</span></span><span style="display:flex;"><span>â”œâ”€â”€ reqs
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ server.req
</span></span><span style="display:flex;"><span>â”œâ”€â”€ revoked
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ certs_by_serial
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ private_by_serial
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ reqs_by_serial
</span></span><span style="display:flex;"><span>â”œâ”€â”€ safessl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ serial
</span></span><span style="display:flex;"><span>â””â”€â”€ serial.old
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">12</span> directories, <span style="color:#ae81ff">14</span> files
</span></span></code></pre></div><h3 id="åˆ›å»º-diffie-hellman-å¯†é’¥">åˆ›å»º Diffie-Hellman å¯†é’¥<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»º-diffie-hellman-å¯†é’¥">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># ./easyrsa gen-dh</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars
</span></span><span style="display:flex;"><span>Using SSL: openssl OpenSSL 1.0.2k-fips  <span style="color:#ae81ff">26</span> Jan <span style="color:#ae81ff">2017</span>
</span></span><span style="display:flex;"><span>Generating DH parameters, <span style="color:#ae81ff">2048</span> bit long safe prime, generator <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>This is going to take a long time
</span></span><span style="display:flex;"><span>...............................................................................................................................................................................+.  <span style="color:#75715e"># å¾—ç­‰ä¸€ä¼š</span>
</span></span><span style="display:flex;"><span>DH parameters of size <span style="color:#ae81ff">2048</span> created at /etc/openvpn/easy-rsa-server/3/pki/dh.pem
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># ll pki/dh.pem </span>
</span></span><span style="display:flex;"><span>-rw------- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">424</span> Mar <span style="color:#ae81ff">18</span> 09:34 pki/dh.pem
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span></code></pre></div><h3 id="å‡†å¤‡å®¢æˆ·ç«¯è¯ä¹¦ç¯å¢ƒ">å‡†å¤‡å®¢æˆ·ç«¯è¯ä¹¦ç¯å¢ƒ<a hidden class="anchor" aria-hidden="true" href="#å‡†å¤‡å®¢æˆ·ç«¯è¯ä¹¦ç¯å¢ƒ">#</a></h3>
<p>ä¸Šé¢æœåŠ¡ç«¯è¯ä¹¦é…ç½®å®Œæˆï¼Œä¸‹é¢æ˜¯é…ç½®å®¢æˆ·ç«¯è¯ä¹¦</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 /<span style="color:#f92672">]</span><span style="color:#75715e"># cp -a /usr/share/easy-rsa/ /etc/openvpn/easy-rsa-client</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥è¯¥ç›®å½•ä¸‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>/etc/openvpn/easy-rsa-client/3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ç”Ÿæˆè¯ä¹¦ç”³è¯·æ‰€éœ€ç›®å½•pkiå’Œæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># ./easyrsa init-pki</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>init-pki complete; you may now create a CA or requests.
</span></span><span style="display:flex;"><span>Your newly created PKI dir is: /etc/openvpn/easy-rsa-client/3/pki
</span></span></code></pre></div><h3 id="åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ç”³è¯·">åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ç”³è¯·<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ç”³è¯·">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥è¯¥ç›®å½•ä¸‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>/etc/openvpn/easy-rsa-client/3
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ç”Ÿæˆå®¢æˆ·ç«¯ç”¨æˆ·çš„è¯ä¹¦ç”³è¯·,devç”¨æˆ·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># ./easyrsa gen-req dev nopass</span>
</span></span><span style="display:flex;"><span>Using SSL: openssl OpenSSL 1.0.2k-fips  <span style="color:#ae81ff">26</span> Jan <span style="color:#ae81ff">2017</span>
</span></span><span style="display:flex;"><span>Generating a <span style="color:#ae81ff">2048</span> bit RSA private key
</span></span><span style="display:flex;"><span>......................................................+++
</span></span><span style="display:flex;"><span>.........................................................................................................................................................................................................+++
</span></span><span style="display:flex;"><span>writing new private key to <span style="color:#e6db74">&#39;/etc/openvpn/easy-rsa-client/3/pki/easy-rsa-1749.UROzYa/tmp.HqONRu&#39;</span>
</span></span><span style="display:flex;"><span>-----
</span></span><span style="display:flex;"><span>You are about to be asked to enter information that will be incorporated
</span></span><span style="display:flex;"><span>into your certificate request.
</span></span><span style="display:flex;"><span>What you are about to enter is what is called a Distinguished Name or a DN.
</span></span><span style="display:flex;"><span>There are quite a few fields but you can leave some blank
</span></span><span style="display:flex;"><span>For some fields there will be a default value,
</span></span><span style="display:flex;"><span>If you enter <span style="color:#e6db74">&#39;.&#39;</span>, the field will be left blank.
</span></span><span style="display:flex;"><span>-----
</span></span><span style="display:flex;"><span>Common Name <span style="color:#f92672">(</span>eg: your user, host, or server name<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>dev<span style="color:#f92672">]</span>: <span style="color:#75715e"># å›è½¦æ¥å—é»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Keypair and certificate request completed. Your files are:
</span></span><span style="display:flex;"><span>req: /etc/openvpn/easy-rsa-client/3/pki/reqs/dev.req  <span style="color:#75715e">#ç§é’¥æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>key: /etc/openvpn/easy-rsa-client/3/pki/private/dev.key  <span style="color:#75715e">#è¯ä¹¦ç”³è¯·æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ç”Ÿæˆä¸¤ä¸ªæ–°æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># tree</span>
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>â”œâ”€â”€ easyrsa
</span></span><span style="display:flex;"><span>â”œâ”€â”€ openssl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ pki
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ openssl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ private
</span></span><span style="display:flex;"><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ dev.key  <span style="color:#75715e">#ç§é’¥æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ reqs
</span></span><span style="display:flex;"><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ dev.req   <span style="color:#75715e">#è¯ä¹¦ç”³è¯·æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ safessl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â””â”€â”€ x509-types
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ ca
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ client
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ code-signing
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ COMMON
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ email
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ kdc
</span></span><span style="display:flex;"><span>    â”œâ”€â”€ server
</span></span><span style="display:flex;"><span>    â””â”€â”€ serverClient
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4</span> directories, <span style="color:#ae81ff">14</span> files
</span></span></code></pre></div><h3 id="é¢å‘å®¢æˆ·ç«¯è¯ä¹¦">é¢å‘å®¢æˆ·ç«¯è¯ä¹¦<a hidden class="anchor" aria-hidden="true" href="#é¢å‘å®¢æˆ·ç«¯è¯ä¹¦">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># è¿›å…¥è¯¥ç›®å½•ä¸‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>/etc/openvpn/easy-rsa-server/3
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># ./easyrsa import-req /etc/openvpn/easy-rsa-client/3/pki/reqs/dev.req dev</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars
</span></span><span style="display:flex;"><span>Using SSL: openssl OpenSSL 1.0.2k-fips  <span style="color:#ae81ff">26</span> Jan <span style="color:#ae81ff">2017</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The request has been successfully imported with a short name of: dev
</span></span><span style="display:flex;"><span>You may now use this name to perform signing operations on this request.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># tree pki/</span>
</span></span><span style="display:flex;"><span>pki/
</span></span><span style="display:flex;"><span>â”œâ”€â”€ ca.crt
</span></span><span style="display:flex;"><span>â”œâ”€â”€ certs_by_serial
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ EAD7A4786FA803EDD9A7166D0EC694C3.pem
</span></span><span style="display:flex;"><span>â”œâ”€â”€ dh.pem
</span></span><span style="display:flex;"><span>â”œâ”€â”€ index.txt
</span></span><span style="display:flex;"><span>â”œâ”€â”€ index.txt.attr
</span></span><span style="display:flex;"><span>â”œâ”€â”€ index.txt.attr.old
</span></span><span style="display:flex;"><span>â”œâ”€â”€ index.txt.old
</span></span><span style="display:flex;"><span>â”œâ”€â”€ issued
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ server.crt
</span></span><span style="display:flex;"><span>â”œâ”€â”€ openssl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ private
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ ca.key
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ server.key
</span></span><span style="display:flex;"><span>â”œâ”€â”€ renewed
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ certs_by_serial
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ private_by_serial
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ reqs_by_serial
</span></span><span style="display:flex;"><span>â”œâ”€â”€ reqs
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ dev.req <span style="color:#75715e"># å¯¼å…¥çš„æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ server.req
</span></span><span style="display:flex;"><span>â”œâ”€â”€ revoked
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ certs_by_serial
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ private_by_serial
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ reqs_by_serial
</span></span><span style="display:flex;"><span>â”œâ”€â”€ safessl-easyrsa.cnf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ serial
</span></span><span style="display:flex;"><span>â””â”€â”€ serial.old
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">12</span> directories, <span style="color:#ae81ff">16</span> files
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä¿®æ”¹ç»™å®¢æˆ·ç«¯é¢å‘çš„è¯ä¹¦çš„æœ‰æ•ˆæœŸ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e">##vim vars</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å»ºè®®ä¿®æ”¹ç»™å®¢æˆ·ç«¯é¢å‘è¯ä¹¦çš„æœ‰æ•ˆæœŸ,å¯é€‚å½“å‡å°‘,æ¯”å¦‚:90å¤©</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#set_var EASYRSA_CERT_EXPIRE 825</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å°†ä¸Šé¢è¡Œä¿®æ”¹ä¸ºä¸‹é¢</span>
</span></span><span style="display:flex;"><span>set_var EASYRSA_CERT_EXPIRE <span style="color:#ae81ff">90</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#é¢å‘å®¢æˆ·ç«¯è¯ä¹¦</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># ./easyrsa sign client dev</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Note: using Easy-RSA configuration from: /etc/openvpn/easy-rsa-server/3.0.8/vars
</span></span><span style="display:flex;"><span>Using SSL: openssl OpenSSL 1.0.2k-fips  <span style="color:#ae81ff">26</span> Jan <span style="color:#ae81ff">2017</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>You are about to sign the following certificate.
</span></span><span style="display:flex;"><span>Please check over the details shown below <span style="color:#66d9ef">for</span> accuracy. Note that this request
</span></span><span style="display:flex;"><span>has not been cryptographically verified. Please be sure it came from a trusted
</span></span><span style="display:flex;"><span>source or that you have verified the request checksum with the sender.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Request subject, to be signed as a client certificate <span style="color:#66d9ef">for</span> <span style="color:#ae81ff">3650</span> days:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>subject<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    commonName                <span style="color:#f92672">=</span> dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Type the word <span style="color:#e6db74">&#39;yes&#39;</span> to <span style="color:#66d9ef">continue</span>, or any other input to abort.
</span></span><span style="display:flex;"><span>  Confirm request details: yes   <span style="color:#75715e"># è¾“å…¥yes</span>
</span></span><span style="display:flex;"><span>Using configuration from /etc/openvpn/easy-rsa-server/3/pki/easy-rsa-1998.yxi0PJ/tmp.IJUwSd
</span></span><span style="display:flex;"><span>Check that the request matches the signature
</span></span><span style="display:flex;"><span>Signature ok
</span></span><span style="display:flex;"><span>The Subject<span style="color:#e6db74">&#39;s Distinguished Name is as follows
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">commonName            :ASN.1 12:&#39;</span>dev<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>Certificate is to be certified <span style="color:#66d9ef">until</span> Mar <span style="color:#ae81ff">15</span> 01:51:32 <span style="color:#ae81ff">2033</span> GMT <span style="color:#f92672">(</span><span style="color:#ae81ff">3650</span> days<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Write out database with <span style="color:#ae81ff">1</span> new entries
</span></span><span style="display:flex;"><span>Data Base Updated
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Certificate created at: /etc/openvpn/easy-rsa-server/3/pki/issued/dev.crt  <span style="color:#75715e">#è¯ä¹¦æ–‡ä»¶</span>
</span></span></code></pre></div><h3 id="å°†caå’ŒæœåŠ¡å™¨è¯ä¹¦ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ç›¸åº”çš„ç›®å½•">å°†CAå’ŒæœåŠ¡å™¨è¯ä¹¦ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ç›¸åº”çš„ç›®å½•<a hidden class="anchor" aria-hidden="true" href="#å°†caå’ŒæœåŠ¡å™¨è¯ä¹¦ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ç›¸åº”çš„ç›®å½•">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir /etc/openvpn/certs</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># cp /etc/openvpn/easy-rsa-server/3/pki/ca.crt /etc/openvpn/certs/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># cp /etc/openvpn/easy-rsa-server/3/pki/issued/server.crt /etc/openvpn/certs/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># cp /etc/openvpn/easy-rsa-server/3/pki/private/server.key</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># cp /etc/openvpn/easy-rsa-server/3/pki/dh.pem /etc/openvpn/certs/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># ll /etc/openvpn/certs/</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>-rw------- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1176</span> Mar <span style="color:#ae81ff">18</span> 09:54 ca.crt
</span></span><span style="display:flex;"><span>-rw------- <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">424</span> Mar <span style="color:#ae81ff">18</span> 09:57 dh.pem
</span></span><span style="display:flex;"><span>-rw------- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">4552</span> Mar <span style="color:#ae81ff">18</span> 09:56 server.crt
</span></span><span style="display:flex;"><span>-rw------- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1704</span> Mar <span style="color:#ae81ff">18</span> 09:55 server.key
</span></span></code></pre></div><h3 id="å°†å®¢æˆ·ç«¯ç§é’¥ä¸è¯ä¹¦ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ç›¸å…³çš„ç›®å½•">å°†å®¢æˆ·ç«¯ç§é’¥ä¸è¯ä¹¦ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ç›¸å…³çš„ç›®å½•<a hidden class="anchor" aria-hidden="true" href="#å°†å®¢æˆ·ç«¯ç§é’¥ä¸è¯ä¹¦ç›¸å…³æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ç›¸å…³çš„ç›®å½•">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir /etc/openvpn/client/dev</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># cp /etc/openvpn/easy-rsa-server/3/pki/ca.crt /etc/openvpn/easy-rsa-server/3/pki/issued/dev.crt /etc/openvpn/easy-rsa-server/3/pki/reqs/dev.req /etc/openvpn/client/dev/</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># ll /etc/openvpn/client/dev/</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>-rw------- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1176</span> Mar <span style="color:#ae81ff">18</span> 10:01 ca.crt
</span></span><span style="display:flex;"><span>-rw------- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">4425</span> Mar <span style="color:#ae81ff">18</span> 10:01 dev.crt
</span></span><span style="display:flex;"><span>-rw------- <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">883</span> Mar <span style="color:#ae81ff">18</span> 10:01 dev.req
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span></code></pre></div><h3 id="å‡†å¤‡-openvpn-æœåŠ¡å™¨é…ç½®æ–‡ä»¶">å‡†å¤‡ OpenVPN æœåŠ¡å™¨é…ç½®æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#å‡†å¤‡-openvpn-æœåŠ¡å™¨é…ç½®æ–‡ä»¶">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>;local a.b.c.d <span style="color:#75715e">#æœ¬æœºç›‘å¬IP,é»˜è®¤ä¸ºæœ¬æœºæ‰€æœ‰IP</span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">1194</span> <span style="color:#75715e">#ç«¯å£</span>
</span></span><span style="display:flex;"><span>;proto tcp <span style="color:#75715e">#åè®®,ç”Ÿäº§æ¨èä½¿ç”¨TCP</span>
</span></span><span style="display:flex;"><span>proto udp <span style="color:#75715e">#é»˜è®¤åè®®udp</span>
</span></span><span style="display:flex;"><span>;dev tap <span style="color:#75715e">#åˆ›å»ºä»¥å¤ªç½‘éš§é“è®¾å¤‡ï¼Œtapè®¾å¤‡å®ç°ä»¥å¤ªç½‘å¸§é€šè¿‡Openvpnéš§é“ï¼Œå¯æä¾›éIPåè®®å¦‚</span>
</span></span><span style="display:flex;"><span>IPXå’ŒAppleTalkç­‰çš„æ”¯æŒï¼Œtapç­‰å½“äºä¸€ä¸ªä»¥å¤ªç½‘è®¾å¤‡ï¼Œå®ƒæ“ä½œç¬¬äºŒå±‚æ•°æ®åŒ…å¦‚ä»¥å¤ªç½‘æ•°æ®å¸§ã€‚
</span></span><span style="display:flex;"><span>dev tun <span style="color:#75715e">#åˆ›å»ºIPè·¯ç”±éš§é“ï¼Œç”Ÿäº§æ¨å­˜ä½¿ç”¨tun.äº’è”ç½‘ä½¿ç”¨tun,ä¸€ä¸ªtunè®¾å¤‡å¤§å¤šæ—¶å€™è¢«ç”¨äºåŸº</span>
</span></span><span style="display:flex;"><span>äºIPåè®®çš„é€šè®¯ã€‚tunæ¨¡æ‹Ÿäº†ç½‘ç»œå±‚è®¾å¤‡ï¼Œæ“ä½œç¬¬ä¸‰å±‚æ•°æ®åŒ…æ¯”å¦‚IPæ•°æ®å°åŒ…ã€‚
</span></span><span style="display:flex;"><span>;dev-node MyTap <span style="color:#75715e">#TAP-Win32çš„è®¾å¤‡é©±åŠ¨ã€‚éwindowsç³»ç»Ÿä¸éœ€è¦</span>
</span></span><span style="display:flex;"><span>ca ca.crt <span style="color:#75715e">#caè¯ä¹¦æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>cert server.crt <span style="color:#75715e">#æœåŠ¡å™¨è¯ä¹¦æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>key server.key <span style="color:#75715e">#æœåŠ¡å™¨ç§é’¥æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>dh dh2048.pem <span style="color:#75715e">#dhå‚æ•°æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>;topology subnet
</span></span><span style="display:flex;"><span>server 10.8.0.0 255.255.255.0 <span style="color:#75715e">#å®¢æˆ·ç«¯è¿æ¥åè‡ªåŠ¨åˆ†é…çš„IPç½‘æ®µï¼Œé»˜è®¤ä¼šç»™æœåŠ¡å™¨åˆ†é…æ­¤ç½‘æ®µçš„ç¬¬</span>
</span></span><span style="display:flex;"><span>ä¸€ä¸ªIPå°†åšä¸ºå®¢æˆ·ç«¯çš„ç½‘å…³,æ³¨æ„ä¸è¦å’Œå†…ç½‘ç½‘æ®µç›¸åŒ
</span></span><span style="display:flex;"><span>ifconfig-pool-persist ipp.txt <span style="color:#75715e">#è®°å½•å®¢æˆ·ç«¯å’Œè™šæ‹Ÿipåœ°å€åˆ†é…çš„æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>;server-bridge 10.8.0.4 255.255.255.0 10.8.0.50 10.8.0.100 <span style="color:#75715e">#é…ç½®ç½‘æ¡¥æ¨¡å¼ï¼Œæ— éœ€é…ç½®,</span>
</span></span><span style="display:flex;"><span>å»ºè®®æ³¨é‡Š
</span></span><span style="display:flex;"><span>;server-bridge
</span></span><span style="display:flex;"><span>;push <span style="color:#e6db74">&#34;route 192.168.10.0 255.255.255.0&#34;</span> <span style="color:#75715e">#æ¨é€ç»™å®¢æˆ·ç«¯çš„åˆ°è¾¾æœåŠ¡å™¨åé¢ç½‘æ®µçš„é™æ€è·¯ç”±ï¼Œ</span>
</span></span><span style="display:flex;"><span>ç½‘å…³æ˜¯æœåŠ¡å™¨åœ°å€10.8.0.1
</span></span><span style="display:flex;"><span>;push <span style="color:#e6db74">&#34;route 192.168.10.100 255.255.255.255&#34;</span> <span style="color:#75715e">#ç”¨255.255.255.255å¯å®ç°åªèƒ½è®¿é—®å†…ç½‘å•ä¸ª</span>
</span></span><span style="display:flex;"><span>ä¸»æœºçš„åŠŸèƒ½,æ¯”å¦‚:jumpserver
</span></span><span style="display:flex;"><span>;push <span style="color:#e6db74">&#34;route 192.168.20.0 255.255.255.0&#34;</span> <span style="color:#75715e">#æ¨é€è·¯ç”±ä¿¡æ¯åˆ°å®¢æˆ·ç«¯ï¼Œä»¥å…è®¸å®¢æˆ·ç«¯èƒ½å¤Ÿè¿æ¥åˆ°</span>
</span></span><span style="display:flex;"><span>æœåŠ¡å™¨èƒŒåçš„å…¶å®ƒç§æœ‰ç½‘ç»œ
</span></span><span style="display:flex;"><span>;client-config-dir ccd <span style="color:#75715e">#ä¸ºç‰¹å®šå®¢æˆ·ç«¯æ·»åŠ è·¯ç”±ä¿¡æ¯ï¼Œæ­¤è·¯ç”±æ˜¯å®¢æˆ·ç«¯åé¢çš„ç½‘æ®µè€ŒéæœåŠ¡ç«¯çš„ç½‘</span>
</span></span><span style="display:flex;"><span>æ®µï¼Œæ— éœ€è®¾ç½®
</span></span><span style="display:flex;"><span>;route 192.168.40.128 255.255.255.248
</span></span><span style="display:flex;"><span>;client-config-dir ccd
</span></span><span style="display:flex;"><span>;route 10.9.0.0 255.255.255.252
</span></span><span style="display:flex;"><span>;learn-address ./script <span style="color:#75715e">#æŒ‡å®šå¤–éƒ¨è„šæœ¬æ–‡ä»¶ï¼Œå®ç°åˆ›å»ºä¸åŒç»„çš„iptablesè§„</span>
</span></span><span style="display:flex;"><span>åˆ™ï¼Œæ— éœ€é…ç½®
</span></span><span style="display:flex;"><span>;push <span style="color:#e6db74">&#34;redirect-gateway def1 bypass-dhcp&#34;</span> <span style="color:#75715e">#å¯ç”¨æ­¤é…ç½®åå®¢æˆ·ç«¯æ‰€æœ‰æµé‡éƒ½å°†é€šè¿‡VPNæœåŠ¡å™¨è¿›</span>
</span></span><span style="display:flex;"><span>è¡Œè½¬å‘ï¼Œå› æ­¤ç”Ÿäº§ä¸€èˆ¬æ— éœ€é…ç½®æ­¤é¡¹
</span></span><span style="display:flex;"><span>;push <span style="color:#e6db74">&#34;dhcp-option DNS 208.67.222.222&#34;</span> <span style="color:#75715e">#æ¨é€DNSæœåŠ¡å™¨åœ°å€ï¼Œæ— éœ€é…ç½®</span>
</span></span><span style="display:flex;"><span>;push <span style="color:#e6db74">&#34;dhcp-option DNS 208.67.220.220&#34;</span>
</span></span><span style="display:flex;"><span>;client-to-client <span style="color:#75715e">#å…è®¸ä¸åŒçš„å®¢æˆ·ç«¯ç›´æ¥é€šä¿¡,ä¸å®‰å…¨,ç”Ÿäº§ç¯å¢ƒä¸€èˆ¬æ— </span>
</span></span><span style="display:flex;"><span>éœ€é…ç½®
</span></span><span style="display:flex;"><span>;duplicate-cn <span style="color:#75715e">#å¤šä¸ªç”¨æˆ·å…±ç”¨ä¸€ä¸ªè¯ä¹¦ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¸€ä¸ªç”¨æˆ·ä¸€ä¸ªè¯</span>
</span></span><span style="display:flex;"><span>ä¹¦,æ— éœ€å¼€å¯
</span></span><span style="display:flex;"><span>keepalive <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">120</span> <span style="color:#75715e">#è®¾ç½®æœåŠ¡ç«¯æ´»åŠ¨çš„æ£€æµ‹çš„é—´éš”å’Œè¶…æ—¶æ—¶é—´ï¼Œæ¯éš”10ç§’pingä¸€æ¬¡ï¼Œ120ç§’æ²¡æœ‰</span>
</span></span><span style="display:flex;"><span>å›åº”åˆ™è®¤ä¸ºå·²ç»æ–­çº¿
</span></span><span style="display:flex;"><span>tls-auth ta.key <span style="color:#ae81ff">0</span> <span style="color:#75715e">#è®¿æ­¢DoSç­‰æ”»å‡»çš„å®‰å…¨å¢å¼ºé…ç½®,æœåŠ¡å™¨å’Œæ¯ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦æ‹¥æœ‰æ­¤å¯†é’¥æ–‡</span>
</span></span><span style="display:flex;"><span>ä»¶ã€‚ç¬¬äºŒä¸ªå‚æ•°åœ¨æœåŠ¡å™¨ç«¯ä¸º0ï¼Œå®¢æˆ·ç«¯ä¸º1
</span></span><span style="display:flex;"><span>cipher AES-256-CBC <span style="color:#75715e">#åŠ å¯†ç®—æ³•</span>
</span></span><span style="display:flex;"><span>;compress lz4-v2 <span style="color:#75715e">#å¯ç”¨Openvpn2.4.Xæ–°ç‰ˆå‹ç¼©ç®—æ³•</span>
</span></span><span style="display:flex;"><span>;push <span style="color:#e6db74">&#34;compress lz4-v2&#34;</span> <span style="color:#75715e">#æ¨é€å®¢æˆ·ç«¯ä½¿ç”¨æ–°ç‰ˆå‹ç¼©ç®—æ³•,å’Œä¸‹é¢çš„comp-lzoä¸è¦åŒæ—¶ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>;comp-lzo <span style="color:#75715e">#æ—§æˆ·ç«¯å…¼å®¹çš„å‹ç¼©é…ç½®ï¼Œéœ€è¦å®¢æˆ·ç«¯é…ç½®å¼€å¯å‹ç¼©,openvpn2.4.Xç­‰æ–°ç‰ˆå¯ä»¥ä¸</span>
</span></span><span style="display:flex;"><span>ç”¨å¼€å¯
</span></span><span style="display:flex;"><span>;max-clients <span style="color:#ae81ff">100</span> <span style="color:#75715e">#æœ€å¤šæ”¯æŒçš„å®¢æˆ·ç«¯æ•°é‡</span>
</span></span><span style="display:flex;"><span>;user nobody <span style="color:#75715e">#æŒ‡å®šopenvpnæœåŠ¡çš„ç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>;group nobody <span style="color:#75715e">#æŒ‡å®šopenvpnæœåŠ¡çš„ç»„</span>
</span></span><span style="display:flex;"><span>persist-key <span style="color:#75715e">#é‡å¯æœåŠ¡æ—¶é»˜è®¤ä¼šé‡æ–°è¯»å–keyæ–‡ä»¶ï¼Œå¼€å¯æ­¤é…ç½®åä¿æŒä½¿ç”¨ç¬¬ä¸€æ¬¡çš„keyæ–‡ä»¶,</span>
</span></span><span style="display:flex;"><span>ç”Ÿäº§ç¯å¢ƒæ— éœ€å¼€å¯
</span></span><span style="display:flex;"><span>persist-tun <span style="color:#75715e">#Donâ€™t close and reopen TUN/TAP device or run up/down</span>
</span></span><span style="display:flex;"><span>scripts across SIGUSR1 or --ping-restart restarts,ç”Ÿäº§ç¯å¢ƒå»ºè®®æ— éœ€å¼€å¯
</span></span><span style="display:flex;"><span>status openvpn-status.log <span style="color:#75715e">#æœåŠ¡å™¨çŠ¶æ€è®°å½•æ–‡ä»¶ï¼Œæ¯åˆ†é’Ÿè®°å½•ä¸€æ¬¡ç›¸å…³ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>;log openvpn.log <span style="color:#75715e">#ç¬¬ä¸€ç§æ—¥å¿—è®°å½•æ–¹å¼,å¹¶æŒ‡å®šæ—¥å¿—è·¯å¾„ï¼Œlogä¼šåœ¨openvpnå¯åŠ¨çš„æ—¶å€™æ¸…</span>
</span></span><span style="display:flex;"><span>ç©ºæ—¥å¿—æ–‡ä»¶,ä¸å»ºè®®ä½¿ç”¨
</span></span><span style="display:flex;"><span>;log-append openvpn.log <span style="color:#75715e">#ç¬¬äºŒç§æ—¥å¿—è®°å½•æ–¹å¼,å¹¶æŒ‡å®šæ—¥å¿—è·¯å¾„ï¼Œé‡å¯openvpnååœ¨ä¹‹å‰çš„æ—¥å¿—å</span>
</span></span><span style="display:flex;"><span>é¢è¿½åŠ æ–°çš„æ—¥å¿—,ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨
</span></span><span style="display:flex;"><span>verb <span style="color:#ae81ff">3</span> <span style="color:#75715e">#è®¾ç½®æ—¥å¿—çº§åˆ«ï¼Œ0-9ï¼Œçº§åˆ«è¶Šé«˜è®°å½•çš„å†…å®¹è¶Šè¯¦ç»†,0 è¡¨ç¤ºé™é»˜è¿è¡Œï¼Œåªè®°</span>
</span></span><span style="display:flex;"><span>å½•è‡´å‘½é”™è¯¯,4 è¡¨ç¤ºåˆç†çš„å¸¸è§„ç”¨æ³•,5 å’Œ <span style="color:#ae81ff">6</span> å¯ä»¥å¸®åŠ©è°ƒè¯•è¿æ¥é”™è¯¯ã€‚9 è¡¨ç¤ºæåº¦å†—ä½™ï¼Œè¾“å‡ºéå¸¸è¯¦ç»†çš„æ—¥å¿—
</span></span><span style="display:flex;"><span>ä¿¡æ¯
</span></span><span style="display:flex;"><span>;mute <span style="color:#ae81ff">20</span> <span style="color:#75715e">#å¯¹ç›¸åŒç±»åˆ«çš„ä¿¡æ¯åªè®°å½•å‰20æ¡åˆ°æ—¥å¿—æ–‡ä»¶ä¸­</span>
</span></span><span style="display:flex;"><span>explicit-exit-notify <span style="color:#ae81ff">1</span> <span style="color:#75715e">#å½“æœåŠ¡ç«¯é‡å¯åé€šçŸ¥å®¢æˆ·ç«¯è‡ªåŠ¨é‡æ–°è¿æ¥æœåŠ¡å™¨ï¼Œæ­¤é¡¹é…ç½®ä»…èƒ½ç”¨äºudpæ¨¡</span>
</span></span><span style="display:flex;"><span>å¼ï¼Œtcpæ¨¡å¼æ— éœ€é…ç½®å³èƒ½å®ç°é‡æ–°è¿æ¥åŠŸèƒ½,ä¸”å¼€å¯æ­¤é¡¹åtcpé…ç½®åå°†å¯¼è‡´openvpnæœåŠ¡æ— æ³•å¯åŠ¨,æ‰€ä»¥
</span></span><span style="display:flex;"><span>tcpæ—¶å¿…é¡»ä¸èƒ½å¼€å¯æ­¤é¡¹
</span></span><span style="display:flex;"><span>script-security <span style="color:#ae81ff">3</span> <span style="color:#75715e"># å…è®¸ä½¿ç”¨è‡ªå®šä¹‰è„šæœ¬</span>
</span></span><span style="display:flex;"><span>auth-user-pass-verify /etc/openvpn/checkpsw.sh via-env <span style="color:#75715e">#æŒ‡å®šè‡ªå®šä¹‰è„šæœ¬è·¯å¾„</span>
</span></span><span style="display:flex;"><span>username-as-common-name <span style="color:#75715e">#å¼€å¯ç”¨æˆ·å¯†ç éªŒè¯</span>
</span></span><span style="display:flex;"><span>client-cert-not-required <span style="color:#75715e">#åªæ”¯æŒç”¨æˆ·å’Œå¯†ç æ–¹å¼éªŒè¯,ä¸æ”¯æŒè¯ä¹¦,æ— æ­¤é…ç½®è¡¨ç¤ºéœ€è¦è¯ä¹¦å’Œç”¨æˆ·å¯†</span>
</span></span><span style="display:flex;"><span>ç å¤šç§éªŒè¯
</span></span></code></pre></div><h4 id="ä¿®æ”¹æœåŠ¡å™¨ç«¯é…ç½®æ–‡ä»¶">ä¿®æ”¹æœåŠ¡å™¨ç«¯é…ç½®æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#ä¿®æ”¹æœåŠ¡å™¨ç«¯é…ç½®æ–‡ä»¶">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 openvpn<span style="color:#f92672">]</span><span style="color:#75715e"># grep &#39;^[a-Z].*&#39; /etc/openvpn/server.conf</span>
</span></span><span style="display:flex;"><span>port <span style="color:#ae81ff">1194</span>
</span></span><span style="display:flex;"><span>proto tcp
</span></span><span style="display:flex;"><span>dev tun
</span></span><span style="display:flex;"><span>ca /etc/openvpn/certs/ca.crt
</span></span><span style="display:flex;"><span>cert /etc/openvpn/certs/server.crt
</span></span><span style="display:flex;"><span>key /etc/openvpn/certs/server.key  <span style="color:#75715e"># This file should be kept secret</span>
</span></span><span style="display:flex;"><span>dh /etc/openvpn/certs/dh.pem
</span></span><span style="display:flex;"><span>server 10.8.0.0 255.255.255.0
</span></span><span style="display:flex;"><span>ifconfig-pool-persist ipp.txt
</span></span><span style="display:flex;"><span>push <span style="color:#e6db74">&#34;route 172.30.0.0 255.255.255.0&#34;</span>
</span></span><span style="display:flex;"><span>keepalive <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">120</span>
</span></span><span style="display:flex;"><span>tls-auth ta.key <span style="color:#ae81ff">0</span> <span style="color:#75715e"># This file is secret</span>
</span></span><span style="display:flex;"><span>cipher AES-256-CBC
</span></span><span style="display:flex;"><span>compress lz4-v2
</span></span><span style="display:flex;"><span>push <span style="color:#e6db74">&#34;compress lz4-v2&#34;</span>
</span></span><span style="display:flex;"><span>max-clients <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>user openvpn
</span></span><span style="display:flex;"><span>group openvpn
</span></span><span style="display:flex;"><span>persist-key
</span></span><span style="display:flex;"><span>persist-tun
</span></span><span style="display:flex;"><span>status /var/log/openvpn/openvpn-status.log
</span></span><span style="display:flex;"><span>log-append  /var/log/openvpn/openvpn.log
</span></span><span style="display:flex;"><span>verb <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>mute <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>explicit-exit-notify <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 openvpn<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å‡†å¤‡ç›®å¿—ç›¸å…³ç›®å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 openvpn<span style="color:#f92672">]</span><span style="color:#75715e"># getent passwd openvpn</span>
</span></span><span style="display:flex;"><span>openvpnâŒ998:996:OpenVPN:/etc/openvpn:/sbin/nologin
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 openvpn<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir /var/log/openvpn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 openvpn<span style="color:#f92672">]</span><span style="color:#75715e"># chown openvpn.openvpn /var/log/openvpn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 openvpn<span style="color:#f92672">]</span><span style="color:#75715e"># ll -d /var/log/openvpn</span>
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">2</span> openvpn openvpn <span style="color:#ae81ff">6</span> Mar <span style="color:#ae81ff">18</span> 10:16 /var/log/openvpn
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 openvpn<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span></code></pre></div><h2 id="å¯åŠ¨-openvpn-æœåŠ¡">å¯åŠ¨ OpenVPN æœåŠ¡<a hidden class="anchor" aria-hidden="true" href="#å¯åŠ¨-openvpn-æœåŠ¡">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 server<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl enable --now openvpn@server</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨æŠ¥å¦‚ä¸‹é”™è¯¯è¯·åœ¨ç»ˆç«¯æ‰§è¡Œè¯¥å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>openvpn --genkey --secret /etc/openvpn/ta.key
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Sat Mar <span style="color:#ae81ff">18</span> 11:05:32 <span style="color:#ae81ff">2023</span> WARNING: cannot stat file <span style="color:#e6db74">&#39;ta.key&#39;</span>: No such file or directory <span style="color:#f92672">(</span>errno<span style="color:#f92672">=</span>2<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Options error: --tls-auth fails with <span style="color:#e6db74">&#39;ta.key&#39;</span>: No such file or directory <span style="color:#f92672">(</span>errno<span style="color:#f92672">=</span>2<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Options error: Please correct these errors.
</span></span><span style="display:flex;"><span>Use --help <span style="color:#66d9ef">for</span> more information.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹çŠ¶æ€</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 server<span style="color:#f92672">]</span><span style="color:#75715e"># systemctl status openvpn@server</span>
</span></span><span style="display:flex;"><span>â— openvpn@server.service - OpenVPN Robust And Highly Flexible Tunneling Application On server
</span></span><span style="display:flex;"><span>   Loaded: loaded <span style="color:#f92672">(</span>/usr/lib/systemd/system/openvpn@.service; enabled; vendor preset: disabled<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>   Active: active <span style="color:#f92672">(</span>running<span style="color:#f92672">)</span> since Sat 2023-03-18 11:23:23 CST; 1min 59s ago
</span></span><span style="display:flex;"><span> Main PID: <span style="color:#ae81ff">2769</span> <span style="color:#f92672">(</span>openvpn<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>   Status: <span style="color:#e6db74">&#34;Initialization Sequence Completed&#34;</span>
</span></span><span style="display:flex;"><span>   CGroup: /system.slice/system-openvpn.slice/openvpn@server.service
</span></span><span style="display:flex;"><span>           â””â”€2769 /usr/sbin/openvpn --cd /etc/openvpn/ --config server.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Mar <span style="color:#ae81ff">18</span> 11:23:23 openvpn-centos7 systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Starting OpenVPN Robust And Highly Flexible Tunneling Application On server...
</span></span><span style="display:flex;"><span>Mar <span style="color:#ae81ff">18</span> 11:23:23 openvpn-centos7 systemd<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>: Started OpenVPN Robust And Highly Flexible Tunneling Application On server
</span></span></code></pre></div><h2 id="å‡†å¤‡-openvpn-å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶">å‡†å¤‡ OpenVPN å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#å‡†å¤‡-openvpn-å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶">#</a></h2>
<h3 id="å®¢æˆ·ç«¯é»˜è®¤èŒƒä¾‹é…ç½®æ–‡ä»¶è¯´æ˜">å®¢æˆ·ç«¯é»˜è®¤èŒƒä¾‹é…ç½®æ–‡ä»¶è¯´æ˜<a hidden class="anchor" aria-hidden="true" href="#å®¢æˆ·ç«¯é»˜è®¤èŒƒä¾‹é…ç½®æ–‡ä»¶è¯´æ˜">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 server<span style="color:#f92672">]</span><span style="color:#75715e">#grep &#39;^[[:alpha:]].*&#39; /usr/share/doc/openvpn/sample/sample-</span>
</span></span><span style="display:flex;"><span>config-files/client.conf
</span></span><span style="display:flex;"><span>client <span style="color:#75715e">#æŒ‡æ˜å®¢æˆ·ç«¯</span>
</span></span><span style="display:flex;"><span>dev tun <span style="color:#75715e">#æŒ‡å®šå’ŒæœåŠ¡ç«¯ä¸€è‡´çš„æ¥å£ç±»å‹</span>
</span></span><span style="display:flex;"><span>proto udp <span style="color:#75715e">#æŒ‡å®šå’ŒæœåŠ¡ç«¯ä¸€è‡´çš„åè®®ç±»å‹</span>
</span></span><span style="display:flex;"><span>remote my-server-1 <span style="color:#ae81ff">1194</span> <span style="color:#75715e">#æœåŠ¡å™¨ç«¯çš„ipæˆ–FQDNåŠç«¯å£</span>
</span></span><span style="display:flex;"><span>resolv-retry infinite <span style="color:#75715e">#æŒ‡å®šæœåŠ¡å™¨ç«¯FQDNè€ŒéIPæ—¶ï¼Œå½“å®¢æˆ·ç«¯é‡æ–°è¿æ¥åä¼šé‡æ–°è§£FQDNå¯¹åº”çš„IP</span>
</span></span><span style="display:flex;"><span>nobind <span style="color:#75715e">#å®¢æˆ·ç«¯ä¸ç»‘å®šç›‘å¬ç«¯å£ï¼Œéšæœºæ‰“å¼€ç«¯å£è¿æ¥åˆ°æœåŠ¡ç«¯çš„ç«¯å£</span>
</span></span><span style="display:flex;"><span>persist-key
</span></span><span style="display:flex;"><span>persist-tun
</span></span><span style="display:flex;"><span>ca ca.crt
</span></span><span style="display:flex;"><span>cert client.crt
</span></span><span style="display:flex;"><span>key client.key
</span></span><span style="display:flex;"><span>remote-cert-tls server <span style="color:#75715e">#ä½¿ç”¨æœåŠ¡å™¨è¯ä¹¦æ ¡éªŒæ–¹å¼</span>
</span></span><span style="display:flex;"><span>tls-auth ta.key <span style="color:#ae81ff">1</span> <span style="color:#75715e">#å®‰å…¨åŠ å¼º</span>
</span></span><span style="display:flex;"><span>cipher AES-256-CBC
</span></span><span style="display:flex;"><span>verb <span style="color:#ae81ff">3</span>
</span></span></code></pre></div><h3 id="ç”Ÿæˆå®¢æˆ·ç«¯ç”¨æˆ·çš„é…ç½®æ–‡ä»¶">ç”Ÿæˆå®¢æˆ·ç«¯ç”¨æˆ·çš„é…ç½®æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#ç”Ÿæˆå®¢æˆ·ç«¯ç”¨æˆ·çš„é…ç½®æ–‡ä»¶">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#ç”Ÿæˆå®¢æˆ·ç«¯æ–‡ä»¶,æ–‡ä»¶åç¼€å¿…é¡»ä¸º.ovpn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 server<span style="color:#f92672">]</span><span style="color:#75715e">#grep &#39;^[[:alpha:]].*&#39; /usr/share/doc/openvpn/sample/sample-</span>
</span></span><span style="display:flex;"><span>config-files/client.conf &gt; /etc/openvpn/client/wangxiaochun/client.ovpn
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä¿®æ”¹é…ç½®æ–‡ä»¶,å†…å®¹å¦‚ä¸‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 server<span style="color:#f92672">]</span><span style="color:#75715e">#vim /etc/openvpn/client/wangxiaochun/client.ovpn</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 server<span style="color:#f92672">]</span><span style="color:#75715e">#cat /etc/openvpn/client/wangxiaochun/client.ovpn</span>
</span></span><span style="display:flex;"><span>client
</span></span><span style="display:flex;"><span>dev tun
</span></span><span style="display:flex;"><span>proto tcp
</span></span><span style="display:flex;"><span>remote 192.1681.110 <span style="color:#ae81ff">1194</span> <span style="color:#75715e">#ç”Ÿäº§ä¸­ä¸ºOpenVPNå…¬ç½‘IPæˆ–è€…FQDN</span>
</span></span><span style="display:flex;"><span>resolv-retry infinite
</span></span><span style="display:flex;"><span>nobind
</span></span><span style="display:flex;"><span><span style="color:#75715e">#persist-key</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#persist-tun</span>
</span></span><span style="display:flex;"><span>ca ca.crt
</span></span><span style="display:flex;"><span>cert dev.crt
</span></span><span style="display:flex;"><span>key dev.key
</span></span><span style="display:flex;"><span>remote-cert-tls server
</span></span><span style="display:flex;"><span><span style="color:#75715e">#tls-auth ta.key 1</span>
</span></span><span style="display:flex;"><span>cipher AES-256-CBC
</span></span><span style="display:flex;"><span>verb <span style="color:#ae81ff">3</span> <span style="color:#75715e">#æ­¤å€¼ä¸èƒ½éšæ„æŒ‡å®š,å¦åˆ™æ— æ³•é€šä¿¡</span>
</span></span><span style="display:flex;"><span>compress lz4-v2 <span style="color:#75715e">#æ­¤é¡¹åœ¨OpenVPN2.4.Xç‰ˆæœ¬ä½¿ç”¨,éœ€è¦å’ŒæœåŠ¡å™¨ç«¯ä¿æŒä¸€è‡´,å¦‚ä¸æŒ‡å®š,é»˜è®¤ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>comp-lzå‹ç¼©
</span></span></code></pre></div><h2 id="å®ç°-openvpn-å®¢æˆ·ç«¯">å®ç° OpenVPN å®¢æˆ·ç«¯<a hidden class="anchor" aria-hidden="true" href="#å®ç°-openvpn-å®¢æˆ·ç«¯">#</a></h2>
<h3 id="windows-å®¢æˆ·ç«¯å®‰è£…çœç•¥">Windows å®¢æˆ·ç«¯å®‰è£…çœç•¥<a hidden class="anchor" aria-hidden="true" href="#windows-å®¢æˆ·ç«¯å®‰è£…çœç•¥">#</a></h3>
<h3 id="windows-å®¢æˆ·ç«¯é…ç½®å‡†å¤‡">Windows å®¢æˆ·ç«¯é…ç½®å‡†å¤‡<a hidden class="anchor" aria-hidden="true" href="#windows-å®¢æˆ·ç«¯é…ç½®å‡†å¤‡">#</a></h3>
<p>ä¿å­˜è¯ä¹¦åˆ°openvpn å®¢æˆ·ç«¯å®‰è£…ç›®å½•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#åœ¨æœåŠ¡å™¨æ‰“åŒ…è¯ä¹¦å¹¶ä¸‹è½½å‘é€ç»™windowså®¢æˆ·ç«¯</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 dev<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>/etc/openvpn/client/dev
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 dev<span style="color:#f92672">]</span><span style="color:#75715e"># ll</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>-rw------- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1176</span> Mar <span style="color:#ae81ff">18</span> 10:01 ca.crt
</span></span><span style="display:flex;"><span>-rw------- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">4425</span> Mar <span style="color:#ae81ff">18</span> 10:01 dev.crt
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">235</span> Mar <span style="color:#ae81ff">18</span> 11:35 dev.ovpn
</span></span><span style="display:flex;"><span>-rw------- <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">883</span> Mar <span style="color:#ae81ff">18</span> 10:01 dev.req
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 dev<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ”¾ç½®åˆ°windowså®¢æˆ·ç«¯é»˜è®¤å®‰è£…ç›®å½•ä¸‹ C:\Program Files\OpenVPN\config ç›®å½•</span>
</span></span></code></pre></div><h2 id="å®ç°è®¿é—®vpnæœåŠ¡å™¨çš„å†…ç½‘ä¸»æœº">å®ç°è®¿é—®VPNæœåŠ¡å™¨çš„å†…ç½‘ä¸»æœº<a hidden class="anchor" aria-hidden="true" href="#å®ç°è®¿é—®vpnæœåŠ¡å™¨çš„å†…ç½‘ä¸»æœº">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#åœ¨æœåŠ¡å™¨å¼€å¯ip_forwardè½¬å‘åŠŸèƒ½</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 dev<span style="color:#f92672">]</span><span style="color:#75715e">#echo net.ipv4.ip_forward = 1 &gt;&gt; /etc/sysctl.conf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 dev<span style="color:#f92672">]</span><span style="color:#75715e">#sysctl -p</span>
</span></span><span style="display:flex;"><span>net.ipv4.ip_forward <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><h2 id="é…ç½®å®ç°å†…ç½‘æœåŠ¡å™¨å›åº”å¤–ç½‘çš„è¯·æ±‚çš„è·¯ç”±">é…ç½®å®ç°å†…ç½‘æœåŠ¡å™¨å›åº”å¤–ç½‘çš„è¯·æ±‚çš„è·¯ç”±<a hidden class="anchor" aria-hidden="true" href="#é…ç½®å®ç°å†…ç½‘æœåŠ¡å™¨å›åº”å¤–ç½‘çš„è¯·æ±‚çš„è·¯ç”±">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸æ”¯æŒä¿®æ”¹è·¯ç”±</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@web1 ~<span style="color:#f92672">]</span><span style="color:#75715e">#route add -net 10.8.0.0/24 gw 172.30.0.1</span>
</span></span></code></pre></div><h2 id="åœ¨openvpnæœåŠ¡å™¨é…ç½®-iptables-è§„åˆ™">åœ¨OpenVPNæœåŠ¡å™¨é…ç½® iptables è§„åˆ™<a hidden class="anchor" aria-hidden="true" href="#åœ¨openvpnæœåŠ¡å™¨é…ç½®-iptables-è§„åˆ™">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#æ·»åŠ SNATè§„åˆ™</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ–¹æ³•1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 ~<span style="color:#f92672">]</span><span style="color:#75715e">#echo &#39;iptables -t nat -A POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j MASQUERADE&#39; &gt;&gt; /etc/rc.d/rc.local</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ–¹æ³•2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 ~<span style="color:#f92672">]</span><span style="color:#75715e">#echo &#39;iptables -t nat -A POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to-source 172.30.0.1&#39; &gt;&gt; /etc/rc.d/rc.local</span>
</span></span></code></pre></div><h2 id="åŠé”€æŒ‡å®šçš„ç”¨æˆ·çš„è¯ä¹¦">åŠé”€æŒ‡å®šçš„ç”¨æˆ·çš„è¯ä¹¦<a hidden class="anchor" aria-hidden="true" href="#åŠé”€æŒ‡å®šçš„ç”¨æˆ·çš„è¯ä¹¦">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cd /etc/openvpn/easy-rsa-server/3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@openvpn-centos7 3<span style="color:#f92672">]</span><span style="color:#75715e">#./easyrsa revoke dev</span>
</span></span></code></pre></div>

        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://xyenvy.github.io/posts/zookeeper%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>Zookeeperç¦»çº¿å®‰è£…è„šæœ¬</span>
  </a>
  <a class="next" href="https://xyenvy.github.io/posts/docker%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>Dockeré•œåƒåŠ é€Ÿ</span>
  </a>
</nav>

        </footer>
    </div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        2022-2023
        <a href="https://xyenvy.github.io" style="color:#939393;">Hopeful</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;">é»”ICPå¤‡2022006994å·-2</a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="/img/beian.png" style="float:left;margin: 0px 5px 0px 0px;"/>
            é»”å…¬ç½‘å®‰å¤‡2022006994å·
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"Hopeful"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"Hopeful"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'ğŸ“„å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'ğŸ‘ŒğŸ»å·²å¤åˆ¶!';
            setTimeout(() => {
                copybutton.innerText = 'ğŸ“„å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"Hopeful"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>
</body>

</html>
