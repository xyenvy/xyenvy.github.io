<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(äºŒ) | DevOpsHub</title>
<meta name="keywords" content="Ansible">
<meta name="description" content="Ansible çš„åç§°æ¥è‡ªç§‘å¹»å°è¯´ã€Šå®‰å¾·çš„æ¸¸æˆã€‹ä¸­è·¨è¶Šæ—¶ç©ºçš„å³æ—¶é€šä¿¡å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ç›¸è·æ•°å…‰å¹´çš„è·ç¦»,è¿œç¨‹å®æ—¶æ§åˆ¶å‰çº¿çš„èˆ°é˜Ÿæˆ˜æ–—.">
<meta name="author" content="">
<link rel="canonical" href="https://old.colorfulgz.com/posts/ansible2/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://old.colorfulgz.com/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://old.colorfulgz.com/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://old.colorfulgz.com/img/Q.gif">
<link rel="apple-touch-icon" href="https://old.colorfulgz.com/img/Q.gif">
<link rel="mask-icon" href="https://old.colorfulgz.com/img/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>


<link rel="stylesheet" href="https://gitee.com/xyenvy/hugo-style/blob/master/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="https://gitee.com/xyenvy/hugo-style/blob/master/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(äºŒ)" />
<meta property="og:description" content="Ansible çš„åç§°æ¥è‡ªç§‘å¹»å°è¯´ã€Šå®‰å¾·çš„æ¸¸æˆã€‹ä¸­è·¨è¶Šæ—¶ç©ºçš„å³æ—¶é€šä¿¡å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ç›¸è·æ•°å…‰å¹´çš„è·ç¦»,è¿œç¨‹å®æ—¶æ§åˆ¶å‰çº¿çš„èˆ°é˜Ÿæˆ˜æ–—." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://old.colorfulgz.com/posts/ansible2/" />
<meta property="og:image" content="https://old.colorfulgz.com/posts.images/banner/8.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-25T19:12:21+00:00" />
<meta property="article:modified_time" content="2023-02-25T19:12:21+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://old.colorfulgz.com/posts.images/banner/8.jpg" />
<meta name="twitter:title" content="è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(äºŒ)"/>
<meta name="twitter:description" content="Ansible çš„åç§°æ¥è‡ªç§‘å¹»å°è¯´ã€Šå®‰å¾·çš„æ¸¸æˆã€‹ä¸­è·¨è¶Šæ—¶ç©ºçš„å³æ—¶é€šä¿¡å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ç›¸è·æ•°å…‰å¹´çš„è·ç¦»,è¿œç¨‹å®æ—¶æ§åˆ¶å‰çº¿çš„èˆ°é˜Ÿæˆ˜æ–—."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "ğŸ“šæ–‡ç« ",
          "item": "https://old.colorfulgz.com/posts/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(äºŒ)",
      "item": "https://old.colorfulgz.com/posts/ansible2/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(äºŒ)",
  "name": "è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(äºŒ)",
  "description": "Ansible çš„åç§°æ¥è‡ªç§‘å¹»å°è¯´ã€Šå®‰å¾·çš„æ¸¸æˆã€‹ä¸­è·¨è¶Šæ—¶ç©ºçš„å³æ—¶é€šä¿¡å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ç›¸è·æ•°å…‰å¹´çš„è·ç¦»,è¿œç¨‹å®æ—¶æ§åˆ¶å‰çº¿çš„èˆ°é˜Ÿæˆ˜æ–—.",
  "keywords": [
    "Ansible"
  ],
  "articleBody": "Playbook playbookä»‹ç» å®˜æ–¹é“¾æ¥\nhttps://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html Playbook ç»„æˆ ä¸€ä¸ª playbook(å‰§æœ¬)æ–‡ä»¶æ˜¯ä¸€ä¸ªYAMLè¯­è¨€ç¼–å†™çš„æ–‡æœ¬æ–‡ä»¶ é€šå¸¸ä¸€ä¸ªplaybookåªåŒ…æ‹¬ä¸€ä¸ªplay ä¸€ä¸ª playçš„ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†: ä¸»æœºå’Œtasks. å³å®ç°åœ¨æŒ‡å®šä¸€ç»„ä¸»æœºä¸Šæ‰§è¡Œä¸€ä¸ªtaskså®šä¹‰å¥½çš„ä»»åŠ¡åˆ—è¡¨ã€‚ ä¸€ä¸ªtasksä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªtaskä»»åŠ¡ æ¯ä¸€ä¸ªTaskæœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨ansibleçš„ä¸€ä¸ªmodule åœ¨å¤æ‚åœºæ™¯ä¸­,ä¸€ä¸ªplaybookä¸­ä¹Ÿå¯ä»¥åŒ…æ‹¬å¤šä¸ªplayï¼Œå®ç°å¯¹å¤šç»„ä¸åŒçš„ä¸»æœºæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ Playbook ä¸ Ad-Hoc å¯¹æ¯” Playbookæ˜¯å¯¹å¤šä¸ª AD-Hoc çš„ä¸€ç§ç¼–æ’ç»„åˆçš„å®ç°æ–¹å¼ Playbookèƒ½æ§åˆ¶ä»»åŠ¡æ‰§è¡Œçš„å…ˆåé¡ºåº Playbookå¯ä»¥æŒä¹…ä¿å­˜åˆ°æ–‡ä»¶ä¸­ä»è€Œæ–¹ä¾¿å¤šæ¬¡è°ƒç”¨è¿è¡Œï¼Œè€ŒAd-Hocåªèƒ½ä¸´æ—¶è¿è¡Œã€‚ Playbooké€‚åˆå¤æ‚çš„é‡å¤æ€§çš„ä»»åŠ¡ï¼Œè€ŒAd-Hocé€‚åˆåšå¿«é€Ÿç®€å•çš„ä¸€æ¬¡æ€§ä»»åŠ¡ YAML è¯­è¨€ YAML è¯­è¨€ä»‹ç» YAMLï¼šYAML Ainâ€™t Markup Languageï¼Œå³YAMLä¸æ˜¯æ ‡è®°è¯­è¨€ã€‚ä¸è¿‡ï¼Œåœ¨å¼€å‘çš„è¿™ç§è¯­è¨€æ—¶ï¼ŒYAMLçš„ æ„æ€å…¶å®æ˜¯ï¼šâ€œYet Another Markup Languageâ€ï¼ˆä»æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼‰ YAMLæ˜¯ä¸€ä¸ªå¯è¯»æ€§é«˜çš„ç”¨æ¥è¡¨è¾¾èµ„æ–™åºåˆ—çš„æ ¼å¼ã€‚ YAMLå‚è€ƒäº†å…¶ä»–å¤šç§è¯­è¨€ï¼ŒåŒ…æ‹¬ï¼šXMLã€Cè¯­è¨€ã€Pythonã€Perlä»¥åŠç”µå­é‚®ä»¶æ ¼å¼RFC2822ç­‰ã€‚ Clark Evansåœ¨2001å¹´åœ¨é¦–æ¬¡å‘è¡¨äº†è¿™ç§è¯­è¨€ï¼Œå¦å¤–Ingy dÃ¶t Netä¸Oren Ben-Kikiä¹Ÿæ˜¯è¿™è¯­è¨€çš„å…±åŒè®¾è®¡è€… ç›®å‰å¾ˆå¤šæœ€æ–°çš„è½¯ä»¶æ¯”è¾ƒæµè¡Œé‡‡ç”¨æ­¤æ ¼å¼çš„æ–‡ä»¶å­˜æ”¾é…ç½®ä¿¡æ¯ï¼Œå¦‚:ubuntuï¼Œanisbleï¼Œdockerï¼Œkubernetesç­‰ YAML å®˜æ–¹ç½‘ç«™ï¼š\nhttp://www.yaml.org ansible å®˜ç½‘:\nhttps://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html YAML è¯­è¨€ç‰¹æ€§ YAMLçš„å¯è¯»æ€§å¥½ YAMLå’Œè„šæœ¬è¯­è¨€çš„äº¤äº’æ€§å¥½ YAMLä½¿ç”¨å®ç°è¯­è¨€çš„æ•°æ®ç±»å‹ YAMLæœ‰ä¸€ä¸ªä¸€è‡´çš„ä¿¡æ¯æ¨¡å‹ YAMLæ˜“äºå®ç° YAMLå¯ä»¥åŸºäºæµæ¥å¤„ç† YAMLè¡¨è¾¾èƒ½åŠ›å¼ºï¼Œæ‰©å±•æ€§å¥½ YAMLè¯­æ³•ç®€ä»‹ åœ¨å•ä¸€æ–‡ä»¶ç¬¬ä¸€è¡Œï¼Œç”¨è¿ç»­ä¸‰ä¸ªè¿å­—å·\"-\" å¼€å§‹ï¼Œè¿˜æœ‰é€‰æ‹©æ€§çš„è¿ç»­ä¸‰ä¸ªç‚¹å·( â€¦ )ç”¨æ¥è¡¨ç¤ºæ–‡ä»¶ç»“å°¾ æ¬¡è¡Œå¼€å§‹æ­£å¸¸å†™Playbookçš„å†…å®¹ï¼Œä¸€èˆ¬å»ºè®®å†™æ˜è¯¥Playbookçš„åŠŸèƒ½ ä½¿ç”¨#å·æ³¨é‡Šä»£ç  ç¼©è¿›çš„çº§åˆ«ä¹Ÿå¿…é¡»æ˜¯ä¸€è‡´çš„ï¼ŒåŒæ ·çš„ç¼©è¿›ä»£è¡¨åŒæ ·çš„çº§åˆ«ï¼Œç¨‹åºåˆ¤åˆ«é…ç½®çš„çº§åˆ«æ˜¯é€šè¿‡ç¼©è¿›ç»“è¡Œæ¥å®ç°çš„ ç¼©è¿›ä¸æ”¯æŒtab,å¿…é¡»ä½¿ç”¨ç©ºæ ¼è¿›è¡Œç¼©è¿› ç¼©è¿›çš„ç©ºæ ¼æ•°ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯ YAMLæ–‡ä»¶å†…å®¹æ˜¯åŒºåˆ«å¤§å°å†™çš„ï¼Œkey/valueçš„å€¼å‡éœ€å¤§å°å†™æ•æ„Ÿ å¤šä¸ªkey/valueå¯åŒè¡Œå†™ä¹Ÿå¯æ¢è¡Œå†™ï¼ŒåŒè¡Œä½¿ç”¨ï¼Œåˆ†éš” keyåé¢å†’å·è¦åŠ ä¸€ä¸ªç©ºæ ¼ æ¯”å¦‚: key: value valueå¯æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯æ˜¯å¦ä¸€ä¸ªåˆ—è¡¨ YAMLæ–‡ä»¶æ‰©å±•åé€šå¸¸ä¸ºymlæˆ–yaml æ”¯æŒçš„æ•°æ®ç±»å‹ YAML æ”¯æŒä»¥ä¸‹å¸¸ç”¨å‡ ç§æ•°æ®ç±»å‹ï¼š\næ ‡é‡ï¼šå•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼ å¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆï¼Œåˆç§°ä¸º: å­—å…¸ï¼ˆdictionaryï¼‰/ å“ˆå¸Œï¼ˆhashesï¼‰ / æ˜ å°„ï¼ˆmappingï¼‰ æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼Œåˆç§°ä¸º: åˆ—è¡¨ï¼ˆlistï¼‰/ åºåˆ—ï¼ˆsequenceï¼‰ scalar æ ‡é‡ keyå¯¹åº”value\nname: wang age: 18 ä½¿ç”¨ç¼©è¿›çš„æ–¹å¼\nname: wang age: 18 æ ‡é‡æ˜¯æœ€åŸºæœ¬çš„ï¼Œä¸å¯å†åˆ†çš„å€¼ï¼ŒåŒ…æ‹¬ï¼š\nå­—ç¬¦ä¸² å¸ƒå°”å€¼ æ•´æ•° æµ®ç‚¹æ•° Null æ—¶é—´ æ—¥æœŸ Dictionary å­—å…¸ ä¸€ä¸ªå­—å…¸æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªkeyä¸valueæ„æˆ keyå’Œvalueä¹‹é—´ç”¨å†’å· ï¼šåˆ†éš” å†’å· : åé¢æœ‰ä¸€ä¸ªç©ºæ ¼ æ‰€æœ‰ k/v å¯ä»¥æ”¾åœ¨ä¸€è¡Œï¼Œ,æ¯ä¸ª k/v ä¹‹é—´ç”¨é€—å·åˆ†éš” æ‰€æœ‰æ¯ä¸ª k/v ä¹Ÿå¯ä»¥åˆ†åˆ«æ”¾åœ¨ä¸åŒè¡Œ,ä¸€å¯¹k/væ”¾åœ¨ç‹¬ç«‹çš„ä¸€è¡Œ æ ¼å¼\naccount: { name: wang, age: 30 } ä½¿ç”¨ç¼©è¿›æ–¹å¼\naccount: name: wang age: 18 èŒƒä¾‹ï¼š\n#ä¸åŒè¡Œ # An employee record name: Example Developer job: Developer skill: Elite(ç¤¾ä¼šç²¾è‹±) #åŒä¸€è¡Œ,ä¹Ÿå¯ä»¥å°†key:valueæ”¾ç½®äº{}ä¸­è¿›è¡Œè¡¨ç¤ºï¼Œç”¨,åˆ†éš”å¤šä¸ªkey:value # An employee record {name: \"Example Developer\", job: \"Developer\", skill: \"Elite\"} List åˆ—è¡¨ åˆ—è¡¨ç”±å¤šä¸ªå…ƒç´ ç»„æˆ æ¯ä¸ªå…ƒç´ æ”¾åœ¨ä¸åŒè¡Œï¼Œæ¯ä¸ªå…ƒç´ ä¸€è¡Œ,ä¸”å…ƒç´ å‰å‡ä½¿ç”¨ä¸­æ¨ªçº¿ - å¼€å¤´ï¼Œå¹¶ä¸”ä¸­æ¨ªçº¿ - å’Œå…ƒç´ ä¹‹é—´æœ‰ä¸€ä¸ªç©ºæ ¼ ä¹Ÿå¯ä»¥å°†æ‰€æœ‰å…ƒç´ ç”¨ [ ] æ‹¬èµ·æ¥æ”¾åœ¨åŒä¸€è¡Œ,æ¯ä¸ªå…ƒç´ ä¹‹é—´ç”¨é€—å·åˆ†éš” æ ¼å¼\ncourse: [ linux , golang , python ] ä¹Ÿå¯ä»¥å†™æˆä»¥ - å¼€å¤´çš„å¤šè¡Œ\ncourse: - linux - golang - python course: - linux: manjaro - golang: gin - python: django èŒƒä¾‹ï¼š\n#ä¸åŒè¡Œ,è¡Œä»¥-å¼€å¤´,åé¢æœ‰ä¸€ä¸ªç©ºæ ¼ # A list of tasty fruits - Apple - Orange - Strawberry - Mango #åŒä¸€è¡Œ [Apple,Orange,Strawberry,Mango] èŒƒä¾‹ï¼šYAML è¡¨ç¤ºä¸€ä¸ªå®¶åº­\nname: John Smith age: 41 gender: Male spouse: { name: Jane Smith, age: 37, gender: Female } # å†™åœ¨ä¸€è¡Œé‡Œ name: Jane Smith #ä¹Ÿå¯ä»¥å†™æˆå¤šè¡Œ age: 37 gender: Female children: [ {name: Jimmy Smith,age: 17, gender: Male}, {name: Jenny Smith, age:13, gender: Female}, {name: hao Smith, age: 20, gender: Male } ] #å†™åœ¨ä¸€è¡Œ - name: Jimmy Smith #å†™åœ¨å¤šè¡Œ,æ›´ä¸ºæ¨èçš„å†™æ³• age: 17 gender: Male - {name: Jenny Smith, age: 13, gender: Female} - {name: hao Smith, age: 20, gender: Male } ä¸‰ç§å¸¸è§çš„æ•°æ®æ ¼å¼ XMLï¼šExtensible Markup Languageï¼Œå¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼Œå¯ç”¨äºæ•°æ®äº¤æ¢å’Œé…ç½® JSONï¼šJavaScript Object Notation, JavaScript å¯¹è±¡è¡¨è®°æ³•ï¼Œä¸»è¦ç”¨æ¥æ•°æ®äº¤æ¢æˆ–é…ç½®ï¼Œä¸æ”¯æŒæ³¨é‡Š YAMLï¼šYAML Ainâ€™t Markup Language YAML ä¸æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼Œ ä¸»è¦ç”¨æ¥é…ç½®ï¼Œå¤§å°å†™æ•æ„Ÿï¼Œä¸æ”¯æŒtab å¯ä»¥ç”¨å·¥å…·äº’ç›¸è½¬æ¢ï¼Œå‚è€ƒç½‘ç«™ï¼š\nurl url1\nPlaybook æ ¸å¿ƒç»„ä»¶ å®˜æ–¹æ–‡æ¡£\nhttps://docs.ansible.com/ansible/latest/reference_appendices/playbooks_keywords.html#playbook-keywords ä¸€ä¸ªplaybook ä¸­ç”±å¤šä¸ªç»„ä»¶ç»„æˆ,å…¶ä¸­æ‰€ç”¨åˆ°çš„å¸¸è§ç»„ä»¶ç±»å‹å¦‚ä¸‹:\nHosts æ‰§è¡Œçš„è¿œç¨‹ä¸»æœºåˆ—è¡¨ Tasks ä»»åŠ¡é›†,ç”±å¤šä¸ªtaskçš„å…ƒç´ ç»„æˆçš„åˆ—è¡¨å®ç°,æ¯ä¸ªtaskæ˜¯ä¸€ä¸ªå­—å…¸,ä¸€ä¸ªå®Œæ•´çš„ä»£ç å—åŠŸèƒ½éœ€å°‘å…ƒç´ éœ€åŒ…æ‹¬ name å’Œ task,ä¸€ä¸ªnameåªèƒ½åŒ…æ‹¬ä¸€ä¸ªtask Variables å†…ç½®å˜é‡æˆ–è‡ªå®šä¹‰å˜é‡åœ¨playbookä¸­è°ƒç”¨ Templates æ¨¡æ¿ï¼Œå¯æ›¿æ¢æ¨¡æ¿æ–‡ä»¶ä¸­çš„å˜é‡å¹¶å®ç°ä¸€äº›ç®€å•é€»è¾‘çš„æ–‡ä»¶ Handlers å’Œ notify ç»“åˆä½¿ç”¨ï¼Œç”±ç‰¹å®šæ¡ä»¶è§¦å‘çš„æ“ä½œï¼Œæ»¡è¶³æ¡ä»¶æ–¹æ‰æ‰§è¡Œï¼Œå¦åˆ™ä¸æ‰§è¡Œ tags æ ‡ç­¾ æŒ‡å®šæŸæ¡ä»»åŠ¡æ‰§è¡Œï¼Œç”¨äºé€‰æ‹©è¿è¡Œplaybookä¸­çš„éƒ¨åˆ†ä»£ç ã€‚ansibleå…·æœ‰å¹‚ç­‰æ€§ï¼Œå› æ­¤ ä¼šè‡ªåŠ¨è·³è¿‡æ²¡æœ‰å˜åŒ–çš„éƒ¨åˆ†ï¼Œå³ä¾¿å¦‚æ­¤ï¼Œæœ‰äº›ä»£ç ä¸ºæµ‹è¯•å…¶ç¡®å®æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„æ—¶é—´ä¾ç„¶ä¼šéå¸¸åœ°é•¿ã€‚æ­¤æ—¶ï¼Œå¦‚æœç¡®ä¿¡å…¶æ²¡æœ‰å˜åŒ–ï¼Œå°±å¯ä»¥é€šè¿‡tagsè·³è¿‡æ­¤äº›ä»£ç ç‰‡æ–­ hosts ç»„ä»¶ Hostsï¼šplaybookä¸­çš„æ¯ä¸€ä¸ªplayçš„ç›®çš„éƒ½æ˜¯ä¸ºäº†è®©ç‰¹å®šä¸»æœºä»¥æŸä¸ªæŒ‡å®šçš„ç”¨æˆ·èº«ä»½æ‰§è¡Œä»»åŠ¡ã€‚hostsç”¨äºæŒ‡å®šè¦æ‰§è¡ŒæŒ‡å®šä»»åŠ¡çš„ä¸»æœºï¼Œé¡»äº‹å…ˆå®šä¹‰åœ¨ä¸»æœºæ¸…å•ä¸­\none.example.com one.example.com:two.example.com 192.168.1.50 192.168.1.* Websrvs:dbsrvs #æˆ–è€…ï¼Œä¸¤ä¸ªç»„çš„å¹¶é›† Websrvs:\u0026dbsrvs #ä¸ï¼Œä¸¤ä¸ªç»„çš„äº¤é›† webservers:!dbsrvs #åœ¨websrvsç»„ï¼Œä½†ä¸åœ¨dbsrvsç»„ æ¡ˆä¾‹ï¼š\n- hosts: websrvs:appsrvs remote_user ç»„ä»¶ remote_user: å¯ç”¨äºHostå’Œtaskä¸­ã€‚ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šå…¶é€šè¿‡sudoçš„æ–¹å¼åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œä»»åŠ¡ï¼Œå…¶å¯ç”¨äºplayå…¨å±€æˆ–æŸä»»åŠ¡ï¼›æ­¤å¤–ï¼Œç”šè‡³å¯ä»¥åœ¨sudoæ—¶ä½¿ç”¨sudo_useræŒ‡å®šsudoæ—¶åˆ‡æ¢çš„ç”¨æˆ·\n- hosts: websrvs remote_user: root tasks: - name: test connection ping: remote_user: magedu sudo: yes #é»˜è®¤sudoä¸ºroot sudo_user:wang #sudoä¸ºwang taskåˆ—è¡¨å’Œactionç»„ä»¶ playçš„ä¸»ä½“éƒ¨åˆ†æ˜¯task listï¼Œtask listä¸­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªtask,å„ä¸ªtask æŒ‰æ¬¡åºé€ä¸ªåœ¨hostsä¸­æŒ‡å®šçš„æ‰€æœ‰ä¸»æœºä¸Šæ‰§è¡Œï¼Œå³åœ¨æ‰€æœ‰ä¸»æœºä¸Šå®Œæˆç¬¬ä¸€ä¸ªtaskåï¼Œå†å¼€å§‹ç¬¬äºŒä¸ªtask taskçš„ç›®çš„æ˜¯ä½¿ç”¨æŒ‡å®šçš„å‚æ•°æ‰§è¡Œæ¨¡å—ï¼Œè€Œåœ¨æ¨¡å—å‚æ•°ä¸­å¯ä»¥ä½¿ç”¨å˜é‡ã€‚æ¨¡å—æ‰§è¡Œæ˜¯å¹‚ç­‰çš„ï¼Œè¿™æ„å‘³ç€å¤šæ¬¡æ‰§è¡Œæ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå…¶ç»“æœå‡ä¸€è‡´ æ¯ä¸ªtaskéƒ½åº”è¯¥æœ‰å…¶nameï¼Œç”¨äºplaybookçš„æ‰§è¡Œç»“æœè¾“å‡ºï¼Œå»ºè®®å…¶å†…å®¹èƒ½æ¸…æ™°åœ°æè¿°ä»»åŠ¡æ‰§è¡Œæ­¥éª¤ã€‚ å¦‚æœæœªæä¾›nameï¼Œåˆ™actionçš„ç»“æœå°†ç”¨äºè¾“å‡º taskä¸¤ç§æ ¼å¼ï¼š\naction: module arguments #ç¤ºä¾‹: action: shell wall hello module: arguments #å»ºè®®ä½¿ç”¨ #ç¤ºä¾‹: shell: wall hello æ³¨æ„ï¼šshellå’Œcommandæ¨¡å—åé¢è·Ÿå‘½ä»¤ï¼Œè€Œékey=value èŒƒä¾‹:\n[root@ansible ansible]#cat hello.yml --- #first yamlæ–‡ä»¶ # - hosts: websrvs remote_user: root gather_facts: no tasks: - name: task1 debug: msg=\"task1 running\" - name: task2 debug: msg=\"task2 running\" - hosts: appsrvs remote_user: root gather_facts: no tasks: - name: task3 debug: msg=\"task3 running\" - name: task4 debug: msg=\"task4 running\" å…¶å®ƒç»„ä»¶è¯´æ˜ æŸä»»åŠ¡çš„çŠ¶æ€åœ¨è¿è¡Œåä¸ºchangedæ—¶ï¼Œå¯é€šè¿‡\"notify\"é€šçŸ¥ç»™ç›¸åº”çš„handlersä»»åŠ¡ è¿˜å¯ä»¥é€šè¿‡\"tags\"ç»™task æ‰“æ ‡ç­¾ï¼Œå¯åœ¨ansible-playbookå‘½ä»¤ä¸Šä½¿ç”¨-tæŒ‡å®šè¿›è¡Œè°ƒç”¨\nShellScripts VS Playbook æ¡ˆä¾‹ #SHELLè„šæœ¬å®ç° #!/bin/bash # å®‰è£…Apache yum install --quiet -y httpd # å¤åˆ¶é…ç½®æ–‡ä»¶ cp /tmp/httpd.conf /etc/httpd/conf/httpd.conf cp/tmp/vhosts.conf /etc/httpd/conf.d/ # å¯åŠ¨Apacheï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨ systemctl enable --now httpd #Playbookå®ç° --- - hosts: websrvs remote_user: root gather_facts: no tasks: - name: \"å®‰è£…Apache\" yum: name=httpd - name: \"å¤åˆ¶é…ç½®æ–‡ä»¶\" copy: src=/tmp/httpd.conf dest=/etc/httpd/conf/ - name: \"å¤åˆ¶é…ç½®æ–‡ä»¶\" copy: src=/tmp/vhosts.conf dest=/etc/httpd/conf.d/ - name: \"å¯åŠ¨Apacheï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨\" service: name=httpd state=started enabled=yes playbook å‘½ä»¤ æ ¼å¼\nansible-playbook ... [options] é€‰é¡¹\n--syntax,--syntax-check #è¯­æ³•æ£€æŸ¥,åŠŸèƒ½ç›¸å½“äºbash -n -C --check #æ¨¡æ‹Ÿæ‰§è¡Œdry run ,åªæ£€æµ‹å¯èƒ½ä¼šå‘ç”Ÿçš„æ”¹å˜ï¼Œä½†ä¸çœŸæ­£æ‰§è¡Œæ“ä½œ --list-hosts #åˆ—å‡ºè¿è¡Œä»»åŠ¡çš„ä¸»æœº --list-tags #åˆ—å‡ºtag --list-tasks #åˆ—å‡ºtask --limit ä¸»æœºåˆ—è¡¨ #åªé’ˆå¯¹ä¸»æœºåˆ—è¡¨ä¸­çš„ç‰¹å®šä¸»æœºæ‰§è¡Œ -i INVENTORY, --inventory INVENTORY #æŒ‡å®šä¸»æœºæ¸…å•æ–‡ä»¶,é€šå¸¸ä¸€ä¸ªé¡¹å¯¹åº”ä¸€ä¸ªä¸»æœºæ¸…å•æ–‡ä»¶ --start-at-task START_AT_TASK #ä»æŒ‡å®štaskå¼€å§‹æ‰§è¡Œ,è€Œéä»å¤´å¼€å§‹,START_AT_TASKä¸ºä»»åŠ¡çš„name -v -vv -vvv #æ˜¾ç¤ºè¿‡ç¨‹ èŒƒä¾‹: ä¸€ä¸ªç®€å•çš„ playbook\n[root@ansible ansible]#cat hello.yml --- - hosts: websrvs tasks: - name: hello command: echo \"hello ansible\" [root@ansible ansible]#ansible-playbook hello.yml [root@ansible ansible]#ansible-playbook -v hello.yml èŒƒä¾‹: æ£€æŸ¥å’Œé™åˆ¶ä¸»æœº\nansible-playbook file.yml --check #åªæ£€æµ‹ ansible-playbook file.yml ansible-playbook file.yml --limit websrvs èŒƒä¾‹: ä¸€ä¸ªplaybook å¤šä¸ªplay\ncat test_plays.yaml --- - hosts: localhost remote_user: root gather_facts: no tasks: - name: play1 command: echo \"play1\" - hosts: centos7 remote_user: root gather_facts: no tasks: - name: play2 command: echo \"play2\" å¿½ç•¥é”™è¯¯ ignore_errors å¦‚æœä¸€ä¸ªtaskå‡ºé”™,é»˜è®¤å°†ä¸ä¼šç»§ç»­æ‰§è¡Œåç»­çš„å…¶å®ƒtask åˆ©ç”¨ ignore_errors: yes å¯ä»¥å¿½ç•¥æ­¤taskçš„é”™è¯¯,ç»§ç»­å‘ä¸‹æ‰§è¡Œplaybookå…¶å®ƒtask\n[root@ansible ansible]#cat test_ignore.yml --- - hosts: centos7 tasks: - name: error command: /bin/false ignore_errors: yes - name: continue command: wall continue ansible-playbookæ¡ˆä¾‹ å®‰è£…nginx --- - hosts: centos7 # yum install nginx remote_user: root gather_facts: no tasks: - name: install nginx yum: name=nginx state=present - name: service: name=nginx state=started enabled=yes å¸è½½httpd #remove_httpd.yml --- - hosts: webservers remote_user: root gather_facts: no tasks: - name: remove httpd package yum: name=httpd state=absent - name: remove apache user user: name=apache state=absent - name: remove config file file: name=/etc/httpd state=absent - name: remove web html file: name=/data/html/ state=absent Playbookä¸­ä½¿ç”¨handlerså’Œnotify handlerså’Œnotify Handlersæœ¬è´¨æ˜¯task list ï¼Œç±»ä¼¼äºMySQLä¸­çš„è§¦å‘å™¨è§¦å‘çš„è¡Œä¸ºï¼Œå…¶ä¸­çš„taskä¸å‰è¿°çš„taskå¹¶æ²¡æœ‰æœ¬è´¨ä¸Šçš„ä¸åŒï¼Œåªæœ‰åœ¨å…³æ³¨çš„èµ„æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡‡å–ä¸€å®šçš„æ“ä½œã€‚ Notifyå¯¹åº”çš„action åœ¨æ‰€æœ‰taskéƒ½æ‰§è¡Œå®Œæ‰ä¼šæœ€åè¢«è§¦å‘ï¼Œè¿™æ ·å¯é¿å…å¤šä¸ªtaskå¤šæ¬¡æ”¹å˜å‘ç”Ÿæ—¶æ¯æ¬¡éƒ½è§¦å‘æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼ŒHandlersä»…åœ¨æ‰€æœ‰çš„å˜åŒ–å‘ç”Ÿå®Œæˆåä¸€æ¬¡æ€§åœ°æ‰§è¡ŒæŒ‡å®šæ“ä½œã€‚ åœ¨notifyä¸­åˆ—å‡ºçš„æ“ä½œç§°ä¸ºhandlerï¼Œä¹Ÿå³notifyä¸­è°ƒç”¨handlerä¸­å®šä¹‰çš„æ“ä½œ æ³¨æ„:\nå¦‚æœå¤šä¸ªtaské€šçŸ¥äº†ç›¸åŒçš„handlersï¼Œ æ­¤handlersä»…ä¼šåœ¨æ‰€æœ‰taskç»“æŸåè¿è¡Œä¸€ æ¬¡ã€‚ åªæœ‰notifyå¯¹åº”çš„taskå‘ç”Ÿæ”¹å˜äº†æ‰ä¼šé€šçŸ¥handlersï¼Œ æ²¡æœ‰æ”¹å˜åˆ™ä¸ä¼šè§¦å‘handlers handlers æ˜¯åœ¨æ‰€æœ‰å‰é¢çš„taskséƒ½æˆåŠŸæ‰§è¡Œæ‰ä¼šæ‰§è¡Œ,å¦‚æœå‰é¢ä»»ä½•ä¸€ä¸ªtaskå¤±è´¥,ä¼šå¯¼è‡´handleè·³è¿‡æ‰§è¡Œ æ¡ˆä¾‹:\næ¡ˆä¾‹ï¼š\næ¡ˆä¾‹ï¼š\nèŒƒä¾‹: éƒ¨ç½²haproxy\nforce_handlers å¦‚æœä¸è®ºå‰é¢çš„taskæˆåŠŸä¸å¦,éƒ½å¸Œæœ›handlersèƒ½æ‰§è¡Œ, å¯ä»¥ä½¿ç”¨force_handlers: yes å¼ºåˆ¶æ‰§è¡Œhandler èŒƒä¾‹: å¼ºåˆ¶è°ƒç”¨handlers\nPlaybookä¸­ä½¿ç”¨tagsç»„ä»¶ å®˜æ–¹æ–‡æ¡£:\nhttps://docs.ansible.com/ansible/latest/user_guide/playbooks_tags.html é»˜è®¤æƒ…å†µä¸‹ï¼Œ Ansible åœ¨æ‰§è¡Œä¸€ä¸ª playbook æ—¶ï¼Œä¼šæ‰§è¡Œ playbook ä¸­æ‰€æœ‰çš„ä»»åŠ¡ï¼Œåœ¨playbookæ–‡ä»¶ä¸­ï¼Œå¯ä»¥åˆ©ç”¨tagsç»„ä»¶ï¼Œä¸ºç‰¹å®š task æŒ‡å®šæ ‡ç­¾ï¼Œå½“åœ¨æ‰§è¡Œplaybookæ—¶ï¼Œå¯ä»¥åªæ‰§è¡Œç‰¹å®štagsçš„task,è€Œéæ•´ä¸ªplaybookæ–‡ä»¶ å¯ä»¥ä¸€ä¸ªtaskå¯¹åº”å¤šä¸ªtag,ä¹Ÿå¯ä»¥å¤šä¸ªtaskå¯¹åº”åŒä¸€ä¸ªtag è¿˜æœ‰å¦å¤–3ä¸ªç‰¹æ®Šå…³é”®å­—ç”¨äºæ ‡ç­¾, tagged, untagged å’Œ all,å®ƒä»¬åˆ†åˆ«æ˜¯ä»…è¿è¡Œå·²æ ‡è®°ï¼Œåªæœ‰æœªæ ‡è®°å’Œæ‰€æœ‰ä»»åŠ¡ã€‚ tags ä¸»è¦ç”¨äºè°ƒè¯•ç¯å¢ƒ èŒƒä¾‹ï¼š tag æ ‡ç­¾\nPlaybookä¸­ä½¿ç”¨å˜é‡ Playbookä¸­åŒæ ·ä¹Ÿæ”¯æŒå˜é‡ å˜é‡åï¼šä»…èƒ½ç”±å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œä¸”åªèƒ½ä»¥å­—æ¯å¼€å¤´ å˜é‡å®šä¹‰ï¼š\nvariable=value variable: value èŒƒä¾‹ï¼š\nhttp_port=80 http_port: 80 é€šè¿‡ {{ variable_name }} è°ƒç”¨å˜é‡ï¼Œä¸”å˜é‡åå‰åå»ºè®®åŠ ç©ºæ ¼ï¼Œæœ‰æ—¶ç”¨\"{{ variable_name }}â€œæ‰ç”Ÿæ•ˆ å˜é‡æ¥æºï¼š\nansible çš„ setup facts è¿œç¨‹ä¸»æœºçš„æ‰€æœ‰å˜é‡éƒ½å¯ç›´æ¥è°ƒç”¨ é€šè¿‡å‘½ä»¤è¡ŒæŒ‡å®šå˜é‡ï¼Œä¼˜å…ˆçº§æœ€é«˜ ansible-playbook -e varname=value test.yml 3.åœ¨playbookæ–‡ä»¶ä¸­å®šä¹‰\nvars: var1: value1 var2: value2 4.åœ¨ç‹¬ç«‹çš„å˜é‡YAMLæ–‡ä»¶ä¸­å®šä¹‰\n- hosts: all vars_files: - vars.yml åœ¨ä¸»æœºæ¸…å•æ–‡ä»¶ä¸­å®šä¹‰ ä¸»æœºï¼ˆæ™®é€šï¼‰å˜é‡ï¼šä¸»æœºç»„ä¸­ä¸»æœºå•ç‹¬å®šä¹‰ï¼Œä¼˜å…ˆçº§é«˜äºå…¬å…±å˜é‡ ç»„ï¼ˆå…¬å…±ï¼‰å˜é‡ï¼šé’ˆå¯¹ä¸»æœºç»„ä¸­æ‰€æœ‰ä¸»æœºå®šä¹‰ç»Ÿä¸€å˜é‡ åœ¨é¡¹ç›®ä¸­é’ˆå¯¹ä¸»æœºå’Œä¸»æœºç»„å®šä¹‰ åœ¨é¡¹ç›®ç›®å½•ä¸­åˆ›å»º host_varså’Œgroup_varsç›®å½• åœ¨roleä¸­å®šä¹‰\nå˜é‡çš„ä¼˜å…ˆçº§ä»é«˜åˆ°ä½å¦‚ä¸‹\n-e é€‰é¡¹å®šä¹‰å˜é‡ --\u003eplaybookä¸­vars_files --\u003e playbookä¸­varså˜é‡å®šä¹‰ --\u003ehost_vars/ä¸»æœºåæ–‡ä»¶ --\u003eä¸»æœºæ¸…å•ä¸­ä¸»æœºå˜é‡--\u003e group_vars/ä¸»æœºç»„åæ–‡ä»¶--\u003egroup_vars/allæ–‡ä»¶--\u003e ä¸»æœºæ¸…å•ç»„å˜é‡ ä½¿ç”¨ setup æ¨¡å—ä¸­å˜é‡ ä½¿ç”¨ facts å˜é‡ æœ¬æ¨¡å—è‡ªåŠ¨åœ¨playbookè°ƒç”¨ï¼Œç”Ÿæˆçš„ç³»ç»ŸçŠ¶æ€ä¿¡æ¯, å¹¶å°†ä¹‹å­˜æ”¾åœ¨factså˜é‡ä¸­ facts åŒ…æ‹¬çš„ä¿¡æ¯å¾ˆå¤š,å¦‚: ä¸»æœºå,IP,CPU,å†…å­˜,ç½‘å¡ç­‰ facts å˜é‡çš„å®é™…ä½¿ç”¨åœºæ™¯æ¡ˆä¾‹\né€šè¿‡factså˜é‡è·å–è¢«æ§ç«¯CPUçš„ä¸ªæ•°ä¿¡æ¯,ä»è€Œç”Ÿæˆä¸åŒçš„Nginxé…ç½®æ–‡ä»¶ é€šè¿‡factså˜é‡è·å–è¢«æ§ç«¯å†…å­˜å¤§å°ä¿¡æ¯,ä»è€Œç”Ÿæˆä¸åŒçš„memcachedçš„é…ç½®æ–‡ä»¶ é€šè¿‡factså˜é‡è·å–è¢«æ§ç«¯ä¸»æœºåç§°ä¿¡æ¯,ä»è€Œç”Ÿæˆä¸åŒçš„Zabbixé…ç½®æ–‡ä»¶ é€šè¿‡factså˜é‡è·å–è¢«æ§ç«¯ç½‘å¡ä¿¡æ¯,ä»è€Œç”Ÿæˆä¸åŒçš„ä¸»æœºå æ¡ˆä¾‹ï¼šä½¿ç”¨setupå˜é‡\n[root@ansible ~]# ansible localhost -m setup -a 'filter=\"ansible_default_ipv4\"' localhost | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_default_ipv4\": { \"address\": \"192.168.32.133\", \"alias\": \"ens160\", \"broadcast\": \"192.168.32.255\", \"gateway\": \"192.168.32.2\", \"interface\": \"ens160\", \"macaddress\": \"00:0c:29:7c:80:cd\", \"mtu\": 1500, \"netmask\": \"255.255.255.0\", \"network\": \"192.168.32.0\", \"prefix\": \"24\", \"type\": \"ether\" } }, \"changed\": false } [root@ansible ~]# èŒƒä¾‹ï¼šæ˜¾ç¤ºens33çš„ç½‘å¡çš„IPåœ°å€\n--- - hosts: centos7 tasks: - name: show ens33 ip debug: msg: IP address {{ ansible_ens33.ipv4.address }} #msg: IP address {{ ansible_facts[\"ens33\"][\"ipv4\"][\"address\"] }} #msg: IP address {{ ansible_facts.ens33.ipv4.address }} #msg: IP address {{ ansible_default_ipv4.address }} #msg: IP address {{ ansible_ens33.ipv4.address }} #msg: IP address {{ ansible_ens33.ipv4.address.split('.')[-1] }} #å–IPä¸­çš„æœ€åä¸€ä¸ªæ•°å­— [root@ansible ansible]# ansible-playbook -v show_ip.yml Using /etc/ansible/ansible.cfg as config file PLAY [centos7] ************************************************************************************************************************* TASK [Gathering Facts] ***************************************************************************************************************** ok: [192.168.32.179] ok: [192.168.32.178] TASK [show ens33 ip] ******************************************************************************************************************* ok: [192.168.32.178] =\u003e { \"msg\": \"IP address 192.168.32.178\" } ok: [192.168.32.179] =\u003e { \"msg\": \"IP address 192.168.32.179\" } PLAY RECAP ***************************************************************************************************************************** 192.168.32.178 : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.32.179 : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 [root@ansible ansible]# èŒƒä¾‹ï¼šä¿®æ”¹ä¸»æœºåç§°ä¸ºweb-IP\n- hosts: centos7 tasks: - name: æ‰“å°factså˜é‡ debug: msg={{ ansible_ens33.ipv4.address }} - name: ä¿®æ”¹ä¸»æœºå hostname: name=web-{{ ansible_ens33.ipv4.address }} #- name: è·å–factså˜é‡æå–IPåœ°å€ï¼Œä»¥.ç»“å°¾çš„æœ€åä¸€åˆ—,ä¿®æ”¹ä¸»æœºåä¸ºweb-hostid #hostname: name=web-{{ ansible_ens33.ipv4.address.split('.')[-1] }} [root@ansible ansible]# ansible-playbook change_hostname.yml PLAY [centos7] ************************************************************************************************************************* TASK [Gathering Facts] ***************************************************************************************************************** ok: [192.168.32.178] ok: [192.168.32.179] TASK [æ‰“å°factså˜é‡] ******************************************************************************************************************* ok: [192.168.32.178] =\u003e { \"msg\": \"192.168.32.178\" } ok: [192.168.32.179] =\u003e { \"msg\": \"192.168.32.179\" } TASK [ä¿®æ”¹ä¸»æœºå] ********************************************************************************************************************** changed: [192.168.32.179] changed: [192.168.32.178] PLAY RECAP ***************************************************************************************************************************** 192.168.32.178 : ok=3 changed=1 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 192.168.32.179 : ok=3 changed=1 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 [root@ansible ansible]# æ€§èƒ½ä¼˜åŒ– æ¯æ¬¡æ‰§è¡Œplaybook,é»˜è®¤ä¼šæ”¶é›†æ¯ä¸ªä¸»æœºçš„æ‰€æœ‰factså˜é‡,å°†ä¼šå¯¼è‡´é€Ÿåº¦å¾ˆæ…¢,å¯ä»¥é‡‡ç”¨ä¸‹é¢æ–¹æ³•åŠ é€Ÿ æ–¹æ³•1 å…³é—­factsé‡‡é›†åŠ é€Ÿæ‰§è¡Œ,æ­¤æ–¹æ³•å°†å¯¼è‡´æ— æ³•ä½¿ç”¨factså˜é‡\n- hosts: all gather_facts: no æ–¹æ³•2 å½“ä½¿ç”¨ gather_facts: no å…³é—­ factsï¼Œç¡®å®èƒ½åŠ é€Ÿ Ansible æ‰§è¡Œï¼Œä½†æ˜¯æœ‰æ—¶å€™åˆéœ€è¦ä½¿ç”¨ facts ä¸­çš„å†…å®¹ï¼Œè¿˜å¸Œæœ›æ‰§è¡Œçš„é€Ÿåº¦å¿«ï¼Œè¿™æ—¶å€™å¯ä»¥è®¾ç½®facts çš„ç¼“å­˜,å°†factså˜é‡ä¿¡æ¯å­˜åœ¨redisæœåŠ¡å™¨ä¸­\n[root@ansible ~]# cat /etc/ansible/ansible.cfg [defaults] # smart è¡¨ç¤ºé»˜è®¤æ”¶é›† factsï¼Œä½† facts å·²æœ‰çš„æƒ…å†µä¸‹ä¸ä¼šæ”¶é›†ï¼Œå³ä½¿ç”¨ç¼“å­˜ facts # implicit è¡¨ç¤ºé»˜è®¤æ”¶é›† factsï¼Œè¦ç¦æ­¢æ”¶é›†ï¼Œå¿…é¡»ä½¿ç”¨ gather_facts: False # explicit åˆ™è¡¨ç¤ºé»˜è®¤ä¸æ”¶é›†ï¼Œè¦æ˜¾å¼æ”¶é›†ï¼Œå¿…é¡»ä½¿ç”¨gather_facts: True gathering = smart #åœ¨ä½¿ç”¨ facts ç¼“å­˜æ—¶è®¾ç½®ä¸ºsmart fact_caching_timeout = 86400 #ç¼“å­˜æ—¶é•¿ fact_caching = redis #ç¼“å­˜å­˜åœ¨redisä¸­ fact_caching_connection = 10.0.0.100:6379:0 #0è¡¨ç¤ºredisçš„0å·æ•°æ®åº“ #è‹¥redisè®¾ç½®äº†å¯†ç  fact_caching_connection = 10.0.0.100:6379:0:password register æ³¨å†Œå˜é‡ åœ¨playbookä¸­å¯ä»¥ä½¿ç”¨registerå°†æ•è·å‘½ä»¤çš„è¾“å‡ºä¿å­˜åœ¨ä¸´æ—¶å˜é‡ä¸­ï¼Œæ–¹ä¾¿åç»­è°ƒç”¨æ­¤å˜é‡,æ¯”å¦‚å¯ä»¥ä½¿ç”¨debugæ¨¡å—è¿›è¡Œæ˜¾ç¤ºè¾“å‡º èŒƒä¾‹: åˆ©ç”¨debug æ¨¡å—è¾“å‡ºå˜é‡\n--- - hosts: centos7 tasks: - name: get variable shell: hostname register: name - name: print variable debug: msg: \"{{ name }}\" #è¾“å‡ºregisteræ³¨å†Œçš„nameå˜é‡çš„å…¨éƒ¨ä¿¡æ¯,æ³¨æ„å˜é‡è¦åŠ \" \"å¼•èµ·æ¥ #msg: \"{{ name.cmd }}\" #æ˜¾ç¤ºå‘½ä»¤ #msg: \"{{ name.rc }}\" #æ˜¾ç¤ºå‘½ä»¤æˆåŠŸä¸å¦ #msg: \"{{ name.stdout }}\" #æ˜¾ç¤ºå‘½ä»¤çš„è¾“å‡ºç»“æœä¸ºå­—ç¬¦ä¸²å½¢å¼,æ‰€æœ‰ç»“æœéƒ½æ”¾åœ¨ä¸€è¡Œé‡Œæ˜¾ç¤º,é€‚åˆäºç»“æœæ˜¯å•è¡Œè¾“å‡º #msg: \"{{ name.stdout_lines }}\" #æ˜¾ç¤ºå‘½ä»¤çš„è¾“å‡ºç»“æœä¸ºåˆ—è¡¨å½¢å¼,é€è¡Œæ ‡å‡†è¾“å‡º,é€‚ç”¨äºå¤šè¡Œæ˜¾ç¤º #msg: \"{{ name['stdout_lines'] }}\" #æ˜¾ç¤ºå‘½ä»¤çš„æ‰§è¡Œç»“æœä¸ºåˆ—è¡¨å½¢å¼,å’Œæ•ˆæœä¸Šé¢ç›¸åŒ #msg: \"{{ name.stdout_lines[0] }}\" #æ˜¾ç¤ºå‘½ä»¤çš„è¾“å‡ºç»“æœçš„åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´  #è¯´æ˜ ç¬¬ä¸€ä¸ª task ä¸­ï¼Œä½¿ç”¨äº† register æ³¨å†Œå˜é‡åä¸º name ï¼›å½“ shell æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼Œä¼šå°†æ•°æ®æ”¾åˆ°è¯¥å˜é‡ä¸­ã€‚ç¬¬äºŒç»™ task ä¸­ï¼Œä½¿ç”¨äº† debug æ¨¡å—ï¼Œå¹¶ä»å˜é‡nameä¸­è·å–æ•°æ®ã€‚ [root@ansible ansible]# ansible-playbook -C register.yml PLAY [centos7] ************************************************************************************************************************* TASK [Gathering Facts] ***************************************************************************************************************** ok: [192.168.32.179] ok: [192.168.32.178] TASK [get variable] ******************************************************************************************************************** skipping: [192.168.32.179] skipping: [192.168.32.178] TASK [print variable] ****************************************************************************************************************** ok: [192.168.32.178] =\u003e { \"msg\": { \"changed\": false, \"cmd\": \"hostname\", \"delta\": null, \"end\": null, \"failed\": false, \"msg\": \"Command would have run if not in check mode\", \"rc\": 0, \"skipped\": true, \"start\": null, \"stderr\": \"\", \"stderr_lines\": [], \"stdout\": \"\", \"stdout_lines\": [] } } ok: [192.168.32.179] =\u003e { \"msg\": { \"changed\": false, \"cmd\": \"hostname\", \"delta\": null, \"end\": null, \"failed\": false, \"msg\": \"Command would have run if not in check mode\", \"rc\": 0, \"skipped\": true, \"start\": null, \"stderr\": \"\", \"stderr_lines\": [], \"stdout\": \"\", \"stdout_lines\": [] } } PLAY RECAP ***************************************************************************************************************************** 192.168.32.178 : ok=2 changed=0 unreachable=0 failed=0 skipped=1 rescued=0 ignored=0 192.168.32.179 : ok=2 changed=0 unreachable=0 failed=0 skipped=1 rescued=0 ignored=0 [root@ansible ansible]# èŒƒä¾‹: å®‰è£…å¯åŠ¨æœåŠ¡å¹¶æ£€æŸ¥\n--- - hosts: centos7 vars: package_name: nginx service_name: nginx tasks: - name: install {{ package_name }} yum: name={{ package_name }} - name: start {{ service_name }} service: name={{ service_name }} state=started enabled=yes - name: check shell: ps axu|grep {{ service_name }} register: check_service - name: debug debug: msg: \"{{ check_service.stdout_lines }}\" èŒƒä¾‹: ä¿®æ”¹ä¸»æœºåå½¢å¼ä¸º web_\u003céšæœºå­—ç¬¦\u003e\n- hosts: centos7 tasks: - name: genarate random shell: cmd: openssl rand -base64 12 |tr -dc '[:alnum:]' register: num - name: show random debug: msg: \"{{ num }}\" - name: change hostname hostname: name: web-{{ num.stdout }} èŒƒä¾‹: ä¿®æ”¹ä¸»æœºåå½¢å¼ä¸º web_éšæœºæ•°\n- hosts: centos7 tasks: - name: å®šä¹‰ä¸€ä¸ªéšæœºæ•°ï¼Œè®¾å®šä¸ºå˜é‡ï¼Œç„¶ååç»­è°ƒç”¨ shell: echo $((RANDOM%255)) register: web_number - name: ä½¿ç”¨debugè¾“å‡ºå˜é‡ç»“æœ debug: msg={{ web_number }} - name: ä½¿ç”¨hostnameæ¨¡å—å°†ä¸»æœºåä¿®æ”¹ä¸ºweb_éšæœºæ•° hostname: name=web_{{ web_number.stdout }} èŒƒä¾‹: æ‰¹é‡ä¿®æ”¹ä¸»æœºåä¸ºéšæœºå­—ç¬¦\n- hosts: centos7 vars: host: web domain: wang.org tasks: - name: get variable shell: echo $RANDOM | md5sum | cut -c 1-8 register: get_random - name: print variable debug: msg: \"{{ get_random.stdout }}\" - name: set hostname hostname: name={{ host }}-{{ get_random.stdout }}.{{ domain }} èŒƒä¾‹: æ‰¹é‡ä¿®æ”¹ä¸»æœºåä¸ºIPæœ€å1ä½æ•°å­—\n- hosts: centos7 vars: host: web domain: wang.org tasks: - name: get variable shell: hostname -I | awk '{print $1}' register: get_ip - name: print variable debug: msg: \"{{ get_ip.stdout.split('.')[3] }}\" - name: set hostname hostname: name={{ host }}-{{ get_ip.stdout.split('.')[3] }}.{{ domain }} åœ¨ Playbook å‘½ä»¤è¡Œä¸­å®šä¹‰å˜é‡ èŒƒä¾‹ï¼š\n--- - hosts: centos7 remote_user: root tasks: - name: install nginx yum: name={{ pkname }} state=present [root@ansible ~]#ansible-playbook -e pkname=nginx var2.yml èŒƒä¾‹ï¼š\n#ä¹Ÿå¯ä»¥å°†å¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ [root@ansible ~]#cat vars pkname1: memcached pkname2: vsftpd [root@ansible ~]#vim var2.yml --- - hosts: centos7 remote_user: root tasks: - name: install package {{ pkname1 } yum: name={{ pkname1 }} state=present - name: install package {{ pkname2 } yum: name={{ pkname2 }} state=present [root@ansible ~]#ansible-playbook -e pkname1=memcached -e pkname2=httpd var2.yml [root@ansible ~]#ansible-playbook -e '@vars' var2.yml åœ¨playbookæ–‡ä»¶ä¸­å®šä¹‰å˜é‡ æ­¤æ–¹å¼å®šä¹‰çš„æ˜¯ç§æœ‰å˜é‡,å³åªèƒ½åœ¨å½“å‰playbookä¸­ä½¿ç”¨,ä¸èƒ½è¢«å…¶å®ƒPlaybookå…±ç”¨ èŒƒä¾‹ï¼š\n- hosts: webservers remote_user: root vars: username: user1 groupname: group1 tasks: - name: create group {{ groupname }} group: name={{ groupname }} state=present - name: create user {{ username }} user: name={{ username }} group={{ groupname }} state=present [root@ansible ~]#ansible-playbook -e \"username=user2 groupname=group2\" var3.yml èŒƒä¾‹ï¼šå˜é‡çš„ç›¸äº’è°ƒç”¨\n--- - hosts: centos7 remote_user: root vars: collect_info: \"/data/test/{{ansible_default_ipv4['address']}}/\" tasks: - name: create IP directory file: name=\"{{collect_info}}\" state=directory ä½¿ç”¨ä¸“ç”¨çš„å…¬å…±çš„å˜é‡æ–‡ä»¶ å¯ä»¥åœ¨ä¸€ä¸ªç‹¬ç«‹çš„playbookæ–‡ä»¶ä¸­å®šä¹‰å…¬å…±å˜é‡ï¼Œåœ¨å…¶å®ƒçš„playbookæ–‡ä»¶ä¸­å¯ä»¥å¼•ç”¨å˜é‡æ–‡ä»¶ä¸­çš„å˜é‡ æ­¤æ–¹å¼æ¯”playbookä¸­å®šä¹‰çš„å˜é‡ä¼˜åŒ–çº§é«˜\nvim vars.yml --- # variables file package_name: mariadb-server service_name: mariadb vim var5.yml --- #install package and start service - hosts: dbsrvs remote_user: root vars_files: # æŒ‡å®šå˜é‡æ–‡ä»¶å - vars.yml tasks: - name: install package yum: name={{ package_name }} tags: install - name: start service service: name={{ service_name }} state=started enabled=yes åœ¨ä¸»æœºæ¸…å•ä¸­å®šä¹‰ä¸»æœºå’Œä¸»æœºç»„çš„å˜é‡ æ‰€æœ‰é¡¹ç›®çš„ä¸»æœºå˜é‡ åœ¨inventory ä¸»æœºæ¸…å•æ–‡ä»¶ä¸­ä¸ºæŒ‡å®šçš„ä¸»æœºå®šä¹‰å˜é‡ä»¥ä¾¿äºåœ¨playbookä¸­ä½¿ç”¨ èŒƒä¾‹ï¼š\n[webservers] www1.wang.org http_port=80 maxRequestsPerChild=808 www2.wang.org http_port=8080 maxRequestsPerChild=909 æ‰€æœ‰é¡¹ç›®çš„ç»„ï¼ˆå…¬å…±ï¼‰å˜é‡ åœ¨inventory ä¸»æœºæ¸…å•æ–‡ä»¶ä¸­èµ‹äºˆç»™æŒ‡å®šç»„å†…æ‰€æœ‰ä¸»æœºä¸Šçš„åœ¨playbookä¸­å¯ç”¨çš„å˜é‡ï¼Œå¦‚æœå’Œä¸»æœºå˜æ˜¯åŒåï¼Œä¼˜å…ˆçº§ä½äºä¸»æœºå˜é‡\næ¡ˆä¾‹ï¼š\n[webservers:vars] http_port=80 ntp_server=ntp.wang.org nfs_server=nfs.wang.org [all:vars] # --------- Main Variables --------------- # Cluster container-runtime supported: docker, containerd CONTAINER_RUNTIME=\"docker\" # Network plugins supported: calico, flannel, kube-router, cilium, kube-ovn CLUSTER_NETWORK=\"calico\" # Service proxy mode of kube-proxy: 'iptables' or 'ipvs' PROXY_MODE=\"ipvs\" # K8S Service CIDR, not overlap with node(host) networking SERVICE_CIDR=\"192.168.0.0/16\" # Cluster CIDR (Pod CIDR), not overlap with node(host) networking CLUSTER_CIDR=\"172.16.0.0/16\" # NodePort Range NODE_PORT_RANGE=\"20000-60000\" # Cluster DNS Domain CLUSTER_DNS_DOMAIN=\"magedu.local.\" èŒƒä¾‹ï¼š\n[root@ansible ~]#vim /etc/ansible/hosts [webservers] 10.0.0.8 hname=www1 domain=magedu.io 10.0.0.7 hname=www2 [webservers:vars] mark=\"-\" [all:vars] domain=wang.org [root@ansible ~]#ansible webservers -m hostname -a 'name={{ hname }}{{ mark }} {{ domain }}' #å‘½ä»¤è¡ŒæŒ‡å®šå˜é‡ï¼š [root@ansible ~]#ansible webservers -e domain=magedu.cn -m hostname -a 'name= {{ hname }}{{ mark }}{{ domain }}' é’ˆå¯¹å½“å‰é¡¹ç›®çš„ä¸»æœºå’Œä¸»æœºç»„çš„å˜é‡ ä¸Šé¢çš„æ–¹å¼æ˜¯é’ˆå¯¹æ‰€æœ‰é¡¹ç›®éƒ½æœ‰æ•ˆ,è€Œå®˜æ–¹æ›´å»ºè®®çš„æ–¹å¼æ˜¯ä½¿ç”¨ansibleç‰¹å®šé¡¹ç›®çš„ä¸»æœºå˜é‡å’Œç»„å˜é‡.ç”Ÿäº§å»ºè®®åœ¨æ¯ä¸ªé¡¹ç›®å¯¹åº”çš„ç›®å½•ä¸­åˆ›å»ºé¢å¤–çš„ä¸¤ä¸ªå˜é‡ç›®å½•,åˆ†åˆ«æ˜¯host_varså’Œgroup_vars\nhost_varsä¸‹é¢çš„æ–‡ä»¶åå’Œä¸»æœºæ¸…å•ä¸»æœºåä¸€è‡´,é’ˆå¯¹å•ä¸ªä¸»æœºè¿›è¡Œå˜é‡å®šä¹‰æ ¼å¼:host_vars/hostname group_varsä¸‹é¢çš„æ–‡ä»¶åå’Œä¸»æœºæ¸…å•ä¸­ç»„åä¸€è‡´, é’ˆå¯¹å•ä¸ªç»„è¿›è¡Œå˜é‡å®šä¹‰æ ¼å¼: group_vars/groupname group_vars/allæ–‡ä»¶å†…å®šä¹‰çš„å˜é‡å¯¹æ‰€æœ‰ç»„éƒ½æœ‰æ•ˆ èŒƒä¾‹: ç‰¹å®šé¡¹ç›®çš„ä¸»æœºå’Œç»„å˜é‡\n[root@ansible ansible]#pwd /data/ansible [root@ansible ansible]#mkdir host_vars [root@ansible ansible]#mkdir group_vars [root@ansible ansible]#cat host_vars/10.0.0.8 id: 2 [root@ansible ansible]#cat host_vars/10.0.0.7 id: 1 [root@ansible ansible]#cat group_vars/webservers name: web [root@ansible ansible]#cat group_vars/all domain: wang.org [root@ansible ansible]#tree host_vars/ group_vars/ host_vars/ â”œâ”€â”€ 10.0.0.7 â””â”€â”€ 10.0.0.8 group_vars/ â”œâ”€â”€ all â””â”€â”€ webservers 0 directories, 4 files [root@ansible ansible]#cat test.yml - hosts: webservers tasks: - name: get variable command: echo \"{{name}}{{id}}.{{domain}}\" register: result - name: print variable debug: msg: \"{{result.stdout}}\" [root@ansible ansible]#ansible-playbook test.yml PLAY [webservers] ******************************************************************************** *************************************** TASK [Gathering Facts] ******************************************************************************** ******************************* ok: [10.0.0.7] ok: [10.0.0.8] TASK [get variable] ******************************************************************************** ********************************** changed: [10.0.0.7] changed: [10.0.0.8] TASK [print variable] ******************************************************************************** ******************************** ok: [10.0.0.7] =\u003e { \"msg\": \"web1.wang.org\" } ok: [10.0.0.8] =\u003e { \"msg\": \"web2.wang.org\" } PLAY RECAP ******************************************************************************** ******************************************* 10.0.0.7 : ok=3 changed=1 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 10.0.0.8 : ok=3 changed=1 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 Template æ¨¡æ¿ æ¨¡æ¿æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥ç”¨äºæ ¹æ®æ¯ä¸ªä¸»æœºçš„ä¸åŒç¯å¢ƒè€Œä¸ºç”Ÿæˆä¸åŒçš„æ–‡ä»¶ æ¨¡æ¿æ–‡ä»¶ä¸­æ”¯æŒåµŒå¥—jinja2è¯­è¨€çš„æŒ‡ä»¤,æ¥å®ç°å˜é‡,æ¡ä»¶åˆ¤æ–­,å¾ªç¯ç­‰åŠŸèƒ½ éœ€è¦ä½¿ç”¨templateæ¨¡å—å®ç°æ–‡ä»¶çš„å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœº,ä½†å’Œcopyæ¨¡å—ä¸åŒ,å¤åˆ¶è¿‡å»çš„æ–‡ä»¶æ¯ä¸ªä¸»æœºå¯ä»¥ä¼šæœ‰æ‰€ä¸åŒ\njinja2è¯­è¨€ Jinja2 æ˜¯ä¸€ä¸ªç°ä»£çš„ï¼Œè®¾è®¡è€…å‹å¥½çš„ï¼Œä»¿ç…§ Django æ¨¡æ¿çš„ Python æ¨¡æ¿è¯­è¨€ã€‚ å®ƒé€Ÿåº¦å¿«ï¼Œè¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¹¶ä¸”æä¾›äº†å¯é€‰çš„æ²™ç®±æ¨¡æ¿æ‰§è¡Œç¯å¢ƒä¿è¯å®‰å…¨: ç‰¹æ€§:\næ²™ç®±ä¸­æ‰§è¡Œ å¼ºå¤§çš„ HTML è‡ªåŠ¨è½¬ä¹‰ç³»ç»Ÿä¿æŠ¤ç³»ç»Ÿå…å— XSS æ¨¡æ¿ç»§æ‰¿ åŠæ—¶ç¼–è¯‘æœ€ä¼˜çš„ python ä»£ç  å¯é€‰æå‰ç¼–è¯‘æ¨¡æ¿çš„æ—¶é—´ æ˜“äºè°ƒè¯•ã€‚å¼‚å¸¸çš„è¡Œæ•°ç›´æ¥æŒ‡å‘æ¨¡æ¿ä¸­çš„å¯¹åº”è¡Œã€‚ å¯é…ç½®çš„è¯­æ³• å®˜æ–¹ç½‘ç«™ï¼š\nhttp://jinja.pocoo.org/ https://jinja.palletsprojects.com/en/2.11.x/ å®˜æ–¹ä¸­æ–‡æ–‡æ¡£\nhttp://docs.jinkan.org/docs/jinja2/ https://www.w3cschool.cn/yshfid/ jinja2 è¯­è¨€æ”¯æŒå¤šç§æ•°æ®ç±»å‹å’Œæ“ä½œ: å­—é¢é‡ï¼Œå¦‚: å­—ç¬¦ä¸²ï¼šä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·,æ•°å­—ï¼šæ•´æ•°ï¼Œæµ®ç‚¹æ•° åˆ—è¡¨ï¼š[item1, item2, â€¦] å…ƒç»„ï¼š(item1, item2, â€¦) å­—å…¸ï¼š{key1:value1, key2:value2, â€¦} å¸ƒå°”å‹ï¼štrue/false ç®—æœ¯è¿ç®—ï¼š+, -, *, /, //, %, ** æ¯”è¾ƒæ“ä½œï¼š==, !=, \u003e, \u003e=, \u003c, \u003c=\né€»è¾‘è¿ç®—ï¼šandï¼Œorï¼Œnot æµè¡¨è¾¾å¼ï¼šForï¼ŒIfï¼ŒWhen\nå­—é¢é‡ï¼š è¡¨è¾¾å¼æœ€ç®€å•çš„å½¢å¼å°±æ˜¯å­—é¢é‡ã€‚å­—é¢é‡è¡¨ç¤ºè¯¸å¦‚å­—ç¬¦ä¸²å’Œæ•°å€¼çš„ Python å¯¹è±¡ã€‚å¦‚\"Hello Worldâ€ åŒå¼•å·æˆ–å•å¼•å·ä¸­é—´çš„ä¸€åˆ‡éƒ½æ˜¯å­—ç¬¦ä¸²ã€‚æ— è®ºä½•æ—¶ä½ éœ€è¦åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚å‡½æ•°è°ƒç”¨ã€è¿‡æ»¤å™¨æˆ–åªæ˜¯åŒ…å«æˆ–ç»§æ‰¿ä¸€ä¸ªæ¨¡æ¿çš„å‚æ•°ï¼‰ï¼Œå¦‚42ï¼Œ42.23 æ•°å€¼å¯ä»¥ä¸ºæ•´æ•°å’Œæµ®ç‚¹æ•°ã€‚å¦‚æœæœ‰å°æ•°ç‚¹ï¼Œåˆ™ä¸ºæµ®ç‚¹æ•°ï¼Œå¦åˆ™ä¸ºæ•´æ•°ã€‚åœ¨ Python é‡Œï¼Œ 42 å’Œ 42.0 æ˜¯ä¸ä¸€æ ·çš„\nç®—æœ¯è¿ç®—ï¼š Jinja å…è®¸ç”¨è®¡ç®—å€¼ã€‚æ”¯æŒä¸‹é¢çš„è¿ç®—ç¬¦ +ï¼šæŠŠä¸¤ä¸ªå¯¹è±¡åŠ åˆ°ä¸€èµ·ã€‚é€šå¸¸å¯¹è±¡æ˜¯ç´ è´¨ï¼Œä½†æ˜¯å¦‚æœä¸¤è€…æ˜¯å­—ç¬¦ä¸²æˆ–åˆ—è¡¨ï¼Œä½ å¯ä»¥ç”¨è¿™ ç§æ–¹å¼æ¥è¡”æ¥ å®ƒä»¬ã€‚æ— è®ºå¦‚ä½•è¿™ä¸æ˜¯é¦–é€‰çš„è¿æ¥å­—ç¬¦ä¸²çš„æ–¹å¼ï¼è¿æ¥å­—ç¬¦ä¸²è§ ~ è¿ç®—ç¬¦ã€‚ {{ 1 + 1 }} ç­‰äº 2 -ï¼šç”¨ç¬¬ä¸€ä¸ªæ•°å‡å»ç¬¬äºŒä¸ªæ•°ã€‚ {{ 3 - 2 }} ç­‰äº 1 /ï¼šå¯¹ä¸¤ä¸ªæ•°åšé™¤æ³•ã€‚è¿”å›å€¼ä¼šæ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ã€‚ {{ 1 / 2 }} ç­‰äº 0.5 //ï¼šå¯¹ä¸¤ä¸ªæ•°åšé™¤æ³•ï¼Œè¿”å›æ•´æ•°å•†ã€‚ {{ 20 // 7 }} ç­‰äº 2 %ï¼šè®¡ç®—æ•´æ•°é™¤æ³•çš„ä½™æ•°ã€‚ {{ 11 % 7 }} ç­‰äº 4 ï¼šç”¨å³è¾¹çš„æ•°ä¹˜å·¦è¾¹çš„æ“ä½œæ•°ã€‚ {{ 22 }} ä¼šè¿”å› 4 ã€‚ä¹Ÿå¯ä»¥ç”¨äºé‡ å¤ä¸€ä¸ªå­—ç¬¦ä¸²å¤šæ¬¡ã€‚ {{ â€˜=â€™ * 80 }} ä¼šæ‰“å° 80 ä¸ªç­‰å·çš„æ¨ªæ¡\nï¼šå–å·¦æ“ä½œæ•°çš„å³æ“ä½œæ•°æ¬¡å¹‚ã€‚ {{ 23 }} ä¼šè¿”å› 8\næ¯”è¾ƒæ“ä½œç¬¦\n== æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ != æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ä¸ç­‰\nå¦‚æœå·¦è¾¹å¤§äºå³è¾¹ï¼Œè¿”å› true = å¦‚æœå·¦è¾¹å¤§äºç­‰äºå³è¾¹ï¼Œè¿”å› true \u003c å¦‚æœå·¦è¾¹å°äºå³è¾¹ï¼Œè¿”å› true \u003c= å¦‚æœå·¦è¾¹å°äºç­‰äºå³è¾¹ï¼Œè¿”å› true é€»è¾‘è¿ç®—ç¬¦\nå¯¹äº if è¯­å¥ï¼Œåœ¨ for è¿‡æ»¤æˆ– if è¡¨è¾¾å¼ä¸­ï¼Œå®ƒå¯ä»¥ç”¨äºè”åˆå¤šä¸ªè¡¨è¾¾å¼ and å¦‚æœå·¦æ“ä½œæ•°å’Œå³æ“ä½œæ•°åŒä¸ºçœŸï¼Œè¿”å› true or å¦‚æœå·¦æ“ä½œæ•°å’Œå³æ“ä½œæ•°æœ‰ä¸€ä¸ªä¸ºçœŸï¼Œè¿”å› true not å¯¹ä¸€ä¸ªè¡¨è¾¾å¼å–å (expr)è¡¨è¾¾å¼ç»„ true / false true æ°¸è¿œæ˜¯ true ï¼Œè€Œ false å§‹ç»ˆæ˜¯ false\ntemplate templateåŠŸèƒ½ï¼šå¯ä»¥æ ¹æ®å’Œå‚è€ƒæ¨¡å—æ–‡ä»¶ï¼ŒåŠ¨æ€ç”Ÿæˆç›¸ç±»ä¼¼çš„é…ç½®æ–‡ä»¶ templateæ–‡ä»¶å­˜å»ºè®®æ”¾äºtemplatesç›®å½•ä¸‹ï¼Œä¸”å‘½åä¸º .j2 ç»“å°¾\nyaml/yml æ–‡ä»¶å’Œtemplatesç›®å½•å¹³çº§ï¼Œæ­¤æ—¶playbookä¸­æŒ‡å®šæ¨¡ç‰ˆæ–‡ä»¶æ—¶å¯ä¸ç”¨æŒ‡å®šè·¯å¾„, ç›®å½•ç»“æ„å¦‚ä¸‹ ç¤ºä¾‹ï¼š\n./ â”œâ”€â”€ temnginx.yml â””â”€â”€ templates â””â”€â”€ nginx.conf.j2 èŒƒä¾‹ï¼šåˆ©ç”¨template åŒæ­¥nginxé…ç½®æ–‡ä»¶\n#å‡†å¤‡templates/nginx.conf.j2æ–‡ä»¶ [root@ansible ~]#vim temnginx.yml --- - hosts: centos7 remote_user: root tasks: - name: template config to remote hosts template: src=nginx.conf.j2 dest=/etc/nginx/nginx.conf [root@ansible ~]#ansible-playbook temnginx.yml templateå˜æ›´æ›¿æ¢ èŒƒä¾‹ï¼š\n#ä¿®æ”¹æ–‡ä»¶nginx.conf.j2 [root@ansible ~]#mkdir templates [root@ansible ~]#vim templates/nginx.conf.j2 ...... worker_processes {{ ansible_processor_vcpus }}; ...... [root@ansible ~]#vim temnginx2.yml --- - hosts: centos7 remote_user: root tasks: - name: install nginx yum: name=nginx - name: template config to remote hosts template: src=nginx.conf.j2 dest=/etc/nginx/nginx.conf - name: start service service: name=nginx state=started enabled=yes [root@ansible ~]#ansible-playbook temnginx2.yml Roles è§’è‰² è§’è‰²æ˜¯ansibleè‡ª1.2ç‰ˆæœ¬å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œç”¨äºå±‚æ¬¡æ€§ã€ç»“æ„åŒ–åœ°ç»„ç»‡playbookã€‚rolesèƒ½å¤Ÿæ ¹æ®å±‚æ¬¡å‹ç»“æ„è‡ªåŠ¨è£…è½½å˜é‡æ–‡ä»¶ã€tasksä»¥åŠhandlersç­‰ã€‚è¦ä½¿ç”¨rolesåªéœ€è¦åœ¨playbookä¸­ä½¿ç”¨includeæŒ‡ä»¤å³å¯ã€‚ç®€å•æ¥è®²ï¼Œroleså°±æ˜¯é€šè¿‡åˆ†åˆ«å°†å˜é‡ã€æ–‡ä»¶ã€ä»»åŠ¡ã€æ¨¡æ¿åŠå¤„ç†å™¨æ”¾ç½®äºå•ç‹¬çš„ç›®å½•ä¸­ï¼Œå¹¶å¯ä»¥ä¾¿æ·åœ°includeå®ƒä»¬çš„ä¸€ç§æœºåˆ¶ã€‚è§’è‰²ä¸€èˆ¬ç”¨äºåŸºäºä¸»æœºæ„å»ºæœåŠ¡çš„åœºæ™¯ä¸­ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ç”¨äºæ„å»ºå®ˆæŠ¤è¿›ç¨‹ç­‰åœºæ™¯ä¸­ è¿ç»´å¤æ‚çš„åœºæ™¯ï¼šå»ºè®®ä½¿ç”¨ rolesï¼Œä»£ç å¤ç”¨åº¦é«˜ rolesï¼šå¤šä¸ªè§’è‰²çš„é›†åˆç›®å½•ï¼Œ å¯ä»¥å°†å¤šä¸ªçš„roleï¼Œåˆ†åˆ«æ”¾è‡³rolesç›®å½•ä¸‹çš„ç‹¬ç«‹å­ç›®å½•ä¸­,å¦‚ä¸‹ç¤ºä¾‹\nroles/ mysql/ nginx/ tomcat/ redis/ é»˜è®¤roleså­˜æ”¾è·¯å¾„\n/root/.ansible/roles /usr/share/ansible/roles /etc/ansible/roles å®˜æ–¹æ–‡æ¡£:\nhttps://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html Ansible Rolesç›®å½•ç¼–æ’ rolesç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤º\næ¯ä¸ªè§’è‰²ï¼Œä»¥ç‰¹å®šçš„å±‚çº§ç›®å½•ç»“æ„è¿›è¡Œç»„ç»‡ rolesç›®å½•ç»“æ„ï¼š\nplaybook1.yml playbook2.yml roles/ project1/ tasks/ files/ vars/ templates/ handlers/ default/ meta/ project2/ tasks/ files/ vars/ templates/ handlers/ default/ meta/ Roleså„ç›®å½•ä½œç”¨ roles/project/ :é¡¹ç›®åç§°,æœ‰ä»¥ä¸‹å­ç›®å½•\nfiles/ ï¼šå­˜æ”¾ç”±copyæˆ–scriptæ¨¡å—ç­‰è°ƒç”¨çš„æ–‡ä»¶ templates/ï¼štemplateæ¨¡å—æŸ¥æ‰¾æ‰€éœ€è¦æ¨¡æ¿æ–‡ä»¶çš„ç›®å½• tasks/ï¼šå®šä¹‰task,roleçš„åŸºæœ¬å…ƒç´ ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼›å…¶å®ƒçš„æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å« handlers/ï¼šè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼›æ­¤ç›®å½•ä¸‹çš„å…¶å®ƒçš„æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å« vars/ï¼šå®šä¹‰å˜é‡ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼›æ­¤ç›®å½•ä¸‹çš„å…¶å®ƒçš„å˜é‡æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«,ä¹Ÿå¯ä»¥é€šè¿‡é¡¹ç›®ç›®å½•ä¸­çš„group_vars/allå®šä¹‰å˜é‡,ä»è€Œå®ç°è§’è‰²é€šç”¨ä»£ç å’Œé¡¹ç›®æ•°æ®çš„åˆ†ç¦» meta/ï¼šå®šä¹‰å½“å‰è§’è‰²çš„ç‰¹æ®Šè®¾å®šåŠå…¶ä¾èµ–å…³ç³»,è‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œå…¶å®ƒæ–‡ä»¶éœ€åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å« default/ï¼šè®¾å®šé»˜è®¤å˜é‡æ—¶ä½¿ç”¨æ­¤ç›®å½•ä¸­çš„main.ymlæ–‡ä»¶ï¼Œæ¯”varsçš„ä¼˜å…ˆçº§ä½ åˆ›å»º role åˆ›å»ºroleçš„æ­¥éª¤\n1 åˆ›å»ºroleçš„ç›®å½•ç»“æ„.åœ¨ä»¥roleså‘½åçš„ç›®å½•ä¸‹åˆ†åˆ«åˆ›å»ºä»¥å„è§’è‰²åç§°å‘½åçš„ç›®å½•ï¼Œå¦‚mysqlç­‰,åœ¨æ¯ä¸ªè§’è‰²å‘½åçš„ç›®å½•ä¸­åˆ†åˆ«åˆ›å»ºç›¸å…³çš„ç›®å½•å’Œæ–‡ä»¶,æ¯”å¦‚tasksã€filesã€handlersã€templateså’Œvarsç­‰ç›®å½•ï¼›ç”¨ä¸åˆ°çš„ç›®å½•å¯ä»¥åˆ›å»ºä¸ºç©ºç›®å½•ï¼Œä¹Ÿå¯ä»¥ä¸åˆ›å»º 2 ç¼–å†™å’Œå‡†å¤‡æŒ‡å®šroleçš„åŠŸèƒ½æ–‡ä»¶,åŒ…æ‹¬: tasks,templates,varsç­‰ç›¸å…³æ–‡ä»¶ 3 ç¼–å†™playbookæ–‡ä»¶è°ƒç”¨ä¸Šé¢å®šä¹‰çš„role,åº”ç”¨åˆ°æŒ‡å®šçš„ä¸»æœº é’ˆå¯¹å¤§å‹é¡¹ç›®ä½¿ç”¨Rolesè¿›è¡Œç¼–æ’ èŒƒä¾‹: åˆ©ç”¨ ansible-galaxy åˆ›å»ºè§’è‰²ç›®å½•çš„ç»“æ„\n#åˆ›å»ºåˆå§‹åŒ–ç›®å½•ç»“æ„ [root@ansible roles]#ansible-galaxy role init test_role - Role test_role was created successfully [root@ansible roles]#tree test_role/ test_role/ â”œâ”€â”€ defaults â”‚ â””â”€â”€ main.yml â”œâ”€â”€ files â”œâ”€â”€ handlers â”‚ â””â”€â”€ main.yml â”œâ”€â”€ meta â”‚ â””â”€â”€ main.yml â”œâ”€â”€ README.md â”œâ”€â”€ tasks â”‚ â””â”€â”€ main.yml â”œâ”€â”€ templates â”œâ”€â”€ tests â”‚ â”œâ”€â”€ inventory â”‚ â””â”€â”€ test.yml â””â”€â”€ vars â””â”€â”€ main.yml 8 directories, 8 files èŒƒä¾‹ï¼šrolesçš„ç›®å½•ç»“æ„\nnginx-role.yml roles/ â””â”€â”€ nginx â”œâ”€â”€ files â”‚ â””â”€â”€ nginx.conf â”œâ”€â”€ tasks â”‚ â”œâ”€â”€ groupadd.yml â”‚ â”œâ”€â”€ install.yml â”‚ â”œâ”€â”€ main.yml â”‚ â”œâ”€â”€ restart.yml â”‚ â””â”€â”€ useradd.yml â””â”€â”€ vars â””â”€â”€ main.yml Playbook è°ƒç”¨è§’è‰² è°ƒç”¨è§’è‰²æ–¹æ³•1ï¼š\n--- - hosts: webservers remote_user: root roles: - mysql - memcached - nginx è°ƒç”¨è§’è‰²æ–¹æ³•2ï¼š é”®roleç”¨äºæŒ‡å®šè§’è‰²åç§°ï¼Œåç»­çš„k/vç”¨äºä¼ é€’å˜é‡ç»™è§’è‰²\n--- - hosts: all remote_user: root roles: - role: mysql username: mysql - { role: nginx, username: nginx } è°ƒç”¨è§’è‰²æ–¹æ³•3ï¼š è¿˜å¯åŸºäºæ¡ä»¶æµ‹è¯•å®ç°è§’è‰²è°ƒç”¨\n--- - hosts: all remote_user: root roles: - { role: nginx, username: nginx, when: ansible_distribution_major_version == '7' } Roles ä¸­ Tags ä½¿ç”¨ [root@ansible ~]#vi app-role.yml --- #å¯ä»¥æœ‰å¤šä¸ªplay - hosts: lbserver roles: - role: haproxy - role: keepalived - hosts: appsrvs remote_user: root roles: - { role: nginx ,tags: [ 'nginx', 'web' ] ,when: ansible_distribution_major_version == \"6\" } - { role: httpd ,tags: [ 'httpd', 'web' ] } - { role: mysql ,tags: [ 'mysql', 'db' ] } - role: mariadb tags: - mariadb - db tags: app #playçš„tag [root@ansible ~]#ansible-playbook --tags=\"nginx,mysql\" app-role.yml å®æˆ˜æ¡ˆä¾‹ å®ç°httpdè§’è‰² # åˆ›å»ºroleç›®å½• [root@ansible data]# ansible-galaxy role init httpd - Role htppd was created successfully [root@ansible data]# tree httpd/ httpd/ â”œâ”€â”€ defaults â”‚Â â””â”€â”€ main.yml â”œâ”€â”€ files â”œâ”€â”€ handlers â”‚Â â””â”€â”€ main.yml â”œâ”€â”€ meta â”‚Â â””â”€â”€ main.yml â”œâ”€â”€ README.md â”œâ”€â”€ tasks â”‚Â â””â”€â”€ main.yml â”œâ”€â”€ templates â”œâ”€â”€ tests â”‚Â â”œâ”€â”€ inventory â”‚Â â””â”€â”€ test.yml â””â”€â”€ vars â””â”€â”€ main.yml 8 directories, 8 files [root@ansible data]# #main.yml æ˜¯taskçš„å…¥å£æ–‡ä»¶ [root@ansible tasks]# cat main.yml --- # tasks file for httpd - include: group.yml - include: user.yml - include: install_httpd.yml - include: config.yml - inclusde: index.yml - include: service.yml [root@ansible tasks]# # åˆ›å»ºç”¨æˆ·ç»„ [root@ansible httpd]# cat tasks/group.yml - name: add group group: name={{ httpd_group}} system=yes gid={{ httpd_gid }} [root@ansible htppd]# # åˆ›å»ºç”¨æˆ· [root@ansible httpd]# cat tasks/user.yml - name: add httpd user user: name={{ httpd_user }} system=yes shel=/sbin/nologin home=/var/www uid={{ httpd_uid }} group={{ httpd_group }} [root@ansible htppd]# # yum install httpd [root@ansible httpd]# cat tasks/install_httpd.yml - name: install httpd yum: name=httpd [root@ansible httpd]# # æ‹·è´é…ç½®æ–‡ä»¶ #æ³¨æ„: æ–‡ä»¶æ˜¯æ”¾åœ¨filesç›®å½•ä¸‹,ä½†srcçš„è·¯å¾„æ— éœ€å†™filesç›®å½•å [root@ansible htppd]# cat tasks/config.yml - name: httpd config copy: src=httpd.conf dest=/etc/httpd/conf backup=yes notify: restart httpd # å‡†å¤‡æµ‹è¯•æ–‡ä»¶ [root@ansible htppd]# cat tasks/index.yml - name: copy index.html copy: src=index.html dest=/var/www/html [root@ansible htppd]# # start httpd [root@ansible htppd]# cat tasks/service.yml - name: start httpd service: name=httpd state=started enabled=yes [root@ansible htppd]# # é…ç½®æ–‡ä»¶ä¿®æ”¹åˆ™é‡å¯httpd [root@ansible htppd]# cat handlers/main.yml --- # handlers file for httpd - name: restart httpd service: name=httpd state=restarted [root@ansible htppd]# #åœ¨filesç›®å½•ä¸‹å‡†å¤‡ä¸¤ä¸ªæ–‡ä»¶ [root@ansible data]# ll httpd/files total 16 -rw-r--r-- 1 root root 11753 Mar 1 18:36 httpd.conf -rw-r--r-- 1 root root 23 Mar 1 21:10 index.html # å‡†å¤‡å˜é‡æ–‡ä»¶ [root@ansible data]# cat httpd/vars/main.yml --- # vars file for httpd httpd_group: apache httpd_gid: 88 httpd_user: apache httpd_uid: 88 [root@ansible data]# #åœ¨playbookä¸­è°ƒç”¨è§’è‰² [root@ansible data]# cat web_roles.yml --- - hosts: centos7 remote_user: root roles: - httpd #è¿è¡Œplaybook [root@ansible data]# ansible-playbook /data/web_roles.yml å®ç°Nginxè§’è‰² # åˆ›å»ºrolesç›®å½• [root@ansible data]# ansible-galaxy init nginx - Role nginx was created successfully [root@ansible data]# ll total 12 -rw-r--r-- 1 root root 614 Mar 1 21:07 ansible.cfg -rw-r--r-- 1 root root 1382 Mar 1 21:07 hosts drwxr-xr-x 10 root root 154 Mar 1 18:07 httpd drwxr-xr-x 10 root root 154 Mar 1 21:52 nginx -rw-r--r-- 1 root root 63 Mar 1 21:14 web_roles.yml [root@ansible data]# # åˆ›å»ºtasksæ–‡ä»¶ [root@ansible data]# cat nginx/tasks/main.yml --- # tasks file for nginx - include: install_nginx.yml - import_playbook: config.yml - include: index.yml - import_playbook: service.yml [root@ansible data]# # å®‰è£…nginx [root@ansible data]# cat nginx/tasks/install_nginx.yml --- - name: install nginx yum: name: nginx state: present [root@ansible data]# # é…ç½®æ–‡ä»¶ [root@ansible data]# cat nginx/tasks/config.yml --- - name: copy config template: src=nginx.conf.j2 dest=/etc/nginx/nginx.conf notify: restart nginx # åˆ›å»ºæµ‹è¯•æ–‡ä»¶ [root@ansible data]# cat nginx/tasks/index.yml --- - name: copt index.html copy: src=index.html dest=/usr/share/nginx/html/ # å¯åŠ¨nginx [root@ansible data]# cat nginx/tasks/service.yml --- - name: start nginx service: name=nginx state=started enabled=yes #åˆ›å»ºhandleræ–‡ä»¶ [root@ansible data]# cat nginx/handlers/main.yml --- # handlers file for nginx - name: restart nginx service: naem=nginx state=restarted [root@ansible data]# ll #åˆ›å»ºtemplateæ–‡ä»¶ [root@ansible data]# ll nginx/templates/ total 4 -rw-r--r-- 1 root root 2336 Mar 1 22:12 nginx.conf.j2 [root@ansible data]# # åˆ›å»ºæµ‹è¯•æ–‡ä»¶ [root@ansible data]# ll nginx/files/ total 4 -rw-r--r-- 1 root root 23 Mar 1 22:14 index.html [root@ansible data]# #åœ¨playbookä¸­è°ƒç”¨è§’è‰² [root@ansible data]# cat web_roles.yml --- - hosts: centos7 remote_user: root roles: # - httpd - nginx [root@ansible data]# #è¿è¡Œplaybook [root@ansible data]# ansible-playbook web_roles.yml å®ç°MySql8è§’è‰² åˆ›å»ºè§’è‰²ç›®å½• [root@ansible data]# ansible-galaxy init mysql8 [root@ansible data]# ll total 12 -rw-r--r-- 1 root root 614 Mar 1 21:07 ansible.cfg -rw-r--r-- 1 root root 1382 Mar 1 21:07 hosts drwxr-xr-x 10 root root 154 Mar 1 18:07 httpd drwxr-xr-x 10 root root 154 Mar 1 22:55 mysql8 drwxr-xr-x 8 root root 125 Mar 1 22:44 nginx -rw-r--r-- 1 root root 75 Mar 1 22:38 web_roles.yml [root@ansible data]# åˆ›å»ºtasks ymlæ–‡ä»¶ # å®‰è£…åŒ… [root@ansible data]# cat mysql8/tasks/install_package.yml --- - name: install package yum: name={{ item }} state=latest loop: - libaio - numactl-libs # add group [root@ansible data]# cat mysql8/tasks/group.yml --- - name: add group group: name={{ group }} gid={{ group_gid }} [root@ansible data]# # add user [root@ansible data]# cat mysql8/tasks/user.yml --- - name: add user user: name={{ user }} uid={{ user_uid }} shell=/sbin/nologin group={{ group }} create_home=no system=yes home=/data/mysql [root@ansible data]# # å‡†å¤‡my.cnfæ–‡ä»¶ [root@ansible data]# cat mysql8/files/my.cnf [mysqld] server-id=1 log-bin datadir=/data/mysql socket=/data/mysql/mysql.sock log-error=/data/mysql/mysql.log pid-file=/data/mysql/mysql.pid [client] socket=/data/mysql/mysql.sock # å‡†å¤‡mysqläºŒè¿›åˆ¶åŒ… [root@ansible data]# ll mysql8/files/ total 1176056 -rw-r--r-- 1 root root 181 Mar 1 23:10 my.cnf -rw-r--r-- 1 root root 1204277208 Dec 18 2021 mysql-8.0.28-linux-glibc2.12-x86_64.tar.xz [root@ansible data]# # å°†mysqläºŒè¿›åˆ¶åŒ…è§£å‹åˆ°è¿œç¨‹ä¸»æœº [root@ansible data]# cat mysql8/tasks/unarchive.yml --- - name: copy mysql tar host # mysql_tar ä¸ºmysqläºŒè¿›åˆ¶çš„å‹ç¼©åŒ…åç§° unarchive: src={{ mysql_tar }} dest=/usr/local/ owner=root group=root [root@ansible data]# # å°†è¿œç¨‹ä¸»æœºè§£å‹å‡ºçš„äºŒè¿›åˆ¶åŒ…åˆ›å»ºè½¯è¿æ¥ [root@ansible data]# cat mysql8/tasks/linkfile.yml --- - name: create link file: src=/usr/local/mysql-{{ mysql_version }}-linux-glibc2.12-x86_64 dest=/usr/local/mysql state=link [root@ansible data]# # åˆå§‹åŒ–æ•°æ®åº“ [root@ansible data]# cat mysql8/tasks/init_mysql_data.yml --- - name: create datadir dir file: path=/data/mysql state=directory owner={{ user }} group={{ group } - name: init mysql data shell: /usr/local/mysql/bin/mysqld --initialize-insecure --user=mysql --datadir=/data/mysql [root@ansible data]# # copy config.con [root@ansible data]# cat mysql8/tasks/config.yml --- - name: copy my.cnf copy: src=my.cnf dest=/etc/my.cnf [root@ansible data]# [root@ansible data]# cat mysql8/tasks/script.yml --- - name: service script shell: /bin/cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld [root@ansible data]# [root@ansible data]# cat mysql8/tasks/path.yml --- - name: path copy: content='PATH=/usr/local/mysql/bin:$PATH' dest=/etc/profile.d/mysql.sh [root@ansible data]# [root@ansible data]# cat mysql8/tasks/service.yml --- - name: service shell: chkconfig --add mysqld;/etc/init.d/mysqld start [root@ansible data]# [root@ansible data]# cat mysql8/tasks/main.yml --- # tasks file for mysql8 - include: install_package.yml - include: group.yml - include: user.yml - include: unarchive.yml - include: linkfile.yml - include: linkfile.yml - include: init_mysql_data.yml - include: config.yml - include: script.yml - include: path.yml - include: service.yml - include: secure.yml # åˆ›å»ºå˜é‡æ–‡ä»¶ [root@ansible data]# cat mysql8/vars/main.yml --- # vars file for mysql8 group: mysql group_gid: 306 user: mysql user_uid: 306 mysql_tar: mysql-8.0.28-linux-glibc2.12-x86_64.tar.xz mysql_version: 8.0.28 mysql_root_password: 123456 [root@ansible data]# # è°ƒç”¨è§’è‰² [root@ansible data]# cat web_roles.yml --- - hosts: centos7 remote_user: root roles: - mysql8 # è¿è¡Œ [root@ansible data]# ansible-playbook web_roles.yml å®ç°Redisè§’è‰² # åˆ›å»ºè§’è‰²ç›®å½• [root@ansible data]# ansible-galaxy init redis [root@ansible data]# tree redis/ redis/ â”œâ”€â”€ defaults â”‚Â â””â”€â”€ main.yml â”œâ”€â”€ files â”œâ”€â”€ handlers â”‚Â â””â”€â”€ main.yml â”œâ”€â”€ meta â”‚Â â””â”€â”€ main.yml â”œâ”€â”€ README.md â”œâ”€â”€ tasks â”‚Â â””â”€â”€ main.yml â”œâ”€â”€ templates â”œâ”€â”€ tests â”‚Â â”œâ”€â”€ inventory â”‚Â â””â”€â”€ test.yml â””â”€â”€ vars â””â”€â”€ main.yml # åˆ›å»ºtasksæ–‡ä»¶ [root@ansible data]# cat redis/tasks/main.yml --- # tasks file for redis - name: Installed Redis Server yum: name: redis state: present - name: Configure Redis Server template: src: redis.conf.j2 dest: /etc/redis.conf owner: redis group: root mode: '0640' notify: Restart Redis Server - name: Start Redis Server systemd: name: redis state: started enabled: yes [root@ansible data]# # åˆ›å»ºhandlersæ–‡ä»¶ [root@ansible data]# cat redis/handlers/main.yml --- # handlers file for redis - name: Restart Redis Server systemd: name: redis state: restarted [root@ansible data]# # åœ¨/data/redis/templatesç›®å½•ä¸‹å‡†å¤‡å¦‚ä¸‹æ–‡ä»¶ [root@ansible data]# ll redis/templates/ total 48 -rw-r----- 1 root root 46729 Mar 2 02:51 redis.conf.j2 [root@ansible data]# # è°ƒç”¨è§’è‰² # è°ƒç”¨è§’è‰² [root@ansible data]# cat web_roles.yml --- - hosts: centos7 remote_user: root roles: - redis # è¿è¡Œ [root@ansible data]# ansible-playbook web_roles.yml Ansibleæ¨èå­¦ä¹ èµ„æ–™ http://galaxy.ansible.com https://galaxy.ansible.com/explore#/ http://github.com/ http://ansible.com.cn/ https://github.com/ansible/ansible https://github.com/ansible/ansible-examples ",
  "wordCount" : "12240",
  "inLanguage": "en",
  "image":"https://old.colorfulgz.com/posts.images/banner/8.jpg","datePublished": "2023-02-25T19:12:21Z",
  "dateModified": "2023-02-25T19:12:21Z",
  "author":[{
    "@type": "Person",
    "name": ""
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://old.colorfulgz.com/posts/ansible2/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "DevOpsHub",
    "logo": {
      "@type": "ImageObject",
      "url": "https://old.colorfulgz.com/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://old.colorfulgz.com" accesskey="h" title="DevOpsHub (Alt + H)">
            <img src="https://old.colorfulgz.com/img/Q.gif" alt="logo" aria-label="logo"
                 height="35">DevOpsHub</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://old.colorfulgz.com/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                <span>ğŸ” æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://old.colorfulgz.com/" title="ğŸ  ä¸»é¡µ">
                <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://old.colorfulgz.com/posts" title="ğŸ“š æ–‡ç« ">
                <span>ğŸ“š æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://old.colorfulgz.com/tags" title="ğŸ§© æ ‡ç­¾">
                <span>ğŸ§© æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://old.colorfulgz.com/archives/" title="â±ï¸ æ—¶é—´è½´">
                <span>â±ï¸ æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://old.colorfulgz.com/about" title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº">
                <span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://old.colorfulgz.com">ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://old.colorfulgz.com/posts/">ğŸ“šæ–‡ç« </a></div>
            <h1 class="post-title">
                è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(äºŒ)
            </h1>
            <div class="post-description">
                Ansible çš„åç§°æ¥è‡ªç§‘å¹»å°è¯´ã€Šå®‰å¾·çš„æ¸¸æˆã€‹ä¸­è·¨è¶Šæ—¶ç©ºçš„å³æ—¶é€šä¿¡å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ç›¸è·æ•°å…‰å¹´çš„è·ç¦»,è¿œç¨‹å®æ—¶æ§åˆ¶å‰çº¿çš„èˆ°é˜Ÿæˆ˜æ–—.
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-02-25
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>12240å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>25åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://old.colorfulgz.com/tags/ansible/" style="color: var(--secondary)!important;">Ansible</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "https://old.colorfulgz.com"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="https://old.colorfulgz.com/posts.images/banner/8.jpg" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">æ–‡ç« ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#playbook" aria-label="Playbook">Playbook</a></li>
                <li>
                    <a href="#playbook%e4%bb%8b%e7%bb%8d" aria-label="playbookä»‹ç»">playbookä»‹ç»</a><ul>
                        
                <li>
                    <a href="#playbook-%e7%bb%84%e6%88%90" aria-label="Playbook ç»„æˆ">Playbook ç»„æˆ</a></li>
                <li>
                    <a href="#playbook-%e4%b8%8e-ad-hoc-%e5%af%b9%e6%af%94" aria-label="Playbook ä¸ Ad-Hoc å¯¹æ¯”">Playbook ä¸ Ad-Hoc å¯¹æ¯”</a></li></ul>
                </li>
                <li>
                    <a href="#yaml-%e8%af%ad%e8%a8%80" aria-label="YAML è¯­è¨€">YAML è¯­è¨€</a><ul>
                        
                <li>
                    <a href="#yaml-%e8%af%ad%e8%a8%80%e4%bb%8b%e7%bb%8d" aria-label="YAML è¯­è¨€ä»‹ç»">YAML è¯­è¨€ä»‹ç»</a></li>
                <li>
                    <a href="#yaml-%e8%af%ad%e8%a8%80%e7%89%b9%e6%80%a7" aria-label="YAML è¯­è¨€ç‰¹æ€§">YAML è¯­è¨€ç‰¹æ€§</a></li>
                <li>
                    <a href="#yaml%e8%af%ad%e6%b3%95%e7%ae%80%e4%bb%8b" aria-label="YAMLè¯­æ³•ç®€ä»‹">YAMLè¯­æ³•ç®€ä»‹</a></li>
                <li>
                    <a href="#%e6%94%af%e6%8c%81%e7%9a%84%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b" aria-label="æ”¯æŒçš„æ•°æ®ç±»å‹">æ”¯æŒçš„æ•°æ®ç±»å‹</a><ul>
                        
                <li>
                    <a href="#scalar-%e6%a0%87%e9%87%8f" aria-label="scalar æ ‡é‡">scalar æ ‡é‡</a></li>
                <li>
                    <a href="#dictionary-%e5%ad%97%e5%85%b8" aria-label="Dictionary å­—å…¸">Dictionary å­—å…¸</a></li>
                <li>
                    <a href="#list-%e5%88%97%e8%a1%a8" aria-label="List åˆ—è¡¨">List åˆ—è¡¨</a></li></ul>
                </li>
                <li>
                    <a href="#%e4%b8%89%e7%a7%8d%e5%b8%b8%e8%a7%81%e7%9a%84%e6%95%b0%e6%8d%ae%e6%a0%bc%e5%bc%8f" aria-label="ä¸‰ç§å¸¸è§çš„æ•°æ®æ ¼å¼">ä¸‰ç§å¸¸è§çš„æ•°æ®æ ¼å¼</a></li></ul>
                </li>
                <li>
                    <a href="#playbook-%e6%a0%b8%e5%bf%83%e7%bb%84%e4%bb%b6" aria-label="Playbook æ ¸å¿ƒç»„ä»¶">Playbook æ ¸å¿ƒç»„ä»¶</a><ul>
                        
                <li>
                    <a href="#hosts-%e7%bb%84%e4%bb%b6" aria-label="hosts ç»„ä»¶">hosts ç»„ä»¶</a></li>
                <li>
                    <a href="#remote_user-%e7%bb%84%e4%bb%b6" aria-label="remote_user ç»„ä»¶">remote_user ç»„ä»¶</a></li>
                <li>
                    <a href="#task%e5%88%97%e8%a1%a8%e5%92%8caction%e7%bb%84%e4%bb%b6" aria-label="taskåˆ—è¡¨å’Œactionç»„ä»¶">taskåˆ—è¡¨å’Œactionç»„ä»¶</a></li>
                <li>
                    <a href="#%e5%85%b6%e5%ae%83%e7%bb%84%e4%bb%b6%e8%af%b4%e6%98%8e" aria-label="å…¶å®ƒç»„ä»¶è¯´æ˜">å…¶å®ƒç»„ä»¶è¯´æ˜</a></li>
                <li>
                    <a href="#shellscripts-vs-playbook-%e6%a1%88%e4%be%8b" aria-label="ShellScripts VS Playbook æ¡ˆä¾‹">ShellScripts VS Playbook æ¡ˆä¾‹</a></li></ul>
                </li>
                <li>
                    <a href="#playbook-%e5%91%bd%e4%bb%a4" aria-label="playbook å‘½ä»¤">playbook å‘½ä»¤</a></li>
                <li>
                    <a href="#%e5%bf%bd%e7%95%a5%e9%94%99%e8%af%af-ignore_errors" aria-label="å¿½ç•¥é”™è¯¯ ignore_errors">å¿½ç•¥é”™è¯¯ ignore_errors</a></li>
                <li>
                    <a href="#ansible-playbook%e6%a1%88%e4%be%8b" aria-label="ansible-playbookæ¡ˆä¾‹">ansible-playbookæ¡ˆä¾‹</a><ul>
                        
                <li>
                    <a href="#%e5%ae%89%e8%a3%85nginx" aria-label="å®‰è£…nginx">å®‰è£…nginx</a></li>
                <li>
                    <a href="#%e5%8d%b8%e8%bd%bdhttpd" aria-label="å¸è½½httpd">å¸è½½httpd</a></li></ul>
                </li>
                <li>
                    <a href="#playbook%e4%b8%ad%e4%bd%bf%e7%94%a8handlers%e5%92%8cnotify" aria-label="Playbookä¸­ä½¿ç”¨handlerså’Œnotify">Playbookä¸­ä½¿ç”¨handlerså’Œnotify</a><ul>
                        
                <li>
                    <a href="#handlers%e5%92%8cnotify" aria-label="handlerså’Œnotify">handlerså’Œnotify</a></li>
                <li>
                    <a href="#force_handlers" aria-label="force_handlers">force_handlers</a></li></ul>
                </li>
                <li>
                    <a href="#playbook%e4%b8%ad%e4%bd%bf%e7%94%a8tags%e7%bb%84%e4%bb%b6" aria-label="Playbookä¸­ä½¿ç”¨tagsç»„ä»¶">Playbookä¸­ä½¿ç”¨tagsç»„ä»¶</a></li>
                <li>
                    <a href="#playbook%e4%b8%ad%e4%bd%bf%e7%94%a8%e5%8f%98%e9%87%8f" aria-label="Playbookä¸­ä½¿ç”¨å˜é‡">Playbookä¸­ä½¿ç”¨å˜é‡</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8-setup-%e6%a8%a1%e5%9d%97%e4%b8%ad%e5%8f%98%e9%87%8f" aria-label="ä½¿ç”¨ setup æ¨¡å—ä¸­å˜é‡">ä½¿ç”¨ setup æ¨¡å—ä¸­å˜é‡</a><ul>
                        
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8-facts-%e5%8f%98%e9%87%8f" aria-label="ä½¿ç”¨ facts å˜é‡">ä½¿ç”¨ facts å˜é‡</a></li>
                <li>
                    <a href="#%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96" aria-label="æ€§èƒ½ä¼˜åŒ–">æ€§èƒ½ä¼˜åŒ–</a></li></ul>
                </li>
                <li>
                    <a href="#register-%e6%b3%a8%e5%86%8c%e5%8f%98%e9%87%8f" aria-label="register æ³¨å†Œå˜é‡">register æ³¨å†Œå˜é‡</a></li>
                <li>
                    <a href="#%e5%9c%a8-playbook-%e5%91%bd%e4%bb%a4%e8%a1%8c%e4%b8%ad%e5%ae%9a%e4%b9%89%e5%8f%98%e9%87%8f" aria-label="åœ¨ Playbook å‘½ä»¤è¡Œä¸­å®šä¹‰å˜é‡">åœ¨ Playbook å‘½ä»¤è¡Œä¸­å®šä¹‰å˜é‡</a></li>
                <li>
                    <a href="#%e5%9c%a8playbook%e6%96%87%e4%bb%b6%e4%b8%ad%e5%ae%9a%e4%b9%89%e5%8f%98%e9%87%8f" aria-label="åœ¨playbookæ–‡ä»¶ä¸­å®šä¹‰å˜é‡">åœ¨playbookæ–‡ä»¶ä¸­å®šä¹‰å˜é‡</a></li>
                <li>
                    <a href="#%e4%bd%bf%e7%94%a8%e4%b8%93%e7%94%a8%e7%9a%84%e5%85%ac%e5%85%b1%e7%9a%84%e5%8f%98%e9%87%8f%e6%96%87%e4%bb%b6" aria-label="ä½¿ç”¨ä¸“ç”¨çš„å…¬å…±çš„å˜é‡æ–‡ä»¶">ä½¿ç”¨ä¸“ç”¨çš„å…¬å…±çš„å˜é‡æ–‡ä»¶</a></li>
                <li>
                    <a href="#%e5%9c%a8%e4%b8%bb%e6%9c%ba%e6%b8%85%e5%8d%95%e4%b8%ad%e5%ae%9a%e4%b9%89%e4%b8%bb%e6%9c%ba%e5%92%8c%e4%b8%bb%e6%9c%ba%e7%bb%84%e7%9a%84%e5%8f%98%e9%87%8f" aria-label="åœ¨ä¸»æœºæ¸…å•ä¸­å®šä¹‰ä¸»æœºå’Œä¸»æœºç»„çš„å˜é‡">åœ¨ä¸»æœºæ¸…å•ä¸­å®šä¹‰ä¸»æœºå’Œä¸»æœºç»„çš„å˜é‡</a><ul>
                        
                <li>
                    <a href="#%e6%89%80%e6%9c%89%e9%a1%b9%e7%9b%ae%e7%9a%84%e4%b8%bb%e6%9c%ba%e5%8f%98%e9%87%8f" aria-label="æ‰€æœ‰é¡¹ç›®çš„ä¸»æœºå˜é‡">æ‰€æœ‰é¡¹ç›®çš„ä¸»æœºå˜é‡</a></li>
                <li>
                    <a href="#%e6%89%80%e6%9c%89%e9%a1%b9%e7%9b%ae%e7%9a%84%e7%bb%84%e5%85%ac%e5%85%b1%e5%8f%98%e9%87%8f" aria-label="æ‰€æœ‰é¡¹ç›®çš„ç»„ï¼ˆå…¬å…±ï¼‰å˜é‡">æ‰€æœ‰é¡¹ç›®çš„ç»„ï¼ˆå…¬å…±ï¼‰å˜é‡</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%92%88%e5%af%b9%e5%bd%93%e5%89%8d%e9%a1%b9%e7%9b%ae%e7%9a%84%e4%b8%bb%e6%9c%ba%e5%92%8c%e4%b8%bb%e6%9c%ba%e7%bb%84%e7%9a%84%e5%8f%98%e9%87%8f" aria-label="é’ˆå¯¹å½“å‰é¡¹ç›®çš„ä¸»æœºå’Œä¸»æœºç»„çš„å˜é‡">é’ˆå¯¹å½“å‰é¡¹ç›®çš„ä¸»æœºå’Œä¸»æœºç»„çš„å˜é‡</a></li></ul>
                </li>
                <li>
                    <a href="#template-%e6%a8%a1%e6%9d%bf" aria-label="Template æ¨¡æ¿">Template æ¨¡æ¿</a><ul>
                        
                <li>
                    <a href="#jinja2%e8%af%ad%e8%a8%80" aria-label="jinja2è¯­è¨€">jinja2è¯­è¨€</a></li>
                <li>
                    <a href="#template" aria-label="template">template</a></li></ul>
                </li>
                <li>
                    <a href="#roles-%e8%a7%92%e8%89%b2" aria-label="Roles è§’è‰²">Roles è§’è‰²</a><ul>
                        
                <li>
                    <a href="#ansible-roles%e7%9b%ae%e5%bd%95%e7%bc%96%e6%8e%92" aria-label="Ansible Rolesç›®å½•ç¼–æ’">Ansible Rolesç›®å½•ç¼–æ’</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba-role" aria-label="åˆ›å»º role">åˆ›å»º role</a></li>
                <li>
                    <a href="#playbook-%e8%b0%83%e7%94%a8%e8%a7%92%e8%89%b2" aria-label="Playbook è°ƒç”¨è§’è‰²">Playbook è°ƒç”¨è§’è‰²</a></li>
                <li>
                    <a href="#roles-%e4%b8%ad-tags-%e4%bd%bf%e7%94%a8" aria-label="Roles ä¸­ Tags ä½¿ç”¨">Roles ä¸­ Tags ä½¿ç”¨</a></li>
                <li>
                    <a href="#%e5%ae%9e%e6%88%98%e6%a1%88%e4%be%8b" aria-label="å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹</a><ul>
                        
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0httpd%e8%a7%92%e8%89%b2" aria-label="å®ç°httpdè§’è‰²">å®ç°httpdè§’è‰²</a></li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0nginx%e8%a7%92%e8%89%b2" aria-label="å®ç°Nginxè§’è‰²">å®ç°Nginxè§’è‰²</a></li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0mysql8%e8%a7%92%e8%89%b2" aria-label="å®ç°MySql8è§’è‰²">å®ç°MySql8è§’è‰²</a></li>
                <li>
                    <a href="#%e5%ae%9e%e7%8e%b0redis%e8%a7%92%e8%89%b2" aria-label="å®ç°Redisè§’è‰²">å®ç°Redisè§’è‰²</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#ansible%e6%8e%a8%e8%8d%90%e5%ad%a6%e4%b9%a0%e8%b5%84%e6%96%99" aria-label="Ansibleæ¨èå­¦ä¹ èµ„æ–™">Ansibleæ¨èå­¦ä¹ èµ„æ–™</a>
                </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h2 id="playbook">Playbook<a hidden class="anchor" aria-hidden="true" href="#playbook">#</a></h2>
<h2 id="playbookä»‹ç»">playbookä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#playbookä»‹ç»">#</a></h2>
<p>å®˜æ–¹é“¾æ¥</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html
</span></span></code></pre></div><h3 id="playbook-ç»„æˆ">Playbook ç»„æˆ<a hidden class="anchor" aria-hidden="true" href="#playbook-ç»„æˆ">#</a></h3>
<p><img loading="lazy" src="/posts.images/image.assets/1677299110747.png" alt="1677299110747"  />
</p>
<ul>
<li>ä¸€ä¸ª playbook(å‰§æœ¬)æ–‡ä»¶æ˜¯ä¸€ä¸ªYAMLè¯­è¨€ç¼–å†™çš„æ–‡æœ¬æ–‡ä»¶</li>
<li>é€šå¸¸ä¸€ä¸ªplaybookåªåŒ…æ‹¬ä¸€ä¸ªplay</li>
<li>ä¸€ä¸ª playçš„ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†: ä¸»æœºå’Œtasks. å³å®ç°åœ¨æŒ‡å®šä¸€ç»„ä¸»æœºä¸Šæ‰§è¡Œä¸€ä¸ªtaskså®šä¹‰å¥½çš„ä»»åŠ¡åˆ—è¡¨ã€‚</li>
<li>ä¸€ä¸ªtasksä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªtaskä»»åŠ¡</li>
<li>æ¯ä¸€ä¸ªTaskæœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨ansibleçš„ä¸€ä¸ªmodule</li>
<li>åœ¨å¤æ‚åœºæ™¯ä¸­,ä¸€ä¸ªplaybookä¸­ä¹Ÿå¯ä»¥åŒ…æ‹¬å¤šä¸ªplayï¼Œå®ç°å¯¹å¤šç»„ä¸åŒçš„ä¸»æœºæ‰§è¡Œä¸åŒçš„ä»»åŠ¡</li>
</ul>
<h3 id="playbook-ä¸-ad-hoc-å¯¹æ¯”">Playbook ä¸ Ad-Hoc å¯¹æ¯”<a hidden class="anchor" aria-hidden="true" href="#playbook-ä¸-ad-hoc-å¯¹æ¯”">#</a></h3>
<ul>
<li>Playbookæ˜¯å¯¹å¤šä¸ª AD-Hoc çš„ä¸€ç§ç¼–æ’ç»„åˆçš„å®ç°æ–¹å¼</li>
<li>Playbookèƒ½æ§åˆ¶ä»»åŠ¡æ‰§è¡Œçš„å…ˆåé¡ºåº</li>
<li>Playbookå¯ä»¥æŒä¹…ä¿å­˜åˆ°æ–‡ä»¶ä¸­ä»è€Œæ–¹ä¾¿å¤šæ¬¡è°ƒç”¨è¿è¡Œï¼Œè€ŒAd-Hocåªèƒ½ä¸´æ—¶è¿è¡Œã€‚</li>
<li>Playbooké€‚åˆå¤æ‚çš„é‡å¤æ€§çš„ä»»åŠ¡ï¼Œè€ŒAd-Hocé€‚åˆåšå¿«é€Ÿç®€å•çš„ä¸€æ¬¡æ€§ä»»åŠ¡</li>
</ul>
<h2 id="yaml-è¯­è¨€">YAML è¯­è¨€<a hidden class="anchor" aria-hidden="true" href="#yaml-è¯­è¨€">#</a></h2>
<h3 id="yaml-è¯­è¨€ä»‹ç»">YAML è¯­è¨€ä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#yaml-è¯­è¨€ä»‹ç»">#</a></h3>
<p>YAMLï¼šYAML Ain&rsquo;t Markup Languageï¼Œå³YAMLä¸æ˜¯æ ‡è®°è¯­è¨€ã€‚ä¸è¿‡ï¼Œåœ¨å¼€å‘çš„è¿™ç§è¯­è¨€æ—¶ï¼ŒYAMLçš„
æ„æ€å…¶å®æ˜¯ï¼š&ldquo;Yet Another Markup Language&rdquo;ï¼ˆä»æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼‰
YAMLæ˜¯ä¸€ä¸ªå¯è¯»æ€§é«˜çš„ç”¨æ¥è¡¨è¾¾èµ„æ–™åºåˆ—çš„æ ¼å¼ã€‚
YAMLå‚è€ƒäº†å…¶ä»–å¤šç§è¯­è¨€ï¼ŒåŒ…æ‹¬ï¼šXMLã€Cè¯­è¨€ã€Pythonã€Perlä»¥åŠç”µå­é‚®ä»¶æ ¼å¼RFC2822ç­‰ã€‚
Clark Evansåœ¨2001å¹´åœ¨é¦–æ¬¡å‘è¡¨äº†è¿™ç§è¯­è¨€ï¼Œå¦å¤–Ingy dÃ¶t Netä¸Oren Ben-Kikiä¹Ÿæ˜¯è¿™è¯­è¨€çš„å…±åŒè®¾è®¡è€…
ç›®å‰å¾ˆå¤šæœ€æ–°çš„è½¯ä»¶æ¯”è¾ƒæµè¡Œé‡‡ç”¨æ­¤æ ¼å¼çš„æ–‡ä»¶å­˜æ”¾é…ç½®ä¿¡æ¯ï¼Œå¦‚:ubuntuï¼Œanisbleï¼Œdockerï¼Œkubernetesç­‰
YAML å®˜æ–¹ç½‘ç«™ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>http://www.yaml.org
</span></span></code></pre></div><p>ansible å®˜ç½‘:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html
</span></span></code></pre></div><h3 id="yaml-è¯­è¨€ç‰¹æ€§">YAML è¯­è¨€ç‰¹æ€§<a hidden class="anchor" aria-hidden="true" href="#yaml-è¯­è¨€ç‰¹æ€§">#</a></h3>
<ul>
<li>YAMLçš„å¯è¯»æ€§å¥½</li>
<li>YAMLå’Œè„šæœ¬è¯­è¨€çš„äº¤äº’æ€§å¥½</li>
<li>YAMLä½¿ç”¨å®ç°è¯­è¨€çš„æ•°æ®ç±»å‹</li>
<li>YAMLæœ‰ä¸€ä¸ªä¸€è‡´çš„ä¿¡æ¯æ¨¡å‹</li>
<li>YAMLæ˜“äºå®ç°</li>
<li>YAMLå¯ä»¥åŸºäºæµæ¥å¤„ç†</li>
<li>YAMLè¡¨è¾¾èƒ½åŠ›å¼ºï¼Œæ‰©å±•æ€§å¥½</li>
</ul>
<h3 id="yamlè¯­æ³•ç®€ä»‹">YAMLè¯­æ³•ç®€ä»‹<a hidden class="anchor" aria-hidden="true" href="#yamlè¯­æ³•ç®€ä»‹">#</a></h3>
<ul>
<li>åœ¨å•ä¸€æ–‡ä»¶ç¬¬ä¸€è¡Œï¼Œç”¨è¿ç»­ä¸‰ä¸ªè¿å­—å·&quot;-&quot; å¼€å§‹ï¼Œè¿˜æœ‰é€‰æ‹©æ€§çš„è¿ç»­ä¸‰ä¸ªç‚¹å·( &hellip; )ç”¨æ¥è¡¨ç¤ºæ–‡ä»¶ç»“å°¾</li>
<li>æ¬¡è¡Œå¼€å§‹æ­£å¸¸å†™Playbookçš„å†…å®¹ï¼Œä¸€èˆ¬å»ºè®®å†™æ˜è¯¥Playbookçš„åŠŸèƒ½</li>
<li>ä½¿ç”¨#å·æ³¨é‡Šä»£ç </li>
<li>ç¼©è¿›çš„çº§åˆ«ä¹Ÿå¿…é¡»æ˜¯ä¸€è‡´çš„ï¼ŒåŒæ ·çš„ç¼©è¿›ä»£è¡¨åŒæ ·çš„çº§åˆ«ï¼Œç¨‹åºåˆ¤åˆ«é…ç½®çš„çº§åˆ«æ˜¯é€šè¿‡ç¼©è¿›ç»“è¡Œæ¥å®ç°çš„</li>
<li>ç¼©è¿›ä¸æ”¯æŒtab,å¿…é¡»ä½¿ç”¨ç©ºæ ¼è¿›è¡Œç¼©è¿›</li>
<li>ç¼©è¿›çš„ç©ºæ ¼æ•°ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯</li>
<li>YAMLæ–‡ä»¶å†…å®¹æ˜¯åŒºåˆ«å¤§å°å†™çš„ï¼Œkey/valueçš„å€¼å‡éœ€å¤§å°å†™æ•æ„Ÿ</li>
<li>å¤šä¸ªkey/valueå¯åŒè¡Œå†™ä¹Ÿå¯æ¢è¡Œå†™ï¼ŒåŒè¡Œä½¿ç”¨ï¼Œåˆ†éš”</li>
<li>keyåé¢å†’å·è¦åŠ ä¸€ä¸ªç©ºæ ¼ æ¯”å¦‚: key: value</li>
<li>valueå¯æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯æ˜¯å¦ä¸€ä¸ªåˆ—è¡¨</li>
<li>YAMLæ–‡ä»¶æ‰©å±•åé€šå¸¸ä¸ºymlæˆ–yaml</li>
</ul>
<h3 id="æ”¯æŒçš„æ•°æ®ç±»å‹">æ”¯æŒçš„æ•°æ®ç±»å‹<a hidden class="anchor" aria-hidden="true" href="#æ”¯æŒçš„æ•°æ®ç±»å‹">#</a></h3>
<p>YAML æ”¯æŒä»¥ä¸‹å¸¸ç”¨å‡ ç§æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>æ ‡é‡ï¼šå•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼</li>
<li>å¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆï¼Œåˆç§°ä¸º: å­—å…¸ï¼ˆdictionaryï¼‰/ å“ˆå¸Œï¼ˆhashesï¼‰ / æ˜ å°„ï¼ˆmappingï¼‰</li>
<li>æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼Œåˆç§°ä¸º: åˆ—è¡¨ï¼ˆlistï¼‰/ åºåˆ—ï¼ˆsequenceï¼‰</li>
</ul>
<h4 id="scalar-æ ‡é‡">scalar æ ‡é‡<a hidden class="anchor" aria-hidden="true" href="#scalar-æ ‡é‡">#</a></h4>
<p>keyå¯¹åº”value</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>name: wang
</span></span><span style="display:flex;"><span>age: 18
</span></span></code></pre></div><p>ä½¿ç”¨ç¼©è¿›çš„æ–¹å¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>name:
</span></span><span style="display:flex;"><span>wang
</span></span><span style="display:flex;"><span>age:
</span></span><span style="display:flex;"><span>18
</span></span></code></pre></div><p>æ ‡é‡æ˜¯æœ€åŸºæœ¬çš„ï¼Œä¸å¯å†åˆ†çš„å€¼ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>å­—ç¬¦ä¸²</li>
<li>å¸ƒå°”å€¼</li>
<li>æ•´æ•°</li>
<li>æµ®ç‚¹æ•°</li>
<li>Null</li>
<li>æ—¶é—´</li>
<li>æ—¥æœŸ</li>
</ul>
<h4 id="dictionary-å­—å…¸">Dictionary å­—å…¸<a hidden class="anchor" aria-hidden="true" href="#dictionary-å­—å…¸">#</a></h4>
<p>ä¸€ä¸ªå­—å…¸æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªkeyä¸valueæ„æˆ
keyå’Œvalueä¹‹é—´ç”¨å†’å· ï¼šåˆ†éš”
å†’å· : åé¢æœ‰ä¸€ä¸ªç©ºæ ¼
æ‰€æœ‰ k/v å¯ä»¥æ”¾åœ¨ä¸€è¡Œï¼Œ,æ¯ä¸ª k/v ä¹‹é—´ç”¨é€—å·åˆ†éš”
æ‰€æœ‰æ¯ä¸ª k/v ä¹Ÿå¯ä»¥åˆ†åˆ«æ”¾åœ¨ä¸åŒè¡Œ,ä¸€å¯¹k/væ”¾åœ¨ç‹¬ç«‹çš„ä¸€è¡Œ
æ ¼å¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>account: { name: wang, age: 30 }
</span></span></code></pre></div><p>ä½¿ç”¨ç¼©è¿›æ–¹å¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>account:
</span></span><span style="display:flex;"><span>name: wang
</span></span><span style="display:flex;"><span>age: 18
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#ä¸åŒè¡Œ
</span></span><span style="display:flex;"><span># An employee record
</span></span><span style="display:flex;"><span>name: Example Developer
</span></span><span style="display:flex;"><span>job: Developer
</span></span><span style="display:flex;"><span>skill: Elite(ç¤¾ä¼šç²¾è‹±)
</span></span><span style="display:flex;"><span>#åŒä¸€è¡Œ,ä¹Ÿå¯ä»¥å°†key:valueæ”¾ç½®äº{}ä¸­è¿›è¡Œè¡¨ç¤ºï¼Œç”¨,åˆ†éš”å¤šä¸ªkey:value
</span></span><span style="display:flex;"><span># An employee record
</span></span><span style="display:flex;"><span>{name: &#34;Example Developer&#34;, job: &#34;Developer&#34;, skill: &#34;Elite&#34;}
</span></span></code></pre></div><h4 id="list-åˆ—è¡¨">List åˆ—è¡¨<a hidden class="anchor" aria-hidden="true" href="#list-åˆ—è¡¨">#</a></h4>
<p>åˆ—è¡¨ç”±å¤šä¸ªå…ƒç´ ç»„æˆ
æ¯ä¸ªå…ƒç´ æ”¾åœ¨ä¸åŒè¡Œï¼Œæ¯ä¸ªå…ƒç´ ä¸€è¡Œ,ä¸”å…ƒç´ å‰å‡ä½¿ç”¨ä¸­æ¨ªçº¿ - å¼€å¤´ï¼Œå¹¶ä¸”ä¸­æ¨ªçº¿ - å’Œå…ƒç´ ä¹‹é—´æœ‰ä¸€ä¸ªç©ºæ ¼
ä¹Ÿå¯ä»¥å°†æ‰€æœ‰å…ƒç´ ç”¨ [ ] æ‹¬èµ·æ¥æ”¾åœ¨åŒä¸€è¡Œ,æ¯ä¸ªå…ƒç´ ä¹‹é—´ç”¨é€—å·åˆ†éš”
æ ¼å¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>course: [ linux , golang , python ]
</span></span></code></pre></div><p>ä¹Ÿå¯ä»¥å†™æˆä»¥ - å¼€å¤´çš„å¤šè¡Œ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>course:
</span></span><span style="display:flex;"><span>- linux
</span></span><span style="display:flex;"><span>- golang
</span></span><span style="display:flex;"><span>- python
</span></span><span style="display:flex;"><span>course:
</span></span><span style="display:flex;"><span>- linux: manjaro
</span></span><span style="display:flex;"><span>- golang: gin
</span></span><span style="display:flex;"><span>- python: django
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#ä¸åŒè¡Œ,è¡Œä»¥-å¼€å¤´,åé¢æœ‰ä¸€ä¸ªç©ºæ ¼</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># A list of tasty fruits</span>
</span></span><span style="display:flex;"><span>- Apple
</span></span><span style="display:flex;"><span>- Orange
</span></span><span style="display:flex;"><span>- Strawberry
</span></span><span style="display:flex;"><span>- Mango
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åŒä¸€è¡Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Apple,Orange,Strawberry,Mango<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šYAML è¡¨ç¤ºä¸€ä¸ªå®¶åº­</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name: John Smith
</span></span><span style="display:flex;"><span>age: <span style="color:#ae81ff">41</span>
</span></span><span style="display:flex;"><span>gender: Male
</span></span><span style="display:flex;"><span>spouse: <span style="color:#f92672">{</span> name: Jane Smith, age: 37, gender: Female <span style="color:#f92672">}</span> <span style="color:#75715e"># å†™åœ¨ä¸€è¡Œé‡Œ</span>
</span></span><span style="display:flex;"><span>  name: Jane Smith <span style="color:#75715e">#ä¹Ÿå¯ä»¥å†™æˆå¤šè¡Œ</span>
</span></span><span style="display:flex;"><span>  age: <span style="color:#ae81ff">37</span>
</span></span><span style="display:flex;"><span>  gender: Female
</span></span><span style="display:flex;"><span>  children: <span style="color:#f92672">[</span> <span style="color:#f92672">{</span>name: Jimmy Smith,age: 17, gender: Male<span style="color:#f92672">}</span>, <span style="color:#f92672">{</span>name: Jenny Smith, age:13, gender: Female<span style="color:#f92672">}</span>, <span style="color:#f92672">{</span>name: hao Smith, age: 20, gender: Male <span style="color:#f92672">}</span> <span style="color:#f92672">]</span> <span style="color:#75715e">#å†™åœ¨ä¸€è¡Œ</span>
</span></span><span style="display:flex;"><span>  - name: Jimmy Smith <span style="color:#75715e">#å†™åœ¨å¤šè¡Œ,æ›´ä¸ºæ¨èçš„å†™æ³•</span>
</span></span><span style="display:flex;"><span>    age: <span style="color:#ae81ff">17</span>
</span></span><span style="display:flex;"><span>    gender: Male
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">{</span>name: Jenny Smith, age: 13, gender: Female<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">{</span>name: hao Smith, age: 20, gender: Male <span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="ä¸‰ç§å¸¸è§çš„æ•°æ®æ ¼å¼">ä¸‰ç§å¸¸è§çš„æ•°æ®æ ¼å¼<a hidden class="anchor" aria-hidden="true" href="#ä¸‰ç§å¸¸è§çš„æ•°æ®æ ¼å¼">#</a></h3>
<ul>
<li>XMLï¼šExtensible Markup Languageï¼Œå¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼Œå¯ç”¨äºæ•°æ®äº¤æ¢å’Œé…ç½®</li>
<li>JSONï¼šJavaScript Object Notation, JavaScript å¯¹è±¡è¡¨è®°æ³•ï¼Œä¸»è¦ç”¨æ¥æ•°æ®äº¤æ¢æˆ–é…ç½®ï¼Œä¸æ”¯æŒæ³¨é‡Š</li>
<li>YAMLï¼šYAML Ain&rsquo;t Markup Language YAML ä¸æ˜¯ä¸€ç§æ ‡è®°è¯­è¨€ï¼Œ ä¸»è¦ç”¨æ¥é…ç½®ï¼Œå¤§å°å†™æ•æ„Ÿï¼Œä¸æ”¯æŒtab</li>
</ul>
<p><img loading="lazy" src="/posts.images/image.assets/1677310138888.png" alt="1677310138888"  />
</p>
<p>å¯ä»¥ç”¨å·¥å…·äº’ç›¸è½¬æ¢ï¼Œå‚è€ƒç½‘ç«™ï¼š</p>
<p><a href="https://www.json2yaml.com/">url</a>
<a href="http://www.bejson.com/json/json2yaml/">url1</a></p>
<h2 id="playbook-æ ¸å¿ƒç»„ä»¶">Playbook æ ¸å¿ƒç»„ä»¶<a hidden class="anchor" aria-hidden="true" href="#playbook-æ ¸å¿ƒç»„ä»¶">#</a></h2>
<p>å®˜æ–¹æ–‡æ¡£</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>https://docs.ansible.com/ansible/latest/reference_appendices/playbooks_keywords.html#playbook-keywords
</span></span></code></pre></div><p>ä¸€ä¸ªplaybook ä¸­ç”±å¤šä¸ªç»„ä»¶ç»„æˆ,å…¶ä¸­æ‰€ç”¨åˆ°çš„å¸¸è§ç»„ä»¶ç±»å‹å¦‚ä¸‹:</p>
<ul>
<li>Hosts æ‰§è¡Œçš„è¿œç¨‹ä¸»æœºåˆ—è¡¨</li>
<li>Tasks ä»»åŠ¡é›†,ç”±å¤šä¸ªtaskçš„å…ƒç´ ç»„æˆçš„åˆ—è¡¨å®ç°,æ¯ä¸ªtaskæ˜¯ä¸€ä¸ªå­—å…¸,ä¸€ä¸ªå®Œæ•´çš„ä»£ç å—åŠŸèƒ½éœ€å°‘å…ƒç´ éœ€åŒ…æ‹¬ name å’Œ task,ä¸€ä¸ªnameåªèƒ½åŒ…æ‹¬ä¸€ä¸ªtask</li>
<li>Variables å†…ç½®å˜é‡æˆ–è‡ªå®šä¹‰å˜é‡åœ¨playbookä¸­è°ƒç”¨</li>
<li>Templates æ¨¡æ¿ï¼Œå¯æ›¿æ¢æ¨¡æ¿æ–‡ä»¶ä¸­çš„å˜é‡å¹¶å®ç°ä¸€äº›ç®€å•é€»è¾‘çš„æ–‡ä»¶</li>
<li>Handlers å’Œ notify ç»“åˆä½¿ç”¨ï¼Œç”±ç‰¹å®šæ¡ä»¶è§¦å‘çš„æ“ä½œï¼Œæ»¡è¶³æ¡ä»¶æ–¹æ‰æ‰§è¡Œï¼Œå¦åˆ™ä¸æ‰§è¡Œ</li>
<li>tags æ ‡ç­¾ æŒ‡å®šæŸæ¡ä»»åŠ¡æ‰§è¡Œï¼Œç”¨äºé€‰æ‹©è¿è¡Œplaybookä¸­çš„éƒ¨åˆ†ä»£ç ã€‚ansibleå…·æœ‰å¹‚ç­‰æ€§ï¼Œå› æ­¤ ä¼šè‡ªåŠ¨è·³è¿‡æ²¡æœ‰å˜åŒ–çš„éƒ¨åˆ†ï¼Œå³ä¾¿å¦‚æ­¤ï¼Œæœ‰äº›ä»£ç ä¸ºæµ‹è¯•å…¶ç¡®å®æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„æ—¶é—´ä¾ç„¶ä¼šéå¸¸åœ°é•¿ã€‚æ­¤æ—¶ï¼Œå¦‚æœç¡®ä¿¡å…¶æ²¡æœ‰å˜åŒ–ï¼Œå°±å¯ä»¥é€šè¿‡tagsè·³è¿‡æ­¤äº›ä»£ç ç‰‡æ–­</li>
</ul>
<h3 id="hosts-ç»„ä»¶">hosts ç»„ä»¶<a hidden class="anchor" aria-hidden="true" href="#hosts-ç»„ä»¶">#</a></h3>
<p>Hostsï¼šplaybookä¸­çš„æ¯ä¸€ä¸ªplayçš„ç›®çš„éƒ½æ˜¯ä¸ºäº†è®©ç‰¹å®šä¸»æœºä»¥æŸä¸ªæŒ‡å®šçš„ç”¨æˆ·èº«ä»½æ‰§è¡Œä»»åŠ¡ã€‚hostsç”¨äºæŒ‡å®šè¦æ‰§è¡ŒæŒ‡å®šä»»åŠ¡çš„ä¸»æœºï¼Œé¡»äº‹å…ˆå®šä¹‰åœ¨ä¸»æœºæ¸…å•ä¸­</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>one.example.com
</span></span><span style="display:flex;"><span>one.example.com:two.example.com
</span></span><span style="display:flex;"><span>192.168.1.50
</span></span><span style="display:flex;"><span>192.168.1.*
</span></span><span style="display:flex;"><span>Websrvs:dbsrvs <span style="color:#75715e">#æˆ–è€…ï¼Œä¸¤ä¸ªç»„çš„å¹¶é›†</span>
</span></span><span style="display:flex;"><span>Websrvs:&amp;dbsrvs <span style="color:#75715e">#ä¸ï¼Œä¸¤ä¸ªç»„çš„äº¤é›†</span>
</span></span><span style="display:flex;"><span>webservers:!dbsrvs <span style="color:#75715e">#åœ¨websrvsç»„ï¼Œä½†ä¸åœ¨dbsrvsç»„</span>
</span></span></code></pre></div><p>æ¡ˆä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- hosts: websrvs:appsrvs
</span></span></code></pre></div><h3 id="remote_user-ç»„ä»¶">remote_user ç»„ä»¶<a hidden class="anchor" aria-hidden="true" href="#remote_user-ç»„ä»¶">#</a></h3>
<p>remote_user: å¯ç”¨äºHostå’Œtaskä¸­ã€‚ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šå…¶é€šè¿‡sudoçš„æ–¹å¼åœ¨è¿œç¨‹ä¸»æœºä¸Šæ‰§è¡Œä»»åŠ¡ï¼Œå…¶å¯ç”¨äºplayå…¨å±€æˆ–æŸä»»åŠ¡ï¼›æ­¤å¤–ï¼Œç”šè‡³å¯ä»¥åœ¨sudoæ—¶ä½¿ç”¨sudo_useræŒ‡å®šsudoæ—¶åˆ‡æ¢çš„ç”¨æˆ·</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- hosts: websrvs
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>    - name: test connection
</span></span><span style="display:flex;"><span>    ping:
</span></span><span style="display:flex;"><span>    remote_user: magedu
</span></span><span style="display:flex;"><span>    sudo: yes <span style="color:#75715e">#é»˜è®¤sudoä¸ºroot</span>
</span></span><span style="display:flex;"><span>    sudo_user:wang <span style="color:#75715e">#sudoä¸ºwang</span>
</span></span></code></pre></div><h3 id="taskåˆ—è¡¨å’Œactionç»„ä»¶">taskåˆ—è¡¨å’Œactionç»„ä»¶<a hidden class="anchor" aria-hidden="true" href="#taskåˆ—è¡¨å’Œactionç»„ä»¶">#</a></h3>
<p>playçš„ä¸»ä½“éƒ¨åˆ†æ˜¯task listï¼Œtask listä¸­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªtask,å„ä¸ªtask æŒ‰æ¬¡åºé€ä¸ªåœ¨hostsä¸­æŒ‡å®šçš„æ‰€æœ‰ä¸»æœºä¸Šæ‰§è¡Œï¼Œå³åœ¨æ‰€æœ‰ä¸»æœºä¸Šå®Œæˆç¬¬ä¸€ä¸ªtaskåï¼Œå†å¼€å§‹ç¬¬äºŒä¸ªtask
taskçš„ç›®çš„æ˜¯ä½¿ç”¨æŒ‡å®šçš„å‚æ•°æ‰§è¡Œæ¨¡å—ï¼Œè€Œåœ¨æ¨¡å—å‚æ•°ä¸­å¯ä»¥ä½¿ç”¨å˜é‡ã€‚æ¨¡å—æ‰§è¡Œæ˜¯å¹‚ç­‰çš„ï¼Œè¿™æ„å‘³ç€å¤šæ¬¡æ‰§è¡Œæ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºå…¶ç»“æœå‡ä¸€è‡´
æ¯ä¸ªtaskéƒ½åº”è¯¥æœ‰å…¶nameï¼Œç”¨äºplaybookçš„æ‰§è¡Œç»“æœè¾“å‡ºï¼Œå»ºè®®å…¶å†…å®¹èƒ½æ¸…æ™°åœ°æè¿°ä»»åŠ¡æ‰§è¡Œæ­¥éª¤ã€‚
å¦‚æœæœªæä¾›nameï¼Œåˆ™actionçš„ç»“æœå°†ç”¨äºè¾“å‡º
taskä¸¤ç§æ ¼å¼ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>action: module arguments <span style="color:#75715e">#ç¤ºä¾‹: action: shell wall hello</span>
</span></span><span style="display:flex;"><span>module: arguments <span style="color:#75715e">#å»ºè®®ä½¿ç”¨ #ç¤ºä¾‹: shell: wall hello</span>
</span></span></code></pre></div><p>æ³¨æ„ï¼šshellå’Œcommandæ¨¡å—åé¢è·Ÿå‘½ä»¤ï¼Œè€Œékey=value
èŒƒä¾‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#cat hello.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">#first yamlæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>- hosts: websrvs
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  gather_facts: no
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>    - name: task1
</span></span><span style="display:flex;"><span>      debug: msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;task1 running&#34;</span>
</span></span><span style="display:flex;"><span>    - name: task2
</span></span><span style="display:flex;"><span>      debug: msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;task2 running&#34;</span>
</span></span><span style="display:flex;"><span>- hosts: appsrvs
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  gather_facts: no
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>    - name: task3
</span></span><span style="display:flex;"><span>      debug: msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;task3 running&#34;</span>
</span></span><span style="display:flex;"><span>    - name: task4
</span></span><span style="display:flex;"><span>      debug: msg<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;task4 running&#34;</span>
</span></span></code></pre></div><h3 id="å…¶å®ƒç»„ä»¶è¯´æ˜">å…¶å®ƒç»„ä»¶è¯´æ˜<a hidden class="anchor" aria-hidden="true" href="#å…¶å®ƒç»„ä»¶è¯´æ˜">#</a></h3>
<p>æŸä»»åŠ¡çš„çŠ¶æ€åœ¨è¿è¡Œåä¸ºchangedæ—¶ï¼Œå¯é€šè¿‡&quot;notify&quot;é€šçŸ¥ç»™ç›¸åº”çš„handlersä»»åŠ¡
è¿˜å¯ä»¥é€šè¿‡&quot;tags&quot;ç»™task æ‰“æ ‡ç­¾ï¼Œå¯åœ¨ansible-playbookå‘½ä»¤ä¸Šä½¿ç”¨-tæŒ‡å®šè¿›è¡Œè°ƒç”¨</p>
<h3 id="shellscripts-vs-playbook-æ¡ˆä¾‹">ShellScripts VS Playbook æ¡ˆä¾‹<a hidden class="anchor" aria-hidden="true" href="#shellscripts-vs-playbook-æ¡ˆä¾‹">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#SHELLè„šæœ¬å®ç°</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…Apache</span>
</span></span><span style="display:flex;"><span>yum install --quiet -y httpd
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¤åˆ¶é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>cp /tmp/httpd.conf /etc/httpd/conf/httpd.conf
</span></span><span style="display:flex;"><span>cp/tmp/vhosts.conf /etc/httpd/conf.d/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨Apacheï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨</span>
</span></span><span style="display:flex;"><span>systemctl enable --now httpd
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Playbookå®ç°</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: websrvs
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  gather_facts: no
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: <span style="color:#e6db74">&#34;å®‰è£…Apache&#34;</span>
</span></span><span style="display:flex;"><span>    yum: name<span style="color:#f92672">=</span>httpd
</span></span><span style="display:flex;"><span>  - name: <span style="color:#e6db74">&#34;å¤åˆ¶é…ç½®æ–‡ä»¶&#34;</span>
</span></span><span style="display:flex;"><span>  copy: src<span style="color:#f92672">=</span>/tmp/httpd.conf dest<span style="color:#f92672">=</span>/etc/httpd/conf/
</span></span><span style="display:flex;"><span>  - name: <span style="color:#e6db74">&#34;å¤åˆ¶é…ç½®æ–‡ä»¶&#34;</span>
</span></span><span style="display:flex;"><span>  copy: src<span style="color:#f92672">=</span>/tmp/vhosts.conf dest<span style="color:#f92672">=</span>/etc/httpd/conf.d/
</span></span><span style="display:flex;"><span>  - name: <span style="color:#e6db74">&#34;å¯åŠ¨Apacheï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨&#34;</span>
</span></span><span style="display:flex;"><span>  service: name<span style="color:#f92672">=</span>httpd state<span style="color:#f92672">=</span>started enabled<span style="color:#f92672">=</span>yes
</span></span></code></pre></div><h2 id="playbook-å‘½ä»¤">playbook å‘½ä»¤<a hidden class="anchor" aria-hidden="true" href="#playbook-å‘½ä»¤">#</a></h2>
<p>æ ¼å¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ansible-playbook &lt;filename.yml&gt; ... <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>--syntax,--syntax-check <span style="color:#75715e">#è¯­æ³•æ£€æŸ¥,åŠŸèƒ½ç›¸å½“äºbash -n</span>
</span></span><span style="display:flex;"><span>-C --check <span style="color:#75715e">#æ¨¡æ‹Ÿæ‰§è¡Œdry run ,åªæ£€æµ‹å¯èƒ½ä¼šå‘ç”Ÿçš„æ”¹å˜ï¼Œä½†ä¸çœŸæ­£æ‰§è¡Œæ“ä½œ</span>
</span></span><span style="display:flex;"><span>--list-hosts <span style="color:#75715e">#åˆ—å‡ºè¿è¡Œä»»åŠ¡çš„ä¸»æœº</span>
</span></span><span style="display:flex;"><span>--list-tags <span style="color:#75715e">#åˆ—å‡ºtag</span>
</span></span><span style="display:flex;"><span>--list-tasks <span style="color:#75715e">#åˆ—å‡ºtask</span>
</span></span><span style="display:flex;"><span>--limit ä¸»æœºåˆ—è¡¨ <span style="color:#75715e">#åªé’ˆå¯¹ä¸»æœºåˆ—è¡¨ä¸­çš„ç‰¹å®šä¸»æœºæ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>-i INVENTORY, --inventory INVENTORY <span style="color:#75715e">#æŒ‡å®šä¸»æœºæ¸…å•æ–‡ä»¶,é€šå¸¸ä¸€ä¸ªé¡¹å¯¹åº”ä¸€ä¸ªä¸»æœºæ¸…å•æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>--start-at-task START_AT_TASK <span style="color:#75715e">#ä»æŒ‡å®štaskå¼€å§‹æ‰§è¡Œ,è€Œéä»å¤´å¼€å§‹,START_AT_TASKä¸ºä»»åŠ¡çš„name</span>
</span></span><span style="display:flex;"><span>-v -vv -vvv <span style="color:#75715e">#æ˜¾ç¤ºè¿‡ç¨‹</span>
</span></span></code></pre></div><p>èŒƒä¾‹: ä¸€ä¸ªç®€å•çš„ playbook</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#cat hello.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: websrvs
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>    - name: hello
</span></span><span style="display:flex;"><span>      command: echo <span style="color:#e6db74">&#34;hello ansible&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook hello.yml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook -v hello.yml</span>
</span></span></code></pre></div><p>èŒƒä¾‹: æ£€æŸ¥å’Œé™åˆ¶ä¸»æœº</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ansible-playbook file.yml --check <span style="color:#75715e">#åªæ£€æµ‹</span>
</span></span><span style="display:flex;"><span>ansible-playbook file.yml
</span></span><span style="display:flex;"><span>ansible-playbook file.yml --limit websrvs
</span></span></code></pre></div><p>èŒƒä¾‹: ä¸€ä¸ªplaybook å¤šä¸ªplay</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat test_plays.yaml
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: localhost
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  gather_facts: no
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>    - name: play1
</span></span><span style="display:flex;"><span>      command: echo <span style="color:#e6db74">&#34;play1&#34;</span>
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  gather_facts: no
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>    - name: play2
</span></span><span style="display:flex;"><span>      command: echo <span style="color:#e6db74">&#34;play2&#34;</span>
</span></span></code></pre></div><h2 id="å¿½ç•¥é”™è¯¯-ignore_errors">å¿½ç•¥é”™è¯¯ ignore_errors<a hidden class="anchor" aria-hidden="true" href="#å¿½ç•¥é”™è¯¯-ignore_errors">#</a></h2>
<p>å¦‚æœä¸€ä¸ªtaskå‡ºé”™,é»˜è®¤å°†ä¸ä¼šç»§ç»­æ‰§è¡Œåç»­çš„å…¶å®ƒtask
åˆ©ç”¨ ignore_errors: yes å¯ä»¥å¿½ç•¥æ­¤taskçš„é”™è¯¯,ç»§ç»­å‘ä¸‹æ‰§è¡Œplaybookå…¶å®ƒtask</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#cat test_ignore.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>    - name: error
</span></span><span style="display:flex;"><span>      command: /bin/false
</span></span><span style="display:flex;"><span>      ignore_errors: yes
</span></span><span style="display:flex;"><span>    - name: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>      command: wall <span style="color:#66d9ef">continue</span>
</span></span></code></pre></div><h2 id="ansible-playbookæ¡ˆä¾‹">ansible-playbookæ¡ˆä¾‹<a hidden class="anchor" aria-hidden="true" href="#ansible-playbookæ¡ˆä¾‹">#</a></h2>
<h3 id="å®‰è£…nginx">å®‰è£…nginx<a hidden class="anchor" aria-hidden="true" href="#å®‰è£…nginx">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span># yum install nginx
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  gather_facts: no
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>    - name: install nginx
</span></span><span style="display:flex;"><span>      yum: name=nginx state=present
</span></span><span style="display:flex;"><span>    - name:
</span></span><span style="display:flex;"><span>      service: name=nginx state=started enabled=yes
</span></span></code></pre></div><h3 id="å¸è½½httpd">å¸è½½httpd<a hidden class="anchor" aria-hidden="true" href="#å¸è½½httpd">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#75715e">#remove_httpd.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">webservers</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">remote_user</span>: <span style="color:#ae81ff">root</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">gather_facts</span>: <span style="color:#66d9ef">no</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tasks</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">remove httpd package</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">yum</span>: <span style="color:#ae81ff">name=httpd state=absent</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">remove apache user</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">user</span>: <span style="color:#ae81ff">name=apache state=absent</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">remove config file</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">file</span>: <span style="color:#ae81ff">name=/etc/httpd state=absent</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">remove web html</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">file</span>: <span style="color:#ae81ff">name=/data/html/ state=absent</span>
</span></span></code></pre></div><h2 id="playbookä¸­ä½¿ç”¨handlerså’Œnotify">Playbookä¸­ä½¿ç”¨handlerså’Œnotify<a hidden class="anchor" aria-hidden="true" href="#playbookä¸­ä½¿ç”¨handlerså’Œnotify">#</a></h2>
<h3 id="handlerså’Œnotify">handlerså’Œnotify<a hidden class="anchor" aria-hidden="true" href="#handlerså’Œnotify">#</a></h3>
<p>Handlersæœ¬è´¨æ˜¯task list ï¼Œç±»ä¼¼äºMySQLä¸­çš„è§¦å‘å™¨è§¦å‘çš„è¡Œä¸ºï¼Œå…¶ä¸­çš„taskä¸å‰è¿°çš„taskå¹¶æ²¡æœ‰æœ¬è´¨ä¸Šçš„ä¸åŒï¼Œåªæœ‰åœ¨å…³æ³¨çš„èµ„æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šé‡‡å–ä¸€å®šçš„æ“ä½œã€‚
Notifyå¯¹åº”çš„action åœ¨æ‰€æœ‰taskéƒ½æ‰§è¡Œå®Œæ‰ä¼šæœ€åè¢«è§¦å‘ï¼Œè¿™æ ·å¯é¿å…å¤šä¸ªtaskå¤šæ¬¡æ”¹å˜å‘ç”Ÿæ—¶æ¯æ¬¡éƒ½è§¦å‘æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼ŒHandlersä»…åœ¨æ‰€æœ‰çš„å˜åŒ–å‘ç”Ÿå®Œæˆåä¸€æ¬¡æ€§åœ°æ‰§è¡ŒæŒ‡å®šæ“ä½œã€‚
åœ¨notifyä¸­åˆ—å‡ºçš„æ“ä½œç§°ä¸ºhandlerï¼Œä¹Ÿå³notifyä¸­è°ƒç”¨handlerä¸­å®šä¹‰çš„æ“ä½œ
æ³¨æ„:</p>
<ul>
<li>å¦‚æœå¤šä¸ªtaské€šçŸ¥äº†ç›¸åŒçš„handlersï¼Œ æ­¤handlersä»…ä¼šåœ¨æ‰€æœ‰taskç»“æŸåè¿è¡Œä¸€ æ¬¡ã€‚</li>
<li>åªæœ‰notifyå¯¹åº”çš„taskå‘ç”Ÿæ”¹å˜äº†æ‰ä¼šé€šçŸ¥handlersï¼Œ æ²¡æœ‰æ”¹å˜åˆ™ä¸ä¼šè§¦å‘handlers</li>
<li>handlers æ˜¯åœ¨æ‰€æœ‰å‰é¢çš„taskséƒ½æˆåŠŸæ‰§è¡Œæ‰ä¼šæ‰§è¡Œ,å¦‚æœå‰é¢ä»»ä½•ä¸€ä¸ªtaskå¤±è´¥,ä¼šå¯¼è‡´handleè·³è¿‡æ‰§è¡Œ</li>
</ul>
<p>æ¡ˆä¾‹:</p>
<p><img loading="lazy" src="/posts.images/image.assets/1677315798458.png" alt="1677315798458"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1677315812687.png" alt="1677315812687"  />
</p>
<p>æ¡ˆä¾‹ï¼š</p>
<p><img loading="lazy" src="/posts.images/image.assets/1677315839869.png" alt="1677315839869"  />
</p>
<p>æ¡ˆä¾‹ï¼š</p>
<p><img loading="lazy" src="/posts.images/image.assets/1677315862982.png" alt="1677315862982"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1677315872464.png" alt="1677315872464"  />
</p>
<p>èŒƒä¾‹: éƒ¨ç½²haproxy</p>
<p><img loading="lazy" src="/posts.images/image.assets/1677315902745.png" alt="1677315902745"  />
</p>
<h3 id="force_handlers">force_handlers<a hidden class="anchor" aria-hidden="true" href="#force_handlers">#</a></h3>
<p>å¦‚æœä¸è®ºå‰é¢çš„taskæˆåŠŸä¸å¦,éƒ½å¸Œæœ›handlersèƒ½æ‰§è¡Œ, å¯ä»¥ä½¿ç”¨force_handlers: yes å¼ºåˆ¶æ‰§è¡Œhandler
èŒƒä¾‹: å¼ºåˆ¶è°ƒç”¨handlers</p>
<p><img loading="lazy" src="/posts.images/image.assets/1677315975960.png" alt="1677315975960"  />
</p>
<h2 id="playbookä¸­ä½¿ç”¨tagsç»„ä»¶">Playbookä¸­ä½¿ç”¨tagsç»„ä»¶<a hidden class="anchor" aria-hidden="true" href="#playbookä¸­ä½¿ç”¨tagsç»„ä»¶">#</a></h2>
<p>å®˜æ–¹æ–‡æ¡£:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>https://docs.ansible.com/ansible/latest/user_guide/playbooks_tags.html
</span></span></code></pre></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ Ansible åœ¨æ‰§è¡Œä¸€ä¸ª playbook æ—¶ï¼Œä¼šæ‰§è¡Œ playbook ä¸­æ‰€æœ‰çš„ä»»åŠ¡ï¼Œåœ¨playbookæ–‡ä»¶ä¸­ï¼Œå¯ä»¥åˆ©ç”¨tagsç»„ä»¶ï¼Œä¸ºç‰¹å®š task æŒ‡å®šæ ‡ç­¾ï¼Œå½“åœ¨æ‰§è¡Œplaybookæ—¶ï¼Œå¯ä»¥åªæ‰§è¡Œç‰¹å®štagsçš„task,è€Œéæ•´ä¸ªplaybookæ–‡ä»¶
å¯ä»¥ä¸€ä¸ªtaskå¯¹åº”å¤šä¸ªtag,ä¹Ÿå¯ä»¥å¤šä¸ªtaskå¯¹åº”åŒä¸€ä¸ªtag
è¿˜æœ‰å¦å¤–3ä¸ªç‰¹æ®Šå…³é”®å­—ç”¨äºæ ‡ç­¾, tagged, untagged å’Œ all,å®ƒä»¬åˆ†åˆ«æ˜¯ä»…è¿è¡Œå·²æ ‡è®°ï¼Œåªæœ‰æœªæ ‡è®°å’Œæ‰€æœ‰ä»»åŠ¡ã€‚
tags ä¸»è¦ç”¨äºè°ƒè¯•ç¯å¢ƒ
èŒƒä¾‹ï¼š tag æ ‡ç­¾</p>
<p><img loading="lazy" src="/posts.images/image.assets/1677316033321.png" alt="1677316033321"  />
</p>
<h2 id="playbookä¸­ä½¿ç”¨å˜é‡">Playbookä¸­ä½¿ç”¨å˜é‡<a hidden class="anchor" aria-hidden="true" href="#playbookä¸­ä½¿ç”¨å˜é‡">#</a></h2>
<p>Playbookä¸­åŒæ ·ä¹Ÿæ”¯æŒå˜é‡
å˜é‡åï¼šä»…èƒ½ç”±å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆï¼Œä¸”åªèƒ½ä»¥å­—æ¯å¼€å¤´
å˜é‡å®šä¹‰ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>variable=value
</span></span><span style="display:flex;"><span>variable: value
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>http_port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>http_port: <span style="color:#ae81ff">80</span>
</span></span></code></pre></div><p>é€šè¿‡ {{ variable_name }} è°ƒç”¨å˜é‡ï¼Œä¸”å˜é‡åå‰åå»ºè®®åŠ ç©ºæ ¼ï¼Œæœ‰æ—¶ç”¨&quot;{{ variable_name }}&ldquo;æ‰ç”Ÿæ•ˆ
å˜é‡æ¥æºï¼š</p>
<ol>
<li>ansible çš„ setup facts è¿œç¨‹ä¸»æœºçš„æ‰€æœ‰å˜é‡éƒ½å¯ç›´æ¥è°ƒç”¨</li>
<li>é€šè¿‡å‘½ä»¤è¡ŒæŒ‡å®šå˜é‡ï¼Œä¼˜å…ˆçº§æœ€é«˜</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ansible-playbook -e varname<span style="color:#f92672">=</span>value test.yml
</span></span></code></pre></div><p>3.åœ¨playbookæ–‡ä»¶ä¸­å®šä¹‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>vars:
</span></span><span style="display:flex;"><span>var1: value1
</span></span><span style="display:flex;"><span>var2: value2
</span></span></code></pre></div><p>4.åœ¨ç‹¬ç«‹çš„å˜é‡YAMLæ–‡ä»¶ä¸­å®šä¹‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>- hosts: all
</span></span><span style="display:flex;"><span>vars_files:
</span></span><span style="display:flex;"><span>- vars.yml
</span></span></code></pre></div><p>åœ¨ä¸»æœºæ¸…å•æ–‡ä»¶ä¸­å®šä¹‰
ä¸»æœºï¼ˆæ™®é€šï¼‰å˜é‡ï¼šä¸»æœºç»„ä¸­ä¸»æœºå•ç‹¬å®šä¹‰ï¼Œä¼˜å…ˆçº§é«˜äºå…¬å…±å˜é‡
ç»„ï¼ˆå…¬å…±ï¼‰å˜é‡ï¼šé’ˆå¯¹ä¸»æœºç»„ä¸­æ‰€æœ‰ä¸»æœºå®šä¹‰ç»Ÿä¸€å˜é‡
åœ¨é¡¹ç›®ä¸­é’ˆå¯¹ä¸»æœºå’Œä¸»æœºç»„å®šä¹‰
åœ¨é¡¹ç›®ç›®å½•ä¸­åˆ›å»º host_varså’Œgroup_varsç›®å½•
åœ¨roleä¸­å®šä¹‰</p>
<p>å˜é‡çš„ä¼˜å…ˆçº§ä»é«˜åˆ°ä½å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-e é€‰é¡¹å®šä¹‰å˜é‡ --&gt;playbookä¸­vars_files --&gt; playbookä¸­varså˜é‡å®šä¹‰ --&gt;host_vars/ä¸»æœºåæ–‡ä»¶ --&gt;ä¸»æœºæ¸…å•ä¸­ä¸»æœºå˜é‡--&gt; group_vars/ä¸»æœºç»„åæ–‡ä»¶--&gt;group_vars/allæ–‡ä»¶--&gt; ä¸»æœºæ¸…å•ç»„å˜é‡
</span></span></code></pre></div><h3 id="ä½¿ç”¨-setup-æ¨¡å—ä¸­å˜é‡">ä½¿ç”¨ setup æ¨¡å—ä¸­å˜é‡<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨-setup-æ¨¡å—ä¸­å˜é‡">#</a></h3>
<h4 id="ä½¿ç”¨-facts-å˜é‡">ä½¿ç”¨ facts å˜é‡<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨-facts-å˜é‡">#</a></h4>
<p>æœ¬æ¨¡å—è‡ªåŠ¨åœ¨playbookè°ƒç”¨ï¼Œç”Ÿæˆçš„ç³»ç»ŸçŠ¶æ€ä¿¡æ¯, å¹¶å°†ä¹‹å­˜æ”¾åœ¨factså˜é‡ä¸­
facts åŒ…æ‹¬çš„ä¿¡æ¯å¾ˆå¤š,å¦‚: ä¸»æœºå,IP,CPU,å†…å­˜,ç½‘å¡ç­‰
facts å˜é‡çš„å®é™…ä½¿ç”¨åœºæ™¯æ¡ˆä¾‹</p>
<ul>
<li>é€šè¿‡factså˜é‡è·å–è¢«æ§ç«¯CPUçš„ä¸ªæ•°ä¿¡æ¯,ä»è€Œç”Ÿæˆä¸åŒçš„Nginxé…ç½®æ–‡ä»¶</li>
<li>é€šè¿‡factså˜é‡è·å–è¢«æ§ç«¯å†…å­˜å¤§å°ä¿¡æ¯,ä»è€Œç”Ÿæˆä¸åŒçš„memcachedçš„é…ç½®æ–‡ä»¶</li>
<li>é€šè¿‡factså˜é‡è·å–è¢«æ§ç«¯ä¸»æœºåç§°ä¿¡æ¯,ä»è€Œç”Ÿæˆä¸åŒçš„Zabbixé…ç½®æ–‡ä»¶</li>
<li>é€šè¿‡factså˜é‡è·å–è¢«æ§ç«¯ç½‘å¡ä¿¡æ¯,ä»è€Œç”Ÿæˆä¸åŒçš„ä¸»æœºå</li>
</ul>
<p>æ¡ˆä¾‹ï¼šä½¿ç”¨setupå˜é‡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e"># ansible localhost -m setup -a &#39;filter=&#34;ansible_default_ipv4&#34;&#39;</span>
</span></span><span style="display:flex;"><span>localhost | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;ansible_facts&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ansible_default_ipv4&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;address&#34;</span>: <span style="color:#e6db74">&#34;192.168.32.133&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;alias&#34;</span>: <span style="color:#e6db74">&#34;ens160&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;broadcast&#34;</span>: <span style="color:#e6db74">&#34;192.168.32.255&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;gateway&#34;</span>: <span style="color:#e6db74">&#34;192.168.32.2&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;interface&#34;</span>: <span style="color:#e6db74">&#34;ens160&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;macaddress&#34;</span>: <span style="color:#e6db74">&#34;00:0c:29:7c:80:cd&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;mtu&#34;</span>: 1500,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;netmask&#34;</span>: <span style="color:#e6db74">&#34;255.255.255.0&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;network&#34;</span>: <span style="color:#e6db74">&#34;192.168.32.0&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;prefix&#34;</span>: <span style="color:#e6db74">&#34;24&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;ether&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;changed&#34;</span>: false
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šæ˜¾ç¤ºens33çš„ç½‘å¡çš„IPåœ°å€</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>    - name: show ens33 ip
</span></span><span style="display:flex;"><span>      debug:
</span></span><span style="display:flex;"><span>        msg: IP address <span style="color:#f92672">{{</span> ansible_ens33.ipv4.address <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#msg: IP address {{ ansible_facts[&#34;ens33&#34;][&#34;ipv4&#34;][&#34;address&#34;] }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#msg: IP address {{ ansible_facts.ens33.ipv4.address }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#msg: IP address {{ ansible_default_ipv4.address }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#msg: IP address {{ ansible_ens33.ipv4.address }}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#msg: IP address {{ ansible_ens33.ipv4.address.split(&#39;.&#39;)[-1] }}  #å–IPä¸­çš„æœ€åä¸€ä¸ªæ•°å­—</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-playbook -v show_ip.yml </span>
</span></span><span style="display:flex;"><span>Using /etc/ansible/ansible.cfg as config file
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PLAY <span style="color:#f92672">[</span>centos7<span style="color:#f92672">]</span> *************************************************************************************************************************
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>Gathering Facts<span style="color:#f92672">]</span> *****************************************************************************************************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>192.168.32.179<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>192.168.32.178<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>show ens33 ip<span style="color:#f92672">]</span> *******************************************************************************************************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>192.168.32.178<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;IP address 192.168.32.178&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>192.168.32.179<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;IP address 192.168.32.179&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PLAY RECAP *****************************************************************************************************************************
</span></span><span style="display:flex;"><span>192.168.32.178             : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>    changed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>   
</span></span><span style="display:flex;"><span>192.168.32.179             : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>    changed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šä¿®æ”¹ä¸»æœºåç§°ä¸ºweb-IP</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: æ‰“å°factså˜é‡
</span></span><span style="display:flex;"><span>    debug: msg<span style="color:#f92672">={{</span> ansible_ens33.ipv4.address <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  - name: ä¿®æ”¹ä¸»æœºå
</span></span><span style="display:flex;"><span>    hostname: name<span style="color:#f92672">=</span>web-<span style="color:#f92672">{{</span> ansible_ens33.ipv4.address <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#- name: è·å–factså˜é‡æå–IPåœ°å€ï¼Œä»¥.ç»“å°¾çš„æœ€åä¸€åˆ—,ä¿®æ”¹ä¸»æœºåä¸ºweb-hostid</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#hostname: name=web-{{ ansible_ens33.ipv4.address.split(&#39;.&#39;)[-1] }}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-playbook change_hostname.yml </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PLAY <span style="color:#f92672">[</span>centos7<span style="color:#f92672">]</span> *************************************************************************************************************************
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>Gathering Facts<span style="color:#f92672">]</span> *****************************************************************************************************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>192.168.32.178<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>192.168.32.179<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>æ‰“å°factså˜é‡<span style="color:#f92672">]</span> *******************************************************************************************************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>192.168.32.178<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;192.168.32.178&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>192.168.32.179<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;192.168.32.179&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>ä¿®æ”¹ä¸»æœºå<span style="color:#f92672">]</span> **********************************************************************************************************************
</span></span><span style="display:flex;"><span>changed: <span style="color:#f92672">[</span>192.168.32.179<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>changed: <span style="color:#f92672">[</span>192.168.32.178<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PLAY RECAP *****************************************************************************************************************************
</span></span><span style="display:flex;"><span>192.168.32.178             : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>    changed<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>    unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>   
</span></span><span style="display:flex;"><span>192.168.32.179             : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>    changed<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>    unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span></code></pre></div><h4 id="æ€§èƒ½ä¼˜åŒ–">æ€§èƒ½ä¼˜åŒ–<a hidden class="anchor" aria-hidden="true" href="#æ€§èƒ½ä¼˜åŒ–">#</a></h4>
<p>æ¯æ¬¡æ‰§è¡Œplaybook,é»˜è®¤ä¼šæ”¶é›†æ¯ä¸ªä¸»æœºçš„æ‰€æœ‰factså˜é‡,å°†ä¼šå¯¼è‡´é€Ÿåº¦å¾ˆæ…¢,å¯ä»¥é‡‡ç”¨ä¸‹é¢æ–¹æ³•åŠ é€Ÿ
æ–¹æ³•1
å…³é—­factsé‡‡é›†åŠ é€Ÿæ‰§è¡Œ,æ­¤æ–¹æ³•å°†å¯¼è‡´æ— æ³•ä½¿ç”¨factså˜é‡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- hosts: all
</span></span><span style="display:flex;"><span>  gather_facts: no
</span></span></code></pre></div><p>æ–¹æ³•2
å½“ä½¿ç”¨ gather_facts: no å…³é—­ factsï¼Œç¡®å®èƒ½åŠ é€Ÿ Ansible æ‰§è¡Œï¼Œä½†æ˜¯æœ‰æ—¶å€™åˆéœ€è¦ä½¿ç”¨ facts ä¸­çš„å†…å®¹ï¼Œè¿˜å¸Œæœ›æ‰§è¡Œçš„é€Ÿåº¦å¿«ï¼Œè¿™æ—¶å€™å¯ä»¥è®¾ç½®facts çš„ç¼“å­˜,å°†factså˜é‡ä¿¡æ¯å­˜åœ¨redisæœåŠ¡å™¨ä¸­</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat /etc/ansible/ansible.cfg</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>defaults<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># smart è¡¨ç¤ºé»˜è®¤æ”¶é›† factsï¼Œä½† facts å·²æœ‰çš„æƒ…å†µä¸‹ä¸ä¼šæ”¶é›†ï¼Œå³ä½¿ç”¨ç¼“å­˜ facts</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># implicit è¡¨ç¤ºé»˜è®¤æ”¶é›† factsï¼Œè¦ç¦æ­¢æ”¶é›†ï¼Œå¿…é¡»ä½¿ç”¨ gather_facts: False</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># explicit åˆ™è¡¨ç¤ºé»˜è®¤ä¸æ”¶é›†ï¼Œè¦æ˜¾å¼æ”¶é›†ï¼Œå¿…é¡»ä½¿ç”¨gather_facts: True</span>
</span></span><span style="display:flex;"><span>gathering <span style="color:#f92672">=</span> smart <span style="color:#75715e">#åœ¨ä½¿ç”¨ facts ç¼“å­˜æ—¶è®¾ç½®ä¸ºsmart</span>
</span></span><span style="display:flex;"><span>fact_caching_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">86400</span> <span style="color:#75715e">#ç¼“å­˜æ—¶é•¿</span>
</span></span><span style="display:flex;"><span>fact_caching <span style="color:#f92672">=</span> redis <span style="color:#75715e">#ç¼“å­˜å­˜åœ¨redisä¸­</span>
</span></span><span style="display:flex;"><span>fact_caching_connection <span style="color:#f92672">=</span> 10.0.0.100:6379:0 <span style="color:#75715e">#0è¡¨ç¤ºredisçš„0å·æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è‹¥redisè®¾ç½®äº†å¯†ç </span>
</span></span><span style="display:flex;"><span>fact_caching_connection <span style="color:#f92672">=</span> 10.0.0.100:6379:0:password
</span></span></code></pre></div><h3 id="register-æ³¨å†Œå˜é‡">register æ³¨å†Œå˜é‡<a hidden class="anchor" aria-hidden="true" href="#register-æ³¨å†Œå˜é‡">#</a></h3>
<p>åœ¨playbookä¸­å¯ä»¥ä½¿ç”¨registerå°†æ•è·å‘½ä»¤çš„è¾“å‡ºä¿å­˜åœ¨ä¸´æ—¶å˜é‡ä¸­ï¼Œæ–¹ä¾¿åç»­è°ƒç”¨æ­¤å˜é‡,æ¯”å¦‚å¯ä»¥ä½¿ç”¨debugæ¨¡å—è¿›è¡Œæ˜¾ç¤ºè¾“å‡º
èŒƒä¾‹: åˆ©ç”¨debug æ¨¡å—è¾“å‡ºå˜é‡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>    - name: get variable
</span></span><span style="display:flex;"><span>      shell: hostname
</span></span><span style="display:flex;"><span>      register: name
</span></span><span style="display:flex;"><span>    - name: print variable
</span></span><span style="display:flex;"><span>      debug:
</span></span><span style="display:flex;"><span>        msg: <span style="color:#e6db74">&#34;{{ name }}&#34;</span> <span style="color:#75715e">#è¾“å‡ºregisteræ³¨å†Œçš„nameå˜é‡çš„å…¨éƒ¨ä¿¡æ¯,æ³¨æ„å˜é‡è¦åŠ &#34; &#34;å¼•èµ·æ¥</span>
</span></span><span style="display:flex;"><span>         <span style="color:#75715e">#msg: &#34;{{ name.cmd }}&#34; #æ˜¾ç¤ºå‘½ä»¤</span>
</span></span><span style="display:flex;"><span>         <span style="color:#75715e">#msg: &#34;{{ name.rc }}&#34; #æ˜¾ç¤ºå‘½ä»¤æˆåŠŸä¸å¦</span>
</span></span><span style="display:flex;"><span>   <span style="color:#75715e">#msg: &#34;{{ name.stdout }}&#34; #æ˜¾ç¤ºå‘½ä»¤çš„è¾“å‡ºç»“æœä¸ºå­—ç¬¦ä¸²å½¢å¼,æ‰€æœ‰ç»“æœéƒ½æ”¾åœ¨ä¸€è¡Œé‡Œæ˜¾ç¤º,é€‚åˆäºç»“æœæ˜¯å•è¡Œè¾“å‡º</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">#msg: &#34;{{ name.stdout_lines }}&#34; #æ˜¾ç¤ºå‘½ä»¤çš„è¾“å‡ºç»“æœä¸ºåˆ—è¡¨å½¢å¼,é€è¡Œæ ‡å‡†è¾“å‡º,é€‚ç”¨äºå¤šè¡Œæ˜¾ç¤º</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#msg: &#34;{{ name[&#39;stdout_lines&#39;] }}&#34; #æ˜¾ç¤ºå‘½ä»¤çš„æ‰§è¡Œç»“æœä¸ºåˆ—è¡¨å½¢å¼,å’Œæ•ˆæœä¸Šé¢ç›¸åŒ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#msg: &#34;{{ name.stdout_lines[0] }}&#34; #æ˜¾ç¤ºå‘½ä»¤çš„è¾“å‡ºç»“æœçš„åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¯´æ˜ ç¬¬ä¸€ä¸ª task ä¸­ï¼Œä½¿ç”¨äº† register æ³¨å†Œå˜é‡åä¸º name ï¼›å½“ shell æ¨¡å—æ‰§è¡Œå®Œæ¯•åï¼Œä¼šå°†æ•°æ®æ”¾åˆ°è¯¥å˜é‡ä¸­ã€‚ç¬¬äºŒç»™ task ä¸­ï¼Œä½¿ç”¨äº† debug æ¨¡å—ï¼Œå¹¶ä»å˜é‡nameä¸­è·å–æ•°æ®ã€‚</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-playbook -C register.yml </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PLAY <span style="color:#f92672">[</span>centos7<span style="color:#f92672">]</span> *************************************************************************************************************************
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>Gathering Facts<span style="color:#f92672">]</span> *****************************************************************************************************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>192.168.32.179<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>192.168.32.178<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>get variable<span style="color:#f92672">]</span> ********************************************************************************************************************
</span></span><span style="display:flex;"><span>skipping: <span style="color:#f92672">[</span>192.168.32.179<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>skipping: <span style="color:#f92672">[</span>192.168.32.178<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>print variable<span style="color:#f92672">]</span> ******************************************************************************************************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>192.168.32.178<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;changed&#34;</span>: false,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;hostname&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;delta&#34;</span>: null,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;end&#34;</span>: null,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;failed&#34;</span>: false,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;Command would have run if not in check mode&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;rc&#34;</span>: 0,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;skipped&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;start&#34;</span>: null,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;stderr&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;stderr_lines&#34;</span>: <span style="color:#f92672">[]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;stdout&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;stdout_lines&#34;</span>: <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>192.168.32.179<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;changed&#34;</span>: false,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;cmd&#34;</span>: <span style="color:#e6db74">&#34;hostname&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;delta&#34;</span>: null,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;end&#34;</span>: null,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;failed&#34;</span>: false,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;Command would have run if not in check mode&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;rc&#34;</span>: 0,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;skipped&#34;</span>: true,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;start&#34;</span>: null,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;stderr&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;stderr_lines&#34;</span>: <span style="color:#f92672">[]</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;stdout&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;stdout_lines&#34;</span>: <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PLAY RECAP *****************************************************************************************************************************
</span></span><span style="display:flex;"><span>192.168.32.178             : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>    changed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>    rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>   
</span></span><span style="display:flex;"><span>192.168.32.179             : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>    changed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>    rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span></code></pre></div><p>èŒƒä¾‹: å®‰è£…å¯åŠ¨æœåŠ¡å¹¶æ£€æŸ¥</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  vars:
</span></span><span style="display:flex;"><span>    package_name: nginx
</span></span><span style="display:flex;"><span>    service_name: nginx
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: install <span style="color:#f92672">{{</span> package_name <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    yum: name<span style="color:#f92672">={{</span> package_name <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  - name: start <span style="color:#f92672">{{</span> service_name <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    service: name<span style="color:#f92672">={{</span> service_name <span style="color:#f92672">}}</span> state<span style="color:#f92672">=</span>started enabled<span style="color:#f92672">=</span>yes
</span></span><span style="display:flex;"><span>  - name: check
</span></span><span style="display:flex;"><span>    shell: ps axu|grep <span style="color:#f92672">{{</span> service_name <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    register: check_service
</span></span><span style="display:flex;"><span>  - name: debug
</span></span><span style="display:flex;"><span>    debug:
</span></span><span style="display:flex;"><span>      msg: <span style="color:#e6db74">&#34;{{ check_service.stdout_lines }}&#34;</span>
</span></span></code></pre></div><p>èŒƒä¾‹: ä¿®æ”¹ä¸»æœºåå½¢å¼ä¸º web_&lt;éšæœºå­—ç¬¦&gt;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: genarate random
</span></span><span style="display:flex;"><span>    shell:
</span></span><span style="display:flex;"><span>      cmd: openssl rand -base64 <span style="color:#ae81ff">12</span> |tr -dc <span style="color:#e6db74">&#39;[:alnum:]&#39;</span>
</span></span><span style="display:flex;"><span>    register:
</span></span><span style="display:flex;"><span>      num
</span></span><span style="display:flex;"><span>  - name: show random
</span></span><span style="display:flex;"><span>    debug:
</span></span><span style="display:flex;"><span>      msg: <span style="color:#e6db74">&#34;{{ num }}&#34;</span>
</span></span><span style="display:flex;"><span>  - name: change hostname
</span></span><span style="display:flex;"><span>    hostname:
</span></span><span style="display:flex;"><span>      name: web-<span style="color:#f92672">{{</span> num.stdout <span style="color:#f92672">}}</span>
</span></span></code></pre></div><p>èŒƒä¾‹: ä¿®æ”¹ä¸»æœºåå½¢å¼ä¸º web_éšæœºæ•°</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: å®šä¹‰ä¸€ä¸ªéšæœºæ•°ï¼Œè®¾å®šä¸ºå˜é‡ï¼Œç„¶ååç»­è°ƒç”¨
</span></span><span style="display:flex;"><span>    shell: echo <span style="color:#66d9ef">$((</span>RANDOM%255<span style="color:#66d9ef">))</span>
</span></span><span style="display:flex;"><span>    register: web_number
</span></span><span style="display:flex;"><span>  - name: ä½¿ç”¨debugè¾“å‡ºå˜é‡ç»“æœ
</span></span><span style="display:flex;"><span>    debug: msg<span style="color:#f92672">={{</span> web_number <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  - name: ä½¿ç”¨hostnameæ¨¡å—å°†ä¸»æœºåä¿®æ”¹ä¸ºweb_éšæœºæ•°
</span></span><span style="display:flex;"><span>    hostname: name<span style="color:#f92672">=</span>web_<span style="color:#f92672">{{</span> web_number.stdout <span style="color:#f92672">}}</span>
</span></span></code></pre></div><p>èŒƒä¾‹: æ‰¹é‡ä¿®æ”¹ä¸»æœºåä¸ºéšæœºå­—ç¬¦</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  vars:
</span></span><span style="display:flex;"><span>    host: web
</span></span><span style="display:flex;"><span>    domain: wang.org
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: get variable
</span></span><span style="display:flex;"><span>    shell: echo $RANDOM | md5sum | cut -c 1-8
</span></span><span style="display:flex;"><span>    register: get_random
</span></span><span style="display:flex;"><span>  - name: print variable
</span></span><span style="display:flex;"><span>    debug:
</span></span><span style="display:flex;"><span>      msg: <span style="color:#e6db74">&#34;{{ get_random.stdout }}&#34;</span>
</span></span><span style="display:flex;"><span>  - name: set hostname
</span></span><span style="display:flex;"><span>    hostname: name<span style="color:#f92672">={{</span> host <span style="color:#f92672">}}</span>-<span style="color:#f92672">{{</span> get_random.stdout <span style="color:#f92672">}}</span>.<span style="color:#f92672">{{</span> domain <span style="color:#f92672">}}</span>
</span></span></code></pre></div><p>èŒƒä¾‹: æ‰¹é‡ä¿®æ”¹ä¸»æœºåä¸ºIPæœ€å1ä½æ•°å­—</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  vars:
</span></span><span style="display:flex;"><span>    host: web
</span></span><span style="display:flex;"><span>    domain: wang.org
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>    - name: get variable
</span></span><span style="display:flex;"><span>      shell: hostname -I | awk <span style="color:#e6db74">&#39;{print $1}&#39;</span>
</span></span><span style="display:flex;"><span>      register: get_ip
</span></span><span style="display:flex;"><span>    - name: print variable
</span></span><span style="display:flex;"><span>      debug:
</span></span><span style="display:flex;"><span>        msg: <span style="color:#e6db74">&#34;{{ get_ip.stdout.split(&#39;.&#39;)[3] }}&#34;</span>
</span></span><span style="display:flex;"><span>    - name: set hostname
</span></span><span style="display:flex;"><span>      hostname: name<span style="color:#f92672">={{</span> host <span style="color:#f92672">}}</span>-<span style="color:#f92672">{{</span> get_ip.stdout.split<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;.&#39;</span><span style="color:#f92672">)[</span>3<span style="color:#f92672">]</span> <span style="color:#f92672">}}</span>.<span style="color:#f92672">{{</span> domain <span style="color:#f92672">}}</span>
</span></span></code></pre></div><h3 id="åœ¨-playbook-å‘½ä»¤è¡Œä¸­å®šä¹‰å˜é‡">åœ¨ Playbook å‘½ä»¤è¡Œä¸­å®šä¹‰å˜é‡<a hidden class="anchor" aria-hidden="true" href="#åœ¨-playbook-å‘½ä»¤è¡Œä¸­å®šä¹‰å˜é‡">#</a></h3>
<p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: install nginx
</span></span><span style="display:flex;"><span>    yum: name<span style="color:#f92672">={{</span> pkname <span style="color:#f92672">}}</span> state<span style="color:#f92672">=</span>present
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook -e pkname=nginx var2.yml</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#ä¹Ÿå¯ä»¥å°†å¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#cat vars</span>
</span></span><span style="display:flex;"><span>pkname1: memcached
</span></span><span style="display:flex;"><span>pkname2: vsftpd
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#vim var2.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: install package <span style="color:#f92672">{{</span> pkname1 <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    yum: name<span style="color:#f92672">={{</span> pkname1 <span style="color:#f92672">}}</span> state<span style="color:#f92672">=</span>present
</span></span><span style="display:flex;"><span>  - name: install package <span style="color:#f92672">{{</span> pkname2 <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    yum: name<span style="color:#f92672">={{</span> pkname2 <span style="color:#f92672">}}</span> state<span style="color:#f92672">=</span>present
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook -e pkname1=memcached -e pkname2=httpd var2.yml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook -e &#39;@vars&#39; var2.yml</span>
</span></span></code></pre></div><h3 id="åœ¨playbookæ–‡ä»¶ä¸­å®šä¹‰å˜é‡">åœ¨playbookæ–‡ä»¶ä¸­å®šä¹‰å˜é‡<a hidden class="anchor" aria-hidden="true" href="#åœ¨playbookæ–‡ä»¶ä¸­å®šä¹‰å˜é‡">#</a></h3>
<p>æ­¤æ–¹å¼å®šä¹‰çš„æ˜¯ç§æœ‰å˜é‡,å³åªèƒ½åœ¨å½“å‰playbookä¸­ä½¿ç”¨,ä¸èƒ½è¢«å…¶å®ƒPlaybookå…±ç”¨
èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- hosts: webservers
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  vars:
</span></span><span style="display:flex;"><span>    username: user1
</span></span><span style="display:flex;"><span>    groupname: group1
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: create group <span style="color:#f92672">{{</span> groupname <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    group: name<span style="color:#f92672">={{</span> groupname <span style="color:#f92672">}}</span> state<span style="color:#f92672">=</span>present
</span></span><span style="display:flex;"><span>  - name: create user <span style="color:#f92672">{{</span> username <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    user: name<span style="color:#f92672">={{</span> username <span style="color:#f92672">}}</span> group<span style="color:#f92672">={{</span> groupname <span style="color:#f92672">}}</span> state<span style="color:#f92672">=</span>present
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook -e &#34;username=user2 groupname=group2&#34; var3.yml</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šå˜é‡çš„ç›¸äº’è°ƒç”¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  vars:
</span></span><span style="display:flex;"><span>    collect_info: <span style="color:#e6db74">&#34;/data/test/{{ansible_default_ipv4[&#39;address&#39;]}}/&#34;</span>
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: create IP directory
</span></span><span style="display:flex;"><span>    file: name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{collect_info}}&#34;</span> state<span style="color:#f92672">=</span>directory
</span></span></code></pre></div><h3 id="ä½¿ç”¨ä¸“ç”¨çš„å…¬å…±çš„å˜é‡æ–‡ä»¶">ä½¿ç”¨ä¸“ç”¨çš„å…¬å…±çš„å˜é‡æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#ä½¿ç”¨ä¸“ç”¨çš„å…¬å…±çš„å˜é‡æ–‡ä»¶">#</a></h3>
<p>å¯ä»¥åœ¨ä¸€ä¸ªç‹¬ç«‹çš„playbookæ–‡ä»¶ä¸­å®šä¹‰å…¬å…±å˜é‡ï¼Œåœ¨å…¶å®ƒçš„playbookæ–‡ä»¶ä¸­å¯ä»¥å¼•ç”¨å˜é‡æ–‡ä»¶ä¸­çš„å˜é‡
æ­¤æ–¹å¼æ¯”playbookä¸­å®šä¹‰çš„å˜é‡ä¼˜åŒ–çº§é«˜</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>vim vars.yml
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># variables file</span>
</span></span><span style="display:flex;"><span>package_name: mariadb-server
</span></span><span style="display:flex;"><span>service_name: mariadb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>vim var5.yml
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">#install package and start service</span>
</span></span><span style="display:flex;"><span>- hosts: dbsrvs
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  vars_files:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># æŒ‡å®šå˜é‡æ–‡ä»¶å</span>
</span></span><span style="display:flex;"><span>    - vars.yml
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: install package
</span></span><span style="display:flex;"><span>    yum: name<span style="color:#f92672">={{</span> package_name <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>    tags: install
</span></span><span style="display:flex;"><span>  - name: start service
</span></span><span style="display:flex;"><span>    service: name<span style="color:#f92672">={{</span> service_name <span style="color:#f92672">}}</span> state<span style="color:#f92672">=</span>started enabled<span style="color:#f92672">=</span>yes
</span></span></code></pre></div><h3 id="åœ¨ä¸»æœºæ¸…å•ä¸­å®šä¹‰ä¸»æœºå’Œä¸»æœºç»„çš„å˜é‡">åœ¨ä¸»æœºæ¸…å•ä¸­å®šä¹‰ä¸»æœºå’Œä¸»æœºç»„çš„å˜é‡<a hidden class="anchor" aria-hidden="true" href="#åœ¨ä¸»æœºæ¸…å•ä¸­å®šä¹‰ä¸»æœºå’Œä¸»æœºç»„çš„å˜é‡">#</a></h3>
<h4 id="æ‰€æœ‰é¡¹ç›®çš„ä¸»æœºå˜é‡">æ‰€æœ‰é¡¹ç›®çš„ä¸»æœºå˜é‡<a hidden class="anchor" aria-hidden="true" href="#æ‰€æœ‰é¡¹ç›®çš„ä¸»æœºå˜é‡">#</a></h4>
<p>åœ¨inventory ä¸»æœºæ¸…å•æ–‡ä»¶ä¸­ä¸ºæŒ‡å®šçš„ä¸»æœºå®šä¹‰å˜é‡ä»¥ä¾¿äºåœ¨playbookä¸­ä½¿ç”¨
èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>webservers<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>www1.wang.org http_port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span> maxRequestsPerChild<span style="color:#f92672">=</span><span style="color:#ae81ff">808</span>
</span></span><span style="display:flex;"><span>www2.wang.org http_port<span style="color:#f92672">=</span><span style="color:#ae81ff">8080</span> maxRequestsPerChild<span style="color:#f92672">=</span><span style="color:#ae81ff">909</span>
</span></span></code></pre></div><h4 id="æ‰€æœ‰é¡¹ç›®çš„ç»„å…¬å…±å˜é‡">æ‰€æœ‰é¡¹ç›®çš„ç»„ï¼ˆå…¬å…±ï¼‰å˜é‡<a hidden class="anchor" aria-hidden="true" href="#æ‰€æœ‰é¡¹ç›®çš„ç»„å…¬å…±å˜é‡">#</a></h4>
<p>åœ¨inventory ä¸»æœºæ¸…å•æ–‡ä»¶ä¸­èµ‹äºˆç»™æŒ‡å®šç»„å†…æ‰€æœ‰ä¸»æœºä¸Šçš„åœ¨playbookä¸­å¯ç”¨çš„å˜é‡ï¼Œå¦‚æœå’Œä¸»æœºå˜æ˜¯åŒåï¼Œä¼˜å…ˆçº§ä½äºä¸»æœºå˜é‡</p>
<p>æ¡ˆä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>webservers:vars<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>http_port<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>ntp_server<span style="color:#f92672">=</span>ntp.wang.org
</span></span><span style="display:flex;"><span>nfs_server<span style="color:#f92672">=</span>nfs.wang.org
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>all:vars<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># --------- Main Variables ---------------</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Cluster container-runtime supported: docker, containerd</span>
</span></span><span style="display:flex;"><span>CONTAINER_RUNTIME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;docker&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Network plugins supported: calico, flannel, kube-router, cilium, kube-ovn</span>
</span></span><span style="display:flex;"><span>CLUSTER_NETWORK<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;calico&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Service proxy mode of kube-proxy: &#39;iptables&#39; or &#39;ipvs&#39;</span>
</span></span><span style="display:flex;"><span>PROXY_MODE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ipvs&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># K8S Service CIDR, not overlap with node(host) networking</span>
</span></span><span style="display:flex;"><span>SERVICE_CIDR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;192.168.0.0/16&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Cluster CIDR (Pod CIDR), not overlap with node(host) networking</span>
</span></span><span style="display:flex;"><span>CLUSTER_CIDR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;172.16.0.0/16&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># NodePort Range</span>
</span></span><span style="display:flex;"><span>NODE_PORT_RANGE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;20000-60000&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Cluster DNS Domain</span>
</span></span><span style="display:flex;"><span>CLUSTER_DNS_DOMAIN<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;magedu.local.&#34;</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#vim /etc/ansible/hosts</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>webservers<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>10.0.0.8 hname<span style="color:#f92672">=</span>www1 domain<span style="color:#f92672">=</span>magedu.io
</span></span><span style="display:flex;"><span>10.0.0.7 hname<span style="color:#f92672">=</span>www2
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>webservers:vars<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>mark<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>all:vars<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>domain<span style="color:#f92672">=</span>wang.org
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible webservers -m hostname -a &#39;name={{ hname }}{{ mark }}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{{</span> domain <span style="color:#f92672">}}</span><span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">#å‘½ä»¤è¡ŒæŒ‡å®šå˜é‡ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[root@ansible ~]#ansible webservers -e domain=magedu.cn -m hostname -a &#39;</span>name<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{{</span> hname <span style="color:#f92672">}}{{</span> mark <span style="color:#f92672">}}{{</span> domain <span style="color:#f92672">}}</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span></code></pre></div><h3 id="é’ˆå¯¹å½“å‰é¡¹ç›®çš„ä¸»æœºå’Œä¸»æœºç»„çš„å˜é‡">é’ˆå¯¹å½“å‰é¡¹ç›®çš„ä¸»æœºå’Œä¸»æœºç»„çš„å˜é‡<a hidden class="anchor" aria-hidden="true" href="#é’ˆå¯¹å½“å‰é¡¹ç›®çš„ä¸»æœºå’Œä¸»æœºç»„çš„å˜é‡">#</a></h3>
<p>ä¸Šé¢çš„æ–¹å¼æ˜¯é’ˆå¯¹æ‰€æœ‰é¡¹ç›®éƒ½æœ‰æ•ˆ,è€Œå®˜æ–¹æ›´å»ºè®®çš„æ–¹å¼æ˜¯ä½¿ç”¨ansibleç‰¹å®šé¡¹ç›®çš„ä¸»æœºå˜é‡å’Œç»„å˜é‡.ç”Ÿäº§å»ºè®®åœ¨æ¯ä¸ªé¡¹ç›®å¯¹åº”çš„ç›®å½•ä¸­åˆ›å»ºé¢å¤–çš„ä¸¤ä¸ªå˜é‡ç›®å½•,åˆ†åˆ«æ˜¯host_varså’Œgroup_vars</p>
<ul>
<li>host_varsä¸‹é¢çš„æ–‡ä»¶åå’Œä¸»æœºæ¸…å•ä¸»æœºåä¸€è‡´,é’ˆå¯¹å•ä¸ªä¸»æœºè¿›è¡Œå˜é‡å®šä¹‰æ ¼å¼:host_vars/hostname</li>
<li>group_varsä¸‹é¢çš„æ–‡ä»¶åå’Œä¸»æœºæ¸…å•ä¸­ç»„åä¸€è‡´, é’ˆå¯¹å•ä¸ªç»„è¿›è¡Œå˜é‡å®šä¹‰æ ¼å¼: group_vars/groupname</li>
<li>group_vars/allæ–‡ä»¶å†…å®šä¹‰çš„å˜é‡å¯¹æ‰€æœ‰ç»„éƒ½æœ‰æ•ˆ</li>
</ul>
<p>èŒƒä¾‹: ç‰¹å®šé¡¹ç›®çš„ä¸»æœºå’Œç»„å˜é‡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#pwd</span>
</span></span><span style="display:flex;"><span>/data/ansible
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#mkdir host_vars</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#mkdir group_vars</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#cat host_vars/10.0.0.8</span>
</span></span><span style="display:flex;"><span>id: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#cat host_vars/10.0.0.7</span>
</span></span><span style="display:flex;"><span>id: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#cat group_vars/webservers</span>
</span></span><span style="display:flex;"><span>name: web
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#cat group_vars/all</span>
</span></span><span style="display:flex;"><span>domain: wang.org
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#tree host_vars/ group_vars/</span>
</span></span><span style="display:flex;"><span>host_vars/
</span></span><span style="display:flex;"><span>â”œâ”€â”€ 10.0.0.7
</span></span><span style="display:flex;"><span>â””â”€â”€ 10.0.0.8
</span></span><span style="display:flex;"><span>group_vars/
</span></span><span style="display:flex;"><span>â”œâ”€â”€ all
</span></span><span style="display:flex;"><span>â””â”€â”€ webservers
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span> directories, <span style="color:#ae81ff">4</span> files
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#cat test.yml</span>
</span></span><span style="display:flex;"><span>- hosts: webservers
</span></span><span style="display:flex;"><span>tasks:
</span></span><span style="display:flex;"><span>- name: get variable
</span></span><span style="display:flex;"><span>command: echo <span style="color:#e6db74">&#34;{{name}}{{id}}.{{domain}}&#34;</span>
</span></span><span style="display:flex;"><span>register: result
</span></span><span style="display:flex;"><span>- name: print variable
</span></span><span style="display:flex;"><span>debug:
</span></span><span style="display:flex;"><span>msg: <span style="color:#e6db74">&#34;{{result.stdout}}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook test.yml</span>
</span></span><span style="display:flex;"><span>PLAY <span style="color:#f92672">[</span>webservers<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>***************************************
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>Gathering Facts<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>*******************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.7<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.8<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>get variable<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>**********************************
</span></span><span style="display:flex;"><span>changed: <span style="color:#f92672">[</span>10.0.0.7<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>changed: <span style="color:#f92672">[</span>10.0.0.8<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>print variable<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>********************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.7<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;web1.wang.org&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.8<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;web2.wang.org&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>PLAY RECAP
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>*******************************************
</span></span><span style="display:flex;"><span>10.0.0.7 : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> changed<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>10.0.0.8 : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> changed<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span></code></pre></div><h2 id="template-æ¨¡æ¿">Template æ¨¡æ¿<a hidden class="anchor" aria-hidden="true" href="#template-æ¨¡æ¿">#</a></h2>
<p>æ¨¡æ¿æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥ç”¨äºæ ¹æ®æ¯ä¸ªä¸»æœºçš„ä¸åŒç¯å¢ƒè€Œä¸ºç”Ÿæˆä¸åŒçš„æ–‡ä»¶
æ¨¡æ¿æ–‡ä»¶ä¸­æ”¯æŒåµŒå¥—jinja2è¯­è¨€çš„æŒ‡ä»¤,æ¥å®ç°å˜é‡,æ¡ä»¶åˆ¤æ–­,å¾ªç¯ç­‰åŠŸèƒ½
éœ€è¦ä½¿ç”¨templateæ¨¡å—å®ç°æ–‡ä»¶çš„å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœº,ä½†å’Œcopyæ¨¡å—ä¸åŒ,å¤åˆ¶è¿‡å»çš„æ–‡ä»¶æ¯ä¸ªä¸»æœºå¯ä»¥ä¼šæœ‰æ‰€ä¸åŒ</p>
<h3 id="jinja2è¯­è¨€">jinja2è¯­è¨€<a hidden class="anchor" aria-hidden="true" href="#jinja2è¯­è¨€">#</a></h3>
<p><img loading="lazy" src="/posts.images/image.assets/1677662324156.png" alt="1677662324156"  />
</p>
<p>Jinja2 æ˜¯ä¸€ä¸ªç°ä»£çš„ï¼Œè®¾è®¡è€…å‹å¥½çš„ï¼Œä»¿ç…§ Django æ¨¡æ¿çš„ Python æ¨¡æ¿è¯­è¨€ã€‚ å®ƒé€Ÿåº¦å¿«ï¼Œè¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¹¶ä¸”æä¾›äº†å¯é€‰çš„æ²™ç®±æ¨¡æ¿æ‰§è¡Œç¯å¢ƒä¿è¯å®‰å…¨:
ç‰¹æ€§:</p>
<ul>
<li>æ²™ç®±ä¸­æ‰§è¡Œ</li>
<li>å¼ºå¤§çš„ HTML è‡ªåŠ¨è½¬ä¹‰ç³»ç»Ÿä¿æŠ¤ç³»ç»Ÿå…å— XSS</li>
<li>æ¨¡æ¿ç»§æ‰¿</li>
<li>åŠæ—¶ç¼–è¯‘æœ€ä¼˜çš„ python ä»£ç </li>
<li>å¯é€‰æå‰ç¼–è¯‘æ¨¡æ¿çš„æ—¶é—´</li>
<li>æ˜“äºè°ƒè¯•ã€‚å¼‚å¸¸çš„è¡Œæ•°ç›´æ¥æŒ‡å‘æ¨¡æ¿ä¸­çš„å¯¹åº”è¡Œã€‚</li>
<li>å¯é…ç½®çš„è¯­æ³•</li>
</ul>
<p>å®˜æ–¹ç½‘ç«™ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http://jinja.pocoo.org/
</span></span><span style="display:flex;"><span>https://jinja.palletsprojects.com/en/2.11.x/
</span></span></code></pre></div><p>å®˜æ–¹ä¸­æ–‡æ–‡æ¡£</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>http://docs.jinkan.org/docs/jinja2/
</span></span><span style="display:flex;"><span>https://www.w3cschool.cn/yshfid/
</span></span></code></pre></div><p>jinja2 è¯­è¨€æ”¯æŒå¤šç§æ•°æ®ç±»å‹å’Œæ“ä½œ:
å­—é¢é‡ï¼Œå¦‚: å­—ç¬¦ä¸²ï¼šä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·,æ•°å­—ï¼šæ•´æ•°ï¼Œæµ®ç‚¹æ•°
åˆ—è¡¨ï¼š[item1, item2, &hellip;]
å…ƒç»„ï¼š(item1, item2, &hellip;)
å­—å…¸ï¼š{key1:value1, key2:value2, &hellip;}
å¸ƒå°”å‹ï¼štrue/false
ç®—æœ¯è¿ç®—ï¼š+, -, *, /, //, %, **
æ¯”è¾ƒæ“ä½œï¼š==, !=, &gt;, &gt;=, &lt;, &lt;=</p>
<p>é€»è¾‘è¿ç®—ï¼šandï¼Œorï¼Œnot
æµè¡¨è¾¾å¼ï¼šForï¼ŒIfï¼ŒWhen</p>
<p><strong>å­—é¢é‡ï¼š</strong>
è¡¨è¾¾å¼æœ€ç®€å•çš„å½¢å¼å°±æ˜¯å­—é¢é‡ã€‚å­—é¢é‡è¡¨ç¤ºè¯¸å¦‚å­—ç¬¦ä¸²å’Œæ•°å€¼çš„ Python å¯¹è±¡ã€‚å¦‚&quot;Hello World&rdquo;
åŒå¼•å·æˆ–å•å¼•å·ä¸­é—´çš„ä¸€åˆ‡éƒ½æ˜¯å­—ç¬¦ä¸²ã€‚æ— è®ºä½•æ—¶ä½ éœ€è¦åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚å‡½æ•°è°ƒç”¨ã€è¿‡æ»¤å™¨æˆ–åªæ˜¯åŒ…å«æˆ–ç»§æ‰¿ä¸€ä¸ªæ¨¡æ¿çš„å‚æ•°ï¼‰ï¼Œå¦‚42ï¼Œ42.23
æ•°å€¼å¯ä»¥ä¸ºæ•´æ•°å’Œæµ®ç‚¹æ•°ã€‚å¦‚æœæœ‰å°æ•°ç‚¹ï¼Œåˆ™ä¸ºæµ®ç‚¹æ•°ï¼Œå¦åˆ™ä¸ºæ•´æ•°ã€‚åœ¨ Python é‡Œï¼Œ 42 å’Œ 42.0 æ˜¯ä¸ä¸€æ ·çš„</p>
<p><strong>ç®—æœ¯è¿ç®—ï¼š</strong>
Jinja å…è®¸ç”¨è®¡ç®—å€¼ã€‚æ”¯æŒä¸‹é¢çš„è¿ç®—ç¬¦
+ï¼šæŠŠä¸¤ä¸ªå¯¹è±¡åŠ åˆ°ä¸€èµ·ã€‚é€šå¸¸å¯¹è±¡æ˜¯ç´ è´¨ï¼Œä½†æ˜¯å¦‚æœä¸¤è€…æ˜¯å­—ç¬¦ä¸²æˆ–åˆ—è¡¨ï¼Œä½ å¯ä»¥ç”¨è¿™ ç§æ–¹å¼æ¥è¡”æ¥
å®ƒä»¬ã€‚æ— è®ºå¦‚ä½•è¿™ä¸æ˜¯é¦–é€‰çš„è¿æ¥å­—ç¬¦ä¸²çš„æ–¹å¼ï¼è¿æ¥å­—ç¬¦ä¸²è§ ~ è¿ç®—ç¬¦ã€‚ {{ 1 + 1 }} ç­‰äº 2
-ï¼šç”¨ç¬¬ä¸€ä¸ªæ•°å‡å»ç¬¬äºŒä¸ªæ•°ã€‚ {{ 3 - 2 }} ç­‰äº 1
/ï¼šå¯¹ä¸¤ä¸ªæ•°åšé™¤æ³•ã€‚è¿”å›å€¼ä¼šæ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ã€‚ {{ 1 / 2 }} ç­‰äº 0.5
//ï¼šå¯¹ä¸¤ä¸ªæ•°åšé™¤æ³•ï¼Œè¿”å›æ•´æ•°å•†ã€‚ {{ 20 // 7 }} ç­‰äº 2
%ï¼šè®¡ç®—æ•´æ•°é™¤æ³•çš„ä½™æ•°ã€‚ {{ 11 % 7 }} ç­‰äº 4
<em>ï¼šç”¨å³è¾¹çš„æ•°ä¹˜å·¦è¾¹çš„æ“ä½œæ•°ã€‚ {{ 2</em>2 }} ä¼šè¿”å› 4 ã€‚ä¹Ÿå¯ä»¥ç”¨äºé‡ å¤ä¸€ä¸ªå­—ç¬¦ä¸²å¤šæ¬¡ã€‚ {{ &lsquo;=&rsquo; * 80 }}
ä¼šæ‰“å° 80 ä¸ªç­‰å·çš„æ¨ªæ¡<br>
<strong>ï¼šå–å·¦æ“ä½œæ•°çš„å³æ“ä½œæ•°æ¬¡å¹‚ã€‚ {{ 2</strong>3 }} ä¼šè¿”å› 8</p>
<p>æ¯”è¾ƒæ“ä½œç¬¦</p>
<p>== æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰
!= æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ä¸ç­‰</p>
<blockquote>
<p>å¦‚æœå·¦è¾¹å¤§äºå³è¾¹ï¼Œè¿”å› true
= å¦‚æœå·¦è¾¹å¤§äºç­‰äºå³è¾¹ï¼Œè¿”å› true
&lt; å¦‚æœå·¦è¾¹å°äºå³è¾¹ï¼Œè¿”å› true
&lt;= å¦‚æœå·¦è¾¹å°äºç­‰äºå³è¾¹ï¼Œè¿”å› true
é€»è¾‘è¿ç®—ç¬¦</p>
</blockquote>
<p>å¯¹äº if è¯­å¥ï¼Œåœ¨ for è¿‡æ»¤æˆ– if è¡¨è¾¾å¼ä¸­ï¼Œå®ƒå¯ä»¥ç”¨äºè”åˆå¤šä¸ªè¡¨è¾¾å¼
and å¦‚æœå·¦æ“ä½œæ•°å’Œå³æ“ä½œæ•°åŒä¸ºçœŸï¼Œè¿”å› true
or å¦‚æœå·¦æ“ä½œæ•°å’Œå³æ“ä½œæ•°æœ‰ä¸€ä¸ªä¸ºçœŸï¼Œè¿”å› true
not å¯¹ä¸€ä¸ªè¡¨è¾¾å¼å–å
(expr)è¡¨è¾¾å¼ç»„
true / false true æ°¸è¿œæ˜¯ true ï¼Œè€Œ false å§‹ç»ˆæ˜¯ false</p>
<h3 id="template">template<a hidden class="anchor" aria-hidden="true" href="#template">#</a></h3>
<p>templateåŠŸèƒ½ï¼šå¯ä»¥æ ¹æ®å’Œå‚è€ƒæ¨¡å—æ–‡ä»¶ï¼ŒåŠ¨æ€ç”Ÿæˆç›¸ç±»ä¼¼çš„é…ç½®æ–‡ä»¶
templateæ–‡ä»¶å­˜å»ºè®®æ”¾äºtemplatesç›®å½•ä¸‹ï¼Œä¸”å‘½åä¸º .j2 ç»“å°¾</p>
<p>yaml/yml æ–‡ä»¶å’Œtemplatesç›®å½•å¹³çº§ï¼Œæ­¤æ—¶playbookä¸­æŒ‡å®šæ¨¡ç‰ˆæ–‡ä»¶æ—¶å¯ä¸ç”¨æŒ‡å®šè·¯å¾„, ç›®å½•ç»“æ„å¦‚ä¸‹
ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./
</span></span><span style="display:flex;"><span>â”œâ”€â”€ temnginx.yml
</span></span><span style="display:flex;"><span>â””â”€â”€ templates
</span></span><span style="display:flex;"><span>   â””â”€â”€ nginx.conf.j2
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šåˆ©ç”¨template åŒæ­¥nginxé…ç½®æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#å‡†å¤‡templates/nginx.conf.j2æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#vim temnginx.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: template config to remote hosts
</span></span><span style="display:flex;"><span>    template: src<span style="color:#f92672">=</span>nginx.conf.j2 dest<span style="color:#f92672">=</span>/etc/nginx/nginx.conf
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook temnginx.yml</span>
</span></span></code></pre></div><p>templateå˜æ›´æ›¿æ¢
èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#ä¿®æ”¹æ–‡ä»¶nginx.conf.j2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#mkdir templates</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#vim templates/nginx.conf.j2</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>worker_processes <span style="color:#f92672">{{</span> ansible_processor_vcpus <span style="color:#f92672">}}</span>;
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#vim temnginx2.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: install nginx
</span></span><span style="display:flex;"><span>    yum: name<span style="color:#f92672">=</span>nginx
</span></span><span style="display:flex;"><span>  - name: template config to remote hosts
</span></span><span style="display:flex;"><span>    template: src<span style="color:#f92672">=</span>nginx.conf.j2 dest<span style="color:#f92672">=</span>/etc/nginx/nginx.conf
</span></span><span style="display:flex;"><span>  - name: start service
</span></span><span style="display:flex;"><span>    service: name<span style="color:#f92672">=</span>nginx state<span style="color:#f92672">=</span>started enabled<span style="color:#f92672">=</span>yes
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook temnginx2.yml</span>
</span></span></code></pre></div><h2 id="roles-è§’è‰²">Roles è§’è‰²<a hidden class="anchor" aria-hidden="true" href="#roles-è§’è‰²">#</a></h2>
<p>è§’è‰²æ˜¯ansibleè‡ª1.2ç‰ˆæœ¬å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œç”¨äºå±‚æ¬¡æ€§ã€ç»“æ„åŒ–åœ°ç»„ç»‡playbookã€‚rolesèƒ½å¤Ÿæ ¹æ®å±‚æ¬¡å‹ç»“æ„è‡ªåŠ¨è£…è½½å˜é‡æ–‡ä»¶ã€tasksä»¥åŠhandlersç­‰ã€‚è¦ä½¿ç”¨rolesåªéœ€è¦åœ¨playbookä¸­ä½¿ç”¨includeæŒ‡ä»¤å³å¯ã€‚ç®€å•æ¥è®²ï¼Œroleså°±æ˜¯é€šè¿‡åˆ†åˆ«å°†å˜é‡ã€æ–‡ä»¶ã€ä»»åŠ¡ã€æ¨¡æ¿åŠå¤„ç†å™¨æ”¾ç½®äºå•ç‹¬çš„ç›®å½•ä¸­ï¼Œå¹¶å¯ä»¥ä¾¿æ·åœ°includeå®ƒä»¬çš„ä¸€ç§æœºåˆ¶ã€‚è§’è‰²ä¸€èˆ¬ç”¨äºåŸºäºä¸»æœºæ„å»ºæœåŠ¡çš„åœºæ™¯ä¸­ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯ç”¨äºæ„å»ºå®ˆæŠ¤è¿›ç¨‹ç­‰åœºæ™¯ä¸­
è¿ç»´å¤æ‚çš„åœºæ™¯ï¼šå»ºè®®ä½¿ç”¨ rolesï¼Œä»£ç å¤ç”¨åº¦é«˜
rolesï¼šå¤šä¸ªè§’è‰²çš„é›†åˆç›®å½•ï¼Œ å¯ä»¥å°†å¤šä¸ªçš„roleï¼Œåˆ†åˆ«æ”¾è‡³rolesç›®å½•ä¸‹çš„ç‹¬ç«‹å­ç›®å½•ä¸­,å¦‚ä¸‹ç¤ºä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>roles/
</span></span><span style="display:flex;"><span>mysql/
</span></span><span style="display:flex;"><span>nginx/
</span></span><span style="display:flex;"><span>tomcat/
</span></span><span style="display:flex;"><span>redis/
</span></span></code></pre></div><p>é»˜è®¤roleså­˜æ”¾è·¯å¾„</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/root/.ansible/roles
</span></span><span style="display:flex;"><span>/usr/share/ansible/roles
</span></span><span style="display:flex;"><span>/etc/ansible/roles
</span></span></code></pre></div><p>å®˜æ–¹æ–‡æ¡£:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html
</span></span></code></pre></div><h3 id="ansible-rolesç›®å½•ç¼–æ’">Ansible Rolesç›®å½•ç¼–æ’<a hidden class="anchor" aria-hidden="true" href="#ansible-rolesç›®å½•ç¼–æ’">#</a></h3>
<p>rolesç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤º</p>
<p><img loading="lazy" src="/posts.images/image.assets/1677664119238.png" alt="1677664119238"  />
</p>
<p>æ¯ä¸ªè§’è‰²ï¼Œä»¥ç‰¹å®šçš„å±‚çº§ç›®å½•ç»“æ„è¿›è¡Œç»„ç»‡
rolesç›®å½•ç»“æ„ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>playbook1.yml
</span></span><span style="display:flex;"><span>playbook2.yml
</span></span><span style="display:flex;"><span>roles/
</span></span><span style="display:flex;"><span>project1/
</span></span><span style="display:flex;"><span>tasks/
</span></span><span style="display:flex;"><span>files/
</span></span><span style="display:flex;"><span>vars/
</span></span><span style="display:flex;"><span>templates/
</span></span><span style="display:flex;"><span>handlers/
</span></span><span style="display:flex;"><span>default/
</span></span><span style="display:flex;"><span>meta/
</span></span><span style="display:flex;"><span>project2/
</span></span><span style="display:flex;"><span>tasks/
</span></span><span style="display:flex;"><span>files/
</span></span><span style="display:flex;"><span>vars/
</span></span><span style="display:flex;"><span>templates/
</span></span><span style="display:flex;"><span>handlers/
</span></span><span style="display:flex;"><span>default/
</span></span><span style="display:flex;"><span>meta/
</span></span></code></pre></div><p>Roleså„ç›®å½•ä½œç”¨
roles/project/ :é¡¹ç›®åç§°,æœ‰ä»¥ä¸‹å­ç›®å½•</p>
<ul>
<li>files/ ï¼šå­˜æ”¾ç”±copyæˆ–scriptæ¨¡å—ç­‰è°ƒç”¨çš„æ–‡ä»¶</li>
<li>templates/ï¼štemplateæ¨¡å—æŸ¥æ‰¾æ‰€éœ€è¦æ¨¡æ¿æ–‡ä»¶çš„ç›®å½•</li>
<li>tasks/ï¼šå®šä¹‰task,roleçš„åŸºæœ¬å…ƒç´ ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼›å…¶å®ƒçš„æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«</li>
<li>handlers/ï¼šè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼›æ­¤ç›®å½•ä¸‹çš„å…¶å®ƒçš„æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«</li>
<li>vars/ï¼šå®šä¹‰å˜é‡ï¼Œè‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼›æ­¤ç›®å½•ä¸‹çš„å…¶å®ƒçš„å˜é‡æ–‡ä»¶éœ€è¦åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«,ä¹Ÿå¯ä»¥é€šè¿‡é¡¹ç›®ç›®å½•ä¸­çš„group_vars/allå®šä¹‰å˜é‡,ä»è€Œå®ç°è§’è‰²é€šç”¨ä»£ç å’Œé¡¹ç›®æ•°æ®çš„åˆ†ç¦»</li>
<li>meta/ï¼šå®šä¹‰å½“å‰è§’è‰²çš„ç‰¹æ®Šè®¾å®šåŠå…¶ä¾èµ–å…³ç³»,è‡³å°‘åº”è¯¥åŒ…å«ä¸€ä¸ªåä¸ºmain.ymlçš„æ–‡ä»¶ï¼Œå…¶å®ƒæ–‡ä»¶éœ€åœ¨æ­¤æ–‡ä»¶ä¸­é€šè¿‡includeè¿›è¡ŒåŒ…å«</li>
<li>default/ï¼šè®¾å®šé»˜è®¤å˜é‡æ—¶ä½¿ç”¨æ­¤ç›®å½•ä¸­çš„main.ymlæ–‡ä»¶ï¼Œæ¯”varsçš„ä¼˜å…ˆçº§ä½</li>
</ul>
<h3 id="åˆ›å»º-role">åˆ›å»º role<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»º-role">#</a></h3>
<p>åˆ›å»ºroleçš„æ­¥éª¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>1 åˆ›å»ºroleçš„ç›®å½•ç»“æ„.åœ¨ä»¥roleså‘½åçš„ç›®å½•ä¸‹åˆ†åˆ«åˆ›å»ºä»¥å„è§’è‰²åç§°å‘½åçš„ç›®å½•ï¼Œå¦‚mysqlç­‰,åœ¨æ¯ä¸ªè§’è‰²å‘½åçš„ç›®å½•ä¸­åˆ†åˆ«åˆ›å»ºç›¸å…³çš„ç›®å½•å’Œæ–‡ä»¶,æ¯”å¦‚tasksã€filesã€handlersã€templateså’Œvarsç­‰ç›®å½•ï¼›ç”¨ä¸åˆ°çš„ç›®å½•å¯ä»¥åˆ›å»ºä¸ºç©ºç›®å½•ï¼Œä¹Ÿå¯ä»¥ä¸åˆ›å»º
</span></span><span style="display:flex;"><span>2 ç¼–å†™å’Œå‡†å¤‡æŒ‡å®šroleçš„åŠŸèƒ½æ–‡ä»¶,åŒ…æ‹¬: tasks,templates,varsç­‰ç›¸å…³æ–‡ä»¶
</span></span><span style="display:flex;"><span>3 ç¼–å†™playbookæ–‡ä»¶è°ƒç”¨ä¸Šé¢å®šä¹‰çš„role,åº”ç”¨åˆ°æŒ‡å®šçš„ä¸»æœº
</span></span></code></pre></div><p>é’ˆå¯¹å¤§å‹é¡¹ç›®ä½¿ç”¨Rolesè¿›è¡Œç¼–æ’
èŒƒä¾‹: åˆ©ç”¨ ansible-galaxy åˆ›å»ºè§’è‰²ç›®å½•çš„ç»“æ„</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºåˆå§‹åŒ–ç›®å½•ç»“æ„</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible roles<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-galaxy role init test_role</span>
</span></span><span style="display:flex;"><span>- Role test_role was created successfully
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible roles<span style="color:#f92672">]</span><span style="color:#75715e">#tree test_role/</span>
</span></span><span style="display:flex;"><span>test_role/
</span></span><span style="display:flex;"><span>â”œâ”€â”€ defaults
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ files
</span></span><span style="display:flex;"><span>â”œâ”€â”€ handlers
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ meta
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ README.md
</span></span><span style="display:flex;"><span>â”œâ”€â”€ tasks
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ templates
</span></span><span style="display:flex;"><span>â”œâ”€â”€ tests
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ inventory
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ test.yml
</span></span><span style="display:flex;"><span>â””â”€â”€ vars
</span></span><span style="display:flex;"><span>â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8</span> directories, <span style="color:#ae81ff">8</span> files
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šrolesçš„ç›®å½•ç»“æ„</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nginx-role.yml
</span></span><span style="display:flex;"><span>roles/
</span></span><span style="display:flex;"><span>â””â”€â”€ nginx
</span></span><span style="display:flex;"><span>â”œâ”€â”€ files
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ nginx.conf
</span></span><span style="display:flex;"><span>â”œâ”€â”€ tasks
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ groupadd.yml
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ install.yml
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”‚ â”œâ”€â”€ restart.yml
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ useradd.yml
</span></span><span style="display:flex;"><span>â””â”€â”€ vars
</span></span><span style="display:flex;"><span>â””â”€â”€ main.yml
</span></span></code></pre></div><h3 id="playbook-è°ƒç”¨è§’è‰²">Playbook è°ƒç”¨è§’è‰²<a hidden class="anchor" aria-hidden="true" href="#playbook-è°ƒç”¨è§’è‰²">#</a></h3>
<p>è°ƒç”¨è§’è‰²æ–¹æ³•1ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: webservers
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  roles:
</span></span><span style="display:flex;"><span>    - mysql
</span></span><span style="display:flex;"><span>    - memcached
</span></span><span style="display:flex;"><span>    - nginx
</span></span></code></pre></div><p>è°ƒç”¨è§’è‰²æ–¹æ³•2ï¼š
é”®roleç”¨äºæŒ‡å®šè§’è‰²åç§°ï¼Œåç»­çš„k/vç”¨äºä¼ é€’å˜é‡ç»™è§’è‰²</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: all
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  roles:
</span></span><span style="display:flex;"><span>    - role: mysql
</span></span><span style="display:flex;"><span>    username: mysql
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">{</span> role: nginx, username: nginx <span style="color:#f92672">}</span>
</span></span></code></pre></div><p>è°ƒç”¨è§’è‰²æ–¹æ³•3ï¼š
è¿˜å¯åŸºäºæ¡ä»¶æµ‹è¯•å®ç°è§’è‰²è°ƒç”¨</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: all
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  roles:
</span></span><span style="display:flex;"><span>   - <span style="color:#f92672">{</span> role: nginx, username: nginx, when: ansible_distribution_major_version <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;7&#39;</span> <span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="roles-ä¸­-tags-ä½¿ç”¨">Roles ä¸­ Tags ä½¿ç”¨<a hidden class="anchor" aria-hidden="true" href="#roles-ä¸­-tags-ä½¿ç”¨">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#vi app-role.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å¯ä»¥æœ‰å¤šä¸ªplay</span>
</span></span><span style="display:flex;"><span>- hosts: lbserver
</span></span><span style="display:flex;"><span>  roles:
</span></span><span style="display:flex;"><span>    - role: haproxy
</span></span><span style="display:flex;"><span>    - role: keepalived
</span></span><span style="display:flex;"><span>    - hosts: appsrvs
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  roles:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">{</span> role: nginx ,tags: <span style="color:#f92672">[</span> <span style="color:#e6db74">&#39;nginx&#39;</span>, <span style="color:#e6db74">&#39;web&#39;</span> <span style="color:#f92672">]</span> ,when:
</span></span><span style="display:flex;"><span>    ansible_distribution_major_version <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;6&#34;</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">{</span> role: httpd ,tags: <span style="color:#f92672">[</span> <span style="color:#e6db74">&#39;httpd&#39;</span>, <span style="color:#e6db74">&#39;web&#39;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">{</span> role: mysql ,tags: <span style="color:#f92672">[</span> <span style="color:#e6db74">&#39;mysql&#39;</span>, <span style="color:#e6db74">&#39;db&#39;</span> <span style="color:#f92672">]</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    - role: mariadb
</span></span><span style="display:flex;"><span>      tags:
</span></span><span style="display:flex;"><span>      - mariadb
</span></span><span style="display:flex;"><span>      - db
</span></span><span style="display:flex;"><span>  tags: app <span style="color:#75715e">#playçš„tag</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook --tags=&#34;nginx,mysql&#34; app-role.yml</span>
</span></span></code></pre></div><h3 id="å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹<a hidden class="anchor" aria-hidden="true" href="#å®æˆ˜æ¡ˆä¾‹">#</a></h3>
<h4 id="å®ç°httpdè§’è‰²">å®ç°httpdè§’è‰²<a hidden class="anchor" aria-hidden="true" href="#å®ç°httpdè§’è‰²">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºroleç›®å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-galaxy role init httpd</span>
</span></span><span style="display:flex;"><span>- Role htppd was created successfully
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># tree httpd/</span>
</span></span><span style="display:flex;"><span>httpd/
</span></span><span style="display:flex;"><span>â”œâ”€â”€ defaults
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ files
</span></span><span style="display:flex;"><span>â”œâ”€â”€ handlers
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ meta
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ README.md
</span></span><span style="display:flex;"><span>â”œâ”€â”€ tasks
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ templates
</span></span><span style="display:flex;"><span>â”œâ”€â”€ tests
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ inventory
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ test.yml
</span></span><span style="display:flex;"><span>â””â”€â”€ vars
</span></span><span style="display:flex;"><span>    â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8</span> directories, <span style="color:#ae81ff">8</span> files
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#main.yml æ˜¯taskçš„å…¥å£æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible tasks<span style="color:#f92672">]</span><span style="color:#75715e"># cat main.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tasks file for httpd</span>
</span></span><span style="display:flex;"><span>- include: group.yml
</span></span><span style="display:flex;"><span>- include: user.yml
</span></span><span style="display:flex;"><span>- include: install_httpd.yml
</span></span><span style="display:flex;"><span>- include: config.yml
</span></span><span style="display:flex;"><span>- inclusde: index.yml
</span></span><span style="display:flex;"><span>- include: service.yml
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible tasks<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºç”¨æˆ·ç»„</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible httpd<span style="color:#f92672">]</span><span style="color:#75715e"># cat tasks/group.yml </span>
</span></span><span style="display:flex;"><span>- name: add group 
</span></span><span style="display:flex;"><span>  group: name<span style="color:#f92672">={{</span> httpd_group<span style="color:#f92672">}}</span> system<span style="color:#f92672">=</span>yes gid<span style="color:#f92672">={{</span> httpd_gid <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible htppd<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºç”¨æˆ·</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible httpd<span style="color:#f92672">]</span><span style="color:#75715e"># cat tasks/user.yml </span>
</span></span><span style="display:flex;"><span>- name: add httpd user
</span></span><span style="display:flex;"><span>  user: name<span style="color:#f92672">={{</span> httpd_user <span style="color:#f92672">}}</span> system<span style="color:#f92672">=</span>yes shel<span style="color:#f92672">=</span>/sbin/nologin home<span style="color:#f92672">=</span>/var/www uid<span style="color:#f92672">={{</span> httpd_uid <span style="color:#f92672">}}</span> group<span style="color:#f92672">={{</span> httpd_group <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible htppd<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># yum install httpd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible httpd<span style="color:#f92672">]</span><span style="color:#75715e"># cat tasks/install_httpd.yml </span>
</span></span><span style="display:flex;"><span>- name: install httpd
</span></span><span style="display:flex;"><span>  yum: name<span style="color:#f92672">=</span>httpd
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible httpd<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ‹·è´é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ³¨æ„: æ–‡ä»¶æ˜¯æ”¾åœ¨filesç›®å½•ä¸‹,ä½†srcçš„è·¯å¾„æ— éœ€å†™filesç›®å½•å</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible htppd<span style="color:#f92672">]</span><span style="color:#75715e"># cat tasks/config.yml</span>
</span></span><span style="display:flex;"><span>- name: httpd config
</span></span><span style="display:flex;"><span>  copy: src<span style="color:#f92672">=</span>httpd.conf dest<span style="color:#f92672">=</span>/etc/httpd/conf backup<span style="color:#f92672">=</span>yes
</span></span><span style="display:flex;"><span>  notify: restart httpd
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># å‡†å¤‡æµ‹è¯•æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible htppd<span style="color:#f92672">]</span><span style="color:#75715e"># cat tasks/index.yml </span>
</span></span><span style="display:flex;"><span>- name: copy index.html
</span></span><span style="display:flex;"><span>  copy: src<span style="color:#f92672">=</span>index.html dest<span style="color:#f92672">=</span>/var/www/html
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible htppd<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># start httpd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible htppd<span style="color:#f92672">]</span><span style="color:#75715e"># cat tasks/service.yml </span>
</span></span><span style="display:flex;"><span>- name: start httpd
</span></span><span style="display:flex;"><span>  service: name<span style="color:#f92672">=</span>httpd state<span style="color:#f92672">=</span>started enabled<span style="color:#f92672">=</span>yes
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible htppd<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®æ–‡ä»¶ä¿®æ”¹åˆ™é‡å¯httpd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible htppd<span style="color:#f92672">]</span><span style="color:#75715e"># cat handlers/main.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># handlers file for httpd</span>
</span></span><span style="display:flex;"><span>- name: restart httpd
</span></span><span style="display:flex;"><span>  service: name<span style="color:#f92672">=</span>httpd state<span style="color:#f92672">=</span>restarted
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible htppd<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åœ¨filesç›®å½•ä¸‹å‡†å¤‡ä¸¤ä¸ªæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ll httpd/files</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">11753</span> Mar  <span style="color:#ae81ff">1</span> 18:36 httpd.conf
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root    <span style="color:#ae81ff">23</span> Mar  <span style="color:#ae81ff">1</span> 21:10 index.html
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‡†å¤‡å˜é‡æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat httpd/vars/main.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># vars file for httpd</span>
</span></span><span style="display:flex;"><span>httpd_group: apache
</span></span><span style="display:flex;"><span>httpd_gid: <span style="color:#ae81ff">88</span>
</span></span><span style="display:flex;"><span>httpd_user: apache
</span></span><span style="display:flex;"><span>httpd_uid: <span style="color:#ae81ff">88</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åœ¨playbookä¸­è°ƒç”¨è§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat web_roles.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  roles:
</span></span><span style="display:flex;"><span>    - httpd
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¿è¡Œplaybook</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-playbook /data/web_roles.yml</span>
</span></span></code></pre></div><h4 id="å®ç°nginxè§’è‰²">å®ç°Nginxè§’è‰²<a hidden class="anchor" aria-hidden="true" href="#å®ç°nginxè§’è‰²">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºrolesç›®å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-galaxy init nginx</span>
</span></span><span style="display:flex;"><span>- Role nginx was created successfully
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ll</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span>-rw-r--r--  <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">614</span> Mar  <span style="color:#ae81ff">1</span> 21:07 ansible.cfg
</span></span><span style="display:flex;"><span>-rw-r--r--  <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1382</span> Mar  <span style="color:#ae81ff">1</span> 21:07 hosts
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">10</span> root root  <span style="color:#ae81ff">154</span> Mar  <span style="color:#ae81ff">1</span> 18:07 httpd
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">10</span> root root  <span style="color:#ae81ff">154</span> Mar  <span style="color:#ae81ff">1</span> 21:52 nginx
</span></span><span style="display:flex;"><span>-rw-r--r--  <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">63</span> Mar  <span style="color:#ae81ff">1</span> 21:14 web_roles.yml
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºtasksæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat nginx/tasks/main.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tasks file for nginx</span>
</span></span><span style="display:flex;"><span>- include: install_nginx.yml
</span></span><span style="display:flex;"><span>- import_playbook: config.yml
</span></span><span style="display:flex;"><span>- include: index.yml
</span></span><span style="display:flex;"><span>- import_playbook: service.yml
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…nginx</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat nginx/tasks/install_nginx.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: install nginx
</span></span><span style="display:flex;"><span>  yum:
</span></span><span style="display:flex;"><span>    name: nginx
</span></span><span style="display:flex;"><span>    state: present
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat nginx/tasks/config.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: copy config
</span></span><span style="display:flex;"><span>  template: src<span style="color:#f92672">=</span>nginx.conf.j2 dest<span style="color:#f92672">=</span>/etc/nginx/nginx.conf
</span></span><span style="display:flex;"><span>  notify: restart nginx
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºæµ‹è¯•æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat nginx/tasks/index.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: copt index.html
</span></span><span style="display:flex;"><span>  copy: src<span style="color:#f92672">=</span>index.html dest<span style="color:#f92672">=</span>/usr/share/nginx/html/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯åŠ¨nginx</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat nginx/tasks/service.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: start nginx
</span></span><span style="display:flex;"><span>  service: name<span style="color:#f92672">=</span>nginx state<span style="color:#f92672">=</span>started enabled<span style="color:#f92672">=</span>yes
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºhandleræ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat nginx/handlers/main.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># handlers file for nginx</span>
</span></span><span style="display:flex;"><span>- name: restart nginx
</span></span><span style="display:flex;"><span>  service: naem<span style="color:#f92672">=</span>nginx state<span style="color:#f92672">=</span>restarted
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ll</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºtemplateæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ll nginx/templates/</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">2336</span> Mar  <span style="color:#ae81ff">1</span> 22:12 nginx.conf.j2
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºæµ‹è¯•æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ll nginx/files/</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">23</span> Mar  <span style="color:#ae81ff">1</span> 22:14 index.html
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åœ¨playbookä¸­è°ƒç”¨è§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat web_roles.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  roles:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">#  - httpd</span>
</span></span><span style="display:flex;"><span>    - nginx
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¿è¡Œplaybook</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-playbook web_roles.yml </span>
</span></span></code></pre></div><h4 id="å®ç°mysql8è§’è‰²">å®ç°MySql8è§’è‰²<a hidden class="anchor" aria-hidden="true" href="#å®ç°mysql8è§’è‰²">#</a></h4>
<ul>
<li>åˆ›å»ºè§’è‰²ç›®å½•</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-galaxy init mysql8</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ll</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span>-rw-r--r--  <span style="color:#ae81ff">1</span> root root  <span style="color:#ae81ff">614</span> Mar  <span style="color:#ae81ff">1</span> 21:07 ansible.cfg
</span></span><span style="display:flex;"><span>-rw-r--r--  <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1382</span> Mar  <span style="color:#ae81ff">1</span> 21:07 hosts
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">10</span> root root  <span style="color:#ae81ff">154</span> Mar  <span style="color:#ae81ff">1</span> 18:07 httpd
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">10</span> root root  <span style="color:#ae81ff">154</span> Mar  <span style="color:#ae81ff">1</span> 22:55 mysql8
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">8</span> root root  <span style="color:#ae81ff">125</span> Mar  <span style="color:#ae81ff">1</span> 22:44 nginx
</span></span><span style="display:flex;"><span>-rw-r--r--  <span style="color:#ae81ff">1</span> root root   <span style="color:#ae81ff">75</span> Mar  <span style="color:#ae81ff">1</span> 22:38 web_roles.yml
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span></code></pre></div><ul>
<li>åˆ›å»ºtasks ymlæ–‡ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…åŒ…</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/tasks/install_package.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: install package
</span></span><span style="display:flex;"><span>  yum: name<span style="color:#f92672">={{</span> item <span style="color:#f92672">}}</span> state<span style="color:#f92672">=</span>latest
</span></span><span style="display:flex;"><span>  loop:
</span></span><span style="display:flex;"><span>    - libaio
</span></span><span style="display:flex;"><span>    - numactl-libs
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e"># add group</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/tasks/group.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: add group
</span></span><span style="display:flex;"><span>  group: name<span style="color:#f92672">={{</span> group <span style="color:#f92672">}}</span> gid<span style="color:#f92672">={{</span> group_gid <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># add user</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/tasks/user.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: add user
</span></span><span style="display:flex;"><span>  user: name<span style="color:#f92672">={{</span> user <span style="color:#f92672">}}</span> uid<span style="color:#f92672">={{</span> user_uid <span style="color:#f92672">}}</span> shell<span style="color:#f92672">=</span>/sbin/nologin group<span style="color:#f92672">={{</span> group <span style="color:#f92672">}}</span> create_home<span style="color:#f92672">=</span>no system<span style="color:#f92672">=</span>yes home<span style="color:#f92672">=</span>/data/mysql
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‡†å¤‡my.cnfæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/files/my.cnf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysqld<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>server-id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>log-bin
</span></span><span style="display:flex;"><span>datadir<span style="color:#f92672">=</span>/data/mysql
</span></span><span style="display:flex;"><span>socket<span style="color:#f92672">=</span>/data/mysql/mysql.sock
</span></span><span style="display:flex;"><span>log-error<span style="color:#f92672">=</span>/data/mysql/mysql.log
</span></span><span style="display:flex;"><span>pid-file<span style="color:#f92672">=</span>/data/mysql/mysql.pid
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>client<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>socket<span style="color:#f92672">=</span>/data/mysql/mysql.sock
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‡†å¤‡mysqläºŒè¿›åˆ¶åŒ…</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ll mysql8/files/</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">1176056</span>
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root        <span style="color:#ae81ff">181</span> Mar  <span style="color:#ae81ff">1</span> 23:10 my.cnf
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1204277208</span> Dec <span style="color:#ae81ff">18</span>  <span style="color:#ae81ff">2021</span> mysql-8.0.28-linux-glibc2.12-x86_64.tar.xz
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å°†mysqläºŒè¿›åˆ¶åŒ…è§£å‹åˆ°è¿œç¨‹ä¸»æœº</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/tasks/unarchive.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: copy mysql tar host
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># mysql_tar ä¸ºmysqläºŒè¿›åˆ¶çš„å‹ç¼©åŒ…åç§°</span>
</span></span><span style="display:flex;"><span>  unarchive: src<span style="color:#f92672">={{</span> mysql_tar <span style="color:#f92672">}}</span> dest<span style="color:#f92672">=</span>/usr/local/ owner<span style="color:#f92672">=</span>root group<span style="color:#f92672">=</span>root
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å°†è¿œç¨‹ä¸»æœºè§£å‹å‡ºçš„äºŒè¿›åˆ¶åŒ…åˆ›å»ºè½¯è¿æ¥</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/tasks/linkfile.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: create link
</span></span><span style="display:flex;"><span>  file: src<span style="color:#f92672">=</span>/usr/local/mysql-<span style="color:#f92672">{{</span> mysql_version <span style="color:#f92672">}}</span>-linux-glibc2.12-x86_64 dest<span style="color:#f92672">=</span>/usr/local/mysql state<span style="color:#f92672">=</span>link
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆå§‹åŒ–æ•°æ®åº“</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/tasks/init_mysql_data.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: create datadir dir
</span></span><span style="display:flex;"><span>  file: path<span style="color:#f92672">=</span>/data/mysql state<span style="color:#f92672">=</span>directory owner<span style="color:#f92672">={{</span> user <span style="color:#f92672">}}</span> group<span style="color:#f92672">={{</span> group <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>- name: init mysql data
</span></span><span style="display:flex;"><span>  shell: /usr/local/mysql/bin/mysqld --initialize-insecure --user<span style="color:#f92672">=</span>mysql --datadir<span style="color:#f92672">=</span>/data/mysql
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># copy config.con</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/tasks/config.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: copy my.cnf
</span></span><span style="display:flex;"><span>  copy: src<span style="color:#f92672">=</span>my.cnf dest<span style="color:#f92672">=</span>/etc/my.cnf
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/tasks/script.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: service script
</span></span><span style="display:flex;"><span>  shell: /bin/cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/tasks/path.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: path
</span></span><span style="display:flex;"><span>  copy: content<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;PATH=/usr/local/mysql/bin:$PATH&#39;</span> dest<span style="color:#f92672">=</span>/etc/profile.d/mysql.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/tasks/service.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- name: service
</span></span><span style="display:flex;"><span>  shell: chkconfig --add mysqld;/etc/init.d/mysqld start
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/tasks/main.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tasks file for mysql8</span>
</span></span><span style="display:flex;"><span>- include: install_package.yml
</span></span><span style="display:flex;"><span>- include: group.yml
</span></span><span style="display:flex;"><span>- include: user.yml
</span></span><span style="display:flex;"><span>- include: unarchive.yml
</span></span><span style="display:flex;"><span>- include: linkfile.yml
</span></span><span style="display:flex;"><span>- include: linkfile.yml
</span></span><span style="display:flex;"><span>- include: init_mysql_data.yml
</span></span><span style="display:flex;"><span>- include: config.yml
</span></span><span style="display:flex;"><span>- include: script.yml
</span></span><span style="display:flex;"><span>- include: path.yml
</span></span><span style="display:flex;"><span>- include: service.yml
</span></span><span style="display:flex;"><span>- include: secure.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºå˜é‡æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat mysql8/vars/main.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># vars file for mysql8</span>
</span></span><span style="display:flex;"><span>group: mysql
</span></span><span style="display:flex;"><span>group_gid: <span style="color:#ae81ff">306</span>
</span></span><span style="display:flex;"><span>user: mysql
</span></span><span style="display:flex;"><span>user_uid: <span style="color:#ae81ff">306</span>
</span></span><span style="display:flex;"><span>mysql_tar: mysql-8.0.28-linux-glibc2.12-x86_64.tar.xz
</span></span><span style="display:flex;"><span>mysql_version: 8.0.28
</span></span><span style="display:flex;"><span>mysql_root_password: <span style="color:#ae81ff">123456</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è°ƒç”¨è§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat web_roles.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  roles:
</span></span><span style="display:flex;"><span>    - mysql8
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿è¡Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-playbook web_roles.yml</span>
</span></span></code></pre></div><h4 id="å®ç°redisè§’è‰²">å®ç°Redisè§’è‰²<a hidden class="anchor" aria-hidden="true" href="#å®ç°redisè§’è‰²">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºè§’è‰²ç›®å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-galaxy init redis</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># tree redis/</span>
</span></span><span style="display:flex;"><span>redis/
</span></span><span style="display:flex;"><span>â”œâ”€â”€ defaults
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ files
</span></span><span style="display:flex;"><span>â”œâ”€â”€ handlers
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ meta
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ README.md
</span></span><span style="display:flex;"><span>â”œâ”€â”€ tasks
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>â”œâ”€â”€ templates
</span></span><span style="display:flex;"><span>â”œâ”€â”€ tests
</span></span><span style="display:flex;"><span>â”‚Â Â  â”œâ”€â”€ inventory
</span></span><span style="display:flex;"><span>â”‚Â Â  â””â”€â”€ test.yml
</span></span><span style="display:flex;"><span>â””â”€â”€ vars
</span></span><span style="display:flex;"><span>    â””â”€â”€ main.yml
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºtasksæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat redis/tasks/main.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tasks file for redis</span>
</span></span><span style="display:flex;"><span>- name: Installed Redis Server
</span></span><span style="display:flex;"><span>  yum:
</span></span><span style="display:flex;"><span>    name: redis
</span></span><span style="display:flex;"><span>    state: present
</span></span><span style="display:flex;"><span>- name: Configure Redis Server
</span></span><span style="display:flex;"><span>  template:
</span></span><span style="display:flex;"><span>    src: redis.conf.j2
</span></span><span style="display:flex;"><span>    dest: /etc/redis.conf
</span></span><span style="display:flex;"><span>    owner: redis
</span></span><span style="display:flex;"><span>    group: root
</span></span><span style="display:flex;"><span>    mode: <span style="color:#e6db74">&#39;0640&#39;</span>
</span></span><span style="display:flex;"><span>  notify: Restart Redis Server
</span></span><span style="display:flex;"><span>- name: Start Redis Server
</span></span><span style="display:flex;"><span>  systemd:
</span></span><span style="display:flex;"><span>    name: redis
</span></span><span style="display:flex;"><span>    state: started
</span></span><span style="display:flex;"><span>    enabled: yes
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºhandlersæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat redis/handlers/main.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e"># handlers file for redis</span>
</span></span><span style="display:flex;"><span>- name: Restart Redis Server
</span></span><span style="display:flex;"><span>  systemd:
</span></span><span style="display:flex;"><span>    name: redis
</span></span><span style="display:flex;"><span>    state: restarted
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åœ¨/data/redis/templatesç›®å½•ä¸‹å‡†å¤‡å¦‚ä¸‹æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ll redis/templates/</span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">48</span>
</span></span><span style="display:flex;"><span>-rw-r----- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">46729</span> Mar  <span style="color:#ae81ff">2</span> 02:51 redis.conf.j2
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è°ƒç”¨è§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è°ƒç”¨è§’è‰²</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># cat web_roles.yml </span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: centos7
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  roles:
</span></span><span style="display:flex;"><span>    - redis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¿è¡Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible data<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-playbook web_roles.yml</span>
</span></span></code></pre></div><h2 id="ansibleæ¨èå­¦ä¹ èµ„æ–™">Ansibleæ¨èå­¦ä¹ èµ„æ–™<a hidden class="anchor" aria-hidden="true" href="#ansibleæ¨èå­¦ä¹ èµ„æ–™">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>http://galaxy.ansible.com
</span></span><span style="display:flex;"><span>https://galaxy.ansible.com/explore#/
</span></span><span style="display:flex;"><span>http://github.com/
</span></span><span style="display:flex;"><span>http://ansible.com.cn/
</span></span><span style="display:flex;"><span>https://github.com/ansible/ansible
</span></span><span style="display:flex;"><span>https://github.com/ansible/ansible-examples
</span></span></code></pre></div>

        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://old.colorfulgz.com/posts/zabbix/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>Zabbix</span>
  </a>
  <a class="next" href="https://old.colorfulgz.com/posts/ansible/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(ä¸€)</span>
  </a>
</nav>

        </footer>
    </div>

<style>
    .comments_details summary::marker {
        font-size: 20px;
        content: 'ğŸ‘‰å±•å¼€è¯„è®º';
        color: var(--content);
    }
    .comments_details[open] summary::marker{
        font-size: 20px;
        content: 'ğŸ‘‡å…³é—­è¯„è®º';
        color: var(--content);
    }
</style>


<div>
    <details class="comments_details">
        <summary style="cursor: pointer; margin: 50px 0 20px 0;width: 130px;">
            <span style="font-size: 20px;color: var(--content);">...</span>
        </summary>
        <div id="tcomment"></div>
    </details>
    <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js">
    </script>
    <script>
        twikoo.init({
            envId:  null ,
        el: "#tcomment",
            lang: 'zh-CN',
            region:  null ,
        path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
        })
    </script>
</div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        -2024
        <a href="https://old.colorfulgz.com" style="color:#939393;">DevOpsHub</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;"></a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="" style="float:left;margin: 0px 5px 0px 0px;"/>
            
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"DevOpsHub"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"DevOpsHub"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'ğŸ“„å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'ğŸ‘ŒğŸ»å·²å¤åˆ¶!';
            setTimeout(() => {
                copybutton.innerText = 'ğŸ“„å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"DevOpsHub"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>
</body>

</html>
