<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Redisé›†ç¾¤å’Œé«˜å¯ç”¨ | DevOpsHub</title>
<meta name="keywords" content="Redis">
<meta name="description" content="Rediså•æœºæœåŠ¡å­˜åœ¨æ•°æ®å’ŒæœåŠ¡çš„å•ç‚¹é—®é¢˜,è€Œä¸”å•æœºæ€§èƒ½ä¹Ÿå­˜åœ¨ç€ä¸Šé™,å¯ä»¥åˆ©ç”¨Redisçš„é›†ç¾¤ç›¸å…³æŠ€æœ¯æ¥è§£å†³è¿™äº›é—®é¢˜">
<meta name="author" content="">
<link rel="canonical" href="https://colorfulgz.com/posts/redis%E9%9B%86%E7%BE%A4%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://colorfulgz.com/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://colorfulgz.com/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://colorfulgz.com/img/Q.gif">
<link rel="apple-touch-icon" href="https://colorfulgz.com/img/Q.gif">
<link rel="mask-icon" href="https://colorfulgz.com/img/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>


<link rel="stylesheet" href="./font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="./jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="Redisé›†ç¾¤å’Œé«˜å¯ç”¨" />
<meta property="og:description" content="Rediså•æœºæœåŠ¡å­˜åœ¨æ•°æ®å’ŒæœåŠ¡çš„å•ç‚¹é—®é¢˜,è€Œä¸”å•æœºæ€§èƒ½ä¹Ÿå­˜åœ¨ç€ä¸Šé™,å¯ä»¥åˆ©ç”¨Redisçš„é›†ç¾¤ç›¸å…³æŠ€æœ¯æ¥è§£å†³è¿™äº›é—®é¢˜" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://colorfulgz.com/posts/redis%E9%9B%86%E7%BE%A4%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8/" />
<meta property="og:image" content="https://colorfulgz.com/posts.images/banner/30.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-13T22:20:06+00:00" />
<meta property="article:modified_time" content="2022-12-13T22:20:06+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://colorfulgz.com/posts.images/banner/30.jpg" />
<meta name="twitter:title" content="Redisé›†ç¾¤å’Œé«˜å¯ç”¨"/>
<meta name="twitter:description" content="Rediså•æœºæœåŠ¡å­˜åœ¨æ•°æ®å’ŒæœåŠ¡çš„å•ç‚¹é—®é¢˜,è€Œä¸”å•æœºæ€§èƒ½ä¹Ÿå­˜åœ¨ç€ä¸Šé™,å¯ä»¥åˆ©ç”¨Redisçš„é›†ç¾¤ç›¸å…³æŠ€æœ¯æ¥è§£å†³è¿™äº›é—®é¢˜"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "ğŸ“šæ–‡ç« ",
          "item": "https://colorfulgz.com/posts/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Redisé›†ç¾¤å’Œé«˜å¯ç”¨",
      "item": "https://colorfulgz.com/posts/redis%E9%9B%86%E7%BE%A4%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Redisé›†ç¾¤å’Œé«˜å¯ç”¨",
  "name": "Redisé›†ç¾¤å’Œé«˜å¯ç”¨",
  "description": "Rediså•æœºæœåŠ¡å­˜åœ¨æ•°æ®å’ŒæœåŠ¡çš„å•ç‚¹é—®é¢˜,è€Œä¸”å•æœºæ€§èƒ½ä¹Ÿå­˜åœ¨ç€ä¸Šé™,å¯ä»¥åˆ©ç”¨Redisçš„é›†ç¾¤ç›¸å…³æŠ€æœ¯æ¥è§£å†³è¿™äº›é—®é¢˜",
  "keywords": [
    "Redis"
  ],
  "articleBody": "ç®€ä»‹ Rediså•æœºæœåŠ¡å­˜åœ¨æ•°æ®å’ŒæœåŠ¡çš„å•ç‚¹é—®é¢˜,è€Œä¸”å•æœºæ€§èƒ½ä¹Ÿå­˜åœ¨ç€ä¸Šé™,å¯ä»¥åˆ©ç”¨Redisçš„é›†ç¾¤ç›¸å…³æŠ€æœ¯æ¥è§£å†³è¿™äº›é—®é¢˜.\nä¸»ä»å¤åˆ¶å®ç° ä¸»ä»å‘½ä»¤é…ç½® å½“é…ç½®Rediså¤åˆ¶åŠŸèƒ½æ—¶ï¼Œå¼ºçƒˆå»ºè®®æ‰“å¼€ä¸»æœåŠ¡å™¨çš„æŒä¹…åŒ–åŠŸèƒ½ã€‚å¦åˆ™çš„è¯ï¼Œç”±äºå»¶è¿Ÿç­‰é—®é¢˜ï¼Œéƒ¨ç½²çš„ä¸»èŠ‚ç‚¹RedisæœåŠ¡åº”è¯¥è¦é¿å…è‡ªåŠ¨å¯åŠ¨ã€‚\nå‚è€ƒæ¡ˆä¾‹: å¯¼è‡´ä¸»ä»æœåŠ¡å™¨æ•°æ®å…¨éƒ¨ä¸¢å¤±\n1.å‡è®¾èŠ‚ç‚¹Aä¸ºä¸»æœåŠ¡å™¨ï¼Œå¹¶ä¸”å…³é—­äº†æŒä¹…åŒ–ã€‚å¹¶ä¸”èŠ‚ç‚¹Bå’ŒèŠ‚ç‚¹Cä»èŠ‚ç‚¹Aå¤åˆ¶æ•°æ® 2.èŠ‚ç‚¹Aå´©æºƒï¼Œç„¶åç”±è‡ªåŠ¨æ‹‰èµ·æœåŠ¡é‡å¯äº†èŠ‚ç‚¹A.ç”±äºèŠ‚ç‚¹Açš„æŒä¹…åŒ–è¢«å…³é—­äº†ï¼Œæ‰€ä»¥é‡å¯ä¹‹åæ²¡æœ‰ä»»ä½•æ•°æ® 3.èŠ‚ç‚¹Bå’ŒèŠ‚ç‚¹Cå°†ä»èŠ‚ç‚¹Aå¤åˆ¶æ•°æ®ï¼Œä½†æ˜¯Açš„æ•°æ®æ˜¯ç©ºçš„ï¼Œäºæ˜¯å°±æŠŠè‡ªèº«ä¿å­˜çš„æ•°æ®å‰¯æœ¬åˆ é™¤ã€‚ åœ¨å…³é—­ä¸»æœåŠ¡å™¨ä¸Šçš„æŒä¹…åŒ–ï¼Œå¹¶åŒæ—¶å¼€å¯è‡ªåŠ¨æ‹‰èµ·è¿›ç¨‹çš„æƒ…å†µä¸‹ï¼Œå³ä¾¿ä½¿ç”¨Sentinelæ¥å®ç°Redisçš„é«˜å¯ç”¨æ€§ï¼Œä¹Ÿæ˜¯éå¸¸å±é™©çš„ã€‚å› ä¸ºä¸»æœåŠ¡å™¨å¯èƒ½æ‹‰èµ·å¾—éå¸¸å¿«ï¼Œä»¥è‡³äºSentinelåœ¨é…ç½®çš„å¿ƒè·³æ—¶é—´é—´éš”å†…æ²¡æœ‰æ£€æµ‹åˆ°ä¸»æœåŠ¡å™¨å·²è¢«é‡å¯ï¼Œç„¶åè¿˜æ˜¯ä¼šæ‰§è¡Œä¸Šé¢çš„æ•°æ®ä¸¢å¤±çš„æµç¨‹ã€‚æ— è®ºä½•æ—¶ï¼Œæ•°æ®å®‰å…¨éƒ½æ˜¯æå…¶é‡è¦çš„ï¼Œæ‰€ä»¥åº”è¯¥ç¦æ­¢ä¸»æœåŠ¡å™¨å…³é—­æŒä¹…åŒ–çš„åŒæ—¶è‡ªåŠ¨å¯åŠ¨ã€‚\nå¯ç”¨ä¸»ä»åŒæ­¥ Redis Server é»˜è®¤ä¸º masterèŠ‚ç‚¹ï¼Œå¦‚æœè¦é…ç½®ä¸ºä»èŠ‚ç‚¹,éœ€è¦æŒ‡å®šmasteræœåŠ¡å™¨çš„IP,ç«¯å£åŠè¿æ¥å¯†ç åœ¨ä»èŠ‚ç‚¹æ‰§è¡Œ REPLICAOF MASTER_IP PORT æŒ‡ä»¤å¯ä»¥å¯ç”¨ä¸»ä»åŒæ­¥å¤åˆ¶åŠŸèƒ½,æ—©æœŸç‰ˆæœ¬ä½¿ç”¨ SLAVEOFæŒ‡ä»¤\n127.0.0.1:6379\u003e REPLICAOF MASTER_IP PORT #æ–°ç‰ˆæ¨èä½¿ç”¨ 127.0.0.1:6379\u003e SLAVEOF MasterIP Port #æ—§ç‰ˆä½¿ç”¨ï¼Œå°†è¢«æ·˜æ±° 127.0.0.1:6379\u003e CONFIG SET masterauth åœ¨masterå®ç° 127.0.0.1:6379\u003e AUTH 123456 OK 127.0.0.1:6379\u003e INFO replication #æŸ¥çœ‹å½“å‰è§’è‰²é»˜è®¤ä¸ºmaster # Replication role:master connected_slaves:0 master_failover_state:no-failover master_replid:f945fd1714d8d3b78a149c8b2e0d57567ee6cb77 master_replid2:0000000000000000000000000000000000000000 master_repl_offset:1361 second_repl_offset:-1 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:1 repl_backlog_histlen:1361 127.0.0.1:6379\u003e åœ¨slaveå®ç° #åœ¨slaveä¸Šè®¾ç½®masterçš„IPå’Œç«¯å£ï¼Œ4.0ç‰ˆä¹‹å‰çš„æŒ‡ä»¤ä¸ºslaveof 127.0.0.1:6380\u003e REPLICAOF 127.0.0.1 6379 #ä»å¯ä½¿ç”¨SLAVEOF MasterIP Port OK 127.0.0.1:6380\u003e #åœ¨slaveä¸Šè®¾ç½®masterçš„å¯†ç  127.0.0.1:6379\u003e CONFIG SET masterauth 123456 # Replication #è§’è‰²å˜ä¸ºslave 127.0.0.1:6380\u003e INFO replication # Replication role:slave master_host:127.0.0.1 #æŒ‡å‘master master_port:6379 master_link_status:up master_last_io_seconds_ago:1 master_sync_in_progress:0 slave_read_repl_offset:1515 slave_repl_offset:1515 slave_priority:100 slave_read_only:1 replica_announced:1 connected_slaves:0 master_failover_state:no-failover master_replid:f945fd1714d8d3b78a149c8b2e0d57567ee6cb77 master_replid2:0000000000000000000000000000000000000000 master_repl_offset:1515 second_repl_offset:-1 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:1362 repl_backlog_histlen:154 127.0.0.1:6380\u003e åœ¨masterå®ç° # æ·»åŠ å€¼ 127.0.0.1:6379\u003e set class m48 OK 127.0.0.1:6379\u003e åœ¨slaveéªŒè¯æ˜¯å¦åŒæ­¥è¿‡æ¥ # åœ¨slaveæ‰§è¡Œ 127.0.0.1:6380\u003e get class \"m48\" 127.0.0.1:6380\u003e # å¯ä»¥çœ‹åˆ°å·²ç»åŒæ­¥æˆåŠŸ masterå®ç° #åœ¨masterä¸Šå¯ä»¥çœ‹åˆ°æ‰€æœ‰slaveä¿¡æ¯ 127.0.0.1:6379\u003e info replication # Replication role:master connected_slaves:1 slave0:ip=127.0.0.1,port=6380,state=online,offset=1907,lag=0 master_failover_state:no-failover master_replid:f945fd1714d8d3b78a149c8b2e0d57567ee6cb77 master_replid2:0000000000000000000000000000000000000000 master_repl_offset:1907 second_repl_offset:-1 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:1 repl_backlog_histlen:1907 127.0.0.1:6379\u003e åˆ é™¤ä¸»ä»åŒæ­¥ åœ¨slaveå®ç° # åœ¨ä»èŠ‚ç‚¹æ‰§è¡Œ REPLICAOF NO ONE æŒ‡ä»¤å¯ä»¥å–æ¶ˆä¸»ä»å¤åˆ¶ #å–æ¶ˆå¤åˆ¶,åœ¨slaveä¸Šæ‰§è¡ŒREPLICAOF NO ONE,ä¼šæ–­å¼€å’Œmasterçš„è¿æ¥ä¸å†ä¸»ä»å¤åˆ¶, ä½†ä¸ä¼šæ¸…é™¤slave ä¸Šå·²æœ‰çš„æ•°æ® 127.0.0.1:6380\u003e REPLICAOF no one éªŒè¯åŒæ­¥ æŸ¥çœ‹masteræ—¥å¿— [root@centos7-master ~]# tail -f /usr/local/src/redis/log/redis_6379.log 945:M 13 Dec 2022 22:27:17.550 * Synchronization with replica 127.0.0.1:6380 succeeded 945:M 13 Dec 2022 22:42:59.410 # Connection with replica 127.0.0.1:6380 lost. 945:M 13 Dec 2022 22:46:34.373 * Replica 127.0.0.1:6380 asks for synchronization 945:M 13 Dec 2022 22:46:34.373 * Partial resynchronization not accepted: Replication ID mismatch (Replica asked for '1200062e6b1065421dec8531ca2d96776029ab3d', my replication IDs are 'f945fd1714d8d3b78a149c8b2e0d57567ee6cb77' and '0000000000000000000000000000000000000000') 945:M 13 Dec 2022 22:46:34.373 * Starting BGSAVE for SYNC with target: disk 945:M 13 Dec 2022 22:46:34.374 * Background saving started by pid 1690 1690:C 13 Dec 2022 22:46:34.376 * DB saved on disk 1690:C 13 Dec 2022 22:46:34.377 * RDB: 2 MB of memory used by copy-on-write 945:M 13 Dec 2022 22:46:34.435 * Background saving terminated with success 945:M 13 Dec 2022 22:46:34.435 * Synchronization with replica 127.0.0.1:6380 succeeded æŸ¥çœ‹slaveæ—¥å¿— [root@centos7-master ~]# tail -f /usr/local/src/redis/log/redis_6380.log 946:S 13 Dec 2022 22:46:34.436 * MASTER \u003c-\u003e REPLICA sync: Finished with success 946:S 13 Dec 2022 22:46:34.437 * Background append only file rewriting started by pid 1691 946:S 13 Dec 2022 22:46:34.470 * AOF rewrite child asks to stop sending diffs. 1691:C 13 Dec 2022 22:46:34.470 * Parent agreed to stop sending diffs. Finalizing AOF... 1691:C 13 Dec 2022 22:46:34.470 * Concatenating 0.00 MB of AOF diff received from parent. 1691:C 13 Dec 2022 22:46:34.470 * SYNC append only file rewrite performed 1691:C 13 Dec 2022 22:46:34.471 * AOF rewrite: 2 MB of memory used by copy-on-write 946:S 13 Dec 2022 22:46:34.536 * Background AOF rewrite terminated with success 946:S 13 Dec 2022 22:46:34.536 * Residual parent diff successfully flushed to the rewritten AOF (0.00 MB) 946:S 13 Dec 2022 22:46:34.536 * Background AOF rewrite finished successfully ä¿®æ”¹slaveé…ç½®æ–‡ä»¶ [root@centos7-master ~]# vim /usr/local/src/redis/etc/redis6380.conf # replicaof replicaof 127.0.0.1 6379 #æŒ‡å®šmasterçš„IPå’Œç«¯å£å·ï¼Œæˆ‘è¿™é‡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šå®‰è£…äº†å¤šå®ä¾‹ # masterauth masterauth 123456 #å¦‚æœå¯†ç éœ€è¦è®¾ç½® systemctl restart redis #åœ¨masterä¸ŠæŸ¥çœ‹çŠ¶æ€ 127.0.0.1:6379\u003e info replication # Replication role:master connected_slaves:2 slave0:ip=127.0.0.1,port=6380,state=online,offset=3307,lag=1 slave1:ip=127.0.0.1,port=6381,state=online,offset=3307,lag=1 master_failover_state:no-failover master_replid:f945fd1714d8d3b78a149c8b2e0d57567ee6cb77 master_replid2:0000000000000000000000000000000000000000 master_repl_offset:3307 second_repl_offset:-1 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:1 repl_backlog_histlen:3307 127.0.0.1:6379\u003e #åœæ­¢masterçš„redisæœåŠ¡ï¼šsystemctl stop redis,åœ¨slaveä¸Šå¯ä»¥è§‚å¯Ÿåˆ°ä»¥ä¸‹ç°è±¡ 127.0.0.1:6381\u003e info replication # Replication role:slave master_host:192.168.1.104 master_port:6379 master_link_status:down #æ˜¾ç¤ºdownï¼Œè¡¨ç¤ºæ— æ³•è¿æ¥master master_last_io_seconds_ago:-1 master_sync_in_progress:0 slave_read_repl_offset:84 slave_repl_offset:84 master_link_down_since_seconds:14 slave_priority:100 slave_read_only:1 replica_announced:1 connected_slaves:0 master_failover_state:no-failover master_replid:f6eefc841166e73282b4bab58527081653ddb0d1 master_replid2:0000000000000000000000000000000000000000 master_repl_offset:84 second_repl_offset:-1 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:15 repl_backlog_histlen:70 127.0.0.1:6381\u003e slave åªè¯»çŠ¶æ€ éªŒè¯SlaveèŠ‚ç‚¹ä¸ºåªè¯»çŠ¶æ€, ä¸æ”¯æŒå†™å…¥ 127.0.0.1:6381\u003e set ll aa (error) READONLY You can't write against a read only replica. 127.0.0.1:6381\u003e Rediså®ç°å“¨å…µæ¶æ„ ä»¥ä¸‹æ¡ˆä¾‹å®ç°ä¸€ä¸»ä¸¤ä»çš„åŸºäºå“¨å…µçš„é«˜å¯ç”¨Redisæ¶æ„\nå…ˆå®ç°ä¸»ä»æ¶æ„ å“¨å…µçš„å‰ææ˜¯å·²ç»å®ç°äº†Redisçš„ä¸»ä»å¤åˆ¶ æ³¨æ„: master çš„é…ç½®æ–‡ä»¶ä¸­masterauth å’Œslave éƒ½å¿…é¡»ç›¸åŒ æ‰€æœ‰ä¸»ä»èŠ‚ç‚¹çš„ redis.conf ä¸­å…³å¥é…ç½® èŒƒä¾‹: å‡†å¤‡ä¸»ä»ç¯å¢ƒé…ç½®\n#åœ¨æ‰€æœ‰ä¸»ä»èŠ‚ç‚¹æ‰§è¡Œ vim redis.conf bind 0.0.0.0 masterauth \"123456\" requirepass \"123456\" #æˆ–è€…éäº¤äº’æ‰§è¡Œ [root@centos8 ~]#sed -i -e 's/bind 127.0.0.1/bind 0.0.0.0/' -e 's/^# masterauth .*/masterauth 123456/' -e 's/^# requirepass .*/requirepass 123456/' /etc/redis.conf #åœ¨æ‰€æœ‰ä»èŠ‚ç‚¹æ‰§è¡Œ [root@centos8 ~]#echo \"replicaof 192.168.32.133 6379\" \u003e\u003e /etc/redis.conf #åœ¨æ‰€æœ‰ä¸»ä»èŠ‚ç‚¹æ‰§è¡Œ [root@centos8 ~]#systemctl enable --now redis é…ç½®slave1 [root@redis-slave1 ~]#redis-cli -a 123456 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 127.0.0.1:6379\u003e REPLICAOF 192.168.32.133 6379 OK 127.0.0.1:6379\u003e CONFIG SET masterauth \"123456\" OK é…ç½®slave2 [root@redis-slave2 ~]#redis-cli -a 123456 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 127.0.0.1:6379\u003e REPLICAOF 192.168.32.133 6379 OK 127.0.0.1:6379\u003e CONFIG SET masterauth \"123456\" OK ç¼–è¾‘å“¨å…µé…ç½®\nsentinelé…ç½® Sentinelå®é™…ä¸Šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„redisæœåŠ¡å™¨,æœ‰äº›redisæŒ‡ä»¤æ”¯æŒ,ä½†å¾ˆå¤šæŒ‡ä»¤å¹¶ä¸æ”¯æŒ.é»˜è®¤ç›‘å¬åœ¨ 26379/tcpç«¯å£. å“¨å…µæœåŠ¡å¯ä»¥å’ŒRedisæœåŠ¡å™¨åˆ†å¼€éƒ¨ç½²åœ¨ä¸åŒä¸»æœºï¼Œä½†ä¸ºäº†èŠ‚çº¦æˆæœ¬ä¸€èˆ¬ä¼šéƒ¨ç½²åœ¨ä¸€èµ· æ‰€æœ‰redisèŠ‚ç‚¹ä½¿ç”¨ç›¸åŒçš„ä»¥ä¸‹ç¤ºä¾‹çš„é…ç½®æ–‡ä»¶ #å¦‚æœæ˜¯ç¼–è¯‘å®‰è£…ï¼Œåœ¨æºç ç›®å½•æœ‰sentinel.confï¼Œå¤åˆ¶åˆ°å®‰è£…ç›®å½•å³å¯ï¼Œ å¦‚:/usr/local/src/redis/etc/sentinel.conf [root@centos8 ~]#cp redis-6.2.5/sentinel.conf /usr/local/src/redis/etc/ [root@centos8 ~]#chown redis.redis /usr/local/src/redis/etc/sentinel.conf [root@centos8 ~]#vim /etc/redis-sentinel.conf bind 0.0.0.0 port 26379 daemonize yes pidfile \"redis-sentinel.pid\" logfile \"sentinel_26379.log\" dir \"/tmp\" #å·¥ä½œç›®å½• sentinel monitor mymaster 10.0.0.8 6379 2 #mymasteræ˜¯é›†ç¾¤çš„åç§°ï¼Œæ­¤è¡ŒæŒ‡å®šå½“å‰mymasteré›†ç¾¤ä¸­masteræœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ #2ä¸ºæ³•å®šäººæ•°é™åˆ¶(quorum)ï¼Œå³æœ‰å‡ ä¸ªsentinelè®¤ä¸ºmaster downäº†å°±è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œä¸€èˆ¬æ­¤å€¼æ˜¯æ‰€æœ‰ sentinelèŠ‚ç‚¹(ä¸€èˆ¬æ€»æ•°æ˜¯\u003e=3çš„ å¥‡æ•°,å¦‚:3,5,7ç­‰)çš„ä¸€åŠä»¥ä¸Šçš„æ•´æ•°å€¼ï¼Œæ¯”å¦‚ï¼Œæ€»æ•°æ˜¯3ï¼Œå³3/2=1.5ï¼Œ å–æ•´ä¸º2,æ˜¯masterçš„ODOWNå®¢è§‚ä¸‹çº¿çš„ä¾æ® sentinel auth-pass mymaster 123456 #mymasteré›†ç¾¤ä¸­masterçš„å¯†ç ï¼Œæ³¨æ„æ­¤è¡Œè¦åœ¨ä¸Šé¢è¡Œçš„ä¸‹é¢ sentinel down-after-milliseconds mymaster 30000 #åˆ¤æ–­mymasteré›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„ä¸»è§‚ä¸‹çº¿(SDOWN)çš„æ—¶é—´ï¼Œå•ä½ï¼šæ¯«ç§’ï¼Œå»ºè®®3000 sentinel parallel-syncs mymaster 1 #å‘ç”Ÿæ•…éšœè½¬ç§»åï¼Œå¯ä»¥åŒæ—¶å‘æ–°masteråŒæ­¥æ•°æ®çš„slaveçš„æ•°é‡ï¼Œæ•°å­—è¶Šå°æ€»åŒæ­¥æ—¶é—´è¶Šé•¿ï¼Œä½†å¯ä»¥å‡è½»æ–° masterçš„è´Ÿè½½å‹åŠ› sentinel failover-timeout mymaster 180000 #æ‰€æœ‰slavesæŒ‡å‘æ–°çš„masteræ‰€éœ€çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ï¼šæ¯«ç§’ sentinel deny-scripts-reconfig yes #ç¦æ­¢ä¿®æ”¹è„šæœ¬ logfile /var/log/redis/sentinel.log ä¸‰ä¸ªå“¨å…µæœåŠ¡å™¨çš„é…ç½®éƒ½å¦‚ä¸‹ port 26379 daemonize no pidfile \"/var/run/redis-sentinel.pid\" logfile \"/var/log/redis/sentinel.log\" dir \"/tmp\" sentinel monitor mymaster 192.168.32.133 6379 2 #ä¿®æ”¹æ­¤è¡Œ sentinel auth-pass mymaster 123456 #å¢åŠ æ­¤è¡Œ sentinel down-after-milliseconds mymaster 3000 #ä¿®æ”¹æ­¤è¡Œ sentinel parallel-syncs mymaster 1 sentinel failover-timeout mymaster 180000 sentinel deny-scripts-reconfig yes #æ³¨æ„æ­¤è¡Œè‡ªåŠ¨ç”Ÿæˆå¿…é¡»å”¯ä¸€,ä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹ï¼Œå¦‚æœç›¸åŒåˆ™ä¿®æ”¹æ­¤å€¼éœ€é‡å¯rediså’ŒsentinelæœåŠ¡ sentinel myid 50547f34ed71fd48c197924969937e738a39975b ..... # Generated by CONFIG REWRITE protected-mode no supervised systemd sentinel leader-epoch mymaster 0 sentinel known-replica mymaster 10.0.0.28 6379 sentinel known-replica mymaster 10.0.0.18 6379 sentinel current-epoch 0 å¯åŠ¨å“¨å…µæœåŠ¡ å°†æ‰€æœ‰å“¨å…µæœåŠ¡å™¨éƒ½å¯åŠ¨èµ·æ¥ /usr/local/src/redis/bin/redis-sentinel /usr/local/src/redis/etc/sentinel.conf å°†æœåŠ¡å†™æˆserviceæ–‡ä»¶ vim /lib/systemd/system/redis-sentinel.service [Unit] Description=Redis Sentinel After=network.target [Service] ExecStart=/usr/local/src/redis/bin/redis-sentinel /usr/local/src/redis/etc/sentinel.conf --supervised systemd ExecStop=/bin/kill -s QUIT $MAINPID User=redis Group=redis RuntimeDirectory=redis RuntimeDirectoryMode=0755 [Install] WantedBy=multi-user.target #æ³¨æ„æ‰€æœ‰èŠ‚ç‚¹çš„ç›®å½•æƒé™,å¦åˆ™æ— æ³•å¯åŠ¨æœåŠ¡ [root@redis-master ~]#chown -R redis.redis /usr.local/src/redis/ éªŒè¯å“¨å…µæœåŠ¡ æŸ¥çœ‹å“¨å…µæœåŠ¡ç«¯å£çŠ¶æ€,ç«¯å£26379\n[root@centos8 log]# ss -ntl State Recv-Q Send-Q Local Address:Port Peer Address:Port Process LISTEN 0 511 0.0.0.0:26379 0.0.0.0:* LISTEN 0 511 0.0.0.0:6379 0.0.0.0:* LISTEN 0 128 0.0.0.0:22 0.0.0.0:* LISTEN 0 511 [::1]:6379 [::]:* LISTEN 0 128 [::]:22 [::]:* [root@centos8 log]# Sentinel è¿ç»´ æ‰‹åŠ¨è®©ä¸»èŠ‚ç‚¹ä¸‹çº¿\n127.0.0.1:26379\u003e sentinel failover èŒƒä¾‹ï¼šæ‰‹åŠ¨æ•…éšœè½¬ç§»\nvim redis.conf replica-priority 10 #æŒ‡å®šä¼˜å…ˆçº§,å€¼è¶Šå°sentinelä¼šä¼˜å…ˆå°†ä¹‹é€‰ä¸ºæ–°çš„master,é»˜ä¸ºå€¼ä¸º100 systemctl restart redis #æˆ–è€…åŠ¨æ€ä¿®æ”¹ [root@centos8 ~]#redis-cli -a 123456 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 127.0.0.1:6379\u003e CONFIG GET replica-priority 1) \"replica-priority\" 2) \"100\" 127.0.0.1:6379\u003e CONFIG SET replica-priority 99 OK 127.0.0.1:6379\u003e CONFIG GET replica-priority 1) \"replica-priority\" 2) \"99\" [root@centos8 ~]#redis-cli -p 26379 127.0.0.1:26379\u003e sentinel failover mymaster OK åº”ç”¨ç¨‹åºè¿æ¥ Sentinel Redis å®˜æ–¹æ”¯æŒå¤šç§å¼€å‘è¯­è¨€çš„å®¢æˆ·ç«¯ï¼š\nhttps://redis.io/clients å®¢æˆ·ç«¯è¿æ¥ Sentinel å·¥ä½œåŸç† å®¢æˆ·ç«¯è·å– Sentinel èŠ‚ç‚¹é›†åˆ,é€‰ä¸¾å‡ºä¸€ä¸ª Sentinel 1.ç”±è¿™ä¸ªsentinel é€šè¿‡masterName è·å–masterèŠ‚ç‚¹ä¿¡æ¯,å®¢æˆ·ç«¯é€šè¿‡sentinel get-master-addr-by-name master-nameè¿™ä¸ªapiæ¥è·å–å¯¹åº”ä¸»èŠ‚ç‚¹ä¿¡æ¯\n2.å®¢æˆ·ç«¯å‘é€roleæŒ‡ä»¤ç¡®è®¤masterçš„ä¿¡æ¯,éªŒè¯å½“å‰è·å–çš„â€œä¸»èŠ‚ç‚¹â€æ˜¯çœŸæ­£çš„ä¸»èŠ‚ç‚¹ï¼Œè¿™æ ·çš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢æ•…éšœè½¬ç§»æœŸé—´ä¸»èŠ‚ç‚¹çš„å˜åŒ–\n3.å®¢æˆ·ç«¯ä¿æŒå’ŒSentinelèŠ‚ç‚¹é›†åˆçš„è”ç³»ï¼Œå³è®¢é˜…SentinelèŠ‚ç‚¹ç›¸å…³é¢‘é“ï¼Œæ—¶åˆ»è·å–å…³äºä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯,è·å–æ–°çš„master ä¿¡æ¯å˜åŒ–,å¹¶è‡ªåŠ¨è¿æ¥æ–°çš„master\njava è¿æ¥Sentinelå“¨å…µ java å®¢æˆ·ç«¯è¿æ¥Redisï¼š\nhttps://github.com/xetorthio/jedis/blob/master/pom.xml python è¿æ¥ Sentinel å“¨å…µ [root@centos8 ~]#yum -y install python3 python3-redis [root@centos8 ~]#vim sentinel_test.py #!/usr/bin/python3 import redis from redis.sentinel import Sentinel #è¿æ¥å“¨å…µæœåŠ¡å™¨(ä¸»æœºåä¹Ÿå¯ä»¥ç”¨åŸŸå) sentinel = Sentinel([('192.168.32.135', 26379), ('192.168.32.133', 26379), ('192.168.32.132', 26379)], socket_timeout=0.5) redis_auth_pass = '123456' #mymaster æ˜¯é…ç½®å“¨å…µæ¨¡å¼çš„redisé›†ç¾¤åç§°ï¼Œæ­¤ä¸ºé»˜è®¤å€¼,å®é™…åç§°æŒ‰ç…§ä¸ªäººéƒ¨ç½²æ¡ˆä¾‹æ¥å¡«å†™ #è·å–ä¸»æœåŠ¡å™¨åœ°å€ master = sentinel.discover_master('mymaster') print(\"master:\",master) #è·å–ä»æœåŠ¡å™¨åœ°å€ slave = sentinel.discover_slaves('mymaster') print(\"slave:\",slave) #è·å–ä¸»æœåŠ¡å™¨è¿›è¡Œå†™å…¥ master = sentinel.master_for('mymaster', socket_timeout=0.5, password=redis_auth_pass, db=0) w_ret = master.set('name', 'xy') #è¾“å‡ºï¼šTrue #è·å–ä»æœåŠ¡å™¨è¿›è¡Œè¯»å–ï¼ˆé»˜è®¤æ˜¯round-roubinï¼‰ slave = sentinel.slave_for('mymaster', socket_timeout=0.5, password=redis_auth_pass, db=0) r_ret = slave.get('name') print(r_ret) #è¾“å‡ºï¼šxy chmod +x sentinel_test.py ./sentinel_test.py master: ('192.168.32.135', 6379) slave: [('192.168.32.133', 6379)] b'xy' Redis Cluster Redis Cluster ä»‹ç» ä½¿ç”¨å“¨å…µsentinel åªèƒ½è§£å†³Redisé«˜å¯ç”¨é—®é¢˜ï¼Œå®ç°Redisçš„è‡ªåŠ¨æ•…éšœè½¬ç§»,ä½†ä»ç„¶æ— æ³•è§£å†³Redis Master å•èŠ‚ç‚¹çš„æ€§èƒ½ç“¶é¢ˆé—®é¢˜ ä¸ºäº†è§£å†³å•æœºæ€§èƒ½çš„ç“¶é¢ˆï¼Œæé«˜Redis æœåŠ¡æ•´ä½“æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é›†ç¾¤çš„è§£å†³æ–¹æ¡ˆ æ—©æœŸ Redis åˆ†å¸ƒå¼é›†ç¾¤éƒ¨ç½²æ–¹æ¡ˆï¼š\nå®¢æˆ·ç«¯åˆ†åŒºï¼šç”±å®¢æˆ·ç«¯ç¨‹åºè‡ªå·±å®ç°å†™å…¥åˆ†é…ã€é«˜å¯ç”¨ç®¡ç†å’Œæ•…éšœè½¬ç§»ç­‰,å¯¹å®¢æˆ·ç«¯çš„å¼€å‘å®ç°è¾ƒä¸ºå¤æ‚ ä»£ç†æœåŠ¡ï¼šå®¢æˆ·ç«¯ä¸ç›´æ¥è¿æ¥Redis,è€Œå…ˆè¿æ¥åˆ°ä»£ç†æœåŠ¡ï¼Œç”±ä»£ç†æœåŠ¡å®ç°ç›¸åº”è¯»å†™åˆ†é…ï¼Œå½“å‰ä»£ç†æœåŠ¡éƒ½æ˜¯ç¬¬ä¸‰æ–¹å®ç°.æ­¤æ–¹æ¡ˆä¸­å®¢æˆ·ç«¯å®ç°æ— éœ€ç‰¹æ®Šå¼€å‘,å®ç°å®¹æ˜“,ä½†æ˜¯ä»£ç†æœåŠ¡èŠ‚ç‚¹ä»å­˜æœ‰å•ç‚¹æ•…éšœå’Œæ€§èƒ½ç“¶é¢ˆé—®é¢˜ã€‚æ¯”å¦‚ï¼šè±Œè±†èšå¼€å‘çš„ codis Redis 3.0 ç‰ˆæœ¬ä¹‹åæ¨å‡ºæ— ä¸­å¿ƒæ¶æ„çš„ Redis Cluster ï¼Œæ”¯æŒå¤šä¸ªmasterèŠ‚ç‚¹å¹¶è¡Œå†™å…¥å’Œæ•…éšœçš„è‡ªåŠ¨è½¬ç§»åŠ¨èƒ½\nRedis cluster æ¶æ„ Redis cluster éœ€è¦è‡³å°‘ 3ä¸ªmasterèŠ‚ç‚¹æ‰èƒ½å®ç°,slaveèŠ‚ç‚¹æ•°é‡ä¸é™,å½“ç„¶ä¸€èˆ¬æ¯ä¸ªmasteréƒ½è‡³å°‘å¯¹åº”çš„æœ‰ä¸€ä¸ªslaveèŠ‚ç‚¹ å¦‚æœæœ‰ä¸‰ä¸ªä¸»èŠ‚ç‚¹é‡‡ç”¨å“ˆå¸Œæ§½ hash slot çš„æ–¹å¼æ¥åˆ†é…16384ä¸ªæ§½ä½ slot æ­¤ä¸‰ä¸ªèŠ‚ç‚¹åˆ†åˆ«æ‰¿æ‹…çš„slot åŒºé—´å¯ä»¥æ˜¯å¦‚ä»¥ä¸‹æ–¹å¼åˆ†é…\nèŠ‚ç‚¹M1 0ï¼5460 èŠ‚ç‚¹M2 5461ï¼10922 èŠ‚ç‚¹M3 10923ï¼16383 Redis clusterçš„å·¥ä½œåŸç† æ•°æ®åˆ†åŒº å¦‚æœæ˜¯å•æœºå­˜å‚¨çš„è¯ï¼Œç›´æ¥å°†æ•°æ®å­˜æ”¾åœ¨å•æœºrediså°±è¡Œäº†ã€‚ä½†æ˜¯å¦‚æœæ˜¯é›†ç¾¤å­˜å‚¨ï¼Œå°±éœ€è¦è€ƒè™‘åˆ°æ•°æ®åˆ†åŒºäº†ã€‚\né›†ç¾¤é€šä¿¡ ä½†æ˜¯å¯»æ‰¾æ§½çš„è¿‡ç¨‹å¹¶ä¸æ˜¯ä¸€æ¬¡å°±å‘½ä¸­çš„ï¼Œæ¯”å¦‚ä¸Šå›¾keyå°†è¦å­˜æ”¾åœ¨14396æ§½ä¸­ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ä¸€ä¸‹å°±é”å®šäº†node3èŠ‚ç‚¹ï¼Œå¯èƒ½å…ˆå»è¯¢é—®node1ï¼Œç„¶åæ‰è®¿é—®node3ã€‚ è€Œé›†ç¾¤ä¸­èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ï¼Œä¿è¯äº†æœ€å¤šä¸¤æ¬¡å°±èƒ½å‘½ä¸­å¯¹åº”æ§½æ‰€åœ¨çš„èŠ‚ç‚¹ã€‚å› ä¸ºåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ï¼Œéƒ½ä¿å­˜äº†å…¶ä»–èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒçŸ¥é“å“ªä¸ªæ§½ç”±å“ªä¸ªèŠ‚ç‚¹è´Ÿè´£ã€‚è¿™æ ·å³ä½¿ç¬¬ä¸€æ¬¡è®¿é—®æ²¡æœ‰å‘½ä¸­æ§½ï¼Œä½†æ˜¯ä¼šé€šçŸ¥å®¢æˆ·ç«¯ï¼Œè¯¥æ§½åœ¨å“ªä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·è®¿é—®å¯¹åº”èŠ‚ç‚¹å°±èƒ½ç²¾å‡†å‘½ä¸­ã€‚\né›†ç¾¤ä¼¸ç¼© é›†ç¾¤å¹¶ä¸æ˜¯å»ºç«‹ä¹‹åï¼ŒèŠ‚ç‚¹æ•°å°±å›ºå®šä¸å˜çš„ï¼Œä¹Ÿä¼šæœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æˆ–è€…é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¸‹çº¿ï¼Œè¿™å°±æ˜¯é›†ç¾¤çš„æ‰©å®¹å’Œç¼©å®¹ã€‚ä½†æ˜¯ç”±äºé›†ç¾¤èŠ‚ç‚¹å’Œæ§½æ¯æ¯ç›¸å…³ï¼Œæ‰€ä»¥é›†ç¾¤çš„ä¼¸ç¼©ä¹Ÿå¯¹åº”äº†æ§½å’Œæ•°æ®çš„è¿ç§»\né›†ç¾¤æ‰©å®¹ å½“æœ‰æ–°çš„èŠ‚ç‚¹å‡†å¤‡å¥½åŠ å…¥é›†ç¾¤æ—¶ï¼Œè¿™ä¸ªæ–°çš„èŠ‚ç‚¹è¿˜æ˜¯å­¤ç«‹èŠ‚ç‚¹ï¼ŒåŠ å…¥æœ‰ä¸¤ç§æ–¹å¼ã€‚ä¸€ä¸ªæ˜¯é€šè¿‡é›†ç¾¤èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤æ¥å’Œå­¤ç«‹èŠ‚ç‚¹æ¡æ‰‹ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯ä½¿ç”¨è„šæœ¬æ¥æ·»åŠ èŠ‚ç‚¹ã€‚\né›†ç¾¤ç¼©å®¹ æ•…éšœè½¬ç§» å½“ä»èŠ‚ç‚¹èµ°é©¬ä¸Šä»»å˜æˆä¸»èŠ‚ç‚¹ä¹‹åï¼Œå°±è¦å¼€å§‹è¿›è¡Œæ›¿æ¢ä¸»èŠ‚ç‚¹ï¼š\nè®©è¯¥slaveèŠ‚ç‚¹æ‰§è¡Œslaveof no oneå˜ä¸ºmasterèŠ‚ç‚¹ å°†æ•…éšœèŠ‚ç‚¹è´Ÿè´£çš„æ§½åˆ†é…ç»™è¯¥èŠ‚ç‚¹ å‘é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹å¹¿æ’­Pongæ¶ˆæ¯ï¼Œè¡¨æ˜å·²å®Œæˆæ•…éšœè½¬ç§» æ•…éšœèŠ‚ç‚¹é‡å¯åï¼Œä¼šæˆä¸ºnew_masterçš„slaveèŠ‚ç‚¹ å®æˆ˜æ¡ˆä¾‹ åŸºäºRedis 5 ä»¥ä¸Šç‰ˆæœ¬çš„ redis cluster éƒ¨ç½² å®˜æ–¹æ–‡æ¡£ï¼š\nhttps://redis.io/topics/cluster-tutorial åˆ›å»º redis clusteré›†ç¾¤çš„ç¯å¢ƒå‡†å¤‡ æ¯ä¸ªRedis èŠ‚ç‚¹é‡‡ç”¨ç›¸åŒçš„ç›¸åŒçš„Redisç‰ˆæœ¬ã€ç›¸åŒçš„å¯†ç ã€ç¡¬ä»¶é…ç½® æ‰€æœ‰RedisæœåŠ¡å™¨å¿…é¡»æ²¡æœ‰ä»»ä½•æ•°æ® å‡†å¤‡å…­å°ä¸»æœºï¼Œåœ°å€å¦‚ä¸‹ï¼š 192.168.32.132 192.168.32.137 192.168.32.140 192.168.32.129 192.168.32.136 192.168.32.138 å¯ç”¨ redis cluster é…ç½® æ¯ä¸ªèŠ‚ç‚¹å®‰è£…ç›¸åŒç‰ˆæ¯ä¸ªèŠ‚ç‚¹ä¿®æ”¹redisé…ç½®ï¼Œå¿…é¡»å¼€å¯clusteråŠŸèƒ½çš„å‚æ•°\nvim /etc/redis.conf bind 0.0.0.0 masterauth 123456 #å»ºè®®é…ç½®ï¼Œå¦åˆ™åæœŸçš„masterå’Œslaveä¸»ä»å¤åˆ¶æ— æ³•æˆåŠŸï¼Œè¿˜éœ€å†é…ç½® requirepass 123456 cluster-enabled yes #å–æ¶ˆæ­¤è¡Œæ³¨é‡Š,å¿…é¡»å¼€å¯é›†ç¾¤ï¼Œå¼€å¯å redis è¿›ç¨‹ä¼šæœ‰clusteræ ‡è¯† cluster-config-file nodes-6379.conf #å–æ¶ˆæ­¤è¡Œæ³¨é‡Š,æ­¤ä¸ºé›†ç¾¤çŠ¶æ€æ•°æ®æ–‡ä»¶,è®°å½•ä¸»ä»å…³ç³» åŠslotèŒƒå›´ä¿¡æ¯,ç”±redis cluster é›†ç¾¤è‡ªåŠ¨åˆ›å»ºå’Œç»´æŠ¤ cluster-require-full-coverage no #é»˜è®¤å€¼ä¸ºyes,è®¾ä¸ºnoå¯ä»¥é˜²æ­¢ä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨å¯¼è‡´æ•´ ä¸ªclusterä¸å¯ç”¨ ä»¥ä¸‹æ–¹å¼äºŒé€‰ä¸€\næ‰§è¡Œä¸‹é¢å‘½ä»¤,æ‰¹é‡ä¿®æ”¹ sed -i.bak -e 's/bind 127.0.0.1/bind 0.0.0.0/' -e '/masterauth/a masterauth 123456' -e '/# requirepass/a requirepass 123456' -e '/# cluster-enabled yes/a cluster-enabled yes' -e '/# cluster-config-file nodes-6379.conf/a cluster-config-file nodes-6379.conf' -e '/cluster-require-full-coverage yes/c cluster-require-full-coverage no' /etc/redis.conf å¦‚æœæ˜¯ç¼–è¯‘å®‰è£…å¯ä»¥æ‰§è¡Œä¸‹é¢æ“ä½œ sed -i.bak -e '/masterauth/a masterauth 123456' -e '/# cluster-enabled yes/a cluster-enabled yes' -e '/# cluster-config-file nodes-6379.conf/a cluster-config-file nodes-6379.conf' -e '/cluster-require-full-coverage yes/c cluster-require-full-coverage no' /usr/local/src/redis/etc/redis.conf å¼€æœºå¯åŠ¨redis\nsystemctl enable --now redis # ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶é‡å¯redis systemctl restart redis éªŒè¯å½“å‰RedisæœåŠ¡çŠ¶æ€ï¼š\n#å¼€å¯äº†16379çš„clusterçš„ç«¯å£,å®é™…çš„ç«¯å£=redis port + 10000 [root@centos7 ~]# ss -ntl State Recv-Q Send-Q Local Address:Port Peer Address:Port LISTEN 0 128 *:22 *:* LISTEN 0 100 127.0.0.1:25 *:* LISTEN 0 511 *:16379 *:* LISTEN 0 511 *:6379 *:* LISTEN 0 128 [::]:22 [::]:* LISTEN 0 100 [::1]:25 [::]:* LISTEN 0 511 [::1]:16379 [::]:* LISTEN 0 511 [::1]:6379 [::]:* [root@centos7 ~]# åˆ›å»ºé›†ç¾¤ #å‘½ä»¤redis-cliçš„é€‰é¡¹ --cluster-replicas 1 è¡¨ç¤ºæ¯ä¸ªmasterå¯¹åº”ä¸€ä¸ªslaveèŠ‚ç‚¹ # é»˜è®¤å‰ä¸‰ä¸ªä¸ºä¸»èŠ‚ç‚¹ [root@centos8 etc]# redis-cli -a 123456 --cluster create 192.168.32.132:6379 192.168.32.137:6379 192.168.32.140:6379 192.168.32.129:6379 192.168.32.136:6379 192.168.32.138:6379 --cluster-replicas 1 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. \u003e\u003e\u003e Performing hash slots allocation on 6 nodes... Master[0] -\u003e Slots 0 - 5460 Master[1] -\u003e Slots 5461 - 10922 Master[2] -\u003e Slots 10923 - 16383 Adding replica 192.168.32.136:6379 to 192.168.32.132:6379 Adding replica 192.168.32.138:6379 to 192.168.32.137:6379 Adding replica 192.168.32.129:6379 to 192.168.32.140:6379 M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379 slots:[0-5460] (5461 slots) master M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379 slots:[5461-10922] (5462 slots) master M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379 slots:[10923-16383] (5461 slots) master S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379 replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379 replicates 658dd91e4b51bf06b161e6903d4084c77abd195d S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379 replicates 46b54e8298e11e77450e232c9a0ee057b362191a Can I set the above configuration? (type 'yes' to accept): yes \u003e\u003e\u003e Nodes configuration updated \u003e\u003e\u003e Assign a different config epoch to each node \u003e\u003e\u003e Sending CLUSTER MEET messages to join the cluster Waiting for the cluster to join . \u003e\u003e\u003e Performing Cluster Check (using node 192.168.32.132:6379) M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379 slots:[0-5460] (5461 slots) master 1 additional replica(s) S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379 slots: (0 slots) slave replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379 slots:[10923-16383] (5461 slots) master 1 additional replica(s) M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379 slots: (0 slots) slave replicates 658dd91e4b51bf06b161e6903d4084c77abd195d S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379 slots: (0 slots) slave replicates 46b54e8298e11e77450e232c9a0ee057b362191a [OK] All nodes agree about slots configuration. \u003e\u003e\u003e Check for open slots... \u003e\u003e\u003e Check slots coverage... [OK] All 16384 slots covered. [root@centos8 ~]# éªŒè¯é›†ç¾¤ æŸ¥çœ‹ä¸»ä»çŠ¶æ€ 127.0.0.1:6379\u003e info replication # Replication role:master connected_slaves:1 slave0:ip=192.168.32.136,port=6379,state=online,offset=98,lag=1 master_failover_state:no-failover master_replid:b1bd51213722f38a83c8bb525e8a74e62392a161 master_replid2:0000000000000000000000000000000000000000 master_repl_offset:98 second_repl_offset:-1 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:1 repl_backlog_histlen:98 127.0.0.1:6379\u003e éªŒè¯é›†ç¾¤çŠ¶æ€\n127.0.0.1:6379\u003e CLUSTER INFO cluster_state:ok cluster_slots_assigned:16384 cluster_slots_ok:16384 cluster_slots_pfail:0 cluster_slots_fail:0 cluster_known_nodes:6 # èŠ‚ç‚¹æ•° cluster_size:3 # ä¸‰ä¸ªé›†ç¾¤ cluster_current_epoch:6 cluster_my_epoch:1 cluster_stats_messages_ping_sent:210 cluster_stats_messages_pong_sent:210 cluster_stats_messages_sent:420 cluster_stats_messages_ping_received:205 cluster_stats_messages_pong_received:210 cluster_stats_messages_meet_received:5 cluster_stats_messages_received:420 127.0.0.1:6379\u003e #æŸ¥çœ‹ä»»æ„èŠ‚ç‚¹çš„é›†ç¾¤çŠ¶æ€ [root@centos8 ~]# redis-cli -a 123456 --cluster info 192.168.32.137:6379 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 192.168.32.137:6379 (46b54e82...) -\u003e 0 keys | 5462 slots | 1 slaves. 192.168.32.140:6379 (f49ca2e5...) -\u003e 0 keys | 5461 slots | 1 slaves. 192.168.32.132:6379 (658dd91e...) -\u003e 0 keys | 5461 slots | 1 slaves. [OK] 0 keys in 3 masters. 0.00 keys per slot on average. [root@centos8 ~]# æŸ¥çœ‹å¯¹åº”å…³ç³» [root@centos8 ~]# redis-cli -a 123456 CLUSTER NODES Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379@16379 slave f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 0 1671364792207 3 connected 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379@16379 myself,master - 0 1671364792000 1 connected 0-5460 f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379@16379 master - 0 1671364792000 3 connected 10923-16383 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379@16379 master - 0 1671364793216 2 connected 5461-10922 f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379@16379 slave 658dd91e4b51bf06b161e6903d4084c77abd195d 0 1671364793000 1 connected eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379@16379 slave 46b54e8298e11e77450e232c9a0ee057b362191a 0 1671364792000 2 connected [root@centos8 ~]# æµ‹è¯•é›†ç¾¤å†™å…¥æ•°æ® redis cluster å†™å…¥key #ç»è¿‡ç®—æ³•è®¡ç®—ï¼Œå½“å‰keyçš„æ§½ä½éœ€è¦å†™å…¥æŒ‡å®šçš„node [root@centos8 ~]# redis-cli -a 123456 set k1 v1 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. (error) MOVED 12706 192.168.32.140:6379 #æ§½ä½ä¸åœ¨å½“å‰nodeæ‰€ä»¥æ— æ³•å†™å…¥ [root@centos8 ~]# #æŒ‡å®šæ§½ä½å¯¹åº”nodeå¯å†™å…¥ [root@centos8 ~]# redis-cli -h 192.168.32.140 -a 123456 set k1 v1 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. OK [root@centos8 ~]# #å¯¹åº”çš„slaveèŠ‚ç‚¹å¯ä»¥KEYS *,ä½†GET k1å¤±è´¥,å¯ä»¥åˆ°masterä¸Šæ‰§è¡ŒGET k1 [root@centos8 ~]# redis-cli -h 192.168.32.129 -a 123456 get k1 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. (error) MOVED 12706 192.168.32.140:6379 [root@centos8 ~]# redis-cli -h 192.168.32.129 -a 123456 keys \"*\" Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 1) \"k1\" [root@centos8 ~]# Redis cluster ç®¡ç† é›†ç¾¤æ‰©å®¹\næ‰©å®¹é€‚ç”¨åœºæ™¯ï¼š å½“å‰å®¢æˆ·é‡æ¿€å¢ï¼Œç°æœ‰çš„Redis clusteræ¶æ„å·²ç»æ— æ³•æ»¡è¶³è¶Šæ¥è¶Šé«˜çš„å¹¶å‘è®¿é—®è¯·æ±‚ï¼Œä¸ºè§£å†³æ­¤é—®é¢˜,æ–°è´­ç½®ä¸¤å°æœåŠ¡å™¨ï¼Œè¦æ±‚å°†å…¶åŠ¨æ€æ·»åŠ åˆ°ç°æœ‰é›†ç¾¤ï¼Œä½†ä¸èƒ½å½±å“ä¸šåŠ¡çš„æ­£å¸¸è®¿é—®ã€‚ æ³¨æ„: ç”Ÿäº§ç¯å¢ƒä¸€èˆ¬å»ºè®®masterèŠ‚ç‚¹ä¸ºå¥‡æ•°ä¸ª,æ¯”å¦‚:3,5,7,ä»¥é˜²æ­¢è„‘è£‚ç°è±¡\næ·»åŠ èŠ‚ç‚¹å‡†å¤‡ å¢åŠ Redis æ–°èŠ‚ç‚¹ï¼Œéœ€è¦ä¸ä¹‹å‰çš„Redis nodeç‰ˆæœ¬å’Œé…ç½®ä¸€è‡´ï¼Œç„¶ååˆ†åˆ«å†å¯åŠ¨ä¸¤å°Redis nodeï¼Œåº”ä¸ºä¸€ä¸»ä¸€ä»ã€‚\n192.168.32.133 ä¸» 192.168.32.139 ä» # ä¿®æ”¹é…ç½®æ–‡ä»¶,ä¸»ä»èŠ‚ç‚¹éƒ½ä¿®æ”¹ sed -i.bak -e '/masterauth/a masterauth 123456' -e '/# cluster-enabled yes/a cluster-enabled yes' -e '/# cluster-config-file nodes-6379.conf/a cluster-config-file nodes-6379.conf' -e '/cluster-require-full-coverage yes/c cluster-require-full-coverage no' /usr/local/src/redis/etc/redis.conf systemctl restart redis æ·»åŠ æ–°çš„masterèŠ‚ç‚¹åˆ°é›†ç¾¤\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ æ–°èŠ‚ç‚¹ï¼Œè¦æ·»åŠ çš„æ–°redisèŠ‚ç‚¹IPå’Œç«¯å£æ·»åŠ åˆ°çš„å·²æœ‰çš„é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹çš„IP:ç«¯å£ add-node new_host:new_port existing_host:existing_port [--slave --master-id ] #è¯´æ˜ï¼š new_host:new_port #æŒ‡å®šæ–°æ·»åŠ çš„ä¸»æœºçš„IPå’Œç«¯å£ existing_host:existing_port #æŒ‡å®šå·²æœ‰çš„é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹çš„IPå’Œç«¯å£ Redis 3/4 ç‰ˆæœ¬çš„æ·»åŠ å‘½ä»¤ï¼š #æŠŠæ–°çš„Redis èŠ‚ç‚¹192.168.32.133æ·»åŠ åˆ°å½“å‰Redisé›†ç¾¤å½“ä¸­ã€‚ [root@redis-node1 ~]#redis-trib.rb add-node 192.168.32.133:6379 192.168.32.132:6379 Redis 5 ä»¥ä¸Šç‰ˆæœ¬çš„æ·»åŠ å‘½ä»¤ï¼š #å°†ä¸€å°æ–°çš„ä¸»æœºåŠ å…¥é›†ç¾¤ [root@redis-node1 ~]#redis-cli -a 123456 --cluster add-node 192.168.32.133:6379 \u003cå½“å‰ ä»»æ„é›†ç¾¤èŠ‚ç‚¹\u003e:6379 [root@centos8 data]# redis-cli -a 123456 --cluster add-node 192.168.32.133:6379 192.168.32.132:6379 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. \u003e\u003e\u003e Adding node 192.168.32.133:6379 to cluster 192.168.32.132:6379 \u003e\u003e\u003e Performing Cluster Check (using node 192.168.32.132:6379) M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379 slots:[0-5460] (5461 slots) master 1 additional replica(s) S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379 slots: (0 slots) slave replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379 slots:[10923-16383] (5461 slots) master 1 additional replica(s) M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379 slots: (0 slots) slave replicates 658dd91e4b51bf06b161e6903d4084c77abd195d S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379 slots: (0 slots) slave replicates 46b54e8298e11e77450e232c9a0ee057b362191a [OK] All nodes agree about slots configuration. \u003e\u003e\u003e Check for open slots... \u003e\u003e\u003e Check slots coverage... [OK] All 16384 slots covered. \u003e\u003e\u003e Send CLUSTER MEET to node 192.168.32.133:6379 to make it join the cluster. [OK] New node added correctly. [root@centos8 data]# åœ¨æ–°çš„masterä¸Šé‡æ–°åˆ†é…æ§½ä½ æ–°çš„nodeèŠ‚ç‚¹åŠ åˆ°é›†ç¾¤ä¹‹å,é»˜è®¤æ˜¯masterèŠ‚ç‚¹ï¼Œä½†æ˜¯æ²¡æœ‰slotsï¼Œéœ€è¦é‡æ–°åˆ†é…,å¦åˆ™æ²¡æœ‰æ§½ä½å°†æ— æ³•è®¿é—® æ³¨æ„: é‡æ–°åˆ†é…æ§½ä½éœ€è¦æ¸…ç©ºæ•°æ®,æ‰€ä»¥éœ€è¦å…ˆå¤‡ä»½æ•°æ®,æ‰©å±•åå†æ¢å¤æ•°æ® Redis 3/4 ç‰ˆæœ¬å‘½ä»¤: [root@redis-node1 ~]# redis-trib.rb check 10.0.0.67:6379 #å½“å‰çŠ¶æ€ [root@redis-node1 ~]# redis-trib.rb reshard \u003cä»»æ„èŠ‚ç‚¹\u003e:6379 #é‡æ–°åˆ†ç‰‡ [root@redis-node1 ~]# redis-trib.rb fix 10.0.0.67:6379 #å¦‚æœè¿ç§»å¤±è´¥ä½¿ç”¨æ­¤å‘½ä»¤ä¿®å¤é›†ç¾¤ Redis 5ä»¥ä¸Šç‰ˆæœ¬å‘½ä»¤ï¼š [root@redis-node1 ~]#redis-cli -a 123456 --cluster reshard \u003cå½“å‰ä»»æ„é›†ç¾¤èŠ‚ç‚¹\u003e:6379 [root@centos8 data]# redis-cli -a 123456 --cluster reshard 192.168.32.133:6379 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. \u003e\u003e\u003e Performing Cluster Check (using node 192.168.32.133:6379) M: 77cfc3429c8b470331520074faea7c3a21f77d1f 192.168.32.133:6379 slots: (0 slots) master S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379 slots: (0 slots) slave replicates 46b54e8298e11e77450e232c9a0ee057b362191a M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379 slots:[0-5460] (5461 slots) master 1 additional replica(s) M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379 slots:[5461-10922] (5462 slots) master 1 additional replica(s) S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379 slots: (0 slots) slave replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379 slots: (0 slots) slave replicates 658dd91e4b51bf06b161e6903d4084c77abd195d M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379 slots:[10923-16383] (5461 slots) master 1 additional replica(s) [OK] All nodes agree about slots configuration. \u003e\u003e\u003e Check for open slots... \u003e\u003e\u003e Check slots coverage... [OK] All 16384 slots covered. How many slots do you want to move (from 1 to 16384)? 4096 # å¤åˆ¶æ–°åŠ å…¥çš„èŠ‚ç‚¹çš„IDï¼Œå³192.168.32.133çš„èŠ‚ç‚¹ID What is the receiving node ID? 77cfc3429c8b470331520074faea7c3a21f77d1f Please enter all the source node IDs. Type 'all' to use all the nodes as source nodes for the hash slots. Type 'done' once you entered all the source nodes IDs. Source node #1: all # é€‰æ‹©all Do you want to proceed with the proposed reshard plan (yes/no)? yes ä¸ºæ–°çš„masteræŒ‡å®šæ–°çš„slaveèŠ‚ç‚¹ å½“å‰Redisé›†ç¾¤ä¸­æ–°çš„masterèŠ‚ç‚¹å­˜å•ç‚¹é—®é¢˜,è¿˜éœ€è¦ç»™å…¶æ·»åŠ ä¸€ä¸ªå¯¹åº”slaveèŠ‚ç‚¹ï¼Œå®ç°é«˜å¯ç”¨åŠŸèƒ½ æœ‰ä¸¤ç§æ–¹å¼ï¼š æ–¹æ³•1ï¼šåœ¨æ–°åŠ èŠ‚ç‚¹åˆ°é›†ç¾¤æ—¶ï¼Œç›´æ¥å°†ä¹‹è®¾ç½®ä¸ºslave Redis 3/4 æ·»åŠ å‘½ä»¤\nredis-trib.rb add-node --slave --master-id 750cab050bc81f2655ed53900fd43d2e64423333 192.168.32.139:6379 \u003cä»»æ„é›†ç¾¤èŠ‚ç‚¹\u003e:6379 Redis 5 ä»¥ä¸Šç‰ˆæœ¬æ·»åŠ å‘½ä»¤ï¼š\nredis-cli -a 123456 --cluster add-node 192.168.32.139:6379 \u003cä»»æ„é›†ç¾¤èŠ‚ç‚¹\u003e:6379 -- cluster-slave --cluster-master-id d6e2eca6b338b717923f64866bd31d42e52edc98 èŒƒä¾‹ï¼š\n# æŸ¥çœ‹å½“å‰çŠ¶æ€ [root@centos8 ~]# redis-cli -a 123456 --cluster check 192.168.32.132:6379 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 192.168.32.132:6379 (658dd91e...) -\u003e 0 keys | 4096 slots | 1 slaves. 192.168.32.133:6379 (77cfc342...) -\u003e 0 keys | 4096 slots | 0 slaves. 192.168.32.140:6379 (f49ca2e5...) -\u003e 1 keys | 4096 slots | 1 slaves. 192.168.32.137:6379 (46b54e82...) -\u003e 0 keys | 4096 slots | 1 slaves. [OK] 1 keys in 4 masters. 0.00 keys per slot on average. \u003e\u003e\u003e Performing Cluster Check (using node 192.168.32.132:6379) M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379 slots:[1365-5460] (4096 slots) master 1 additional replica(s) M: 77cfc3429c8b470331520074faea7c3a21f77d1f 192.168.32.133:6379 slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379 slots: (0 slots) slave replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379 slots:[12288-16383] (4096 slots) master 1 additional replica(s) M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379 slots:[6827-10922] (4096 slots) master 1 additional replica(s) S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379 slots: (0 slots) slave replicates 658dd91e4b51bf06b161e6903d4084c77abd195d S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379 slots: (0 slots) slave replicates 46b54e8298e11e77450e232c9a0ee057b362191a [OK] All nodes agree about slots configuration. \u003e\u003e\u003e Check for open slots... \u003e\u003e\u003e Check slots coverage... [OK] All 16384 slots covered. [root@centos8 ~]# #ç›´æ¥åŠ ä¸ºslaveèŠ‚ç‚¹ [root@centos8 ~]# redis-cli -a 123456 --cluster add-node 192.168.32.139:6379 192.168.32.132:6379 --cluster-slave --cluster-master-id 77cfc3429c8b470331520074faea7c3a21f77d1f # éªŒè¯ [root@centos8 ~]# redis-cli -a 123456 --cluster check 192.168.32.132:6379 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 192.168.32.132:6379 (658dd91e...) -\u003e 0 keys | 4096 slots | 1 slaves. 192.168.32.133:6379 (77cfc342...) -\u003e 0 keys | 4096 slots | 1 slaves. 192.168.32.140:6379 (f49ca2e5...) -\u003e 1 keys | 4096 slots | 1 slaves. 192.168.32.137:6379 (46b54e82...) -\u003e 0 keys | 4096 slots | 1 slaves. [OK] 1 keys in 4 masters. 0.00 keys per slot on average. é›†ç¾¤ç¼©å®¹\nç¼©å®¹é€‚ç”¨åœºæ™¯ï¼š éšç€ä¸šåŠ¡èç¼©ç”¨æˆ·é‡ä¸‹é™æ˜æ˜¾,å’Œé¢†å¯¼å•†é‡å†³å®šå°†ç°æœ‰Redisé›†ç¾¤çš„8å°ä¸»æœºä¸­ä¸‹çº¿ä¸¤å°ä¸»æœºæŒªåšå®ƒç”¨,ç¼©å®¹åæ€§èƒ½ä»èƒ½æ»¡è¶³å½“å‰ä¸šåŠ¡éœ€æ±‚ åˆ é™¤èŠ‚ç‚¹è¿‡ç¨‹ï¼š æ‰©å®¹æ—¶æ˜¯å…ˆæ·»åŠ nodeåˆ°é›†ç¾¤ï¼Œç„¶åå†åˆ†é…æ§½ä½ï¼Œè€Œç¼©å®¹æ—¶çš„æ“ä½œç›¸åï¼Œæ˜¯å…ˆå°†è¢«è¦åˆ é™¤çš„nodeä¸Šçš„æ§½ä½è¿ç§»åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–nodeä¸Šï¼Œç„¶å æ‰èƒ½å†å°†å…¶ä»é›†ç¾¤ä¸­åˆ é™¤ï¼Œå¦‚æœä¸€ä¸ªnodeä¸Šçš„æ§½ä½æ²¡æœ‰è¢«å®Œå…¨è¿ç§»ç©ºï¼Œåˆ é™¤è¯¥nodeæ—¶ä¹Ÿä¼šæç¤ºæœ‰æ•°æ®å‡ºé”™å¯¼è‡´æ— æ³•åˆ é™¤ã€‚\nè¿ç§»è¦åˆ é™¤çš„masterèŠ‚ç‚¹ä¸Šé¢çš„æ§½ä½åˆ°å…¶å®ƒmaster æ³¨æ„: è¢«è¿ç§»Redis masteræºæœåŠ¡å™¨å¿…é¡»ä¿è¯æ²¡æœ‰æ•°æ®ï¼Œå¦åˆ™è¿ç§»æŠ¥é”™å¹¶ä¼šè¢«å¼ºåˆ¶ä¸­æ–­ã€‚ Redis 3/4 ç‰ˆæœ¬å‘½ä»¤\n[root@redis-node1 ~]# redis-trib.rb reshard 10.0.0.8:6379 [root@redis-node1 ~]# redis-trib.rb fix 10.0.0.8:6379 #å¦‚æœè¿ç§»å¤±è´¥ä½¿ç”¨æ­¤å‘½ä»¤ä¿®å¤é›†ç¾¤ Redis 5ç‰ˆæœ¬ä»¥ä¸Šå‘½ä»¤\n# æŸ¥çœ‹å½“å‰çŠ¶æ€ [root@centos8 ~]# redis-cli -a 123456 --cluster check 192.168.32.132:6379 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 192.168.32.132:6379 (658dd91e...) -\u003e 0 keys | 4096 slots | 1 slaves. 192.168.32.133:6379 (77cfc342...) -\u003e 0 keys | 4096 slots | 1 slaves. 192.168.32.140:6379 (f49ca2e5...) -\u003e 1 keys | 4096 slots | 1 slaves. 192.168.32.137:6379 (46b54e82...) -\u003e 0 keys | 4096 slots | 1 slaves. [OK] 1 keys in 4 masters. 0.00 keys per slot on average. \u003e\u003e\u003e Performing Cluster Check (using node 192.168.32.132:6379) M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379 slots:[1365-5460] (4096 slots) master 1 additional replica(s) M: 77cfc3429c8b470331520074faea7c3a21f77d1f 192.168.32.133:6379 slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master 1 additional replica(s) S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379 slots: (0 slots) slave replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379 slots:[12288-16383] (4096 slots) master 1 additional replica(s) M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379 slots:[6827-10922] (4096 slots) master 1 additional replica(s) S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379 slots: (0 slots) slave replicates 658dd91e4b51bf06b161e6903d4084c77abd195d S: a44914056fd3a170850ad572c0e238b499455897 192.168.32.139:6379 slots: (0 slots) slave replicates 77cfc3429c8b470331520074faea7c3a21f77d1f S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379 slots: (0 slots) slave replicates 46b54e8298e11e77450e232c9a0ee057b362191a [OK] All nodes agree about slots configuration. \u003e\u003e\u003e Check for open slots... \u003e\u003e\u003e Check slots coverage... [OK] All 16384 slots covered. [root@centos8 ~]# #è¿æ¥åˆ°ä»»æ„é›†ç¾¤èŠ‚ç‚¹ï¼Œ#æœ€å1365ä¸ªslotä»192.168.32.133ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªmasterèŠ‚ç‚¹192.168.32.132ä¸Š [root@centos8 ~]# redis-cli -a 123456 --cluster reshard 192.168.32.132:6379 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. \u003e\u003e\u003e Performing Cluster Check (using node 192.168.32.132:6379) M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379 slots:[1365-5460] (4096 slots) master 1 additional replica(s) M: 77cfc3429c8b470331520074faea7c3a21f77d1f 192.168.32.133:6379 slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master 1 additional replica(s) S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379 slots: (0 slots) slave replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379 slots:[12288-16383] (4096 slots) master 1 additional replica(s) M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379 slots:[6827-10922] (4096 slots) master 1 additional replica(s) S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379 slots: (0 slots) slave replicates 658dd91e4b51bf06b161e6903d4084c77abd195d S: a44914056fd3a170850ad572c0e238b499455897 192.168.32.139:6379 slots: (0 slots) slave replicates 77cfc3429c8b470331520074faea7c3a21f77d1f S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379 slots: (0 slots) slave replicates 46b54e8298e11e77450e232c9a0ee057b362191a [OK] All nodes agree about slots configuration. \u003e\u003e\u003e Check for open slots... \u003e\u003e\u003e Check slots coverage... [OK] All 16384 slots covered. How many slots do you want to move (from 1 to 16384)? 1356 #å…±4096/3åˆ†åˆ«ç»™å…¶å®ƒä¸‰ä¸ªmasterèŠ‚ç‚¹ What is the receiving node ID? 658dd91e4b51bf06b161e6903d4084c77abd195d # master id Please enter all the source node IDs. Type 'all' to use all the nodes as source nodes for the hash slots. Type 'done' once you entered all the source nodes IDs. Source node #1: 77cfc3429c8b470331520074faea7c3a21f77d1f # åˆ é™¤IDï¼Œ192.168.32.133çš„ID Source node #2: done Do you want to proceed with the proposed reshard plan (yes/no)? yes # redis-cli -a 123456 --cluster reshard 192.168.32.132:6379 è¯¥å‘½ä»¤åœ¨æ‰§è¡Œä¸¤æ¬¡ ä»é›†ç¾¤ä¸­åˆ é™¤æœåŠ¡å™¨ ä¸Šé¢æ­¥éª¤å®Œæˆå,æ§½ä½å·²ç»è¿ç§»èµ°ï¼Œä½†æ˜¯èŠ‚ç‚¹ä»ç„¶è¿˜å±äºé›†ç¾¤æˆå‘˜ï¼Œå› æ­¤è¿˜éœ€ä»é›†ç¾¤åˆ é™¤è¯¥èŠ‚ç‚¹ æ³¨æ„: åˆ é™¤æœåŠ¡å™¨å‰,å¿…é¡»æ¸…é™¤ä¸»æœºä¸Šé¢çš„æ§½ä½,å¦åˆ™ä¼šåˆ é™¤ä¸»æœºå¤±è´¥ Redis 3/4å‘½ä»¤ï¼š\n[root@s~]#redis-trib.rb del-node \u003cä»»æ„é›†ç¾¤èŠ‚ç‚¹çš„IP\u003e:6379 dfffc371085859f2858730e1f350e9167e287073 #dfffc371085859f2858730e1f350e9167e287073 æ˜¯åˆ é™¤èŠ‚ç‚¹çš„ID \u003e\u003e\u003e Removing node dfffc371085859f2858730e1f350e9167e287073 from cluster 192.168.7.102:6379 \u003e\u003e\u003e Sending CLUSTER FORGET messages to the cluster... \u003e\u003e\u003e SHUTDOWN the node. Redis 5ä»¥ä¸Šç‰ˆæœ¬å‘½ä»¤ï¼š\n[root@redis-node1 ~]#redis-cli -a 123456 --cluster del-node \u003cä»»æ„é›†ç¾¤èŠ‚ç‚¹çš„IP\u003e:6379 cb028b83f9dc463d732f6e76ca6bbcd469d948a7 #cb028b83f9dc463d732f6e76ca6bbcd469d948a7æ˜¯åˆ é™¤èŠ‚ç‚¹çš„ID èŒƒä¾‹\n# æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ [root@centos8 ~]# redis-cli -a 123456 --cluster check 192.168.32.132:6379 Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. 192.168.32.132:6379 (658dd91e...) -\u003e 0 keys | 8164 slots | 1 slaves. 192.168.32.133:6379 (77cfc342...) -\u003e 0 keys | 28 slots | 1 slaves. 192.168.32.140:6379 (f49ca2e5...) -\u003e 1 keys | 4096 slots | 1 slaves. 192.168.32.137:6379 (46b54e82...) -\u003e 0 keys | 4096 slots | 1 slaves. [OK] 1 keys in 4 masters. 0.00 keys per slot on average. \u003e\u003e\u003e Performing Cluster Check (using node 192.168.32.132:6379) M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379 slots:[0-6826],[10923-12259] (8164 slots) master 1 additional replica(s) M: 77cfc3429c8b470331520074faea7c3a21f77d1f 192.168.32.133:6379 slots:[12260-12287] (28 slots) master 1 additional replica(s) S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379 slots: (0 slots) slave replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379 slots:[12288-16383] (4096 slots) master 1 additional replica(s) M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379 slots:[6827-10922] (4096 slots) master 1 additional replica(s) S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379 slots: (0 slots) slave replicates 658dd91e4b51bf06b161e6903d4084c77abd195d S: a44914056fd3a170850ad572c0e238b499455897 192.168.32.139:6379 slots: (0 slots) slave replicates 77cfc3429c8b470331520074faea7c3a21f77d1f S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379 slots: (0 slots) slave replicates 46b54e8298e11e77450e232c9a0ee057b362191a [OK] All nodes agree about slots configuration. \u003e\u003e\u003e Check for open slots... \u003e\u003e\u003e Check slots coverage... [OK] All 16384 slots covered. [root@centos8 ~]# # åˆ é™¤192.168.32.133èŠ‚ç‚¹ [root@centos8 ~]# redis-cli -a 123456 --cluster del-node 192.168.32.132:6379 77cfc3429c8b470331520074faea7c3a21f77d1f Warning: Using a password with '-a' or '-u' option on the command line interface may not be safe. \u003e\u003e\u003e Removing node 77cfc3429c8b470331520074faea7c3a21f77d1f from cluster 192.168.32.132:6379 \u003e\u003e\u003e Sending CLUSTER FORGET messages to the cluster... \u003e\u003e\u003e Sending CLUSTER RESET SOFT to the deleted node. [root@centos8 ~]# å¸¸è§é¢è¯•é¢˜ Redis åšä»€ä¹ˆçš„,å³åœ¨å“ªäº›åœºæ™¯ä¸‹ä½¿ç”¨ å¦‚æœç›‘æ§ Redis æ˜¯å¦å‡ºç°æ•…éšœ Rediså®¢æˆ·ç«¯timeoutæŠ¥é”™çªç„¶å¢åŠ ï¼Œæ’æŸ¥æ€è·¯æ˜¯æ€æ ·çš„ï¼Ÿ è¯·ç®€å•æè¿°pipelineåŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆpipelineåŠŸèƒ½ä¼šæå‡redisæ€§èƒ½? æœ¬åœ°redis-clientè®¿é—®è¿œç¨‹RedisæœåŠ¡å‡ºé”™ï¼Œè¯´å‡ºå‡ ç§å¸¸è§çš„é”™è¯¯? key-valueçš„å¤§å°è¶…å¤§æˆ–å•keyçš„qpsè¶…é«˜ï¼Œä¼šå¯¹Redisæœ¬èº«é€ æˆä»€ä¹ˆæ ·çš„å½±å“ã€ä¼šå¯¹è®¿é—®Redisçš„å…¶ä»–å®¢æˆ·ç«¯é€ æˆä»€ä¹ˆæ ·çš„å½±å“ï¼Ÿ Zabbix ç›‘æ§ Redis å“ªäº›ç›‘æ§é¡¹ RDBå’ŒAOFæŒä¹…åŒ–åŒºåˆ« dockeræ‹‰å–ä¸€ä¸ªRediså¦‚ä½•å®ç°æ•°æ®æŒä¹…åŒ–ä¿å­˜ Redis æ”¯æŒå“ªäº›æ•°æ®ç±»å‹ Redis å¦‚ä½•å®ç°æ¶ˆæ¯é˜Ÿåˆ— æè¿°ä¸‹å¸¸è§çš„redisé›†ç¾¤æ¶æ„æœ‰å“ªäº›ï¼Œä»–ä»¬ä¹‹é—´çš„ä¼˜ç¼ºç‚¹å¯¹æ¯” ä¸»ä»å¤åˆ¶å·¥ä½œåŸç† Redis å¦‚ä½•å®ç°é«˜å¯ç”¨ å“¨å…µå·¥ä½œåŸç† Redis é›†ç¾¤çš„å·¥ä½œåŸç† Redis é›†ç¾¤å¦‚æœé¿å…è„‘è£‚ Redis é›†ç¾¤æœ€å°‘å‡ ä¸ªèŠ‚ç‚¹ä¸ºä»€ä¹ˆ? Redisçš„é›†ç¾¤æ§½ä½å¤šå°‘ä¸ª Redisé›†ç¾¤ä¸­æŸä¸ªèŠ‚ç‚¹ç¼ºå°‘ä¸€ä¸ªæ§½ä½æ˜¯å¦èƒ½ä½¿ç”¨ Redisæ•°æ®å†™å…¥çš„æ—¶å€™æ˜¯æ€ä¹ˆåœ¨å„ä¸ªèŠ‚ç‚¹æ§½ä½åˆ†é…æ•°æ®çš„ Redisçš„æ•°æ®å­˜å‚¨æ˜¯ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼å­˜å‚¨ Redisé›†ç¾¤çš„å„æ§½ä½å’Œæ€»æ§½ä½ä¹‹é—´ä»€ä¹ˆå…³ç³» ",
  "wordCount" : "9064",
  "inLanguage": "en",
  "image":"https://colorfulgz.com/posts.images/banner/30.jpg","datePublished": "2022-12-13T22:20:06Z",
  "dateModified": "2022-12-13T22:20:06Z",
  "author":[{
    "@type": "Person",
    "name": ""
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://colorfulgz.com/posts/redis%E9%9B%86%E7%BE%A4%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "DevOpsHub",
    "logo": {
      "@type": "ImageObject",
      "url": "https://colorfulgz.com/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://colorfulgz.com" accesskey="h" title="DevOpsHub (Alt + H)">
            <img src="https://colorfulgz.com/img/Q.gif" alt="logo" aria-label="logo"
                 height="35">DevOpsHub</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://colorfulgz.com/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                <span>ğŸ” æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://colorfulgz.com/" title="ğŸ  ä¸»é¡µ">
                <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://colorfulgz.com/posts" title="ğŸ“š æ–‡ç« ">
                <span>ğŸ“š æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://colorfulgz.com/tags" title="ğŸ§© æ ‡ç­¾">
                <span>ğŸ§© æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://colorfulgz.com/archives/" title="â±ï¸ æ—¶é—´è½´">
                <span>â±ï¸ æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://colorfulgz.com/about" title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº">
                <span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://colorfulgz.com">ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://colorfulgz.com/posts/">ğŸ“šæ–‡ç« </a></div>
            <h1 class="post-title">
                Redisé›†ç¾¤å’Œé«˜å¯ç”¨
            </h1>
            <div class="post-description">
                Rediså•æœºæœåŠ¡å­˜åœ¨æ•°æ®å’ŒæœåŠ¡çš„å•ç‚¹é—®é¢˜,è€Œä¸”å•æœºæ€§èƒ½ä¹Ÿå­˜åœ¨ç€ä¸Šé™,å¯ä»¥åˆ©ç”¨Redisçš„é›†ç¾¤ç›¸å…³æŠ€æœ¯æ¥è§£å†³è¿™äº›é—®é¢˜
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2022-12-13
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>9064å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>19åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://colorfulgz.com/tags/redis/" style="color: var(--secondary)!important;">Redis</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "https://colorfulgz.com"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="https://colorfulgz.com/posts.images/banner/30.jpg" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">æ–‡ç« ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e7%ae%80%e4%bb%8b" aria-label="ç®€ä»‹">ç®€ä»‹</a></li>
                <li>
                    <a href="#%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e5%ae%9e%e7%8e%b0" aria-label="ä¸»ä»å¤åˆ¶å®ç°">ä¸»ä»å¤åˆ¶å®ç°</a></li>
                <li>
                    <a href="#%e4%b8%bb%e4%bb%8e%e5%91%bd%e4%bb%a4%e9%85%8d%e7%bd%ae" aria-label="ä¸»ä»å‘½ä»¤é…ç½®">ä¸»ä»å‘½ä»¤é…ç½®</a><ul>
                        
                <li>
                    <a href="#%e5%90%af%e7%94%a8%e4%b8%bb%e4%bb%8e%e5%90%8c%e6%ad%a5" aria-label="å¯ç”¨ä¸»ä»åŒæ­¥">å¯ç”¨ä¸»ä»åŒæ­¥</a></li>
                <li>
                    <a href="#%e5%88%a0%e9%99%a4%e4%b8%bb%e4%bb%8e%e5%90%8c%e6%ad%a5" aria-label="åˆ é™¤ä¸»ä»åŒæ­¥">åˆ é™¤ä¸»ä»åŒæ­¥</a></li>
                <li>
                    <a href="#%e9%aa%8c%e8%af%81%e5%90%8c%e6%ad%a5" aria-label="éªŒè¯åŒæ­¥">éªŒè¯åŒæ­¥</a></li>
                <li>
                    <a href="#%e4%bf%ae%e6%94%b9slave%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="ä¿®æ”¹slaveé…ç½®æ–‡ä»¶">ä¿®æ”¹slaveé…ç½®æ–‡ä»¶</a></li></ul>
                </li>
                <li>
                    <a href="#redis%e5%ae%9e%e7%8e%b0%e5%93%a8%e5%85%b5%e6%9e%b6%e6%9e%84" aria-label="Rediså®ç°å“¨å…µæ¶æ„">Rediså®ç°å“¨å…µæ¶æ„</a></li>
                <li>
                    <a href="#%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e8%bf%9e%e6%8e%a5-sentinel" aria-label="åº”ç”¨ç¨‹åºè¿æ¥ Sentinel">åº”ç”¨ç¨‹åºè¿æ¥ Sentinel</a></li>
                <li>
                    <a href="#%e5%ae%a2%e6%88%b7%e7%ab%af%e8%bf%9e%e6%8e%a5-sentinel-%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86" aria-label="å®¢æˆ·ç«¯è¿æ¥ Sentinel å·¥ä½œåŸç†">å®¢æˆ·ç«¯è¿æ¥ Sentinel å·¥ä½œåŸç†</a></li>
                <li>
                    <a href="#java-%e8%bf%9e%e6%8e%a5sentinel%e5%93%a8%e5%85%b5" aria-label="java è¿æ¥Sentinelå“¨å…µ">java è¿æ¥Sentinelå“¨å…µ</a></li>
                <li>
                    <a href="#python-%e8%bf%9e%e6%8e%a5-sentinel-%e5%93%a8%e5%85%b5" aria-label="python è¿æ¥ Sentinel å“¨å…µ">python è¿æ¥ Sentinel å“¨å…µ</a></li>
                <li>
                    <a href="#redis-cluster" aria-label="Redis Cluster">Redis Cluster</a></li>
                <li>
                    <a href="#redis-cluster-%e4%bb%8b%e7%bb%8d" aria-label="Redis Cluster ä»‹ç»">Redis Cluster ä»‹ç»</a></li>
                <li>
                    <a href="#redis-cluster-%e6%9e%b6%e6%9e%84" aria-label="Redis cluster æ¶æ„">Redis cluster æ¶æ„</a><ul>
                        
                <li>
                    <a href="#redis-cluster%e7%9a%84%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86" aria-label="Redis clusterçš„å·¥ä½œåŸç†">Redis clusterçš„å·¥ä½œåŸç†</a><ul>
                        
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e5%88%86%e5%8c%ba" aria-label="æ•°æ®åˆ†åŒº">æ•°æ®åˆ†åŒº</a></li>
                <li>
                    <a href="#%e9%9b%86%e7%be%a4%e9%80%9a%e4%bf%a1" aria-label="é›†ç¾¤é€šä¿¡">é›†ç¾¤é€šä¿¡</a></li>
                <li>
                    <a href="#%e9%9b%86%e7%be%a4%e4%bc%b8%e7%bc%a9" aria-label="é›†ç¾¤ä¼¸ç¼©">é›†ç¾¤ä¼¸ç¼©</a></li>
                <li>
                    <a href="#%e9%9b%86%e7%be%a4%e6%89%a9%e5%ae%b9" aria-label="é›†ç¾¤æ‰©å®¹">é›†ç¾¤æ‰©å®¹</a></li>
                <li>
                    <a href="#%e9%9b%86%e7%be%a4%e7%bc%a9%e5%ae%b9" aria-label="é›†ç¾¤ç¼©å®¹">é›†ç¾¤ç¼©å®¹</a></li>
                <li>
                    <a href="#%e6%95%85%e9%9a%9c%e8%bd%ac%e7%a7%bb" aria-label="æ•…éšœè½¬ç§»">æ•…éšœè½¬ç§»</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%ae%9e%e6%88%98%e6%a1%88%e4%be%8b" aria-label="å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹</a><ul>
                        
                <li>
                    <a href="#%e5%9f%ba%e4%ba%8eredis-5-%e4%bb%a5%e4%b8%8a%e7%89%88%e6%9c%ac%e7%9a%84-redis-cluster-%e9%83%a8%e7%bd%b2" aria-label="åŸºäºRedis 5 ä»¥ä¸Šç‰ˆæœ¬çš„ redis cluster éƒ¨ç½²">åŸºäºRedis 5 ä»¥ä¸Šç‰ˆæœ¬çš„ redis cluster éƒ¨ç½²</a><ul>
                        
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba-redis-cluster%e9%9b%86%e7%be%a4%e7%9a%84%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87" aria-label="åˆ›å»º redis clusteré›†ç¾¤çš„ç¯å¢ƒå‡†å¤‡">åˆ›å»º redis clusteré›†ç¾¤çš„ç¯å¢ƒå‡†å¤‡</a></li>
                <li>
                    <a href="#%e5%90%af%e7%94%a8-redis-cluster-%e9%85%8d%e7%bd%ae" aria-label="å¯ç”¨ redis cluster é…ç½®">å¯ç”¨ redis cluster é…ç½®</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e9%9b%86%e7%be%a4" aria-label="åˆ›å»ºé›†ç¾¤">åˆ›å»ºé›†ç¾¤</a></li>
                <li>
                    <a href="#%e9%aa%8c%e8%af%81%e9%9b%86%e7%be%a4" aria-label="éªŒè¯é›†ç¾¤">éªŒè¯é›†ç¾¤</a></li>
                <li>
                    <a href="#%e6%9f%a5%e7%9c%8b%e5%af%b9%e5%ba%94%e5%85%b3%e7%b3%bb" aria-label="æŸ¥çœ‹å¯¹åº”å…³ç³»">æŸ¥çœ‹å¯¹åº”å…³ç³»</a></li>
                <li>
                    <a href="#%e6%b5%8b%e8%af%95%e9%9b%86%e7%be%a4%e5%86%99%e5%85%a5%e6%95%b0%e6%8d%ae" aria-label="æµ‹è¯•é›†ç¾¤å†™å…¥æ•°æ®">æµ‹è¯•é›†ç¾¤å†™å…¥æ•°æ®</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#redis-cluster-%e7%ae%a1%e7%90%86" aria-label="Redis cluster ç®¡ç†">Redis cluster ç®¡ç†</a></li>
                <li>
                    <a href="#%e5%b8%b8%e8%a7%81%e9%9d%a2%e8%af%95%e9%a2%98" aria-label="å¸¸è§é¢è¯•é¢˜">å¸¸è§é¢è¯•é¢˜</a>
                </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h2 id="ç®€ä»‹">ç®€ä»‹<a hidden class="anchor" aria-hidden="true" href="#ç®€ä»‹">#</a></h2>
<p>Rediså•æœºæœåŠ¡å­˜åœ¨æ•°æ®å’ŒæœåŠ¡çš„å•ç‚¹é—®é¢˜,è€Œä¸”å•æœºæ€§èƒ½ä¹Ÿå­˜åœ¨ç€ä¸Šé™,å¯ä»¥åˆ©ç”¨Redisçš„é›†ç¾¤ç›¸å…³æŠ€æœ¯æ¥è§£å†³è¿™äº›é—®é¢˜.</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671327877294.png" alt="1671327877294"  />
</p>
<h2 id="ä¸»ä»å¤åˆ¶å®ç°">ä¸»ä»å¤åˆ¶å®ç°<a hidden class="anchor" aria-hidden="true" href="#ä¸»ä»å¤åˆ¶å®ç°">#</a></h2>
<h2 id="ä¸»ä»å‘½ä»¤é…ç½®">ä¸»ä»å‘½ä»¤é…ç½®<a hidden class="anchor" aria-hidden="true" href="#ä¸»ä»å‘½ä»¤é…ç½®">#</a></h2>
<p><img loading="lazy" src="/posts.images/image.assets/1670942266531.png" alt="1670942266531"  />
</p>
<p>å½“é…ç½®Rediså¤åˆ¶åŠŸèƒ½æ—¶ï¼Œå¼ºçƒˆå»ºè®®æ‰“å¼€ä¸»æœåŠ¡å™¨çš„æŒä¹…åŒ–åŠŸèƒ½ã€‚å¦åˆ™çš„è¯ï¼Œç”±äºå»¶è¿Ÿç­‰é—®é¢˜ï¼Œéƒ¨ç½²çš„ä¸»èŠ‚ç‚¹RedisæœåŠ¡åº”è¯¥è¦é¿å…è‡ªåŠ¨å¯åŠ¨ã€‚</p>
<p>å‚è€ƒæ¡ˆä¾‹: å¯¼è‡´ä¸»ä»æœåŠ¡å™¨æ•°æ®å…¨éƒ¨ä¸¢å¤±</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>1.å‡è®¾èŠ‚ç‚¹Aä¸ºä¸»æœåŠ¡å™¨ï¼Œå¹¶ä¸”å…³é—­äº†æŒä¹…åŒ–ã€‚å¹¶ä¸”èŠ‚ç‚¹Bå’ŒèŠ‚ç‚¹Cä»èŠ‚ç‚¹Aå¤åˆ¶æ•°æ®
</span></span><span style="display:flex;"><span>2.èŠ‚ç‚¹Aå´©æºƒï¼Œç„¶åç”±è‡ªåŠ¨æ‹‰èµ·æœåŠ¡é‡å¯äº†èŠ‚ç‚¹A.ç”±äºèŠ‚ç‚¹Açš„æŒä¹…åŒ–è¢«å…³é—­äº†ï¼Œæ‰€ä»¥é‡å¯ä¹‹åæ²¡æœ‰ä»»ä½•æ•°æ®
</span></span><span style="display:flex;"><span>3.èŠ‚ç‚¹Bå’ŒèŠ‚ç‚¹Cå°†ä»èŠ‚ç‚¹Aå¤åˆ¶æ•°æ®ï¼Œä½†æ˜¯Açš„æ•°æ®æ˜¯ç©ºçš„ï¼Œäºæ˜¯å°±æŠŠè‡ªèº«ä¿å­˜çš„æ•°æ®å‰¯æœ¬åˆ é™¤ã€‚
</span></span></code></pre></div><p>åœ¨å…³é—­ä¸»æœåŠ¡å™¨ä¸Šçš„æŒä¹…åŒ–ï¼Œå¹¶åŒæ—¶å¼€å¯è‡ªåŠ¨æ‹‰èµ·è¿›ç¨‹çš„æƒ…å†µä¸‹ï¼Œå³ä¾¿ä½¿ç”¨Sentinelæ¥å®ç°Redisçš„é«˜å¯ç”¨æ€§ï¼Œä¹Ÿæ˜¯éå¸¸å±é™©çš„ã€‚å› ä¸ºä¸»æœåŠ¡å™¨å¯èƒ½æ‹‰èµ·å¾—éå¸¸å¿«ï¼Œä»¥è‡³äºSentinelåœ¨é…ç½®çš„å¿ƒè·³æ—¶é—´é—´éš”å†…æ²¡æœ‰æ£€æµ‹åˆ°ä¸»æœåŠ¡å™¨å·²è¢«é‡å¯ï¼Œç„¶åè¿˜æ˜¯ä¼šæ‰§è¡Œä¸Šé¢çš„æ•°æ®ä¸¢å¤±çš„æµç¨‹ã€‚æ— è®ºä½•æ—¶ï¼Œæ•°æ®å®‰å…¨éƒ½æ˜¯æå…¶é‡è¦çš„ï¼Œæ‰€ä»¥åº”è¯¥ç¦æ­¢ä¸»æœåŠ¡å™¨å…³é—­æŒä¹…åŒ–çš„åŒæ—¶è‡ªåŠ¨å¯åŠ¨ã€‚</p>
<h3 id="å¯ç”¨ä¸»ä»åŒæ­¥">å¯ç”¨ä¸»ä»åŒæ­¥<a hidden class="anchor" aria-hidden="true" href="#å¯ç”¨ä¸»ä»åŒæ­¥">#</a></h3>
<p>Redis Server é»˜è®¤ä¸º masterèŠ‚ç‚¹ï¼Œå¦‚æœè¦é…ç½®ä¸ºä»èŠ‚ç‚¹,éœ€è¦æŒ‡å®šmasteræœåŠ¡å™¨çš„IP,ç«¯å£åŠè¿æ¥å¯†ç åœ¨ä»èŠ‚ç‚¹æ‰§è¡Œ REPLICAOF MASTER_IP PORT æŒ‡ä»¤å¯ä»¥å¯ç”¨ä¸»ä»åŒæ­¥å¤åˆ¶åŠŸèƒ½,æ—©æœŸç‰ˆæœ¬ä½¿ç”¨ SLAVEOFæŒ‡ä»¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>127.0.0.1:6379&gt; REPLICAOF MASTER_IP PORT #æ–°ç‰ˆæ¨èä½¿ç”¨
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; SLAVEOF MasterIP Port #æ—§ç‰ˆä½¿ç”¨ï¼Œå°†è¢«æ·˜æ±°
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG SET masterauth &lt;masterpass&gt;
</span></span></code></pre></div><ul>
<li>åœ¨masterå®ç°</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>127.0.0.1:6379&gt; AUTH 123456
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; INFO replication #æŸ¥çœ‹å½“å‰è§’è‰²é»˜è®¤ä¸ºmaster
</span></span><span style="display:flex;"><span># Replication
</span></span><span style="display:flex;"><span>role:master
</span></span><span style="display:flex;"><span>connected_slaves:0
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:f945fd1714d8d3b78a149c8b2e0d57567ee6cb77
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:1361
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:1
</span></span><span style="display:flex;"><span>repl_backlog_histlen:1361
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; 
</span></span></code></pre></div><ul>
<li>åœ¨slaveå®ç°</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#åœ¨slaveä¸Šè®¾ç½®masterçš„IPå’Œç«¯å£ï¼Œ4.0ç‰ˆä¹‹å‰çš„æŒ‡ä»¤ä¸ºslaveof
</span></span><span style="display:flex;"><span>127.0.0.1:6380&gt; REPLICAOF 127.0.0.1 6379  #ä»å¯ä½¿ç”¨SLAVEOF MasterIP Port
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6380&gt; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#åœ¨slaveä¸Šè®¾ç½®masterçš„å¯†ç 
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG SET masterauth 123456
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Replication #è§’è‰²å˜ä¸ºslave
</span></span><span style="display:flex;"><span>127.0.0.1:6380&gt; INFO replication
</span></span><span style="display:flex;"><span># Replication
</span></span><span style="display:flex;"><span>role:slave
</span></span><span style="display:flex;"><span>master_host:127.0.0.1  #æŒ‡å‘master
</span></span><span style="display:flex;"><span>master_port:6379
</span></span><span style="display:flex;"><span>master_link_status:up
</span></span><span style="display:flex;"><span>master_last_io_seconds_ago:1
</span></span><span style="display:flex;"><span>master_sync_in_progress:0
</span></span><span style="display:flex;"><span>slave_read_repl_offset:1515
</span></span><span style="display:flex;"><span>slave_repl_offset:1515
</span></span><span style="display:flex;"><span>slave_priority:100
</span></span><span style="display:flex;"><span>slave_read_only:1
</span></span><span style="display:flex;"><span>replica_announced:1
</span></span><span style="display:flex;"><span>connected_slaves:0
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:f945fd1714d8d3b78a149c8b2e0d57567ee6cb77
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:1515
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:1362
</span></span><span style="display:flex;"><span>repl_backlog_histlen:154
</span></span><span style="display:flex;"><span>127.0.0.1:6380&gt; 
</span></span></code></pre></div><ul>
<li>åœ¨masterå®ç°</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># æ·»åŠ å€¼
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; set class m48
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt;
</span></span></code></pre></div><ul>
<li>åœ¨slaveéªŒè¯æ˜¯å¦åŒæ­¥è¿‡æ¥</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># åœ¨slaveæ‰§è¡Œ
</span></span><span style="display:flex;"><span>127.0.0.1:6380&gt; get class
</span></span><span style="display:flex;"><span>&#34;m48&#34;
</span></span><span style="display:flex;"><span>127.0.0.1:6380&gt; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># å¯ä»¥çœ‹åˆ°å·²ç»åŒæ­¥æˆåŠŸ
</span></span></code></pre></div><ul>
<li>masterå®ç°</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#åœ¨masterä¸Šå¯ä»¥çœ‹åˆ°æ‰€æœ‰slaveä¿¡æ¯
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; info replication
</span></span><span style="display:flex;"><span># Replication
</span></span><span style="display:flex;"><span>role:master
</span></span><span style="display:flex;"><span>connected_slaves:1
</span></span><span style="display:flex;"><span>slave0:ip=127.0.0.1,port=6380,state=online,offset=1907,lag=0
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:f945fd1714d8d3b78a149c8b2e0d57567ee6cb77
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:1907
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:1
</span></span><span style="display:flex;"><span>repl_backlog_histlen:1907
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; 
</span></span></code></pre></div><h3 id="åˆ é™¤ä¸»ä»åŒæ­¥">åˆ é™¤ä¸»ä»åŒæ­¥<a hidden class="anchor" aria-hidden="true" href="#åˆ é™¤ä¸»ä»åŒæ­¥">#</a></h3>
<ul>
<li>åœ¨slaveå®ç°</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># åœ¨ä»èŠ‚ç‚¹æ‰§è¡Œ REPLICAOF NO ONE æŒ‡ä»¤å¯ä»¥å–æ¶ˆä¸»ä»å¤åˆ¶
</span></span><span style="display:flex;"><span>#å–æ¶ˆå¤åˆ¶,åœ¨slaveä¸Šæ‰§è¡ŒREPLICAOF NO ONE,ä¼šæ–­å¼€å’Œmasterçš„è¿æ¥ä¸å†ä¸»ä»å¤åˆ¶, ä½†ä¸ä¼šæ¸…é™¤slave
</span></span><span style="display:flex;"><span>ä¸Šå·²æœ‰çš„æ•°æ®
</span></span><span style="display:flex;"><span>127.0.0.1:6380&gt; REPLICAOF no one
</span></span></code></pre></div><h3 id="éªŒè¯åŒæ­¥">éªŒè¯åŒæ­¥<a hidden class="anchor" aria-hidden="true" href="#éªŒè¯åŒæ­¥">#</a></h3>
<ul>
<li>æŸ¥çœ‹masteræ—¥å¿—</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7-master ~]# tail -f /usr/local/src/redis/log/redis_6379.log 
</span></span><span style="display:flex;"><span>945:M 13 Dec 2022 22:27:17.550 * Synchronization with replica 127.0.0.1:6380 succeeded
</span></span><span style="display:flex;"><span>945:M 13 Dec 2022 22:42:59.410 # Connection with replica 127.0.0.1:6380 lost.
</span></span><span style="display:flex;"><span>945:M 13 Dec 2022 22:46:34.373 * Replica 127.0.0.1:6380 asks for synchronization
</span></span><span style="display:flex;"><span>945:M 13 Dec 2022 22:46:34.373 * Partial resynchronization not accepted: Replication ID mismatch (Replica asked for &#39;1200062e6b1065421dec8531ca2d96776029ab3d&#39;, my replication IDs are &#39;f945fd1714d8d3b78a149c8b2e0d57567ee6cb77&#39; and &#39;0000000000000000000000000000000000000000&#39;)
</span></span><span style="display:flex;"><span>945:M 13 Dec 2022 22:46:34.373 * Starting BGSAVE for SYNC with target: disk
</span></span><span style="display:flex;"><span>945:M 13 Dec 2022 22:46:34.374 * Background saving started by pid 1690
</span></span><span style="display:flex;"><span>1690:C 13 Dec 2022 22:46:34.376 * DB saved on disk
</span></span><span style="display:flex;"><span>1690:C 13 Dec 2022 22:46:34.377 * RDB: 2 MB of memory used by copy-on-write
</span></span><span style="display:flex;"><span>945:M 13 Dec 2022 22:46:34.435 * Background saving terminated with success
</span></span><span style="display:flex;"><span>945:M 13 Dec 2022 22:46:34.435 * Synchronization with replica 127.0.0.1:6380 succeeded
</span></span></code></pre></div><ul>
<li>æŸ¥çœ‹slaveæ—¥å¿—</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7-master ~]# tail -f /usr/local/src/redis/log/redis_6380.log
</span></span><span style="display:flex;"><span>946:S 13 Dec 2022 22:46:34.436 * MASTER &lt;-&gt; REPLICA sync: Finished with success
</span></span><span style="display:flex;"><span>946:S 13 Dec 2022 22:46:34.437 * Background append only file rewriting started by pid 1691
</span></span><span style="display:flex;"><span>946:S 13 Dec 2022 22:46:34.470 * AOF rewrite child asks to stop sending diffs.
</span></span><span style="display:flex;"><span>1691:C 13 Dec 2022 22:46:34.470 * Parent agreed to stop sending diffs. Finalizing AOF...
</span></span><span style="display:flex;"><span>1691:C 13 Dec 2022 22:46:34.470 * Concatenating 0.00 MB of AOF diff received from parent.
</span></span><span style="display:flex;"><span>1691:C 13 Dec 2022 22:46:34.470 * SYNC append only file rewrite performed
</span></span><span style="display:flex;"><span>1691:C 13 Dec 2022 22:46:34.471 * AOF rewrite: 2 MB of memory used by copy-on-write
</span></span><span style="display:flex;"><span>946:S 13 Dec 2022 22:46:34.536 * Background AOF rewrite terminated with success
</span></span><span style="display:flex;"><span>946:S 13 Dec 2022 22:46:34.536 * Residual parent diff successfully flushed to the rewritten AOF (0.00 MB)
</span></span><span style="display:flex;"><span>946:S 13 Dec 2022 22:46:34.536 * Background AOF rewrite finished successfully
</span></span></code></pre></div><h3 id="ä¿®æ”¹slaveé…ç½®æ–‡ä»¶">ä¿®æ”¹slaveé…ç½®æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#ä¿®æ”¹slaveé…ç½®æ–‡ä»¶">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7-master ~]# vim /usr/local/src/redis/etc/redis6380.conf 
</span></span><span style="display:flex;"><span># replicaof &lt;masterip&gt; &lt;masterport&gt;
</span></span><span style="display:flex;"><span>replicaof 127.0.0.1 6379 #æŒ‡å®šmasterçš„IPå’Œç«¯å£å·ï¼Œæˆ‘è¿™é‡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šå®‰è£…äº†å¤šå®ä¾‹
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># masterauth &lt;master-password&gt;
</span></span><span style="display:flex;"><span>masterauth 123456 #å¦‚æœå¯†ç éœ€è¦è®¾ç½®
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>systemctl restart redis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#åœ¨masterä¸ŠæŸ¥çœ‹çŠ¶æ€
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; info replication
</span></span><span style="display:flex;"><span># Replication
</span></span><span style="display:flex;"><span>role:master
</span></span><span style="display:flex;"><span>connected_slaves:2
</span></span><span style="display:flex;"><span>slave0:ip=127.0.0.1,port=6380,state=online,offset=3307,lag=1
</span></span><span style="display:flex;"><span>slave1:ip=127.0.0.1,port=6381,state=online,offset=3307,lag=1
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:f945fd1714d8d3b78a149c8b2e0d57567ee6cb77
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:3307
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:1
</span></span><span style="display:flex;"><span>repl_backlog_histlen:3307
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#åœæ­¢masterçš„redisæœåŠ¡ï¼šsystemctl stop redis,åœ¨slaveä¸Šå¯ä»¥è§‚å¯Ÿåˆ°ä»¥ä¸‹ç°è±¡
</span></span><span style="display:flex;"><span>127.0.0.1:6381&gt; info replication
</span></span><span style="display:flex;"><span># Replication
</span></span><span style="display:flex;"><span>role:slave
</span></span><span style="display:flex;"><span>master_host:192.168.1.104
</span></span><span style="display:flex;"><span>master_port:6379
</span></span><span style="display:flex;"><span>master_link_status:down   #æ˜¾ç¤ºdownï¼Œè¡¨ç¤ºæ— æ³•è¿æ¥master
</span></span><span style="display:flex;"><span>master_last_io_seconds_ago:-1
</span></span><span style="display:flex;"><span>master_sync_in_progress:0
</span></span><span style="display:flex;"><span>slave_read_repl_offset:84
</span></span><span style="display:flex;"><span>slave_repl_offset:84
</span></span><span style="display:flex;"><span>master_link_down_since_seconds:14
</span></span><span style="display:flex;"><span>slave_priority:100
</span></span><span style="display:flex;"><span>slave_read_only:1
</span></span><span style="display:flex;"><span>replica_announced:1
</span></span><span style="display:flex;"><span>connected_slaves:0
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:f6eefc841166e73282b4bab58527081653ddb0d1
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:84
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:15
</span></span><span style="display:flex;"><span>repl_backlog_histlen:70
</span></span><span style="display:flex;"><span>127.0.0.1:6381&gt; 
</span></span></code></pre></div><ul>
<li>slave åªè¯»çŠ¶æ€
éªŒè¯SlaveèŠ‚ç‚¹ä¸ºåªè¯»çŠ¶æ€, ä¸æ”¯æŒå†™å…¥</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>127.0.0.1:6381&gt; set ll aa
</span></span><span style="display:flex;"><span>(error) READONLY You can&#39;t write against a read only replica.
</span></span><span style="display:flex;"><span>127.0.0.1:6381&gt; 
</span></span></code></pre></div><h2 id="rediså®ç°å“¨å…µæ¶æ„">Rediså®ç°å“¨å…µæ¶æ„<a hidden class="anchor" aria-hidden="true" href="#rediså®ç°å“¨å…µæ¶æ„">#</a></h2>
<p>ä»¥ä¸‹æ¡ˆä¾‹å®ç°ä¸€ä¸»ä¸¤ä»çš„åŸºäºå“¨å…µçš„é«˜å¯ç”¨Redisæ¶æ„</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671283453244.png" alt="1671283453244"  />
</p>
<ul>
<li>å…ˆå®ç°ä¸»ä»æ¶æ„</li>
</ul>
<p>å“¨å…µçš„å‰ææ˜¯å·²ç»å®ç°äº†Redisçš„ä¸»ä»å¤åˆ¶
æ³¨æ„: master çš„é…ç½®æ–‡ä»¶ä¸­masterauth å’Œslave éƒ½å¿…é¡»ç›¸åŒ
æ‰€æœ‰ä¸»ä»èŠ‚ç‚¹çš„ redis.conf ä¸­å…³å¥é…ç½®
èŒƒä¾‹: å‡†å¤‡ä¸»ä»ç¯å¢ƒé…ç½®</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#åœ¨æ‰€æœ‰ä¸»ä»èŠ‚ç‚¹æ‰§è¡Œ
</span></span><span style="display:flex;"><span>vim redis.conf
</span></span><span style="display:flex;"><span>bind 0.0.0.0
</span></span><span style="display:flex;"><span>masterauth &#34;123456&#34;
</span></span><span style="display:flex;"><span>requirepass &#34;123456&#34;
</span></span><span style="display:flex;"><span>#æˆ–è€…éäº¤äº’æ‰§è¡Œ
</span></span><span style="display:flex;"><span>[root@centos8 ~]#sed -i -e &#39;s/bind 127.0.0.1/bind 0.0.0.0/&#39; -e &#39;s/^# masterauth
</span></span><span style="display:flex;"><span>.*/masterauth 123456/&#39; -e &#39;s/^# requirepass .*/requirepass 123456/&#39;
</span></span><span style="display:flex;"><span>/etc/redis.conf
</span></span><span style="display:flex;"><span>#åœ¨æ‰€æœ‰ä»èŠ‚ç‚¹æ‰§è¡Œ
</span></span><span style="display:flex;"><span>[root@centos8 ~]#echo &#34;replicaof 192.168.32.133 6379&#34; &gt;&gt; /etc/redis.conf
</span></span><span style="display:flex;"><span>#åœ¨æ‰€æœ‰ä¸»ä»èŠ‚ç‚¹æ‰§è¡Œ
</span></span><span style="display:flex;"><span>[root@centos8 ~]#systemctl enable --now redis
</span></span></code></pre></div><ul>
<li>é…ç½®slave1</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@redis-slave1 ~]#redis-cli -a 123456
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface
</span></span><span style="display:flex;"><span>may not be safe.
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; REPLICAOF 192.168.32.133 6379
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG SET masterauth &#34;123456&#34;
</span></span><span style="display:flex;"><span>OK
</span></span></code></pre></div><ul>
<li>é…ç½®slave2</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@redis-slave2 ~]#redis-cli -a 123456
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface
</span></span><span style="display:flex;"><span>may not be safe.
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; REPLICAOF 192.168.32.133 6379
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG SET masterauth &#34;123456&#34;
</span></span><span style="display:flex;"><span>OK
</span></span></code></pre></div><ul>
<li>ç¼–è¾‘å“¨å…µé…ç½®<br>
sentinelé…ç½®
Sentinelå®é™…ä¸Šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„redisæœåŠ¡å™¨,æœ‰äº›redisæŒ‡ä»¤æ”¯æŒ,ä½†å¾ˆå¤šæŒ‡ä»¤å¹¶ä¸æ”¯æŒ.é»˜è®¤ç›‘å¬åœ¨
26379/tcpç«¯å£.
å“¨å…µæœåŠ¡å¯ä»¥å’ŒRedisæœåŠ¡å™¨åˆ†å¼€éƒ¨ç½²åœ¨ä¸åŒä¸»æœºï¼Œä½†ä¸ºäº†èŠ‚çº¦æˆæœ¬ä¸€èˆ¬ä¼šéƒ¨ç½²åœ¨ä¸€èµ·
æ‰€æœ‰redisèŠ‚ç‚¹ä½¿ç”¨ç›¸åŒçš„ä»¥ä¸‹ç¤ºä¾‹çš„é…ç½®æ–‡ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#å¦‚æœæ˜¯ç¼–è¯‘å®‰è£…ï¼Œåœ¨æºç ç›®å½•æœ‰sentinel.confï¼Œå¤åˆ¶åˆ°å®‰è£…ç›®å½•å³å¯ï¼Œ
</span></span><span style="display:flex;"><span>å¦‚:/usr/local/src/redis/etc/sentinel.conf
</span></span><span style="display:flex;"><span>[root@centos8 ~]#cp redis-6.2.5/sentinel.conf /usr/local/src/redis/etc/
</span></span><span style="display:flex;"><span>[root@centos8 ~]#chown redis.redis /usr/local/src/redis/etc/sentinel.conf
</span></span><span style="display:flex;"><span>[root@centos8 ~]#vim /etc/redis-sentinel.conf
</span></span><span style="display:flex;"><span>bind 0.0.0.0
</span></span><span style="display:flex;"><span>port 26379
</span></span><span style="display:flex;"><span>daemonize yes
</span></span><span style="display:flex;"><span>pidfile &#34;redis-sentinel.pid&#34;
</span></span><span style="display:flex;"><span>logfile &#34;sentinel_26379.log&#34;
</span></span><span style="display:flex;"><span>dir &#34;/tmp&#34; #å·¥ä½œç›®å½•
</span></span><span style="display:flex;"><span>sentinel monitor mymaster 10.0.0.8 6379 2
</span></span><span style="display:flex;"><span>#mymasteræ˜¯é›†ç¾¤çš„åç§°ï¼Œæ­¤è¡ŒæŒ‡å®šå½“å‰mymasteré›†ç¾¤ä¸­masteræœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£
</span></span><span style="display:flex;"><span>#2ä¸ºæ³•å®šäººæ•°é™åˆ¶(quorum)ï¼Œå³æœ‰å‡ ä¸ªsentinelè®¤ä¸ºmaster downäº†å°±è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œä¸€èˆ¬æ­¤å€¼æ˜¯æ‰€æœ‰
</span></span><span style="display:flex;"><span>sentinelèŠ‚ç‚¹(ä¸€èˆ¬æ€»æ•°æ˜¯&gt;=3çš„ å¥‡æ•°,å¦‚:3,5,7ç­‰)çš„ä¸€åŠä»¥ä¸Šçš„æ•´æ•°å€¼ï¼Œæ¯”å¦‚ï¼Œæ€»æ•°æ˜¯3ï¼Œå³3/2=1.5ï¼Œ
</span></span><span style="display:flex;"><span>å–æ•´ä¸º2,æ˜¯masterçš„ODOWNå®¢è§‚ä¸‹çº¿çš„ä¾æ®
</span></span><span style="display:flex;"><span>sentinel auth-pass mymaster 123456
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#mymasteré›†ç¾¤ä¸­masterçš„å¯†ç ï¼Œæ³¨æ„æ­¤è¡Œè¦åœ¨ä¸Šé¢è¡Œçš„ä¸‹é¢
</span></span><span style="display:flex;"><span>sentinel down-after-milliseconds mymaster 30000
</span></span><span style="display:flex;"><span>#åˆ¤æ–­mymasteré›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„ä¸»è§‚ä¸‹çº¿(SDOWN)çš„æ—¶é—´ï¼Œå•ä½ï¼šæ¯«ç§’ï¼Œå»ºè®®3000
</span></span><span style="display:flex;"><span>sentinel parallel-syncs mymaster 1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#å‘ç”Ÿæ•…éšœè½¬ç§»åï¼Œå¯ä»¥åŒæ—¶å‘æ–°masteråŒæ­¥æ•°æ®çš„slaveçš„æ•°é‡ï¼Œæ•°å­—è¶Šå°æ€»åŒæ­¥æ—¶é—´è¶Šé•¿ï¼Œä½†å¯ä»¥å‡è½»æ–°
</span></span><span style="display:flex;"><span>masterçš„è´Ÿè½½å‹åŠ›
</span></span><span style="display:flex;"><span>sentinel failover-timeout mymaster 180000
</span></span><span style="display:flex;"><span>#æ‰€æœ‰slavesæŒ‡å‘æ–°çš„masteræ‰€éœ€çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ï¼šæ¯«ç§’
</span></span><span style="display:flex;"><span>sentinel deny-scripts-reconfig yes #ç¦æ­¢ä¿®æ”¹è„šæœ¬
</span></span><span style="display:flex;"><span>logfile /var/log/redis/sentinel.log
</span></span></code></pre></div><ul>
<li>ä¸‰ä¸ªå“¨å…µæœåŠ¡å™¨çš„é…ç½®éƒ½å¦‚ä¸‹</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>port 26379
</span></span><span style="display:flex;"><span>daemonize no
</span></span><span style="display:flex;"><span>pidfile &#34;/var/run/redis-sentinel.pid&#34;
</span></span><span style="display:flex;"><span>logfile &#34;/var/log/redis/sentinel.log&#34;
</span></span><span style="display:flex;"><span>dir &#34;/tmp&#34;
</span></span><span style="display:flex;"><span>sentinel monitor mymaster 192.168.32.133 6379 2 #ä¿®æ”¹æ­¤è¡Œ
</span></span><span style="display:flex;"><span>sentinel auth-pass mymaster 123456 #å¢åŠ æ­¤è¡Œ
</span></span><span style="display:flex;"><span>sentinel down-after-milliseconds mymaster 3000 #ä¿®æ”¹æ­¤è¡Œ
</span></span><span style="display:flex;"><span>sentinel parallel-syncs mymaster 1
</span></span><span style="display:flex;"><span>sentinel failover-timeout mymaster 180000
</span></span><span style="display:flex;"><span>sentinel deny-scripts-reconfig yes
</span></span><span style="display:flex;"><span>#æ³¨æ„æ­¤è¡Œè‡ªåŠ¨ç”Ÿæˆå¿…é¡»å”¯ä¸€,ä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹ï¼Œå¦‚æœç›¸åŒåˆ™ä¿®æ”¹æ­¤å€¼éœ€é‡å¯rediså’ŒsentinelæœåŠ¡
</span></span><span style="display:flex;"><span>sentinel myid 50547f34ed71fd48c197924969937e738a39975b
</span></span><span style="display:flex;"><span>.....
</span></span><span style="display:flex;"><span># Generated by CONFIG REWRITE
</span></span><span style="display:flex;"><span>protected-mode no
</span></span><span style="display:flex;"><span>supervised systemd
</span></span><span style="display:flex;"><span>sentinel leader-epoch mymaster 0
</span></span><span style="display:flex;"><span>sentinel known-replica mymaster 10.0.0.28 6379
</span></span><span style="display:flex;"><span>sentinel known-replica mymaster 10.0.0.18 6379
</span></span><span style="display:flex;"><span>sentinel current-epoch 0
</span></span></code></pre></div><ul>
<li>å¯åŠ¨å“¨å…µæœåŠ¡
å°†æ‰€æœ‰å“¨å…µæœåŠ¡å™¨éƒ½å¯åŠ¨èµ·æ¥</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>/usr/local/src/redis/bin/redis-sentinel /usr/local/src/redis/etc/sentinel.conf
</span></span></code></pre></div><ul>
<li>å°†æœåŠ¡å†™æˆserviceæ–‡ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>vim /lib/systemd/system/redis-sentinel.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[Unit]
</span></span><span style="display:flex;"><span>Description=Redis Sentinel
</span></span><span style="display:flex;"><span>After=network.target
</span></span><span style="display:flex;"><span>[Service]
</span></span><span style="display:flex;"><span>ExecStart=/usr/local/src/redis/bin/redis-sentinel /usr/local/src/redis/etc/sentinel.conf --supervised systemd
</span></span><span style="display:flex;"><span>ExecStop=/bin/kill -s QUIT $MAINPID
</span></span><span style="display:flex;"><span>User=redis
</span></span><span style="display:flex;"><span>Group=redis
</span></span><span style="display:flex;"><span>RuntimeDirectory=redis
</span></span><span style="display:flex;"><span>RuntimeDirectoryMode=0755
</span></span><span style="display:flex;"><span>[Install]
</span></span><span style="display:flex;"><span>WantedBy=multi-user.target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#æ³¨æ„æ‰€æœ‰èŠ‚ç‚¹çš„ç›®å½•æƒé™,å¦åˆ™æ— æ³•å¯åŠ¨æœåŠ¡
</span></span><span style="display:flex;"><span>[root@redis-master ~]#chown -R redis.redis /usr.local/src/redis/
</span></span></code></pre></div><ul>
<li>éªŒè¯å“¨å…µæœåŠ¡</li>
</ul>
<p>æŸ¥çœ‹å“¨å…µæœåŠ¡ç«¯å£çŠ¶æ€,ç«¯å£26379</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos8 log]# ss -ntl
</span></span><span style="display:flex;"><span>State            Recv-Q           Send-Q                     Local Address:Port                       Peer Address:Port           Process           
</span></span><span style="display:flex;"><span>LISTEN           0                511                              0.0.0.0:26379                           0.0.0.0:*                                
</span></span><span style="display:flex;"><span>LISTEN           0                511                              0.0.0.0:6379                            0.0.0.0:*                                
</span></span><span style="display:flex;"><span>LISTEN           0                128                              0.0.0.0:22                              0.0.0.0:*                                
</span></span><span style="display:flex;"><span>LISTEN           0                511                                [::1]:6379                               [::]:*                                
</span></span><span style="display:flex;"><span>LISTEN           0                128                                 [::]:22                                 [::]:*                                
</span></span><span style="display:flex;"><span>[root@centos8 log]# 
</span></span></code></pre></div><ul>
<li>Sentinel è¿ç»´</li>
</ul>
<p>æ‰‹åŠ¨è®©ä¸»èŠ‚ç‚¹ä¸‹çº¿</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>127.0.0.1:26379&gt; sentinel failover &lt;masterName&gt;
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šæ‰‹åŠ¨æ•…éšœè½¬ç§»</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>vim redis.conf
</span></span><span style="display:flex;"><span>replica-priority 10 #æŒ‡å®šä¼˜å…ˆçº§,å€¼è¶Šå°sentinelä¼šä¼˜å…ˆå°†ä¹‹é€‰ä¸ºæ–°çš„master,é»˜ä¸ºå€¼ä¸º100
</span></span><span style="display:flex;"><span>systemctl restart redis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#æˆ–è€…åŠ¨æ€ä¿®æ”¹
</span></span><span style="display:flex;"><span>[root@centos8 ~]#redis-cli -a 123456
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface
</span></span><span style="display:flex;"><span>may not be safe.
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG GET replica-priority
</span></span><span style="display:flex;"><span>1) &#34;replica-priority&#34;
</span></span><span style="display:flex;"><span>2) &#34;100&#34;
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG SET replica-priority 99
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG GET replica-priority
</span></span><span style="display:flex;"><span>1) &#34;replica-priority&#34;
</span></span><span style="display:flex;"><span>2) &#34;99&#34;
</span></span><span style="display:flex;"><span>[root@centos8 ~]#redis-cli -p 26379
</span></span><span style="display:flex;"><span>127.0.0.1:26379&gt; sentinel failover mymaster
</span></span><span style="display:flex;"><span>OK
</span></span></code></pre></div><h2 id="åº”ç”¨ç¨‹åºè¿æ¥-sentinel">åº”ç”¨ç¨‹åºè¿æ¥ Sentinel<a hidden class="anchor" aria-hidden="true" href="#åº”ç”¨ç¨‹åºè¿æ¥-sentinel">#</a></h2>
<p>Redis å®˜æ–¹æ”¯æŒå¤šç§å¼€å‘è¯­è¨€çš„å®¢æˆ·ç«¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>https://redis.io/clients
</span></span></code></pre></div><h2 id="å®¢æˆ·ç«¯è¿æ¥-sentinel-å·¥ä½œåŸç†">å®¢æˆ·ç«¯è¿æ¥ Sentinel å·¥ä½œåŸç†<a hidden class="anchor" aria-hidden="true" href="#å®¢æˆ·ç«¯è¿æ¥-sentinel-å·¥ä½œåŸç†">#</a></h2>
<ol>
<li>å®¢æˆ·ç«¯è·å– Sentinel èŠ‚ç‚¹é›†åˆ,é€‰ä¸¾å‡ºä¸€ä¸ª Sentinel</li>
</ol>
<p><img loading="lazy" src="/posts.images/image.assets/1671326052932.png" alt="1671326052932"  />
</p>
<p>1.ç”±è¿™ä¸ªsentinel é€šè¿‡masterName è·å–masterèŠ‚ç‚¹ä¿¡æ¯,å®¢æˆ·ç«¯é€šè¿‡sentinel get-master-addr-by-name master-nameè¿™ä¸ªapiæ¥è·å–å¯¹åº”ä¸»èŠ‚ç‚¹ä¿¡æ¯</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671326076150.png" alt="1671326076150"  />
</p>
<p>2.å®¢æˆ·ç«¯å‘é€roleæŒ‡ä»¤ç¡®è®¤masterçš„ä¿¡æ¯,éªŒè¯å½“å‰è·å–çš„â€œä¸»èŠ‚ç‚¹â€æ˜¯çœŸæ­£çš„ä¸»èŠ‚ç‚¹ï¼Œè¿™æ ·çš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢æ•…éšœè½¬ç§»æœŸé—´ä¸»èŠ‚ç‚¹çš„å˜åŒ–</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671326092067.png" alt="1671326092067"  />
</p>
<p>3.å®¢æˆ·ç«¯ä¿æŒå’ŒSentinelèŠ‚ç‚¹é›†åˆçš„è”ç³»ï¼Œå³è®¢é˜…SentinelèŠ‚ç‚¹ç›¸å…³é¢‘é“ï¼Œæ—¶åˆ»è·å–å…³äºä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯,è·å–æ–°çš„master ä¿¡æ¯å˜åŒ–,å¹¶è‡ªåŠ¨è¿æ¥æ–°çš„master</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671326121741.png" alt="1671326121741"  />
</p>
<h2 id="java-è¿æ¥sentinelå“¨å…µ">java è¿æ¥Sentinelå“¨å…µ<a hidden class="anchor" aria-hidden="true" href="#java-è¿æ¥sentinelå“¨å…µ">#</a></h2>
<p>java å®¢æˆ·ç«¯è¿æ¥Redisï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>https://github.com/xetorthio/jedis/blob/master/pom.xml
</span></span></code></pre></div><h2 id="python-è¿æ¥-sentinel-å“¨å…µ">python è¿æ¥ Sentinel å“¨å…µ<a hidden class="anchor" aria-hidden="true" href="#python-è¿æ¥-sentinel-å“¨å…µ">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#yum -y install python3 python3-redis</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#vim sentinel_test.py</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/python3</span>
</span></span><span style="display:flex;"><span>import redis
</span></span><span style="display:flex;"><span>from redis.sentinel import Sentinel
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¿æ¥å“¨å…µæœåŠ¡å™¨(ä¸»æœºåä¹Ÿå¯ä»¥ç”¨åŸŸå)</span>
</span></span><span style="display:flex;"><span>sentinel <span style="color:#f92672">=</span> Sentinel<span style="color:#f92672">([(</span><span style="color:#e6db74">&#39;192.168.32.135&#39;</span>, 26379<span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>                   <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;192.168.32.133&#39;</span>, 26379<span style="color:#f92672">)</span>,
</span></span><span style="display:flex;"><span>                   <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;192.168.32.132&#39;</span>, 26379<span style="color:#f92672">)]</span>,
</span></span><span style="display:flex;"><span>socket_timeout<span style="color:#f92672">=</span>0.5<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>redis_auth_pass <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;123456&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#mymaster æ˜¯é…ç½®å“¨å…µæ¨¡å¼çš„redisé›†ç¾¤åç§°ï¼Œæ­¤ä¸ºé»˜è®¤å€¼,å®é™…åç§°æŒ‰ç…§ä¸ªäººéƒ¨ç½²æ¡ˆä¾‹æ¥å¡«å†™</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è·å–ä¸»æœåŠ¡å™¨åœ°å€</span>
</span></span><span style="display:flex;"><span>master <span style="color:#f92672">=</span> sentinel.discover_master<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;mymaster&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;master:&#34;</span>,master<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è·å–ä»æœåŠ¡å™¨åœ°å€</span>
</span></span><span style="display:flex;"><span>slave <span style="color:#f92672">=</span> sentinel.discover_slaves<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;mymaster&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>print<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;slave:&#34;</span>,slave<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è·å–ä¸»æœåŠ¡å™¨è¿›è¡Œå†™å…¥</span>
</span></span><span style="display:flex;"><span>master <span style="color:#f92672">=</span> sentinel.master_for<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;mymaster&#39;</span>, socket_timeout<span style="color:#f92672">=</span>0.5,
</span></span><span style="display:flex;"><span>password<span style="color:#f92672">=</span>redis_auth_pass, db<span style="color:#f92672">=</span>0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>w_ret <span style="color:#f92672">=</span> master.set<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;xy&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¾“å‡ºï¼šTrue</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è·å–ä»æœåŠ¡å™¨è¿›è¡Œè¯»å–ï¼ˆé»˜è®¤æ˜¯round-roubinï¼‰</span>
</span></span><span style="display:flex;"><span>slave <span style="color:#f92672">=</span> sentinel.slave_for<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;mymaster&#39;</span>, socket_timeout<span style="color:#f92672">=</span>0.5,
</span></span><span style="display:flex;"><span>password<span style="color:#f92672">=</span>redis_auth_pass, db<span style="color:#f92672">=</span>0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>r_ret <span style="color:#f92672">=</span> slave.get<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;name&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>print<span style="color:#f92672">(</span>r_ret<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#è¾“å‡ºï¼šxy</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>chmod +x sentinel_test.py
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>./sentinel_test.py
</span></span><span style="display:flex;"><span>master: <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;192.168.32.135&#39;</span>, 6379<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>slave: <span style="color:#f92672">[(</span><span style="color:#e6db74">&#39;192.168.32.133&#39;</span>, 6379<span style="color:#f92672">)]</span>
</span></span><span style="display:flex;"><span>b<span style="color:#e6db74">&#39;xy&#39;</span>
</span></span></code></pre></div><h2 id="redis-cluster">Redis Cluster<a hidden class="anchor" aria-hidden="true" href="#redis-cluster">#</a></h2>
<p><img loading="lazy" src="/posts.images/image.assets/1671327580442.png" alt="1671327580442"  />
</p>
<h2 id="redis-cluster-ä»‹ç»">Redis Cluster ä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#redis-cluster-ä»‹ç»">#</a></h2>
<p>ä½¿ç”¨å“¨å…µsentinel åªèƒ½è§£å†³Redisé«˜å¯ç”¨é—®é¢˜ï¼Œå®ç°Redisçš„è‡ªåŠ¨æ•…éšœè½¬ç§»,ä½†ä»ç„¶æ— æ³•è§£å†³Redis Master
å•èŠ‚ç‚¹çš„æ€§èƒ½ç“¶é¢ˆé—®é¢˜
ä¸ºäº†è§£å†³å•æœºæ€§èƒ½çš„ç“¶é¢ˆï¼Œæé«˜Redis æœåŠ¡æ•´ä½“æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é›†ç¾¤çš„è§£å†³æ–¹æ¡ˆ
<strong>æ—©æœŸ Redis åˆ†å¸ƒå¼é›†ç¾¤éƒ¨ç½²æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>å®¢æˆ·ç«¯åˆ†åŒºï¼šç”±å®¢æˆ·ç«¯ç¨‹åºè‡ªå·±å®ç°å†™å…¥åˆ†é…ã€é«˜å¯ç”¨ç®¡ç†å’Œæ•…éšœè½¬ç§»ç­‰,å¯¹å®¢æˆ·ç«¯çš„å¼€å‘å®ç°è¾ƒä¸ºå¤æ‚</li>
<li>ä»£ç†æœåŠ¡ï¼šå®¢æˆ·ç«¯ä¸ç›´æ¥è¿æ¥Redis,è€Œå…ˆè¿æ¥åˆ°ä»£ç†æœåŠ¡ï¼Œç”±ä»£ç†æœåŠ¡å®ç°ç›¸åº”è¯»å†™åˆ†é…ï¼Œå½“å‰ä»£ç†æœåŠ¡éƒ½æ˜¯ç¬¬ä¸‰æ–¹å®ç°.æ­¤æ–¹æ¡ˆä¸­å®¢æˆ·ç«¯å®ç°æ— éœ€ç‰¹æ®Šå¼€å‘,å®ç°å®¹æ˜“,ä½†æ˜¯ä»£ç†æœåŠ¡èŠ‚ç‚¹ä»å­˜æœ‰å•ç‚¹æ•…éšœå’Œæ€§èƒ½ç“¶é¢ˆé—®é¢˜ã€‚æ¯”å¦‚ï¼šè±Œè±†èšå¼€å‘çš„ codis</li>
</ul>
<p>Redis 3.0 ç‰ˆæœ¬ä¹‹åæ¨å‡ºæ— ä¸­å¿ƒæ¶æ„çš„ Redis Cluster ï¼Œæ”¯æŒå¤šä¸ªmasterèŠ‚ç‚¹å¹¶è¡Œå†™å…¥å’Œæ•…éšœçš„è‡ªåŠ¨è½¬ç§»åŠ¨èƒ½</p>
<h2 id="redis-cluster-æ¶æ„">Redis cluster æ¶æ„<a hidden class="anchor" aria-hidden="true" href="#redis-cluster-æ¶æ„">#</a></h2>
<p><img loading="lazy" src="/posts.images/image.assets/1671328724924.png" alt="1671328724924"  />
</p>
<p>Redis cluster éœ€è¦è‡³å°‘ 3ä¸ªmasterèŠ‚ç‚¹æ‰èƒ½å®ç°,slaveèŠ‚ç‚¹æ•°é‡ä¸é™,å½“ç„¶ä¸€èˆ¬æ¯ä¸ªmasteréƒ½è‡³å°‘å¯¹åº”çš„æœ‰ä¸€ä¸ªslaveèŠ‚ç‚¹
å¦‚æœæœ‰ä¸‰ä¸ªä¸»èŠ‚ç‚¹é‡‡ç”¨å“ˆå¸Œæ§½ hash slot çš„æ–¹å¼æ¥åˆ†é…16384ä¸ªæ§½ä½ slot
æ­¤ä¸‰ä¸ªèŠ‚ç‚¹åˆ†åˆ«æ‰¿æ‹…çš„slot åŒºé—´å¯ä»¥æ˜¯å¦‚ä»¥ä¸‹æ–¹å¼åˆ†é…</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>èŠ‚ç‚¹M1 0ï¼5460
</span></span><span style="display:flex;"><span>èŠ‚ç‚¹M2 5461ï¼10922
</span></span><span style="display:flex;"><span>èŠ‚ç‚¹M3 10923ï¼16383
</span></span></code></pre></div><p><img loading="lazy" src="/posts.images/image.assets/1671328782321.png" alt="1671328782321"  />
</p>
<h3 id="redis-clusterçš„å·¥ä½œåŸç†">Redis clusterçš„å·¥ä½œåŸç†<a hidden class="anchor" aria-hidden="true" href="#redis-clusterçš„å·¥ä½œåŸç†">#</a></h3>
<p><img loading="lazy" src="/posts.images/image.assets/1671328827665.png" alt="1671328827665"  />
</p>
<h4 id="æ•°æ®åˆ†åŒº">æ•°æ®åˆ†åŒº<a hidden class="anchor" aria-hidden="true" href="#æ•°æ®åˆ†åŒº">#</a></h4>
<p>å¦‚æœæ˜¯å•æœºå­˜å‚¨çš„è¯ï¼Œç›´æ¥å°†æ•°æ®å­˜æ”¾åœ¨å•æœºrediså°±è¡Œäº†ã€‚ä½†æ˜¯å¦‚æœæ˜¯é›†ç¾¤å­˜å‚¨ï¼Œå°±éœ€è¦è€ƒè™‘åˆ°æ•°æ®åˆ†åŒºäº†ã€‚</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671328870673.png" alt="1671328870673"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671328992908.png" alt="1671328992908"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671329004830.png" alt="1671329004830"  />
</p>
<h4 id="é›†ç¾¤é€šä¿¡">é›†ç¾¤é€šä¿¡<a hidden class="anchor" aria-hidden="true" href="#é›†ç¾¤é€šä¿¡">#</a></h4>
<p>ä½†æ˜¯å¯»æ‰¾æ§½çš„è¿‡ç¨‹å¹¶ä¸æ˜¯ä¸€æ¬¡å°±å‘½ä¸­çš„ï¼Œæ¯”å¦‚ä¸Šå›¾keyå°†è¦å­˜æ”¾åœ¨14396æ§½ä¸­ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ä¸€ä¸‹å°±é”å®šäº†node3èŠ‚ç‚¹ï¼Œå¯èƒ½å…ˆå»è¯¢é—®node1ï¼Œç„¶åæ‰è®¿é—®node3ã€‚
è€Œé›†ç¾¤ä¸­èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ï¼Œä¿è¯äº†æœ€å¤šä¸¤æ¬¡å°±èƒ½å‘½ä¸­å¯¹åº”æ§½æ‰€åœ¨çš„èŠ‚ç‚¹ã€‚å› ä¸ºåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ï¼Œéƒ½ä¿å­˜äº†å…¶ä»–èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒçŸ¥é“å“ªä¸ªæ§½ç”±å“ªä¸ªèŠ‚ç‚¹è´Ÿè´£ã€‚è¿™æ ·å³ä½¿ç¬¬ä¸€æ¬¡è®¿é—®æ²¡æœ‰å‘½ä¸­æ§½ï¼Œä½†æ˜¯ä¼šé€šçŸ¥å®¢æˆ·ç«¯ï¼Œè¯¥æ§½åœ¨å“ªä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·è®¿é—®å¯¹åº”èŠ‚ç‚¹å°±èƒ½ç²¾å‡†å‘½ä¸­ã€‚</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671329162018.png" alt="1671329162018"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671329175313.png" alt="1671329175313"  />
</p>
<h4 id="é›†ç¾¤ä¼¸ç¼©">é›†ç¾¤ä¼¸ç¼©<a hidden class="anchor" aria-hidden="true" href="#é›†ç¾¤ä¼¸ç¼©">#</a></h4>
<p>é›†ç¾¤å¹¶ä¸æ˜¯å»ºç«‹ä¹‹åï¼ŒèŠ‚ç‚¹æ•°å°±å›ºå®šä¸å˜çš„ï¼Œä¹Ÿä¼šæœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æˆ–è€…é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¸‹çº¿ï¼Œè¿™å°±æ˜¯é›†ç¾¤çš„æ‰©å®¹å’Œç¼©å®¹ã€‚ä½†æ˜¯ç”±äºé›†ç¾¤èŠ‚ç‚¹å’Œæ§½æ¯æ¯ç›¸å…³ï¼Œæ‰€ä»¥é›†ç¾¤çš„ä¼¸ç¼©ä¹Ÿå¯¹åº”äº†æ§½å’Œæ•°æ®çš„è¿ç§»</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671329671490.png" alt="1671329671490"  />
</p>
<h4 id="é›†ç¾¤æ‰©å®¹">é›†ç¾¤æ‰©å®¹<a hidden class="anchor" aria-hidden="true" href="#é›†ç¾¤æ‰©å®¹">#</a></h4>
<p>å½“æœ‰æ–°çš„èŠ‚ç‚¹å‡†å¤‡å¥½åŠ å…¥é›†ç¾¤æ—¶ï¼Œè¿™ä¸ªæ–°çš„èŠ‚ç‚¹è¿˜æ˜¯å­¤ç«‹èŠ‚ç‚¹ï¼ŒåŠ å…¥æœ‰ä¸¤ç§æ–¹å¼ã€‚ä¸€ä¸ªæ˜¯é€šè¿‡é›†ç¾¤èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤æ¥å’Œå­¤ç«‹èŠ‚ç‚¹æ¡æ‰‹ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯ä½¿ç”¨è„šæœ¬æ¥æ·»åŠ èŠ‚ç‚¹ã€‚</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671329705222.png" alt="1671329705222"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671329719113.png" alt="1671329719113"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671329733621.png" alt="1671329733621"  />
</p>
<h4 id="é›†ç¾¤ç¼©å®¹">é›†ç¾¤ç¼©å®¹<a hidden class="anchor" aria-hidden="true" href="#é›†ç¾¤ç¼©å®¹">#</a></h4>
<p><img loading="lazy" src="/posts.images/image.assets/1671329778357.png" alt="1671329778357"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671329787950.png" alt="1671329787950"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671329813270.png" alt="1671329813270"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671329824032.png" alt="1671329824032"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671329836794.png" alt="1671329836794"  />
</p>
<h4 id="æ•…éšœè½¬ç§»">æ•…éšœè½¬ç§»<a hidden class="anchor" aria-hidden="true" href="#æ•…éšœè½¬ç§»">#</a></h4>
<p><img loading="lazy" src="/posts.images/image.assets/1671329862455.png" alt="1671329862455"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1671329876909.png" alt="1671329876909"  />
</p>
<p>å½“ä»èŠ‚ç‚¹èµ°é©¬ä¸Šä»»å˜æˆä¸»èŠ‚ç‚¹ä¹‹åï¼Œå°±è¦å¼€å§‹è¿›è¡Œæ›¿æ¢ä¸»èŠ‚ç‚¹ï¼š</p>
<ol>
<li>è®©è¯¥slaveèŠ‚ç‚¹æ‰§è¡Œslaveof no oneå˜ä¸ºmasterèŠ‚ç‚¹</li>
<li>å°†æ•…éšœèŠ‚ç‚¹è´Ÿè´£çš„æ§½åˆ†é…ç»™è¯¥èŠ‚ç‚¹</li>
<li>å‘é›†ç¾¤ä¸­å…¶ä»–èŠ‚ç‚¹å¹¿æ’­Pongæ¶ˆæ¯ï¼Œè¡¨æ˜å·²å®Œæˆæ•…éšœè½¬ç§»</li>
<li>æ•…éšœèŠ‚ç‚¹é‡å¯åï¼Œä¼šæˆä¸ºnew_masterçš„slaveèŠ‚ç‚¹</li>
</ol>
<h2 id="å®æˆ˜æ¡ˆä¾‹">å®æˆ˜æ¡ˆä¾‹<a hidden class="anchor" aria-hidden="true" href="#å®æˆ˜æ¡ˆä¾‹">#</a></h2>
<h3 id="åŸºäºredis-5-ä»¥ä¸Šç‰ˆæœ¬çš„-redis-cluster-éƒ¨ç½²">åŸºäºRedis 5 ä»¥ä¸Šç‰ˆæœ¬çš„ redis cluster éƒ¨ç½²<a hidden class="anchor" aria-hidden="true" href="#åŸºäºredis-5-ä»¥ä¸Šç‰ˆæœ¬çš„-redis-cluster-éƒ¨ç½²">#</a></h3>
<p>å®˜æ–¹æ–‡æ¡£ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>https://redis.io/topics/cluster-tutorial
</span></span></code></pre></div><h4 id="åˆ›å»º-redis-clusteré›†ç¾¤çš„ç¯å¢ƒå‡†å¤‡">åˆ›å»º redis clusteré›†ç¾¤çš„ç¯å¢ƒå‡†å¤‡<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»º-redis-clusteré›†ç¾¤çš„ç¯å¢ƒå‡†å¤‡">#</a></h4>
<p><img loading="lazy" src="/posts.images/image.assets/1671337258210.png" alt="1671337258210"  />
</p>
<ul>
<li>æ¯ä¸ªRedis èŠ‚ç‚¹é‡‡ç”¨ç›¸åŒçš„ç›¸åŒçš„Redisç‰ˆæœ¬ã€ç›¸åŒçš„å¯†ç ã€ç¡¬ä»¶é…ç½®</li>
<li>æ‰€æœ‰RedisæœåŠ¡å™¨å¿…é¡»æ²¡æœ‰ä»»ä½•æ•°æ®</li>
<li>å‡†å¤‡å…­å°ä¸»æœºï¼Œåœ°å€å¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>192.168.32.132
</span></span><span style="display:flex;"><span>192.168.32.137
</span></span><span style="display:flex;"><span>192.168.32.140
</span></span><span style="display:flex;"><span>192.168.32.129
</span></span><span style="display:flex;"><span>192.168.32.136
</span></span><span style="display:flex;"><span>192.168.32.138
</span></span></code></pre></div><h4 id="å¯ç”¨-redis-cluster-é…ç½®">å¯ç”¨ redis cluster é…ç½®<a hidden class="anchor" aria-hidden="true" href="#å¯ç”¨-redis-cluster-é…ç½®">#</a></h4>
<p>æ¯ä¸ªèŠ‚ç‚¹å®‰è£…ç›¸åŒç‰ˆæ¯ä¸ªèŠ‚ç‚¹ä¿®æ”¹redisé…ç½®ï¼Œå¿…é¡»å¼€å¯clusteråŠŸèƒ½çš„å‚æ•°</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>vim /etc/redis.conf
</span></span><span style="display:flex;"><span>bind 0.0.0.0
</span></span><span style="display:flex;"><span>masterauth 123456 #å»ºè®®é…ç½®ï¼Œå¦åˆ™åæœŸçš„masterå’Œslaveä¸»ä»å¤åˆ¶æ— æ³•æˆåŠŸï¼Œè¿˜éœ€å†é…ç½®
</span></span><span style="display:flex;"><span>requirepass 123456
</span></span><span style="display:flex;"><span>cluster-enabled yes #å–æ¶ˆæ­¤è¡Œæ³¨é‡Š,å¿…é¡»å¼€å¯é›†ç¾¤ï¼Œå¼€å¯å redis è¿›ç¨‹ä¼šæœ‰clusteræ ‡è¯†
</span></span><span style="display:flex;"><span>cluster-config-file nodes-6379.conf #å–æ¶ˆæ­¤è¡Œæ³¨é‡Š,æ­¤ä¸ºé›†ç¾¤çŠ¶æ€æ•°æ®æ–‡ä»¶,è®°å½•ä¸»ä»å…³ç³»
</span></span><span style="display:flex;"><span>åŠslotèŒƒå›´ä¿¡æ¯,ç”±redis cluster é›†ç¾¤è‡ªåŠ¨åˆ›å»ºå’Œç»´æŠ¤
</span></span><span style="display:flex;"><span>cluster-require-full-coverage no #é»˜è®¤å€¼ä¸ºyes,è®¾ä¸ºnoå¯ä»¥é˜²æ­¢ä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨å¯¼è‡´æ•´
</span></span><span style="display:flex;"><span>ä¸ªclusterä¸å¯ç”¨
</span></span></code></pre></div><p>ä»¥ä¸‹æ–¹å¼äºŒé€‰ä¸€</p>
<ul>
<li>æ‰§è¡Œä¸‹é¢å‘½ä»¤,æ‰¹é‡ä¿®æ”¹</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sed -i.bak -e &#39;s/bind 127.0.0.1/bind 0.0.0.0/&#39; -e &#39;/masterauth/a masterauth 123456&#39; -e &#39;/# requirepass/a requirepass 123456&#39; -e &#39;/# cluster-enabled yes/a cluster-enabled yes&#39; -e &#39;/# cluster-config-file nodes-6379.conf/a cluster-config-file nodes-6379.conf&#39; -e &#39;/cluster-require-full-coverage yes/c cluster-require-full-coverage no&#39; /etc/redis.conf
</span></span></code></pre></div><ul>
<li>å¦‚æœæ˜¯ç¼–è¯‘å®‰è£…å¯ä»¥æ‰§è¡Œä¸‹é¢æ“ä½œ</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sed -i.bak -e &#39;/masterauth/a masterauth 123456&#39; -e &#39;/# cluster-enabled yes/a cluster-enabled yes&#39; -e &#39;/# cluster-config-file nodes-6379.conf/a cluster-config-file nodes-6379.conf&#39; -e &#39;/cluster-require-full-coverage yes/c cluster-require-full-coverage no&#39; /usr/local/src/redis/etc/redis.conf
</span></span></code></pre></div><p>å¼€æœºå¯åŠ¨redis</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>systemctl enable --now redis
</span></span><span style="display:flex;"><span># ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶é‡å¯redis
</span></span><span style="display:flex;"><span>systemctl restart redis
</span></span></code></pre></div><p>éªŒè¯å½“å‰RedisæœåŠ¡çŠ¶æ€ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#å¼€å¯äº†16379çš„clusterçš„ç«¯å£,å®é™…çš„ç«¯å£=redis port + 10000
</span></span><span style="display:flex;"><span>[root@centos7 ~]# ss -ntl
</span></span><span style="display:flex;"><span>State      Recv-Q Send-Q                       Local Address:Port                                      Peer Address:Port              
</span></span><span style="display:flex;"><span>LISTEN     0      128                                      *:22                                                   *:*                  
</span></span><span style="display:flex;"><span>LISTEN     0      100                              127.0.0.1:25                                                   *:*                  
</span></span><span style="display:flex;"><span>LISTEN     0      511                                      *:16379                                                *:*                  
</span></span><span style="display:flex;"><span>LISTEN     0      511                                      *:6379                                                 *:*                  
</span></span><span style="display:flex;"><span>LISTEN     0      128                                   [::]:22                                                [::]:*                  
</span></span><span style="display:flex;"><span>LISTEN     0      100                                  [::1]:25                                                [::]:*                  
</span></span><span style="display:flex;"><span>LISTEN     0      511                                  [::1]:16379                                             [::]:*                  
</span></span><span style="display:flex;"><span>LISTEN     0      511                                  [::1]:6379                                              [::]:*                  
</span></span><span style="display:flex;"><span>[root@centos7 ~]# 
</span></span></code></pre></div><h4 id="åˆ›å»ºé›†ç¾¤">åˆ›å»ºé›†ç¾¤<a hidden class="anchor" aria-hidden="true" href="#åˆ›å»ºé›†ç¾¤">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#å‘½ä»¤redis-cliçš„é€‰é¡¹ --cluster-replicas 1 è¡¨ç¤ºæ¯ä¸ªmasterå¯¹åº”ä¸€ä¸ªslaveèŠ‚ç‚¹
</span></span><span style="display:flex;"><span># é»˜è®¤å‰ä¸‰ä¸ªä¸ºä¸»èŠ‚ç‚¹
</span></span><span style="display:flex;"><span>[root@centos8 etc]# redis-cli -a 123456 --cluster create 192.168.32.132:6379 192.168.32.137:6379 192.168.32.140:6379 192.168.32.129:6379 192.168.32.136:6379 192.168.32.138:6379 --cluster-replicas 1
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing hash slots allocation on 6 nodes...
</span></span><span style="display:flex;"><span>Master[0] -&gt; Slots 0 - 5460
</span></span><span style="display:flex;"><span>Master[1] -&gt; Slots 5461 - 10922
</span></span><span style="display:flex;"><span>Master[2] -&gt; Slots 10923 - 16383
</span></span><span style="display:flex;"><span>Adding replica 192.168.32.136:6379 to 192.168.32.132:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.32.138:6379 to 192.168.32.137:6379
</span></span><span style="display:flex;"><span>Adding replica 192.168.32.129:6379 to 192.168.32.140:6379
</span></span><span style="display:flex;"><span>M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379
</span></span><span style="display:flex;"><span>   slots:[0-5460] (5461 slots) master
</span></span><span style="display:flex;"><span>M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379
</span></span><span style="display:flex;"><span>   slots:[5461-10922] (5462 slots) master
</span></span><span style="display:flex;"><span>M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379
</span></span><span style="display:flex;"><span>   slots:[10923-16383] (5461 slots) master
</span></span><span style="display:flex;"><span>S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379
</span></span><span style="display:flex;"><span>   replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e
</span></span><span style="display:flex;"><span>S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379
</span></span><span style="display:flex;"><span>   replicates 658dd91e4b51bf06b161e6903d4084c77abd195d
</span></span><span style="display:flex;"><span>S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379
</span></span><span style="display:flex;"><span>   replicates 46b54e8298e11e77450e232c9a0ee057b362191a
</span></span><span style="display:flex;"><span>Can I set the above configuration? (type &#39;yes&#39; to accept): yes
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Nodes configuration updated
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Assign a different config epoch to each node
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Sending CLUSTER MEET messages to join the cluster
</span></span><span style="display:flex;"><span>Waiting for the cluster to join
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check (using node 192.168.32.132:6379)
</span></span><span style="display:flex;"><span>M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379
</span></span><span style="display:flex;"><span>   slots:[0-5460] (5461 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e
</span></span><span style="display:flex;"><span>M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379
</span></span><span style="display:flex;"><span>   slots:[10923-16383] (5461 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379
</span></span><span style="display:flex;"><span>   slots:[5461-10922] (5462 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 658dd91e4b51bf06b161e6903d4084c77abd195d
</span></span><span style="display:flex;"><span>S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 46b54e8298e11e77450e232c9a0ee057b362191a
</span></span><span style="display:flex;"><span>[OK] All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check for open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span>[OK] All 16384 slots covered.
</span></span><span style="display:flex;"><span>[root@centos8 ~]# 
</span></span></code></pre></div><h4 id="éªŒè¯é›†ç¾¤">éªŒè¯é›†ç¾¤<a hidden class="anchor" aria-hidden="true" href="#éªŒè¯é›†ç¾¤">#</a></h4>
<ul>
<li>æŸ¥çœ‹ä¸»ä»çŠ¶æ€</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>127.0.0.1:6379&gt; info replication
</span></span><span style="display:flex;"><span># Replication
</span></span><span style="display:flex;"><span>role:master
</span></span><span style="display:flex;"><span>connected_slaves:1
</span></span><span style="display:flex;"><span>slave0:ip=192.168.32.136,port=6379,state=online,offset=98,lag=1
</span></span><span style="display:flex;"><span>master_failover_state:no-failover
</span></span><span style="display:flex;"><span>master_replid:b1bd51213722f38a83c8bb525e8a74e62392a161
</span></span><span style="display:flex;"><span>master_replid2:0000000000000000000000000000000000000000
</span></span><span style="display:flex;"><span>master_repl_offset:98
</span></span><span style="display:flex;"><span>second_repl_offset:-1
</span></span><span style="display:flex;"><span>repl_backlog_active:1
</span></span><span style="display:flex;"><span>repl_backlog_size:1048576
</span></span><span style="display:flex;"><span>repl_backlog_first_byte_offset:1
</span></span><span style="display:flex;"><span>repl_backlog_histlen:98
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; 
</span></span></code></pre></div><ul>
<li>
<p>éªŒè¯é›†ç¾¤çŠ¶æ€</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>127.0.0.1:6379&gt; CLUSTER INFO
</span></span><span style="display:flex;"><span>cluster_state:ok
</span></span><span style="display:flex;"><span>cluster_slots_assigned:16384
</span></span><span style="display:flex;"><span>cluster_slots_ok:16384
</span></span><span style="display:flex;"><span>cluster_slots_pfail:0
</span></span><span style="display:flex;"><span>cluster_slots_fail:0
</span></span><span style="display:flex;"><span>cluster_known_nodes:6    # èŠ‚ç‚¹æ•°
</span></span><span style="display:flex;"><span>cluster_size:3           # ä¸‰ä¸ªé›†ç¾¤
</span></span><span style="display:flex;"><span>cluster_current_epoch:6
</span></span><span style="display:flex;"><span>cluster_my_epoch:1
</span></span><span style="display:flex;"><span>cluster_stats_messages_ping_sent:210
</span></span><span style="display:flex;"><span>cluster_stats_messages_pong_sent:210
</span></span><span style="display:flex;"><span>cluster_stats_messages_sent:420
</span></span><span style="display:flex;"><span>cluster_stats_messages_ping_received:205
</span></span><span style="display:flex;"><span>cluster_stats_messages_pong_received:210
</span></span><span style="display:flex;"><span>cluster_stats_messages_meet_received:5
</span></span><span style="display:flex;"><span>cluster_stats_messages_received:420
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#æŸ¥çœ‹ä»»æ„èŠ‚ç‚¹çš„é›†ç¾¤çŠ¶æ€
</span></span><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -a 123456 --cluster info 192.168.32.137:6379
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>192.168.32.137:6379 (46b54e82...) -&gt; 0 keys | 5462 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.140:6379 (f49ca2e5...) -&gt; 0 keys | 5461 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.132:6379 (658dd91e...) -&gt; 0 keys | 5461 slots | 1 slaves.
</span></span><span style="display:flex;"><span>[OK] 0 keys in 3 masters.
</span></span><span style="display:flex;"><span>0.00 keys per slot on average.
</span></span><span style="display:flex;"><span>[root@centos8 ~]# 
</span></span></code></pre></div></li>
</ul>
<h4 id="æŸ¥çœ‹å¯¹åº”å…³ç³»">æŸ¥çœ‹å¯¹åº”å…³ç³»<a hidden class="anchor" aria-hidden="true" href="#æŸ¥çœ‹å¯¹åº”å…³ç³»">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -a 123456 CLUSTER NODES
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379@16379 slave f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 0 1671364792207 3 connected
</span></span><span style="display:flex;"><span>658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379@16379 myself,master - 0 1671364792000 1 connected 0-5460
</span></span><span style="display:flex;"><span>f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379@16379 master - 0 1671364792000 3 connected 10923-16383
</span></span><span style="display:flex;"><span>46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379@16379 master - 0 1671364793216 2 connected 5461-10922
</span></span><span style="display:flex;"><span>f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379@16379 slave 658dd91e4b51bf06b161e6903d4084c77abd195d 0 1671364793000 1 connected
</span></span><span style="display:flex;"><span>eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379@16379 slave 46b54e8298e11e77450e232c9a0ee057b362191a 0 1671364792000 2 connected
</span></span><span style="display:flex;"><span>[root@centos8 ~]# 
</span></span></code></pre></div><h4 id="æµ‹è¯•é›†ç¾¤å†™å…¥æ•°æ®">æµ‹è¯•é›†ç¾¤å†™å…¥æ•°æ®<a hidden class="anchor" aria-hidden="true" href="#æµ‹è¯•é›†ç¾¤å†™å…¥æ•°æ®">#</a></h4>
<p><img loading="lazy" src="/posts.images/image.assets/1671364901011.png" alt="1671364901011"  />
</p>
<ul>
<li>redis cluster å†™å…¥key</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#ç»è¿‡ç®—æ³•è®¡ç®—ï¼Œå½“å‰keyçš„æ§½ä½éœ€è¦å†™å…¥æŒ‡å®šçš„node
</span></span><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -a 123456 set k1 v1
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>(error) MOVED 12706 192.168.32.140:6379  #æ§½ä½ä¸åœ¨å½“å‰nodeæ‰€ä»¥æ— æ³•å†™å…¥
</span></span><span style="display:flex;"><span>[root@centos8 ~]# 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#æŒ‡å®šæ§½ä½å¯¹åº”nodeå¯å†™å…¥
</span></span><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -h 192.168.32.140 -a 123456 set k1 v1
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>[root@centos8 ~]# 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#å¯¹åº”çš„slaveèŠ‚ç‚¹å¯ä»¥KEYS *,ä½†GET k1å¤±è´¥,å¯ä»¥åˆ°masterä¸Šæ‰§è¡ŒGET k1
</span></span><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -h 192.168.32.129 -a 123456 get k1
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>(error) MOVED 12706 192.168.32.140:6379
</span></span><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -h 192.168.32.129 -a 123456 keys &#34;*&#34;
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>1) &#34;k1&#34;
</span></span><span style="display:flex;"><span>[root@centos8 ~]# 
</span></span></code></pre></div><h2 id="redis-cluster-ç®¡ç†">Redis cluster ç®¡ç†<a hidden class="anchor" aria-hidden="true" href="#redis-cluster-ç®¡ç†">#</a></h2>
<p>é›†ç¾¤æ‰©å®¹</p>
<p>æ‰©å®¹é€‚ç”¨åœºæ™¯ï¼š
å½“å‰å®¢æˆ·é‡æ¿€å¢ï¼Œç°æœ‰çš„Redis clusteræ¶æ„å·²ç»æ— æ³•æ»¡è¶³è¶Šæ¥è¶Šé«˜çš„å¹¶å‘è®¿é—®è¯·æ±‚ï¼Œä¸ºè§£å†³æ­¤é—®é¢˜,æ–°è´­ç½®ä¸¤å°æœåŠ¡å™¨ï¼Œè¦æ±‚å°†å…¶åŠ¨æ€æ·»åŠ åˆ°ç°æœ‰é›†ç¾¤ï¼Œä½†ä¸èƒ½å½±å“ä¸šåŠ¡çš„æ­£å¸¸è®¿é—®ã€‚
æ³¨æ„: ç”Ÿäº§ç¯å¢ƒä¸€èˆ¬å»ºè®®masterèŠ‚ç‚¹ä¸ºå¥‡æ•°ä¸ª,æ¯”å¦‚:3,5,7,ä»¥é˜²æ­¢è„‘è£‚ç°è±¡</p>
<ul>
<li>æ·»åŠ èŠ‚ç‚¹å‡†å¤‡</li>
</ul>
<p>å¢åŠ Redis æ–°èŠ‚ç‚¹ï¼Œéœ€è¦ä¸ä¹‹å‰çš„Redis nodeç‰ˆæœ¬å’Œé…ç½®ä¸€è‡´ï¼Œç„¶ååˆ†åˆ«å†å¯åŠ¨ä¸¤å°Redis nodeï¼Œåº”ä¸ºä¸€ä¸»ä¸€ä»ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>192.168.32.133 ä¸»
</span></span><span style="display:flex;"><span>192.168.32.139  ä»
</span></span><span style="display:flex;"><span># ä¿®æ”¹é…ç½®æ–‡ä»¶,ä¸»ä»èŠ‚ç‚¹éƒ½ä¿®æ”¹
</span></span><span style="display:flex;"><span>sed -i.bak -e &#39;/masterauth/a masterauth 123456&#39; -e &#39;/# cluster-enabled yes/a cluster-enabled yes&#39; -e &#39;/# cluster-config-file nodes-6379.conf/a cluster-config-file nodes-6379.conf&#39; -e &#39;/cluster-require-full-coverage yes/c cluster-require-full-coverage no&#39; /usr/local/src/redis/etc/redis.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>systemctl restart redis
</span></span></code></pre></div><ul>
<li>æ·»åŠ æ–°çš„masterèŠ‚ç‚¹åˆ°é›†ç¾¤<br>
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ æ–°èŠ‚ç‚¹ï¼Œè¦æ·»åŠ çš„æ–°redisèŠ‚ç‚¹IPå’Œç«¯å£æ·»åŠ åˆ°çš„å·²æœ‰çš„é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹çš„IP:ç«¯å£</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>add-node new_host:new_port existing_host:existing_port [--slave --master-id
</span></span><span style="display:flex;"><span>&lt;arg&gt;]
</span></span><span style="display:flex;"><span>#è¯´æ˜ï¼š
</span></span><span style="display:flex;"><span>new_host:new_port #æŒ‡å®šæ–°æ·»åŠ çš„ä¸»æœºçš„IPå’Œç«¯å£
</span></span><span style="display:flex;"><span>existing_host:existing_port #æŒ‡å®šå·²æœ‰çš„é›†ç¾¤ä¸­ä»»æ„èŠ‚ç‚¹çš„IPå’Œç«¯å£
</span></span></code></pre></div><ul>
<li>Redis 3/4 ç‰ˆæœ¬çš„æ·»åŠ å‘½ä»¤ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#æŠŠæ–°çš„Redis èŠ‚ç‚¹192.168.32.133æ·»åŠ åˆ°å½“å‰Redisé›†ç¾¤å½“ä¸­ã€‚
</span></span><span style="display:flex;"><span>[root@redis-node1 ~]#redis-trib.rb add-node 192.168.32.133:6379 192.168.32.132:6379
</span></span></code></pre></div><ul>
<li>Redis 5 ä»¥ä¸Šç‰ˆæœ¬çš„æ·»åŠ å‘½ä»¤ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#å°†ä¸€å°æ–°çš„ä¸»æœºåŠ å…¥é›†ç¾¤
</span></span><span style="display:flex;"><span>[root@redis-node1 ~]#redis-cli -a 123456 --cluster add-node 192.168.32.133:6379 &lt;å½“å‰
</span></span><span style="display:flex;"><span>ä»»æ„é›†ç¾¤èŠ‚ç‚¹&gt;:6379
</span></span><span style="display:flex;"><span>[root@centos8 data]# redis-cli -a 123456 --cluster add-node 192.168.32.133:6379 192.168.32.132:6379
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Adding node 192.168.32.133:6379 to cluster 192.168.32.132:6379
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check (using node 192.168.32.132:6379)
</span></span><span style="display:flex;"><span>M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379
</span></span><span style="display:flex;"><span>   slots:[0-5460] (5461 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e
</span></span><span style="display:flex;"><span>M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379
</span></span><span style="display:flex;"><span>   slots:[10923-16383] (5461 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379
</span></span><span style="display:flex;"><span>   slots:[5461-10922] (5462 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 658dd91e4b51bf06b161e6903d4084c77abd195d
</span></span><span style="display:flex;"><span>S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 46b54e8298e11e77450e232c9a0ee057b362191a
</span></span><span style="display:flex;"><span>[OK] All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check for open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span>[OK] All 16384 slots covered.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Send CLUSTER MEET to node 192.168.32.133:6379 to make it join the cluster.
</span></span><span style="display:flex;"><span>[OK] New node added correctly.
</span></span><span style="display:flex;"><span>[root@centos8 data]# 
</span></span></code></pre></div><ul>
<li>åœ¨æ–°çš„masterä¸Šé‡æ–°åˆ†é…æ§½ä½
æ–°çš„nodeèŠ‚ç‚¹åŠ åˆ°é›†ç¾¤ä¹‹å,é»˜è®¤æ˜¯masterèŠ‚ç‚¹ï¼Œä½†æ˜¯æ²¡æœ‰slotsï¼Œéœ€è¦é‡æ–°åˆ†é…,å¦åˆ™æ²¡æœ‰æ§½ä½å°†æ— æ³•è®¿é—®
æ³¨æ„: é‡æ–°åˆ†é…æ§½ä½éœ€è¦æ¸…ç©ºæ•°æ®,æ‰€ä»¥éœ€è¦å…ˆå¤‡ä»½æ•°æ®,æ‰©å±•åå†æ¢å¤æ•°æ®
Redis 3/4 ç‰ˆæœ¬å‘½ä»¤:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@redis-node1 ~]# redis-trib.rb check 10.0.0.67:6379 #å½“å‰çŠ¶æ€
</span></span><span style="display:flex;"><span>[root@redis-node1 ~]# redis-trib.rb reshard &lt;ä»»æ„èŠ‚ç‚¹&gt;:6379 #é‡æ–°åˆ†ç‰‡
</span></span><span style="display:flex;"><span>[root@redis-node1 ~]# redis-trib.rb fix 10.0.0.67:6379 #å¦‚æœè¿ç§»å¤±è´¥ä½¿ç”¨æ­¤å‘½ä»¤ä¿®å¤é›†ç¾¤
</span></span></code></pre></div><ul>
<li>Redis 5ä»¥ä¸Šç‰ˆæœ¬å‘½ä»¤ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@redis-node1 ~]#redis-cli -a 123456 --cluster reshard &lt;å½“å‰ä»»æ„é›†ç¾¤èŠ‚ç‚¹&gt;:6379
</span></span><span style="display:flex;"><span>[root@centos8 data]# redis-cli -a 123456 --cluster reshard 192.168.32.133:6379
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check (using node 192.168.32.133:6379)
</span></span><span style="display:flex;"><span>M: 77cfc3429c8b470331520074faea7c3a21f77d1f 192.168.32.133:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) master
</span></span><span style="display:flex;"><span>S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 46b54e8298e11e77450e232c9a0ee057b362191a
</span></span><span style="display:flex;"><span>M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379
</span></span><span style="display:flex;"><span>   slots:[0-5460] (5461 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379
</span></span><span style="display:flex;"><span>   slots:[5461-10922] (5462 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e
</span></span><span style="display:flex;"><span>S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 658dd91e4b51bf06b161e6903d4084c77abd195d
</span></span><span style="display:flex;"><span>M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379
</span></span><span style="display:flex;"><span>   slots:[10923-16383] (5461 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>[OK] All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check for open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span>[OK] All 16384 slots covered.
</span></span><span style="display:flex;"><span>How many slots do you want to move (from 1 to 16384)? 4096
</span></span><span style="display:flex;"><span># å¤åˆ¶æ–°åŠ å…¥çš„èŠ‚ç‚¹çš„IDï¼Œå³192.168.32.133çš„èŠ‚ç‚¹ID
</span></span><span style="display:flex;"><span>What is the receiving node ID? 77cfc3429c8b470331520074faea7c3a21f77d1f
</span></span><span style="display:flex;"><span>Please enter all the source node IDs.
</span></span><span style="display:flex;"><span>  Type &#39;all&#39; to use all the nodes as source nodes for the hash slots.
</span></span><span style="display:flex;"><span>  Type &#39;done&#39; once you entered all the source nodes IDs.
</span></span><span style="display:flex;"><span>Source node #1: all     # é€‰æ‹©all
</span></span><span style="display:flex;"><span>Do you want to proceed with the proposed reshard plan (yes/no)? yes
</span></span></code></pre></div><ul>
<li>ä¸ºæ–°çš„masteræŒ‡å®šæ–°çš„slaveèŠ‚ç‚¹</li>
</ul>
<p>å½“å‰Redisé›†ç¾¤ä¸­æ–°çš„masterèŠ‚ç‚¹å­˜å•ç‚¹é—®é¢˜,è¿˜éœ€è¦ç»™å…¶æ·»åŠ ä¸€ä¸ªå¯¹åº”slaveèŠ‚ç‚¹ï¼Œå®ç°é«˜å¯ç”¨åŠŸèƒ½
æœ‰ä¸¤ç§æ–¹å¼ï¼š
æ–¹æ³•1ï¼šåœ¨æ–°åŠ èŠ‚ç‚¹åˆ°é›†ç¾¤æ—¶ï¼Œç›´æ¥å°†ä¹‹è®¾ç½®ä¸ºslave
Redis 3/4 æ·»åŠ å‘½ä»¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>redis-trib.rb add-node --slave --master-id
</span></span><span style="display:flex;"><span>750cab050bc81f2655ed53900fd43d2e64423333 192.168.32.139:6379 &lt;ä»»æ„é›†ç¾¤èŠ‚ç‚¹&gt;:6379
</span></span></code></pre></div><p>Redis 5 ä»¥ä¸Šç‰ˆæœ¬æ·»åŠ å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>redis-cli -a 123456 --cluster add-node 192.168.32.139:6379 &lt;ä»»æ„é›†ç¾¤èŠ‚ç‚¹&gt;:6379 --
</span></span><span style="display:flex;"><span>cluster-slave --cluster-master-id d6e2eca6b338b717923f64866bd31d42e52edc98
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># æŸ¥çœ‹å½“å‰çŠ¶æ€
</span></span><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -a 123456 --cluster check 192.168.32.132:6379
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>192.168.32.132:6379 (658dd91e...) -&gt; 0 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.133:6379 (77cfc342...) -&gt; 0 keys | 4096 slots | 0 slaves.
</span></span><span style="display:flex;"><span>192.168.32.140:6379 (f49ca2e5...) -&gt; 1 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.137:6379 (46b54e82...) -&gt; 0 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>[OK] 1 keys in 4 masters.
</span></span><span style="display:flex;"><span>0.00 keys per slot on average.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check (using node 192.168.32.132:6379)
</span></span><span style="display:flex;"><span>M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379
</span></span><span style="display:flex;"><span>   slots:[1365-5460] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>M: 77cfc3429c8b470331520074faea7c3a21f77d1f 192.168.32.133:6379
</span></span><span style="display:flex;"><span>   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master
</span></span><span style="display:flex;"><span>S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e
</span></span><span style="display:flex;"><span>M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379
</span></span><span style="display:flex;"><span>   slots:[12288-16383] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379
</span></span><span style="display:flex;"><span>   slots:[6827-10922] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 658dd91e4b51bf06b161e6903d4084c77abd195d
</span></span><span style="display:flex;"><span>S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 46b54e8298e11e77450e232c9a0ee057b362191a
</span></span><span style="display:flex;"><span>[OK] All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check for open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span>[OK] All 16384 slots covered.
</span></span><span style="display:flex;"><span>[root@centos8 ~]# 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#ç›´æ¥åŠ ä¸ºslaveèŠ‚ç‚¹
</span></span><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -a 123456 --cluster add-node 192.168.32.139:6379 192.168.32.132:6379 --cluster-slave --cluster-master-id 77cfc3429c8b470331520074faea7c3a21f77d1f
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># éªŒè¯
</span></span><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -a 123456 --cluster check 192.168.32.132:6379
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>192.168.32.132:6379 (658dd91e...) -&gt; 0 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.133:6379 (77cfc342...) -&gt; 0 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.140:6379 (f49ca2e5...) -&gt; 1 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.137:6379 (46b54e82...) -&gt; 0 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>[OK] 1 keys in 4 masters.
</span></span><span style="display:flex;"><span>0.00 keys per slot on average.
</span></span></code></pre></div><p>é›†ç¾¤ç¼©å®¹</p>
<p>ç¼©å®¹é€‚ç”¨åœºæ™¯ï¼š
éšç€ä¸šåŠ¡èç¼©ç”¨æˆ·é‡ä¸‹é™æ˜æ˜¾,å’Œé¢†å¯¼å•†é‡å†³å®šå°†ç°æœ‰Redisé›†ç¾¤çš„8å°ä¸»æœºä¸­ä¸‹çº¿ä¸¤å°ä¸»æœºæŒªåšå®ƒç”¨,ç¼©å®¹åæ€§èƒ½ä»èƒ½æ»¡è¶³å½“å‰ä¸šåŠ¡éœ€æ±‚
åˆ é™¤èŠ‚ç‚¹è¿‡ç¨‹ï¼š
æ‰©å®¹æ—¶æ˜¯å…ˆæ·»åŠ nodeåˆ°é›†ç¾¤ï¼Œç„¶åå†åˆ†é…æ§½ä½ï¼Œè€Œç¼©å®¹æ—¶çš„æ“ä½œç›¸åï¼Œæ˜¯å…ˆå°†è¢«è¦åˆ é™¤çš„nodeä¸Šçš„æ§½ä½è¿ç§»åˆ°é›†ç¾¤ä¸­çš„å…¶ä»–nodeä¸Šï¼Œç„¶å æ‰èƒ½å†å°†å…¶ä»é›†ç¾¤ä¸­åˆ é™¤ï¼Œå¦‚æœä¸€ä¸ªnodeä¸Šçš„æ§½ä½æ²¡æœ‰è¢«å®Œå…¨è¿ç§»ç©ºï¼Œåˆ é™¤è¯¥nodeæ—¶ä¹Ÿä¼šæç¤ºæœ‰æ•°æ®å‡ºé”™å¯¼è‡´æ— æ³•åˆ é™¤ã€‚</p>
<p>è¿ç§»è¦åˆ é™¤çš„masterèŠ‚ç‚¹ä¸Šé¢çš„æ§½ä½åˆ°å…¶å®ƒmaster
æ³¨æ„: è¢«è¿ç§»Redis masteræºæœåŠ¡å™¨å¿…é¡»ä¿è¯æ²¡æœ‰æ•°æ®ï¼Œå¦åˆ™è¿ç§»æŠ¥é”™å¹¶ä¼šè¢«å¼ºåˆ¶ä¸­æ–­ã€‚
Redis 3/4 ç‰ˆæœ¬å‘½ä»¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@redis-node1 ~]# redis-trib.rb reshard 10.0.0.8:6379
</span></span><span style="display:flex;"><span>[root@redis-node1 ~]# redis-trib.rb fix 10.0.0.8:6379 #å¦‚æœè¿ç§»å¤±è´¥ä½¿ç”¨æ­¤å‘½ä»¤ä¿®å¤é›†ç¾¤
</span></span></code></pre></div><p>Redis 5ç‰ˆæœ¬ä»¥ä¸Šå‘½ä»¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># æŸ¥çœ‹å½“å‰çŠ¶æ€
</span></span><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -a 123456 --cluster check 192.168.32.132:6379
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>192.168.32.132:6379 (658dd91e...) -&gt; 0 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.133:6379 (77cfc342...) -&gt; 0 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.140:6379 (f49ca2e5...) -&gt; 1 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.137:6379 (46b54e82...) -&gt; 0 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>[OK] 1 keys in 4 masters.
</span></span><span style="display:flex;"><span>0.00 keys per slot on average.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check (using node 192.168.32.132:6379)
</span></span><span style="display:flex;"><span>M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379
</span></span><span style="display:flex;"><span>   slots:[1365-5460] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>M: 77cfc3429c8b470331520074faea7c3a21f77d1f 192.168.32.133:6379
</span></span><span style="display:flex;"><span>   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e
</span></span><span style="display:flex;"><span>M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379
</span></span><span style="display:flex;"><span>   slots:[12288-16383] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379
</span></span><span style="display:flex;"><span>   slots:[6827-10922] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 658dd91e4b51bf06b161e6903d4084c77abd195d
</span></span><span style="display:flex;"><span>S: a44914056fd3a170850ad572c0e238b499455897 192.168.32.139:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 77cfc3429c8b470331520074faea7c3a21f77d1f
</span></span><span style="display:flex;"><span>S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 46b54e8298e11e77450e232c9a0ee057b362191a
</span></span><span style="display:flex;"><span>[OK] All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check for open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span>[OK] All 16384 slots covered.
</span></span><span style="display:flex;"><span>[root@centos8 ~]# 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#è¿æ¥åˆ°ä»»æ„é›†ç¾¤èŠ‚ç‚¹ï¼Œ#æœ€å1365ä¸ªslotä»192.168.32.133ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªmasterèŠ‚ç‚¹192.168.32.132ä¸Š
</span></span><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -a 123456 --cluster reshard 192.168.32.132:6379
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check (using node 192.168.32.132:6379)
</span></span><span style="display:flex;"><span>M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379
</span></span><span style="display:flex;"><span>   slots:[1365-5460] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>M: 77cfc3429c8b470331520074faea7c3a21f77d1f 192.168.32.133:6379
</span></span><span style="display:flex;"><span>   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e
</span></span><span style="display:flex;"><span>M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379
</span></span><span style="display:flex;"><span>   slots:[12288-16383] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379
</span></span><span style="display:flex;"><span>   slots:[6827-10922] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 658dd91e4b51bf06b161e6903d4084c77abd195d
</span></span><span style="display:flex;"><span>S: a44914056fd3a170850ad572c0e238b499455897 192.168.32.139:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 77cfc3429c8b470331520074faea7c3a21f77d1f
</span></span><span style="display:flex;"><span>S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 46b54e8298e11e77450e232c9a0ee057b362191a
</span></span><span style="display:flex;"><span>[OK] All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check for open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span>[OK] All 16384 slots covered.
</span></span><span style="display:flex;"><span>How many slots do you want to move (from 1 to 16384)? 1356 #å…±4096/3åˆ†åˆ«ç»™å…¶å®ƒä¸‰ä¸ªmasterèŠ‚ç‚¹
</span></span><span style="display:flex;"><span>What is the receiving node ID? 658dd91e4b51bf06b161e6903d4084c77abd195d # master id
</span></span><span style="display:flex;"><span>Please enter all the source node IDs.
</span></span><span style="display:flex;"><span>  Type &#39;all&#39; to use all the nodes as source nodes for the hash slots.
</span></span><span style="display:flex;"><span>  Type &#39;done&#39; once you entered all the source nodes IDs.
</span></span><span style="display:flex;"><span>Source node #1: 77cfc3429c8b470331520074faea7c3a21f77d1f  # åˆ é™¤IDï¼Œ192.168.32.133çš„ID
</span></span><span style="display:flex;"><span>Source node #2: done
</span></span><span style="display:flex;"><span>Do you want to proceed with the proposed reshard plan (yes/no)? yes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># redis-cli -a 123456 --cluster reshard 192.168.32.132:6379 è¯¥å‘½ä»¤åœ¨æ‰§è¡Œä¸¤æ¬¡
</span></span></code></pre></div><ul>
<li>ä»é›†ç¾¤ä¸­åˆ é™¤æœåŠ¡å™¨</li>
</ul>
<p>ä¸Šé¢æ­¥éª¤å®Œæˆå,æ§½ä½å·²ç»è¿ç§»èµ°ï¼Œä½†æ˜¯èŠ‚ç‚¹ä»ç„¶è¿˜å±äºé›†ç¾¤æˆå‘˜ï¼Œå› æ­¤è¿˜éœ€ä»é›†ç¾¤åˆ é™¤è¯¥èŠ‚ç‚¹
æ³¨æ„: åˆ é™¤æœåŠ¡å™¨å‰,å¿…é¡»æ¸…é™¤ä¸»æœºä¸Šé¢çš„æ§½ä½,å¦åˆ™ä¼šåˆ é™¤ä¸»æœºå¤±è´¥
Redis 3/4å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@s~]#redis-trib.rb del-node &lt;ä»»æ„é›†ç¾¤èŠ‚ç‚¹çš„IP&gt;:6379
</span></span><span style="display:flex;"><span>dfffc371085859f2858730e1f350e9167e287073
</span></span><span style="display:flex;"><span>#dfffc371085859f2858730e1f350e9167e287073 æ˜¯åˆ é™¤èŠ‚ç‚¹çš„ID
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Removing node dfffc371085859f2858730e1f350e9167e287073 from cluster
</span></span><span style="display:flex;"><span>192.168.7.102:6379
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Sending CLUSTER FORGET messages to the cluster...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; SHUTDOWN the node.
</span></span></code></pre></div><p>Redis 5ä»¥ä¸Šç‰ˆæœ¬å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@redis-node1 ~]#redis-cli -a 123456 --cluster del-node &lt;ä»»æ„é›†ç¾¤èŠ‚ç‚¹çš„IP&gt;:6379
</span></span><span style="display:flex;"><span>cb028b83f9dc463d732f6e76ca6bbcd469d948a7
</span></span><span style="display:flex;"><span>#cb028b83f9dc463d732f6e76ca6bbcd469d948a7æ˜¯åˆ é™¤èŠ‚ç‚¹çš„ID
</span></span></code></pre></div><p>èŒƒä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯
</span></span><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -a 123456 --cluster check 192.168.32.132:6379
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>192.168.32.132:6379 (658dd91e...) -&gt; 0 keys | 8164 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.133:6379 (77cfc342...) -&gt; 0 keys | 28 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.140:6379 (f49ca2e5...) -&gt; 1 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>192.168.32.137:6379 (46b54e82...) -&gt; 0 keys | 4096 slots | 1 slaves.
</span></span><span style="display:flex;"><span>[OK] 1 keys in 4 masters.
</span></span><span style="display:flex;"><span>0.00 keys per slot on average.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Performing Cluster Check (using node 192.168.32.132:6379)
</span></span><span style="display:flex;"><span>M: 658dd91e4b51bf06b161e6903d4084c77abd195d 192.168.32.132:6379
</span></span><span style="display:flex;"><span>   slots:[0-6826],[10923-12259] (8164 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>M: 77cfc3429c8b470331520074faea7c3a21f77d1f 192.168.32.133:6379
</span></span><span style="display:flex;"><span>   slots:[12260-12287] (28 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>S: ba4bb2dc1f4550e8602f500f1e0021896e78bf54 192.168.32.129:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates f49ca2e55dae53fa0a069ea9e1d35a31ee62731e
</span></span><span style="display:flex;"><span>M: f49ca2e55dae53fa0a069ea9e1d35a31ee62731e 192.168.32.140:6379
</span></span><span style="display:flex;"><span>   slots:[12288-16383] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>M: 46b54e8298e11e77450e232c9a0ee057b362191a 192.168.32.137:6379
</span></span><span style="display:flex;"><span>   slots:[6827-10922] (4096 slots) master
</span></span><span style="display:flex;"><span>   1 additional replica(s)
</span></span><span style="display:flex;"><span>S: f720a02fee9c4826d08258b740de008040cf80c5 192.168.32.136:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 658dd91e4b51bf06b161e6903d4084c77abd195d
</span></span><span style="display:flex;"><span>S: a44914056fd3a170850ad572c0e238b499455897 192.168.32.139:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 77cfc3429c8b470331520074faea7c3a21f77d1f
</span></span><span style="display:flex;"><span>S: eec71072ab8ad4068b4604f7196d881f9b5363e0 192.168.32.138:6379
</span></span><span style="display:flex;"><span>   slots: (0 slots) slave
</span></span><span style="display:flex;"><span>   replicates 46b54e8298e11e77450e232c9a0ee057b362191a
</span></span><span style="display:flex;"><span>[OK] All nodes agree about slots configuration.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check for open slots...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Check slots coverage...
</span></span><span style="display:flex;"><span>[OK] All 16384 slots covered.
</span></span><span style="display:flex;"><span>[root@centos8 ~]# 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># åˆ é™¤192.168.32.133èŠ‚ç‚¹
</span></span><span style="display:flex;"><span>[root@centos8 ~]# redis-cli -a 123456 --cluster del-node 192.168.32.132:6379 77cfc3429c8b470331520074faea7c3a21f77d1f
</span></span><span style="display:flex;"><span>Warning: Using a password with &#39;-a&#39; or &#39;-u&#39; option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Removing node 77cfc3429c8b470331520074faea7c3a21f77d1f from cluster 192.168.32.132:6379
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Sending CLUSTER FORGET messages to the cluster...
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; Sending CLUSTER RESET SOFT to the deleted node.
</span></span><span style="display:flex;"><span>[root@centos8 ~]# 
</span></span></code></pre></div><h2 id="å¸¸è§é¢è¯•é¢˜">å¸¸è§é¢è¯•é¢˜<a hidden class="anchor" aria-hidden="true" href="#å¸¸è§é¢è¯•é¢˜">#</a></h2>
<ul>
<li>Redis åšä»€ä¹ˆçš„,å³åœ¨å“ªäº›åœºæ™¯ä¸‹ä½¿ç”¨</li>
<li>å¦‚æœç›‘æ§ Redis æ˜¯å¦å‡ºç°æ•…éšœ</li>
<li>Rediså®¢æˆ·ç«¯timeoutæŠ¥é”™çªç„¶å¢åŠ ï¼Œæ’æŸ¥æ€è·¯æ˜¯æ€æ ·çš„ï¼Ÿ</li>
<li>è¯·ç®€å•æè¿°pipelineåŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆpipelineåŠŸèƒ½ä¼šæå‡redisæ€§èƒ½?</li>
<li>æœ¬åœ°redis-clientè®¿é—®è¿œç¨‹RedisæœåŠ¡å‡ºé”™ï¼Œè¯´å‡ºå‡ ç§å¸¸è§çš„é”™è¯¯?</li>
<li>key-valueçš„å¤§å°è¶…å¤§æˆ–å•keyçš„qpsè¶…é«˜ï¼Œä¼šå¯¹Redisæœ¬èº«é€ æˆä»€ä¹ˆæ ·çš„å½±å“ã€ä¼šå¯¹è®¿é—®Redisçš„å…¶ä»–å®¢æˆ·ç«¯é€ æˆä»€ä¹ˆæ ·çš„å½±å“ï¼Ÿ</li>
<li>Zabbix ç›‘æ§ Redis å“ªäº›ç›‘æ§é¡¹</li>
<li>RDBå’ŒAOFæŒä¹…åŒ–åŒºåˆ«</li>
<li>dockeræ‹‰å–ä¸€ä¸ªRediså¦‚ä½•å®ç°æ•°æ®æŒä¹…åŒ–ä¿å­˜</li>
<li>Redis æ”¯æŒå“ªäº›æ•°æ®ç±»å‹</li>
<li>Redis å¦‚ä½•å®ç°æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>æè¿°ä¸‹å¸¸è§çš„redisé›†ç¾¤æ¶æ„æœ‰å“ªäº›ï¼Œä»–ä»¬ä¹‹é—´çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”</li>
<li>ä¸»ä»å¤åˆ¶å·¥ä½œåŸç†</li>
<li>Redis å¦‚ä½•å®ç°é«˜å¯ç”¨</li>
<li>å“¨å…µå·¥ä½œåŸç†</li>
<li>Redis é›†ç¾¤çš„å·¥ä½œåŸç†</li>
<li>Redis é›†ç¾¤å¦‚æœé¿å…è„‘è£‚</li>
<li>Redis é›†ç¾¤æœ€å°‘å‡ ä¸ªèŠ‚ç‚¹ä¸ºä»€ä¹ˆ?</li>
<li>Redisçš„é›†ç¾¤æ§½ä½å¤šå°‘ä¸ª</li>
<li>Redisé›†ç¾¤ä¸­æŸä¸ªèŠ‚ç‚¹ç¼ºå°‘ä¸€ä¸ªæ§½ä½æ˜¯å¦èƒ½ä½¿ç”¨</li>
<li>Redisæ•°æ®å†™å…¥çš„æ—¶å€™æ˜¯æ€ä¹ˆåœ¨å„ä¸ªèŠ‚ç‚¹æ§½ä½åˆ†é…æ•°æ®çš„</li>
<li>Redisçš„æ•°æ®å­˜å‚¨æ˜¯ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼å­˜å‚¨</li>
<li>Redisé›†ç¾¤çš„å„æ§½ä½å’Œæ€»æ§½ä½ä¹‹é—´ä»€ä¹ˆå…³ç³»</li>
</ul>


        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://colorfulgz.com/posts/centos%E7%B3%BB%E7%BB%9Fyum%E9%85%8D%E7%BD%AE/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>Centosç³»ç»Ÿyumæºé…ç½®</span>
  </a>
  <a class="next" href="https://colorfulgz.com/posts/redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>Rediséƒ¨ç½²å’ŒåŸºç¡€ä½¿ç”¨</span>
  </a>
</nav>

        </footer>
    </div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        2022-2023
        <a href="https://colorfulgz.com" style="color:#939393;">DevOpsHub</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;">é»”ICPå¤‡2023014549å·</a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="/img/beian.png" style="float:left;margin: 0px 5px 0px 0px;"/>
            ç²¤å…¬ç½‘å®‰å¤‡44030002001370å·
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"DevOpsHub"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"DevOpsHub"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'ğŸ“„å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'ğŸ‘ŒğŸ»å·²å¤åˆ¶!';
            setTimeout(() => {
                copybutton.innerText = 'ğŸ“„å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"DevOpsHub"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>
</body>

</html>
