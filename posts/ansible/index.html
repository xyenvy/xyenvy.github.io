<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(ä¸€) | DevOpsHub</title>
<meta name="keywords" content="Ansible">
<meta name="description" content="Ansible çš„åç§°æ¥è‡ªç§‘å¹»å°è¯´ã€Šå®‰å¾·çš„æ¸¸æˆã€‹ä¸­è·¨è¶Šæ—¶ç©ºçš„å³æ—¶é€šä¿¡å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ç›¸è·æ•°å…‰å¹´çš„è·ç¦»,è¿œç¨‹å®æ—¶æ§åˆ¶å‰çº¿çš„èˆ°é˜Ÿæˆ˜æ–—">
<meta name="author" content="">
<link rel="canonical" href="https://colorfulgz.com/posts/ansible/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://colorfulgz.com/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://colorfulgz.com/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://colorfulgz.com/img/Q.gif">
<link rel="apple-touch-icon" href="https://colorfulgz.com/img/Q.gif">
<link rel="mask-icon" href="https://colorfulgz.com/img/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>


<link rel="stylesheet" href="./font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="./jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(ä¸€)" />
<meta property="og:description" content="Ansible çš„åç§°æ¥è‡ªç§‘å¹»å°è¯´ã€Šå®‰å¾·çš„æ¸¸æˆã€‹ä¸­è·¨è¶Šæ—¶ç©ºçš„å³æ—¶é€šä¿¡å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ç›¸è·æ•°å…‰å¹´çš„è·ç¦»,è¿œç¨‹å®æ—¶æ§åˆ¶å‰çº¿çš„èˆ°é˜Ÿæˆ˜æ–—" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://colorfulgz.com/posts/ansible/" />
<meta property="og:image" content="https://colorfulgz.com/posts.images/banner/8.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-21T19:12:21+00:00" />
<meta property="article:modified_time" content="2023-02-21T19:12:21+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://colorfulgz.com/posts.images/banner/8.jpg" />
<meta name="twitter:title" content="è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(ä¸€)"/>
<meta name="twitter:description" content="Ansible çš„åç§°æ¥è‡ªç§‘å¹»å°è¯´ã€Šå®‰å¾·çš„æ¸¸æˆã€‹ä¸­è·¨è¶Šæ—¶ç©ºçš„å³æ—¶é€šä¿¡å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ç›¸è·æ•°å…‰å¹´çš„è·ç¦»,è¿œç¨‹å®æ—¶æ§åˆ¶å‰çº¿çš„èˆ°é˜Ÿæˆ˜æ–—"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "ğŸ“šæ–‡ç« ",
          "item": "https://colorfulgz.com/posts/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(ä¸€)",
      "item": "https://colorfulgz.com/posts/ansible/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(ä¸€)",
  "name": "è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(ä¸€)",
  "description": "Ansible çš„åç§°æ¥è‡ªç§‘å¹»å°è¯´ã€Šå®‰å¾·çš„æ¸¸æˆã€‹ä¸­è·¨è¶Šæ—¶ç©ºçš„å³æ—¶é€šä¿¡å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ç›¸è·æ•°å…‰å¹´çš„è·ç¦»,è¿œç¨‹å®æ—¶æ§åˆ¶å‰çº¿çš„èˆ°é˜Ÿæˆ˜æ–—",
  "keywords": [
    "Ansible"
  ],
  "articleBody": "Ansibleä»‹ç»å’Œæ¶æ„ Ansibleå‘å±•å² Ansible çš„åç§°æ¥è‡ªç§‘å¹»å°è¯´ã€Šå®‰å¾·çš„æ¸¸æˆã€‹ä¸­è·¨è¶Šæ—¶ç©ºçš„å³æ—¶é€šä¿¡å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ç›¸è·æ•°å…‰å¹´çš„è·ç¦»ï¼Œè¿œç¨‹å®æ—¶æ§åˆ¶å‰çº¿çš„èˆ°é˜Ÿæˆ˜æ–— 2012-03-09ï¼Œå‘å¸ƒ0.0.1ç‰ˆï¼Œ2015-10-17ï¼ŒRed Hatå®£å¸ƒ1.5äº¿ç¾å…ƒæ”¶è´­ å®˜ç½‘ï¼š å®˜æ–¹æ–‡æ¡£ï¼š\nAnsible åŠŸèƒ½ æ‰¹é‡æ‰§è¡Œè¿œç¨‹å‘½ä»¤,å¯ä»¥å¯¹è¿œç¨‹çš„å¤šå°ä¸»æœºåŒæ—¶è¿›è¡Œå‘½ä»¤çš„æ‰§è¡Œ æ‰¹é‡å®‰è£…å’Œé…ç½®è½¯ä»¶æœåŠ¡ï¼Œå¯ä»¥å¯¹è¿œç¨‹çš„å¤šå°ä¸»æœºè¿›è¡Œè‡ªåŠ¨åŒ–çš„æ–¹å¼é…ç½®å’Œç®¡ç†å„ç§æœåŠ¡ ç¼–æ’é«˜çº§çš„ä¼ä¸šçº§å¤æ‚çš„ITæ¶æ„ä»»åŠ¡, Ansibleçš„Playbookå’Œroleå¯ä»¥è½»æ¾å®ç°å¤§å‹çš„ITå¤æ‚æ¶æ„ æä¾›è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·çš„å¼€å‘API, æœ‰å¾ˆå¤šè¿ç»´å·¥å…·,å¦‚jumpserverå°±æ˜¯åŸºäº ansible å®ç°è‡ªåŠ¨åŒ–ç®¡å·¥åŠŸèƒ½ Ansible ç‰¹ç‚¹ ä¼˜ç‚¹\nåŠŸèƒ½ä¸°å¯Œçš„æ¨¡å—ï¼šæä¾›äº†å¤šè¾¾æ•°åƒä¸ªçš„å„ç§åŠŸèƒ½çš„æ¨¡å—,å®Œæˆç‰¹å®šä»»åŠ¡åªéœ€è°ƒç”¨ç‰¹å®šæ¨¡å—å³å¯ï¼Œè¿˜ æ”¯æŒè‡ªå®šä¹‰æ¨¡å—ï¼Œå¯ä½¿ç”¨ä»»ä½•ç¼–ç¨‹è¯­è¨€å†™æ¨¡å— ä½¿ç”¨å’Œéƒ¨ç½²ç®€å•: æ— éœ€å®‰è£…ä¸“ç”¨ä»£ç†è½¯ä»¶,åŸºäºpythonå’ŒSSH(é»˜è®¤å·²å®‰è£…)å®ç° å®‰å…¨: åŸºäºOpenSSHå®ç°å®‰å…¨é€šè®¯æ— éœ€ä¸“ç”¨åè®® å¹‚ç­‰æ€§ï¼šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œ1éå’Œæ‰§è¡Œnéæ•ˆæœä¸€æ ·ï¼Œä¸å› é‡å¤æ‰§è¡Œå¸¦æ¥æ„å¤–æƒ…å†µ,æ­¤ç‰¹æ€§å’Œæ¨¡å—æœ‰å…³ æ”¯æŒplaybookç¼–æ’ä»»åŠ¡ï¼ŒYAMLæ ¼å¼ï¼Œç¼–æ’ä»»åŠ¡ï¼Œæ”¯æŒä¸°å¯Œçš„æ•°æ®ç»“æ„ è¾ƒå¼ºå¤§çš„å¤šå±‚è§£å†³æ–¹æ¡ˆ Role Pythonè¯­è¨€å®ç°, åŸºäºParamikoï¼ˆpythonå¯¹sshçš„å®ç°ï¼‰ï¼ŒPyYAMLï¼ŒJinja2ï¼ˆæ¨¡æ¿è¯­è¨€ï¼‰ä¸‰ä¸ªå…³é”®æ¨¡å— å±äºçº¢å¸½(IBM)å…¬å¸äº§å“,èƒŒæ™¯å¼ºå¤§,æœªæ¥å‘å±•å‰æ™¯å…‰æ˜ ç¼ºç‚¹\nå¦‚æœç®¡ç†çš„ä¸»æœºè¾ƒå¤šæ—¶,æ‰§è¡Œæ•ˆç‡ä¸å¦‚saltstacké«˜ å½“å‰è¿˜ä¸æ”¯æŒåƒMySQLæ•°æ®åº“ä¸€æ ·çš„äº‹åŠ¡å›æ»š Ansible æ¶æ„ Ansible ç»„æˆ ç»„åˆINVENTORYã€APIã€MODULESã€PLUGINSçš„ç»¿æ¡†ï¼Œä¸ºansibleå‘½ä»¤å·¥å…·ï¼Œå…¶ä¸ºæ ¸å¿ƒæ‰§è¡Œå·¥å…·\nINVENTORYï¼šAnsibleç®¡ç†ä¸»æœºçš„æ¸…å•æ–‡ä»¶,é»˜è®¤ä¸º /etc/ansible/hosts MODULESï¼šAnsibleæ‰§è¡Œå‘½ä»¤çš„åŠŸèƒ½æ¨¡å—ï¼Œå¤šæ•°ä¸ºå†…ç½®æ ¸å¿ƒæ¨¡å—ï¼Œä¹Ÿå¯è‡ªå®šä¹‰ PLUGINSï¼šæ¨¡å—åŠŸèƒ½çš„è¡¥å……ï¼Œå¦‚è¿æ¥ç±»å‹æ’ä»¶ã€å¾ªç¯æ’ä»¶ã€å˜é‡æ’ä»¶ã€è¿‡æ»¤æ’ä»¶ç­‰ï¼Œè¯¥åŠŸèƒ½ä¸å¸¸ç”¨ APIï¼šä¾›ç¬¬ä¸‰æ–¹ç¨‹åºè°ƒç”¨çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ Ansible å‘½ä»¤æ‰§è¡Œæ¥æº USER æ™®é€šç”¨æˆ·ï¼Œå³SYSTEM ADMINISTRATOR PLAYBOOKSï¼šä»»åŠ¡å‰§æœ¬ï¼ˆä»»åŠ¡é›†ï¼‰ï¼Œç¼–æ’å®šä¹‰Ansibleä»»åŠ¡é›†çš„é…ç½®æ–‡ä»¶ï¼Œç”±Ansibleé¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œé€šå¸¸æ˜¯JSONæ ¼å¼çš„YMLæ–‡ä»¶ CMDBï¼ˆé…ç½®ç®¡ç†æ•°æ®åº“ï¼‰ API è°ƒç”¨ PUBLIC/PRIVATE CLOUD APIè°ƒç”¨ USER-\u003e Ansible Playbook -\u003e Ansibile æ³¨æ„äº‹é¡¹ æ‰§è¡Œansibleçš„ä¸»æœºä¸€èˆ¬ç§°ä¸ºç®¡ç†ç«¯, ä¸»æ§ç«¯ï¼Œä¸­æ§ï¼Œmasteræˆ–å ¡å’æœº ä¸»æ§ç«¯Pythonç‰ˆæœ¬éœ€è¦2.6æˆ–ä»¥ä¸Š è¢«æ§ç«¯Pythonç‰ˆæœ¬å°äº2.4ï¼Œéœ€è¦å®‰è£…python-simplejson è¢«æ§ç«¯å¦‚å¼€å¯SELinuxéœ€è¦å®‰è£…libselinux-python windows ä¸èƒ½åšä¸ºä¸»æ§ç«¯,åªèƒ½åšä¸ºè¢«æ§åˆ¶ç«¯ Ansible å®‰è£…å’Œå¸¸è§æ¨¡å— Ansible å®‰è£… ansibleçš„å®‰è£…æ–¹æ³•æœ‰å¤šç§ å®˜æ–¹æ–‡æ¡£\nhttps://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html https://docs.ansible.com/ansible/latest/installation_guide/index.html ä¸‹è½½\nhttps://releases.ansible.com/ansible/ pip ä¸‹è½½\nhttps://pypi.org/project/ansible/ åŒ…å®‰è£…æ–¹å¼ #CentOS çš„EPELæºçš„rpmåŒ…å®‰è£… [root@centos ~]#yum install ansible #ubuntu å®‰è£… [root@ubuntu ~]#apt -y install ansible pipå®‰è£… pip æ˜¯å®‰è£…PythonåŒ…çš„ç®¡ç†å™¨ï¼Œç±»ä¼¼ yum èŒƒä¾‹: åœ¨rocky8ä¸Šé€šè¿‡pip3å®‰è£…ansible\n[root@rocky8 ~]#yum -y install python39 rust [root@rocky8 ~]#pip3 install ansible [root@rocky8 ~]#ansible --version ansible [core 2.12.6] config file = None configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/lib/python3.9/site-packages/ansible ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections executable location = /usr/bin/ansible python version = 3.9.6 (default, Nov 9 2021, 13:31:27) [GCC 8.5.0 20210514 (Red Hat 8.5.0-3)] jinja version = 3.1.2 libyaml = True [root@rocky8 ~]#ansible-doc -l 2\u003e /dev/null|wc -l 6763 èŒƒä¾‹: å®‰è£…python3.8 æ”¯æŒansible2.12ä»¥ä¸Šç‰ˆæœ¬\n[root@rocky8 ~]#yum -y install python38 python38-pip [root@rocky8 ~]#pip3 install --upgrade pip -i https://pypi.douban.com/simple [root@rocky8 ~]#pip3 install ansible -i https://pypi.douban.com/simple/ [root@rocky8 ~]#ansible --version ansible [core 2.12.6] config file = None configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/local/lib/python3.8/site- packages/ansible ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections executable location = /usr/local/bin/ansible python version = 3.8.8 (default, Nov 9 2021, 13:31:34) [GCC 8.5.0 20210514 (Red Hat 8.5.0-3)] jinja version = 3.1.2 libyaml = True èŒƒä¾‹: å®‰è£…é»˜è®¤çš„python3.6ç‰ˆæœ¬ä¼šæœ‰è­¦æŠ¥æç¤º\n[root@rocky8 ~]#yum -y install python3 [root@rocky8 ~]#pip3 install --upgrade pip -i https://pypi.douban.com/simple [root@rocky8 ~]#pip3 install ansible -i https://pypi.douban.com/simple/ [root@rocky8 ~]#ansible --version [DEPRECATION WARNING]: Ansible will require Python 3.8 or newer on the controller starting with Ansible 2.12. Current version: 3.6.8 (default, Nov 9 2021, 14:44:26) [GCC 8.5.0 20210514 (Red Hat 8.5.0-3)]. This feature will be removed from ansible-core in version 2.12. Deprecation warnings can be disabled by setting deprecation_warnings=False in ansible.cfg. /usr/local/lib/python3.6/site-packages/ansible/parsing/vault/__init__.py:44: CryptographyDeprecationWarning: Python 3.6 is no longer supported by the Python core team. Therefore, support for it is deprecated in cryptography and will be removed in a future release. from cryptography.exceptions import InvalidSignature ansible [core 2.11.12] config file = None configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/local/lib/python3.6/site- packages/ansible ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections executable location = /usr/local/bin/ansible python version = 3.6.8 (default, Nov 9 2021, 14:44:26) [GCC 8.5.0 20210514 (Red Hat 8.5.0-3)] jinja version = 3.0.3 libyaml = True [root@rocky8 ~]#ansible-doc -l 2\u003e /dev/null|wc -l 6141 èŒƒä¾‹\n[root@centos7 ~]#yum -y install python-pip [root@centos7 ~]#pip install --upgrade pip [root@centos7 ~]#pip install ansible --upgrade [root@centos7 ~]#ansible --version /usr/lib64/python2.7/site-packages/cryptography/__init__.py:39: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in a future release. CryptographyDeprecationWarning, ansible 2.9.12 config file = None configured module search path = [u'/root/.ansible/plugins/modules', u'/usr/share/ansible/plugins/modules'] ansible python module location = /usr/lib/python2.7/site-packages/ansible executable location = /usr/bin/ansible python version = 2.7.5 (default, Apr 2 2020, 13:16:51) [GCC 4.8.5 20150623 (Red Hat 4.8.5-39)] [root@centos7 ~]#ll /opt/etc/ansible/ansible.cfg -rw-r--r-- 1 wang bin 19980 Aug 11 21:34 /opt/etc/ansible/ansible.cfg ç¡®è®¤å®‰è£… [root@ansible ~]#ansible --version ansible 2.9.5 config file = /etc/ansible/ansible.cfg configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/lib/python3.6/site-packages/ansible executable location = /usr/bin/ansible python version = 3.6.8 (default, Nov 21 2019, 19:31:34) [GCC 8.3.1 20190507 (Red Hat 8.3.1-4)] Ansible ç›¸å…³æ–‡ä»¶ Ansible é…ç½®æ–‡ä»¶åˆ—è¡¨ /etc/ansible/ansible.cfg ä¸»é…ç½®æ–‡ä»¶ï¼Œé…ç½®ansibleå·¥ä½œç‰¹æ€§,ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®çš„ç›®å½•ä¸­åˆ›å»ºæ­¤æ–‡ä»¶,å½“å‰ç›®å½•ä¸‹å¦‚æœä¹Ÿæœ‰ansible.cfg,åˆ™æ­¤æ–‡ä»¶ä¼˜å…ˆç”Ÿæ•ˆ,å»ºè®®æ¯ä¸ªé¡¹ç›®ç›®å½•ä¸‹,åˆ›å»ºç‹¬æœ‰çš„ansible.cfgæ–‡ ä»¶ /etc/ansible/hosts ä¸»æœºæ¸…å• /etc/ansible/roles/ å­˜æ”¾è§’è‰²çš„ç›®å½• Ansible ä¸»é…ç½®æ–‡ä»¶ Ansible çš„é…ç½®æ–‡ä»¶å¯ä»¥æ”¾åœ¨å¤šä¸ªä¸åŒåœ°æ–¹,ä¼˜å…ˆçº§ä»é«˜åˆ°ä½é¡ºåºå¦‚ä¸‹\nANSIBLE_CONFIG #ç¯å¢ƒå˜é‡,ç›®å½•ä¸‹çš„æ–‡ä»¶å¿…é¡»å­˜åœ¨æ‰èƒ½ç”Ÿæ•ˆ ./ansible.cfg #å½“å‰ç›®å½•ä¸‹çš„ansible.cfg,ä¸€èˆ¬ä¸€ä¸ªé¡¹ç›®å¯¹åº”ä¸€ä¸ªä¸“ç”¨é…ç½®æ–‡ä»¶,æ¨èä½¿ç”¨ ~/.ansible.cfg #å½“å‰ç”¨æˆ·å®¶ç›®å½•ä¸‹çš„.ansible.cfg /etc/ansible/ansible.cfg #ç³»ç»Ÿé»˜è®¤é…ç½®æ–‡ä»¶ Ansible çš„é»˜è®¤é…ç½®æ–‡ä»¶ /etc/ansible/ansible.cfg ,å…¶ä¸­å¤§éƒ¨åˆ†çš„é…ç½®å†…å®¹æ— éœ€è¿›è¡Œä¿®æ”¹\n[defaults] #inventory = /etc/ansible/hosts #ä¸»æœºåˆ—è¡¨é…ç½®æ–‡ä»¶ #library = /usr/share/my_modules/ #åº“æ–‡ä»¶å­˜æ”¾ç›®å½• #remote_tmp = $HOME/.ansible/tmp #ä¸´æ—¶pyå‘½ä»¤æ–‡ä»¶å­˜æ”¾åœ¨è¿œç¨‹ä¸»æœºç›®å½• #local_tmp = $HOME/.ansible/tmp #æœ¬æœºçš„ä¸´æ—¶å‘½ä»¤æ‰§è¡Œç›®å½• #forks = 5 #é»˜è®¤å¹¶å‘æ•° #sudo_user = root #é»˜è®¤sudo ç”¨æˆ· #ask_sudo_pass = True #æ¯æ¬¡æ‰§è¡Œansibleå‘½ä»¤æ˜¯å¦è¯¢é—®sshå¯†ç  #ask_pass = True #remote_port = 22 #host_key_checking = False #æ£€æŸ¥å¯¹åº”æœåŠ¡å™¨çš„host_keyï¼Œå»ºè®®å–æ¶ˆæ­¤è¡Œæ³¨é‡Š,å®ç°ç¬¬ä¸€æ¬¡è¿ æ¥è‡ªåŠ¨ä¿¡ä»»ç›®æ ‡ä¸»æœº #log_path=/var/log/ansible.log #æ—¥å¿—æ–‡ä»¶ï¼Œå»ºè®®å¯ç”¨ #module_name = command #é»˜è®¤æ¨¡å—ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºshellæ¨¡å— [privilege_escalation] #æ™®é€šç”¨æˆ·ææƒé…ç½® #become=True #become_method=sudo #become_user=root #become_ask_pass=False èŒƒä¾‹: é€šè¿‡ç¯å¢ƒå˜é‡ANSIBLE_CONFIGæŒ‡å®šansibleé…ç½®æ–‡ä»¶è·¯å¾„\n[root@rocky8 ~]#cd /data/ansible/ [root@rocky8 ansible]#cat ansbile.cfg [defaults] inventory = ./hosts [root@rocky8 ansible]#cat hosts [ubuntu] 10.0.0.100 [centos] 10.0.0.7 10.0.0.8 #å®šä¹‰å˜é‡ [root@rocky8 ansible]#export ANSIBLE_CONFIG=./ansbile.cfg [root@rocky8 ansible]#ansible --version ansible [core 2.12.6] config file = /data/ansible/ansbile.cfg configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/lib/python3.9/site-packages/ansible ansible collection location = /root/.ansible/collections:/usr/share/ansible/collections executable location = /usr/bin/ansible python version = 3.9.6 (default, Nov 9 2021, 13:31:27) [GCC 8.5.0 20210514 (Red Hat 8.5.0-3)] jinja version = 3.1.2 libyaml = True [root@rocky8 ansible]#ansible --list-hosts all hosts (3): 10.0.0.100 10.0.0.7 10.0.0.8 èŒƒä¾‹: åˆ›å»ºansible æŒ‡å®šé¡¹ç›®ä¸“ç”¨çš„é…ç½®æ–‡ä»¶\n[root@ubuntu2004 ~]#ansible --version ansible 2.9.6 config file = /etc/ansible/ansible.cfg configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/lib/python3/dist-packages/ansible executable location = /usr/bin/ansible python version = 3.8.10 (default, Mar 15 2022, 12:22:08) [GCC 9.4.0] [root@ubuntu2004 ~]#mkdir /data/ansible -p [root@ubuntu2004 ~]#cd /data/ansible/ [root@ubuntu2004 ansible]#touch ansible.cfg [root@ubuntu2004 ansible]#ansible --version ansible 2.9.6 config file = /data/ansible/ansible.cfg configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/lib/python3/dist-packages/ansible executable location = /usr/bin/ansible python version = 3.8.10 (default, Mar 15 2022, 12:22:08) [GCC 9.4.0] [root@ubuntu2004 ansible]#cd [root@ubuntu2004 ~]#ansible --version ansible 2.9.6 config file = /etc/ansible/ansible.cfg configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/lib/python3/dist-packages/ansible executable location = /usr/bin/ansible python version = 3.8.10 (default, Mar 15 2022, 12:22:08) [GCC 9.4.0] èŒƒä¾‹: å½“å‰ç›®å½•ä¸‹çš„ansibleçš„é…ç½®æ–‡ä»¶ä¼˜å…ˆç”Ÿæ•ˆ\n[root@ansible ~]#ansible --version ansible 2.9.17 config file = /etc/ansible/ansible.cfg configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/lib/python3.6/site-packages/ansible executable location = /usr/bin/ansible python version = 3.6.8 (default, Apr 16 2020, 01:36:27) [GCC 8.3.1 20191121 (Red Hat 8.3.1-5)] [root@ansible ~]#cp /etc/ansible/ansible.cfg . [root@ansible ~]#ansible --version ansible 2.9.17 config file = /root/ansible.cfg #æ³¨æ„é…ç½®æ–‡ä»¶è·¯å¾„ configured module search path = ['/root/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules'] ansible python module location = /usr/lib/python3.6/site-packages/ansible executable location = /usr/bin/ansible python version = 3.6.8 (default, Apr 16 2020, 01:36:27) [GCC 8.3.1 20191121 (Red Hat 8.3.1-5)] [root@ansible ~]# Inventory ä¸»æœºæ¸…å•æ–‡ä»¶ ansibleçš„ä¸»è¦åŠŸç”¨åœ¨äºæ‰¹é‡ä¸»æœºæ“ä½œï¼Œä¸ºäº†ä¾¿æ·åœ°ä½¿ç”¨å…¶ä¸­çš„éƒ¨åˆ†ä¸»æœºï¼Œå¯ä»¥åœ¨inventory ä¸»æœºæ¸…å•æ–‡ä»¶ä¸­å°†å…¶åˆ†ç»„ç»„ç»‡ é»˜è®¤çš„inventory fileä¸º /etc/ansible/hosts inventory fileå¯ä»¥æœ‰å¤šä¸ªï¼Œä¸”ä¹Ÿå¯ä»¥é€šè¿‡Dynamic Inventoryæ¥åŠ¨æ€ç”Ÿæˆ æ³¨æ„:\nç”Ÿäº§å»ºè®®åœ¨æ¯ä¸ªé¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºé¡¹ç›®ç‹¬ç«‹çš„hostsæ–‡ä»¶ é€šè¿‡é¡¹ç›®ç›®å½•ä¸‹çš„ansible.cfgæ–‡ä»¶ä¸­çš„ inventory = ./hostså®ç° å®˜æ–¹æ–‡æ¡£:\nhttps://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html ä¸»æœºæ¸…å•æ–‡ä»¶æ ¼å¼ inventoryæ–‡ä»¶éµå¾ªINIæ–‡ä»¶é£æ ¼ï¼Œä¸­æ‹¬å·ä¸­çš„å­—ç¬¦ä¸ºç»„åã€‚å¯ä»¥å°†åŒä¸€ä¸ªä¸»æœºåŒæ—¶å½’å¹¶åˆ°å¤šä¸ªä¸åŒçš„ç»„ä¸­,æ­¤å¤–ï¼Œå½“å¦‚è‹¥ç›®æ ‡ä¸»æœºä½¿ç”¨äº†éé»˜è®¤çš„SSHç«¯å£ï¼Œè¿˜å¯ä»¥åœ¨ä¸»æœºåç§°ä¹‹åä½¿ç”¨å†’å·åŠ ç«¯å£å·æ¥æ ‡æ˜,å¦‚æœä¸»æœºåç§°éµå¾ªç›¸ä¼¼çš„å‘½åæ¨¡å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åˆ—è¡¨çš„æ–¹å¼æ ‡è¯†å„ä¸»æœº Inventory å‚æ•°è¯´æ˜\nansible_ssh_host #å°†è¦è¿æ¥çš„è¿œç¨‹ä¸»æœºå.ä¸ä½ æƒ³è¦è®¾å®šçš„ä¸»æœºçš„åˆ«åä¸åŒçš„è¯,å¯é€šè¿‡æ­¤å˜é‡è®¾ç½®. ansible_ssh_port #sshç«¯å£å·.å¦‚æœä¸æ˜¯é»˜è®¤çš„ç«¯å£å·,é€šè¿‡æ­¤å˜é‡è®¾ç½®.è¿™ç§å¯ä»¥ä½¿ç”¨ ip:ç«¯å£ 192.168.1.100:2222 ansible_ssh_user #é»˜è®¤çš„ ssh ç”¨æˆ·å ansible_ssh_pass #ssh å¯†ç (è¿™ç§æ–¹å¼å¹¶ä¸å®‰å…¨,æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨ --ask-pass æˆ– SSH å¯†é’¥) ansible_sudo_pass #sudo å¯†ç (è¿™ç§æ–¹å¼å¹¶ä¸å®‰å…¨,æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨ --ask-sudo-pass) ansible_sudo_exe (new in version 1.8) #sudo å‘½ä»¤è·¯å¾„(é€‚ç”¨äº1.8åŠä»¥ä¸Šç‰ˆæœ¬) ansible_connection #ä¸ä¸»æœºçš„è¿æ¥ç±»å‹.æ¯”å¦‚:local, ssh æˆ–è€… paramiko. Ansible 1.2 ä»¥å‰é»˜è®¤ä½¿ç”¨ paramiko.1.2 ä»¥åé»˜è®¤ä½¿ç”¨ 'smart','smart' æ–¹å¼ä¼šæ ¹æ®æ˜¯å¦æ”¯æŒ ControlPersist,æ¥åˆ¤æ–­'ssh' æ–¹å¼æ˜¯å¦å¯è¡Œ. ansible_ssh_private_key_file #ssh ä½¿ç”¨çš„ç§é’¥æ–‡ä»¶.é€‚ç”¨äºæœ‰å¤šä¸ªå¯†é’¥,è€Œä½ ä¸æƒ³ä½¿ç”¨ SSH ä»£ç†çš„æƒ…å†µ. ansible_shell_type #ç›®æ ‡ç³»ç»Ÿçš„shellç±»å‹.é»˜è®¤æƒ…å†µä¸‹,å‘½ä»¤çš„æ‰§è¡Œä½¿ç”¨ 'sh' è¯­æ³•,å¯è®¾ç½®ä¸º'csh' æˆ– 'fish'. ansible_python_interpreter #ç›®æ ‡ä¸»æœºçš„ python è·¯å¾„.é€‚ç”¨äºçš„æƒ…å†µ: ç³»ç»Ÿä¸­æœ‰å¤šä¸ª Python,æˆ–è€…å‘½ä»¤è·¯å¾„ä¸æ˜¯\"/usr/bin/python\",æ¯”å¦‚ \\*BSD, æˆ–è€… /usr/bin/python ä¸æ˜¯ 2.X ç‰ˆæœ¬çš„Python.ä¹‹æ‰€ä»¥ä¸ä½¿ç”¨ \"/usr/bin/env\" æœºåˆ¶,å› ä¸ºè¿™è¦æ±‚è¿œç¨‹ç”¨æˆ·çš„è·¯å¾„è®¾ç½®æ­£ç¡®,ä¸”è¦æ±‚ \"python\"å¯æ‰§è¡Œç¨‹åºåä¸å¯ä¸º pythonä»¥å¤–çš„åå­—(å®é™…æœ‰å¯èƒ½åä¸ºpython26).ä¸ansible_python_interpreter çš„å·¥ä½œæ–¹å¼ç›¸åŒ,å¯è®¾å®šå¦‚ ruby æˆ– perl çš„è·¯å¾„.... èŒƒä¾‹ï¼š\nntp.wang.org [webservers] www1.wang.org:2222 www2.wang.org [dbservers] db1.wang.org db2.wang.org db3.wang.org #æˆ–è€… db[1:3].wang.org èŒƒä¾‹: ç»„åµŒå¥—\n[webservers] www[1:100].example.com [dbservers] db-[a:f].example.com [appservers] 10.0.0.[1:100] #å®šä¹‰testsrvsç»„ä¸­åŒ…æ‹¬ä¸¤ä¸ªå…¶å®ƒåˆ†ç»„,å®ç°ç»„åµŒå¥— [testsrvs:children] webservers dbservers èŒƒä¾‹: åŸºäºç”¨æˆ·åå’Œå¯†ç çš„sshè¿æ¥ä¸»æœºæ¸…å•\n[test] 10.0.0.8 ansible_connection=local #æŒ‡å®šæœ¬åœ°è¿æ¥,æ— éœ€sshé…ç½® #æ¯ä¸ªä¸»æœºåˆ†åˆ«æŒ‡å®šç”¨æˆ·å’Œå¯†ç ,ansible_connection=ssh éœ€è¦StrictHostKeyChecking no æˆ–è€…host_key_checking = False 10.0.0.7 ansible_connection=ssh ansible_ssh_port=2222 ansible_ssh_user=wangansible_ssh_password=123456 10.0.0.6 ansible_ssh_user=root ansible_ssh_password=123456 #å¯¹æ¯ä¸ªåˆ†ç»„çš„æ‰€æœ‰ä¸»æœºç»Ÿä¸€å®šä¹‰ç”¨æˆ·å’Œå¯†ç ,æ‰§è¡Œansibleå‘½ä»¤æ—¶æ˜¾ç¤ºåˆ«å,å¦‚web01 [websrvs] web01 ansible_ssh_host=10.0.0.101 web02 ansible_ssh_host=10.0.0.102 [websrvs:vars] ansible_ssh_password=magedu some_host ansible_ssh_port=2222 ansible_ssh_user=manager aws_host ansible_ssh_private_key_file=/home/example/.ssh/aws.pem freebsd_host ansible_python_interpreter=/usr/local/bin/python ruby_module_host ansible_ruby_interpreter=/usr/bin/ruby.1.9.3 Ansibleç›¸å…³å·¥å…· /usr/bin/ansible ä¸»ç¨‹åºï¼Œä¸´æ—¶å‘½ä»¤æ‰§è¡Œå·¥å…·\n/usr/bin/ansible-doc æŸ¥çœ‹é…ç½®æ–‡æ¡£ï¼Œæ¨¡å—åŠŸèƒ½æŸ¥çœ‹å·¥å…·,ç›¸å½“äºman\n/usr/bin/ansible-playbook å®šåˆ¶è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼Œç¼–æ’å‰§æœ¬å·¥å…·,ç›¸å½“äºè„šæœ¬\n/usr/bin/ansible-pull è¿œç¨‹æ‰§è¡Œå‘½ä»¤çš„å·¥å…·\n/usr/bin/ansible-vault æ–‡ä»¶åŠ å¯†å·¥å…·\n/usr/bin/ansible-console åŸºäºConsoleç•Œé¢ä¸ç”¨æˆ·äº¤äº’çš„æ‰§è¡Œå·¥å…·\n/usr/bin/ansible-galaxy ä¸‹è½½/ä¸Šä¼ ä¼˜ç§€ä»£ç æˆ–Rolesæ¨¡å—çš„å®˜ç½‘å¹³å°\nåˆ©ç”¨ansibleå®ç°ç®¡ç†çš„ä¸»è¦æ–¹å¼ï¼š\nAnsible Ad-Hoc å³åˆ©ç”¨ansibleå‘½ä»¤ï¼Œä¸»è¦ç”¨äºä¸´æ—¶å‘½ä»¤ä½¿ç”¨åœºæ™¯\nAnsible playbook ä¸»è¦ç”¨äºé•¿æœŸè§„åˆ’å¥½çš„ï¼Œå¤§å‹é¡¹ç›®çš„åœºæ™¯ï¼Œéœ€è¦æœ‰å‰æœŸçš„è§„åˆ’è¿‡ç¨‹\nansible ä½¿ç”¨å‰å‡†å¤‡ ansible ç›¸å…³å·¥å…·å¤§å¤šæ•°æ˜¯é€šè¿‡sshåè®®ï¼Œå®ç°å¯¹è¿œç¨‹ä¸»æœºçš„é…ç½®ç®¡ç†ã€åº”ç”¨éƒ¨ç½²ã€ä»»åŠ¡æ‰§è¡Œç­‰åŠŸèƒ½ å»ºè®®ï¼šä½¿ç”¨æ­¤å·¥å…·å‰ï¼Œå…ˆé…ç½®ansibleä¸»æ§ç«¯èƒ½åŸºäºå¯†é’¥è®¤è¯çš„æ–¹å¼è”ç³»å„ä¸ªè¢«ç®¡ç†èŠ‚ç‚¹ èŒƒä¾‹ï¼šåˆ©ç”¨sshpassæ‰¹é‡å®ç°åŸºäºkeyéªŒè¯è„šæœ¬1\n[root@centos8 ~]#vim /etc/ssh/ssh_config #ä¿®æ”¹ä¸‹é¢ä¸€è¡Œ StrictHostKeyChecking no [root@centos8 ~]#cat hosts.list 192.168.32.178 192.168.32.179 [root@centos8 ~]#vim push_ssh_key.sh #!/bin/bash rpm -ql shpass \u0026\u003e /dev/null || yum -y install sshpass [ -f /root/.ssh/id_rsa ] || ssh-keygen -f /root/.ssh/id_rsa -P '' export SSHPASS=123456 while read IP;do sshpass -e ssh-copy-id -o StrictHostKeyChecking=no $IP done \u003c hosts.list èŒƒä¾‹: å®ç°åŸºäºkeyéªŒè¯çš„è„šæœ¬2\n[root@centos8 ~]#cat ssh_key.sh #!/bin/bash PLIST=\" 192.168.32.178 192.168.32.179\" rpm -q sshpass \u0026\u003e /dev/null || yum -y install sshpass [ -f /root/.ssh/id_rsa ] || ssh-keygen -f /root/.ssh/id_rsa -P '' export SSHPASS=123456 for IP in $IPLIST;do { sshpass -e ssh-copy-id -o StrictHostKeyChecking=no $IP; } \u0026 done wait æ­¤å·¥å…·ç”¨æ¥æ˜¾ç¤ºæ¨¡å—å¸®åŠ©,ç›¸å½“äºman æ ¼å¼\nansible-doc [options] [module...] -l, --list #åˆ—å‡ºå¯ç”¨æ¨¡å— -s, --snippet #æ˜¾ç¤ºæŒ‡å®šæ¨¡å—çš„playbookç‰‡æ®µ èŒƒä¾‹: æŸ¥çœ‹å¸®åŠ©\n[root@rocky ~]# ansible-doc --help usage: ansible-doc [-h] [--version] [-v] [-M MODULE_PATH] [--playbook-dir BASEDIR] [-t {become,cache,callback,cliconf,connection,httpapi,inventory,lookup,netconf,shell,vars,module,strategy,role,keyword}] [-j] [-r ROLES_PATH] [-e ENTRY_POINT | -s | -F | -l | --metadata-dump] [--no-fail-on-errors] [plugin ...] plugin documentation tool positional arguments: plugin Plugin èŒƒä¾‹ï¼š\n#åˆ—å‡ºæ‰€æœ‰æ¨¡å— ansible-doc -l #æŸ¥çœ‹æŒ‡å®šæ¨¡å—å¸®åŠ©ç”¨æ³• ansible-doc ping #æŸ¥çœ‹æŒ‡å®šæ¨¡å—å¸®åŠ©ç”¨æ³• ansible-doc -s ping èŒƒä¾‹: æŸ¥çœ‹æŒ‡å®šçš„æ’ä»¶\n[root@rocky ~]# ansible-doc -t connection -l local execute on controller paramiko_ssh Run tasks via python ssh (paramiko) psrp Run tasks over Microsoft PowerShell Remoting Protocol ssh connect via SSH client binary winrm Run tasks over Microsoft's WinRM [root@rocky ~]# [root@rocky ~]# ansible-doc -t lookup -l config Lookup current Ansible configuration values csvfile read data from a TSV or CSV file dict returns key/value pair items from dictionaries env Read the value of environment variables file read file contents fileglob list files matching a pattern first_found return first file found from list indexed_items rewrites lists to return 'indexed items' ini read data from an ini file inventory_hostnames list of inventory hosts matching a host pattern items list of items lines read lines from command list simply returns what it is given nested composes a list with nested elements of other lists password retrieve or generate a random password, stored in a file pipe read output from a command random_choice return random element from list sequence generate a list based on a number sequence subelements traverse nested key from a list of dictionaries template retrieve contents of file after templating with Jinja2 together merges lists into synchronized list unvault read vaulted file(s) contents url return contents from URL varnames Lookup matching variable names vars Lookup templated value of variables [root@rocky ~]# ansible Ansible Ad-Hoc ä»‹ç» Ansible Ad-Hoc çš„æ‰§è¡Œæ–¹å¼çš„ä¸»è¦å·¥å…·å°±æ˜¯ ansible ç‰¹ç‚¹: ä¸€æ¬¡æ€§çš„æ‰§è¡Œ,ä¸ä¼šä¿å­˜æ‰§è¡Œå‘½ä»¤ä¿¡æ¯,åªé€‚åˆä¸´æ—¶æ€§æˆ–æµ‹è¯•æ€§çš„ä»»åŠ¡\nansible å‘½ä»¤ç”¨æ³• æ ¼å¼ï¼š\nansible [-m module_name] [-a args] é€‰é¡¹è¯´æ˜ï¼š\n--version #æ˜¾ç¤ºç‰ˆæœ¬ -m module #æŒ‡å®šæ¨¡å—ï¼Œé»˜è®¤ä¸ºcommand -v #è¯¦ç»†è¿‡ç¨‹ -vv -vvvæ›´è¯¦ç»† --list-hosts #æ˜¾ç¤ºä¸»æœºåˆ—è¡¨ï¼Œå¯ç®€å†™ --list -C, --check #æ£€æŸ¥ï¼Œå¹¶ä¸æ‰§è¡Œ -T, --timeout=TIMEOUT #æ‰§è¡Œå‘½ä»¤çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤10s -k, --ask-pass #æç¤ºè¾“å…¥sshè¿æ¥å¯†ç ï¼Œé»˜è®¤KeyéªŒè¯ -u, --user=REMOTE_USER #æ‰§è¡Œè¿œç¨‹æ‰§è¡Œçš„ç”¨æˆ·,é»˜è®¤root -b, --become #ä»£æ›¿æ—§ç‰ˆçš„sudoå®ç°é€šè¿‡sudoæœºåˆ¶å®ç°æå‡æƒé™ --become-user=USERNAME #æŒ‡å®šsudoçš„runasç”¨æˆ·ï¼Œé»˜è®¤ä¸ºroot -K, --ask-become-pass #æç¤ºè¾“å…¥sudoæ—¶çš„å£ä»¤ -f FORKS, --forks FORKS #æŒ‡å®šå¹¶å‘åŒæ—¶æ‰§è¡Œansibleä»»åŠ¡çš„ä¸»æœºæ•° -i INVENTORY, --inventory INVENTORY #æŒ‡å®šä¸»æœºæ¸…å•æ–‡ä»¶ èŒƒä¾‹:\n#ä»¥wangç”¨æˆ·æ‰§è¡Œpingå­˜æ´»æ£€æµ‹ ansible all -m ping -u wang -k #ä»¥wang sudoè‡³rootæ‰§è¡Œpingå­˜æ´»æ£€æµ‹ ansible all -m ping -u wang -k -b #ä»¥wang sudoè‡³mageç”¨æˆ·æ‰§è¡Œpingå­˜æ´»æ£€æµ‹ ansible all -m ping -u wang -k -b --become-user=mage #ä»¥wang sudoè‡³rootç”¨æˆ·æ‰§è¡Œls ansible all -m command -u wang -a 'ls /root' -b --become-user=root -k -K èŒƒä¾‹: å¹¶å‘æ‰§è¡Œæ§åˆ¶\n#åˆ†åˆ«æ‰§è¡Œä¸‹é¢ä¸¤æ¡å‘½ä»¤è§‚å¯Ÿç»“æœ [root@ansible ~]#ansible all -a 'sleep 5' -f1 [root@ansible ~]#ansible all -a 'sleep 5' -f10 èŒƒä¾‹: ä½¿ç”¨æ™®èƒ½ç”¨æˆ·è¿›è¡Œè¿œç¨‹ç®¡ç†\n#åœ¨æ‰€æœ‰æ§åˆ¶ç«¯å’Œè¢«æ§åˆ¶ç«¯åˆ›å»ºç”¨æˆ·å’Œå¯†ç  [root@rocky8 ~]#useradd wang [root@rocky8 ~]#echo wang:123456 | chpasswd #åœ¨æ‰€æœ‰è¢«æ§åˆ¶ç«¯å¯¹ç”¨æˆ·sudoæˆæƒ [root@rocky8 ~]#visudo wang ALL=(ALL) NOPASSWD: ALL [root@rocky8 ~]#visudo -c /etc/sudoers: parsed OK #å®ç°ä»æ§åˆ¶ç«¯åˆ°è¢«æ§åˆ¶ç«¯çš„åŸºäºkeyéªŒè¯ [root@ansible ~]#su - wang wang@ansible:~$ssh-keygen -f ~/.ssh/id_rsa -P '' wang@ansible:~$$ssh-copy-id wang@'10.0.0.8' #ä½¿ç”¨æ™®é€šç”¨æˆ·æµ‹è¯•è¿æ¥,é»˜è®¤è¿æ¥æƒé™ä¸è¶³å¤±è´¥ wang@ansible:~$ ansible 10.0.0.8 -m shell -a 'ls /root' 10.0.0.8 | FAILED | rc=2 \u003e\u003e ls: cannot open directory '/root': Permission deniednon-zero return code #ä½¿ç”¨æ™®é€šç”¨æˆ·é€šè¿‡-bé€‰é¡¹è¿æ¥å®ç°sudoææƒåè¿æ¥æˆåŠŸ wang@ansible:~$ ansible 10.0.0.8 -m shell -a 'ls /root' -b --become-user root 10.0.0.8 | CHANGED | rc=0 \u003e\u003e anaconda-ks.cfg #ä¿®æ”¹é…ç½®æ–‡ä»¶æŒ‡å®šsudoæœºåˆ¶ [root@ansible ~]#vim /etc/ansible/ansible.cfg #å–æ¶ˆä¸‹é¢è¡Œå‰é¢çš„æ³¨é‡Š [privilege_escalation] become=True become_method=sudo become_user=root become_ask_pass=False #å†æ¬¡æµ‹è¯• [root@ansible ~]#su - wang wang@ansible:~$ ansible 10.0.0.8 -m shell -a 'ls /root' 10.0.0.8 | CHANGED | rc=0 \u003e\u003e anaconda-ks.cfg èŒƒä¾‹: ä½¿ç”¨æ™®é€šç”¨æˆ·è¿æ¥è¿œç¨‹ä¸»æœºæ‰§è¡Œä»£æ›¿å¦ä¸€ä¸ªç”¨æˆ·èº«ä»½æ‰§è¡Œæ“ä½œ\n[root@centos8 ~]#useradd wang [root@centos8 ~]#echo wang:123456 | chpasswd #å…ˆåœ¨è¢«æ§åˆ¶ç«¯èƒ½è¿‡sudoå¯¹æ™®é€šç”¨æˆ·æˆæƒ [root@centos8 ~]#grep wang /etc/sudoers wang ALL=(ALL) NOPASSWD: ALL #ä»¥wangçš„ç”¨æˆ·è¿æ¥ç”¨æˆ·,å¹¶åˆ©ç”¨sudoä»£è¡¨mageæ‰§è¡Œwhoamiå‘½ä»¤ [root@ansible ~]#ansible 10.0.0.8 -m shell -a 'whoami' -u wang -k -b --become- user=mage SSH password: #è¾“å…¥è¿œç¨‹ä¸»æœºwangç”¨æˆ·sshè¿æ¥å¯†ç  10.0.0.8 | CHANGED | rc=0 \u003e\u003e mage ansibleçš„Host-pattern ç”¨äºåŒ¹é…è¢«æ§åˆ¶çš„ä¸»æœºçš„åˆ—è¡¨ All ï¼šè¡¨ç¤ºæ‰€æœ‰Inventoryä¸­çš„æ‰€æœ‰ä¸»æœº èŒƒä¾‹\nansible all -m ping *:é€šé…ç¬¦\nansible \"*\" -m ping ansible 192.168.1.* -m ping ansible \"srvs\" -m ping ansible \"10.0.0.6 10.0.0.7\" -m ping æˆ–å…³ç³»\nansible \"websrvs:appsrvs\" -m ping ansible \"192.168.1.10:192.168.1.20\" -m ping é€»è¾‘ä¸\n#åœ¨websrvsç»„å¹¶ä¸”åœ¨dbsrvsç»„ä¸­çš„ä¸»æœº ansible \"websrvs:\u0026dbsrvs\" -m ping é€»è¾‘é\n#åœ¨æ‰€æœ‰ä¸»æœº,ä½†ä¸åœ¨websrvsç»„å’Œdbsrvsç»„ä¸­çš„ä¸»æœº #æ³¨æ„ï¼šæ­¤å¤„ä¸ºå•å¼•å· ansible 'all:!dbsrvs:!websrvs' -m ping ç»¼åˆé€»è¾‘\nansible 'websrvs:dbsrvs:\u0026appsrvs:!ftpsrvs' -m ping æ­£åˆ™è¡¨è¾¾å¼\nansible \"websrvs:dbsrvs\" -m ping ansible \"~(web|db).*\\.magedu\\.com\" -m ping ansible å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ åŠ è½½è‡ªå·±çš„é…ç½®æ–‡ä»¶,é»˜è®¤/etc/ansible/ansible.cfg æŸ¥æ‰¾ä¸»æœºæ¸…å•ä¸­å¯¹åº”çš„ä¸»æœºæˆ–ä¸»æœºç»„ åŠ è½½è‡ªå·±å¯¹åº”çš„æ¨¡å—æ–‡ä»¶ï¼Œå¦‚ï¼šcommand é€šè¿‡ansibleå°†æ¨¡å—æˆ–å‘½ä»¤ç”Ÿæˆå¯¹åº”çš„ä¸´æ—¶pyæ–‡ä»¶ï¼Œå¹¶å°†è¯¥æ–‡ä»¶ä¼ è¾“è‡³è¿œç¨‹æœåŠ¡å™¨çš„å¯¹åº”æ‰§è¡Œç”¨æˆ· $HOME/.ansible/tmp/ansible-tmp-æ•°å­—/XXX.PYæ–‡ä»¶ ç»™æ–‡ä»¶+xæ‰§è¡Œ æ‰§è¡Œå¹¶è¿”å›ç»“æœ åˆ é™¤ä¸´æ—¶pyæ–‡ä»¶ï¼Œé€€å‡º ansible å‘½ä»¤çš„æ‰§è¡ŒçŠ¶æ€ [root@centos8 ~]#grep -A 14 '\\[colors\\]' /etc/ansible/ansible.cfg [colors] #highlight = white #verbose = blue #warn = bright purple #error = red #debug = dark gray #deprecate = purple #skip = cyan #unreachable = red #ok = green #changed = yellow #diff_add = green #diff_remove = red #diff_lines = cyan ç»¿è‰²ï¼šæ‰§è¡ŒæˆåŠŸå¹¶ä¸”å¯¹ç›®æ ‡ä¸»æœºä¸éœ€è¦åšæ”¹å˜çš„æ“ä½œ é»„è‰²ï¼šæ‰§è¡ŒæˆåŠŸå¹¶ä¸”å¯¹ç›®æ ‡ä¸»æœºåšå˜æ›´ çº¢è‰²ï¼šæ‰§è¡Œå¤±è´¥ ansible-console æ­¤å·¥å…·å¯äº¤äº’æ‰§è¡Œå‘½ä»¤ï¼Œæ”¯æŒtabï¼Œansible 2.0+æ–°å¢ æç¤ºç¬¦æ ¼å¼ï¼š\næ‰§è¡Œç”¨æˆ·@å½“å‰æ“ä½œçš„ä¸»æœºç»„ (å½“å‰ç»„çš„ä¸»æœºæ•°é‡)[f:å¹¶å‘æ•°]$ å¸¸ç”¨å­å‘½ä»¤ï¼š\nè®¾ç½®å¹¶å‘æ•°ï¼š forks n ä¾‹å¦‚ï¼š forks 10 åˆ‡æ¢ç»„ï¼š cd ä¸»æœºç»„ ä¾‹å¦‚ï¼š cd web åˆ—å‡ºå½“å‰ç»„ä¸»æœºåˆ—è¡¨ï¼š list åˆ—å‡ºæ‰€æœ‰çš„å†…ç½®å‘½ä»¤ï¼š ?æˆ–help èŒƒä¾‹\n[root@ansible ~]#ansible-console Welcome to the ansible console. Type help or ? to list commands. root@all (3)[f:5]$ ping 10.0.0.7 | SUCCESS =\u003e { \"ansible_facts\": { \"discovered_interpreter_python\": \"/usr/bin/python\" }, \"changed\": false, \"ping\": \"pong\" } 10.0.0.6 | SUCCESS =\u003e { \"ansible_facts\": { \"discovered_interpreter_python\": \"/usr/bin/python\" }, \"changed\": false, \"ping\": \"pong\" } 10.0.0.8 | SUCCESS =\u003e { \"ansible_facts\": { \"discovered_interpreter_python\": \"/usr/libexec/platform-python\" }, \"changed\": false, \"ping\": \"pong\" } root@all (3)[f:5]$ list 10.0.0.8 10.0.0.7 10.0.0.6 root@all (3)[f:5]$ cd websrvs root@websrvs (2)[f:5]$ list 10.0.0.7 10.0.0.8 root@websrvs (2)[f:5]$ forks 10 root@websrvs (2)[f:10]$ cd appsrvs root@appsrvs (2)[f:5]$ yum name=httpd state=present root@appsrvs (2)[f:5]$ service name=httpd state=started ansible-playbook æ­¤å·¥å…·ç”¨äºæ‰§è¡Œç¼–å†™å¥½çš„ playbook ä»»åŠ¡ èŒƒä¾‹ï¼š\nansible-playbook hello.yml cat hello.yml --- #hello world yml file - hosts: websrvs remote_user: root gather_facts: no tasks: - name: hello world command: /usr/bin/wall hello world ansible-vault æ­¤å·¥å…·å¯ä»¥ç”¨äºåŠ å¯†è§£å¯†ymlæ–‡ä»¶ æ ¼å¼ï¼š\nansible-vault [create|decrypt|edit|encrypt|rekey|view] èŒƒä¾‹\nansible-vault encrypt hello.yml #åŠ å¯† ansible-vault decrypt hello.yml #è§£å¯† ansible-vault view hello.yml #æŸ¥çœ‹ ansible-vault edit hello.yml #ç¼–è¾‘åŠ å¯†æ–‡ä»¶ ansible-vault rekey hello.yml #ä¿®æ”¹å£ä»¤ ansible-vault create new.yml #åˆ›å»ºæ–°æ–‡ä»¶ #æ‰§è¡ŒåŠ å¯†çš„playbook,äº¤äº’å¼è¾“å…¥å¯†ç  chmod 600 hello.yml ansible-playbook --ask-vault-pass hello.yml #ä»pass.txtæ–‡ä»¶ä¸­è¯»å–å¯†ç  ansible-playbook --vault-password-file pass.txt hello.yml #ä»é…ç½®æ–‡ä»¶ä¸­å–å¾—å¯†ç  #vi /etc/ansible/ansible.cfg [defaults] ault-password-file=pass.txt #å¯ä»¥ç›´æ¥æ‰§è¡ŒåŠ å¯†æ–‡ä»¶ ansible-playbook hello.yml ansible-galaxy Galaxy æ˜¯ä¸€ä¸ªå…è´¹ç½‘ç«™, ç±»ä¼¼äºgithubç½‘ç«™, ç½‘ç«™ä¸Šå‘å¸ƒäº†å¾ˆå¤šçš„å…±äº«çš„rolesè§’è‰²ã€‚ Ansible æä¾›äº†ansible-galaxyå‘½ä»¤è¡Œå·¥å…·è¿æ¥ url ç½‘ç«™ä¸‹è½½ç›¸åº”çš„roles, è¿›è¡Œinit(åˆå§‹åŒ–ã€search( æŸ¥æ‹˜ã€install(å®‰è£…ã€ remove(ç§»é™¤)ç­‰æ“ä½œã€‚\nèŒƒä¾‹ï¼š\n#æœç´¢é¡¹ç›® [root@ansible ~]#ansible-galaxy search lamp #åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„galaxy ansible-galaxy list #å®‰è£…galaxy,é»˜è®¤ä¸‹è½½åˆ°~/.ansible/rolesä¸‹ ansible-galaxy install geerlingguy.mysql ansible-galaxy install geerlingguy.redis #åˆ é™¤galaxy ansible-galaxy remove geerlingguy.redis Ansibleå¸¸ç”¨æ¨¡å— 2015å¹´12æœˆåª270å¤šä¸ªæ¨¡å— 2016å¹´12å¹´26æ—¥ansible 1.9.2 æœ‰540ä¸ªæ¨¡å— 2018å¹´01æœˆ12æ—¥ansible 2.3.8 æœ‰1378ä¸ªæ¨¡å— 2018å¹´05æœˆ28æ—¥ansible 2.5.3 æœ‰1562ä¸ªæ¨¡å— 2018å¹´07æœˆ15æ—¥ansible 2.6.3 æœ‰1852ä¸ªæ¨¡å— 2018å¹´11æœˆ19æ—¥ansible 2.7.2 æœ‰2080ä¸ªæ¨¡å— 2020å¹´03æœˆ02æ—¥ansible 2.9.5 æœ‰3387ä¸ªæ¨¡å— 2021å¹´12æœˆ22æ—¥ansible 2.11.8 æœ‰6141ä¸ªæ¨¡å— 2022å¹´06æœˆ04æ—¥ansible 2.12.6 æœ‰6763ä¸ªæ¨¡å— è™½ç„¶æ¨¡å—ä¼—å¤šï¼Œä½†æœ€å¸¸ç”¨çš„æ¨¡å—ä¹Ÿå°±2ï¼Œ30ä¸ªè€Œå·²ï¼Œé’ˆå¯¹ç‰¹å®šä¸šåŠ¡åªéœ€è¦ç†Ÿæ‚‰10å‡ ä¸ªæ¨¡å—å³å¯ å¸¸ç”¨æ¨¡å—å¸®åŠ©æ–‡æ¡£å‚è€ƒï¼š\nhttps://docs.ansible.com/ansible/2.9/modules/modules_by_category.html https://docs.ansible.com/ansible/2.9/modules/list_of_all_modules.html https://docs.ansible.com/ansible/latest/modules/list_of_all_modules.html https://docs.ansible.com/ansible/latest/modules/modules_by_category.html Command æ¨¡å— åŠŸèƒ½ï¼šåœ¨è¿œç¨‹ä¸»æœºæ‰§è¡Œå‘½ä»¤ï¼Œæ­¤ä¸ºé»˜è®¤æ¨¡å—ï¼Œå¯å¿½ç•¥ -m é€‰é¡¹ æ³¨æ„ï¼šæ­¤å‘½ä»¤ä¸æ”¯æŒ $VARNAME \u003c \u003e | ; \u0026 ç­‰ï¼Œå¯ç”¨shellæ¨¡å—å®ç° æ³¨æ„ï¼šæ­¤æ¨¡å—ä¸å…·æœ‰å¹‚ç­‰æ€§ å¸¸è§é€‰é¡¹\nchdir=dir #æ‰§è¡Œå‘½ä»¤å‰,å…ˆåˆ‡æ¢è‡³ç›®å½•dir creates=file #å½“fileä¸å­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ removes=file #å½“fileå­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ èŒƒä¾‹ï¼š\n[root@ansible ~]#ansible websrvs -m command -a 'chdir=/etc cat centos-release' 10.0.0.7 | CHANGED | rc=0 \u003e\u003e CentOS Linux release 7.7.1908 (Core) 10.0.0.8 | CHANGED | rc=0 \u003e\u003e CentOS Linux release 8.1.1911 (Core) [root@ansible ~]#ansible websrvs -m command -a 'chdir=/etc creates=/data/f1.txt cat centos-release' 10.0.0.7 | CHANGED | rc=0 \u003e\u003e CentOS Linux release 7.7.1908 (Core) 10.0.0.8 | SUCCESS | rc=0 \u003e\u003e skipped, since /data/f1.txt exists [root@ansible ~]#ansible websrvs -m command -a 'chdir=/etc removes=/data/f1.txt cat centos-release' 10.0.0.7 | SUCCESS | rc=0 \u003e\u003e skipped, since /data/f1.txt does not exist 10.0.0.8 | CHANGED | rc=0 \u003e\u003e CentOS Linux release 8.1.1911 (Core) ansible websrvs -m command -a 'service vsftpd start' ansible websrvs -m command -a 'echo magedu |passwd --stdin wang' ansible websrvs -m command -a 'rm -rf /data/' ansible websrvs -m command -a 'echo hello \u003e /data/hello.log' ansible websrvs -m command -a \"echo $HOSTNAME\" Shell æ¨¡å— åŠŸèƒ½ï¼šå’Œcommandç›¸ä¼¼ï¼Œç”¨shellæ‰§è¡Œå‘½ä»¤,æ”¯æŒå„ç§ç¬¦å·,æ¯”å¦‚:*,$, \u003e , ç›¸å½“äºå¢å¼ºç‰ˆçš„commandæ¨¡å— æ³¨æ„ï¼šæ­¤æ¨¡å—ä¸å…·æœ‰å¹‚ç­‰æ€§,å»ºè®®èƒ½ä¸èƒ½å°±ç”¨æ­¤æ¨¡å—,æœ€å¥½ä½¿ç”¨ä¸“ç”¨æ¨¡å— å¸¸è§é€‰é¡¹\nchdir=dir #æ‰§è¡Œå‘½ä»¤å‰,å…ˆåˆ‡æ¢è‡³ç›®å½•dir creates=file #å½“fileä¸å­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ removes=file #å½“fileå­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ èŒƒä¾‹ï¼š\n[root@ansible ~]#ansible websrvs -m shell -a \"echo $HOSTNAME\" 10.0.0.7 | CHANGED | rc=0 \u003e\u003e ansible 10.0.0.8 | CHANGED | rc=0 \u003e\u003e ansible [root@ansible ~]#ansible websrvs -m shell -a 'echo $HOSTNAME' 10.0.0.7 | CHANGED | rc=0 \u003e\u003e centos7.wangxiaochun.com 10.0.0.8 | CHANGED | rc=0 \u003e\u003e centos8.localdomain [root@ansible ~]#ansible websrvs -m shell -a 'echo centos | passwd --stdin wang' 10.0.0.7 | CHANGED | rc=0 \u003e\u003e Changing password for user wang. passwd: all authentication tokens updated successfully. 10.0.0.8 | CHANGED | rc=0 \u003e\u003e Changing password for user wang. passwd: all authentication tokens updated successfully. [root@ansible ~]#ansible websrvs -m shell -a 'ls -l /etc/shadow' 10.0.0.7 | CHANGED | rc=0 \u003e\u003e ---------- 1 root root 889 Mar 2 14:34 /etc/shadow 10.0.0.8 | CHANGED | rc=0 \u003e\u003e ---------- 1 root root 944 Mar 2 14:34 /etc/shadow [root@ansible ~]#ansible websrvs -m shell -a 'echo hello \u003e /data/hello.log' 10.0.0.7 | CHANGED | rc=0 \u003e\u003e 10.0.0.8 | CHANGED | rc=0 \u003e\u003e [root@ansible ~]#ansible websrvs -m shell -a 'cat /data/hello.log' 10.0.0.7 | CHANGED | rc=0 \u003e\u003e hello 10.0.0.8 | CHANGED | rc=0 \u003e\u003e hello æ³¨æ„ï¼šè°ƒç”¨bashæ‰§è¡Œå‘½ä»¤ ç±»ä¼¼ cat /tmp/test.md | awk -Fâ€™|â€™ â€˜{print $1,$2}â€™ \u0026\u003e /tmp/example.txt è¿™äº›å¤æ‚å‘½ä»¤ï¼Œå³ä½¿ä½¿ç”¨shellä¹Ÿå¯èƒ½ä¼šå¤±è´¥ï¼Œè§£å†³åŠæ³•ï¼šå†™åˆ°è„šæœ¬æ—¶ï¼Œcopyåˆ°è¿œç¨‹ï¼Œæ‰§è¡Œï¼Œå†æŠŠéœ€è¦çš„ç»“æœæ‹‰å›æ‰§è¡Œå‘½ä»¤çš„æœºå™¨ èŒƒä¾‹ï¼šå°†shellæ¨¡å—ä»£æ›¿commandï¼Œè®¾ä¸ºæ¨¡å—\n[root@ansible ~]#vim /etc/ansible/ansible.cfg #ä¿®æ”¹ä¸‹é¢ä¸€è¡Œ module_name = shell Script æ¨¡å— åŠŸèƒ½ï¼šåœ¨è¿œç¨‹ä¸»æœºä¸Šè¿è¡ŒansibleæœåŠ¡å™¨ä¸Šçš„è„šæœ¬(æ— éœ€æ‰§è¡Œæƒé™) æ³¨æ„ï¼šæ­¤æ¨¡å—ä¸å…·æœ‰å¹‚ç­‰æ€§ å¸¸è§é€‰é¡¹\nchdir=dir #æ‰§è¡Œå‘½ä»¤å‰,å…ˆåˆ‡æ¢è‡³ç›®å½•dir cmd #æŒ‡å®šansibleä¸»æœºçš„å‘½ä»¤ creates=file #å½“fileä¸å­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ removes=file #å½“fileå­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ èŒƒä¾‹ï¼š\nansible websrvs -m script -a /data/test.sh Copy æ¨¡å— åŠŸèƒ½ï¼šå¤åˆ¶ansibleæœåŠ¡å™¨ä¸»æ§ç«¯æˆ–è¿œç¨‹çš„æœ¬æœºçš„æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœº æ³¨æ„: src=file å¦‚æœæ˜¯æ²¡æŒ‡æ˜è·¯å¾„,åˆ™ä¸ºå½“å‰ç›®å½•æˆ–å½“å‰ç›®å½•ä¸‹çš„filesç›®å½•ä¸‹çš„fileæ–‡ä»¶ å¸¸è§é€‰é¡¹\nsrc #æ§åˆ¶ç«¯çš„æºæ–‡ä»¶è·¯å¾„ dest #è¢«æ§ç«¯çš„æ–‡ä»¶è·¯å¾„ owner #å±ä¸» group #å±ç»„ mode #æƒé™ backup #æ˜¯å¦å¤‡ä»½ validate #éªŒè¯æˆåŠŸæ‰ä¼šæ‰§è¡Œcopy remote_src #noæ˜¯é»˜è®¤å€¼,è¡¨ç¤ºsrcæ–‡ä»¶åœ¨ansibleä¸»æœº,yesè¡¨ç¤ºsrcæ–‡ä»¶åœ¨è¿œç¨‹ä¸»æœº èŒƒä¾‹:\n#å¦‚ç›®æ ‡å­˜åœ¨ï¼Œé»˜è®¤è¦†ç›–ï¼Œæ­¤å¤„æŒ‡å®šå…ˆå¤‡ ansible websrvs -m copy -a \"src=/root/test1.sh dest=/tmp/test2.sh owner=wang mode=600 backup=yes\" #æŒ‡å®šå†…å®¹ï¼Œç›´æ¥ç”Ÿæˆç›®æ ‡æ–‡ä»¶ ansible websrvs -m copy -a \"content='wang 123456\\nxiao 654321\\n' dest=/etc/rsync.pas owner=root group=root mode=0600\" #å¤åˆ¶/etcç›®å½•è‡ªèº«,æ³¨æ„/etc/åé¢æ²¡æœ‰/ ansible websrvs -m copy -a \"src=/etc dest=/backup\" #å¤åˆ¶/etc/ä¸‹çš„æ–‡ä»¶ï¼Œä¸åŒ…æ‹¬/etc/ç›®å½•è‡ªèº«,æ³¨æ„/etc/åé¢æœ‰/ ansible websrvs -m copy -a \"src=/etc/ dest=/backup\" #å¤åˆ¶/etc/suders,å¹¶æ ¡éªŒè¯­æ³• ansible websrvs -m copy -a \"src=/etc/suders dest=/etc/sudoers.edit remote_src=yes validate=/usr/sbin/visudo -csf %s\" Get_url æ¨¡å— åŠŸèƒ½: ç”¨äºå°†æ–‡ä»¶ä»httpã€httpsæˆ–ftpä¸‹è½½åˆ°è¢«ç®¡ç†æœºèŠ‚ç‚¹ä¸Š å¸¸ç”¨å‚æ•°å¦‚ä¸‹ï¼š\nurl #ä¸‹è½½æ–‡ä»¶çš„URL,æ”¯æŒHTTPï¼ŒHTTPSæˆ–FTPåè®® dest #ä¸‹è½½åˆ°ç›®æ ‡è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼‰ï¼Œå¦‚æœç›®æ ‡æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå°±ç”¨åŸæ–‡ä»¶åï¼Œå¦‚æœç›®æ ‡è®¾ç½®äº†åç§°å°±ç”¨ç›®æ ‡ è®¾ç½®çš„åç§° owner #æŒ‡å®šå±ä¸» group #æŒ‡å®šå±ç»„ mode #æŒ‡å®šæƒé™ force #å¦‚æœyesï¼Œdestä¸æ˜¯ç›®å½•ï¼Œå°†æ¯æ¬¡ä¸‹è½½æ–‡ä»¶ï¼Œå¦‚æœå†…å®¹æ”¹å˜æ›¿æ¢æ–‡ä»¶ã€‚å¦‚æœnoï¼Œåˆ™åªæœ‰åœ¨ç›®æ ‡ä¸å­˜ åœ¨æ—¶æ‰ä¼šä¸‹è½½ checksum #å¯¹ç›®æ ‡æ–‡ä»¶åœ¨ä¸‹è½½åè®¡ç®—æ‘˜è¦ï¼Œä»¥ç¡®ä¿å…¶å®Œæ•´æ€§ #ç¤ºä¾‹: checksum=\"sha256:D98291AC[...]B6DC7B97\", checksum=\"sha256:http://example.com/path/sha256sum.txt\" url_username #ç”¨äºHTTPåŸºæœ¬è®¤è¯çš„ç”¨æˆ·åã€‚ å¯¹äºå…è®¸ç©ºå¯†ç çš„ç«™ç‚¹ï¼Œæ­¤å‚æ•°å¯ä»¥ä¸ä½¿ç”¨`url_password' url_password #ç”¨äºHTTPåŸºæœ¬è®¤è¯çš„å¯†ç ã€‚ å¦‚æœæœªæŒ‡å®š`url_username'å‚æ•°ï¼Œåˆ™ä¸ä¼šä½¿ç”¨`url_password'å‚æ•° validate_certs #å¦‚æœâ€œnoâ€ï¼ŒSSLè¯ä¹¦å°†ä¸ä¼šè¢«éªŒè¯ã€‚ é€‚ç”¨äºè‡ªç­¾åè¯ä¹¦åœ¨ç§æœ‰ç½‘ç«™ä¸Šä½¿ç”¨ timeout #URLè¯·æ±‚çš„è¶…æ—¶æ—¶é—´,ç§’ä¸ºå•ä½ èŒƒä¾‹: ä¸‹è½½å¹¶MD5éªŒè¯\n[root@ansible ~]#ansible websrvs -m get_url -a 'url=http://nginx.org/download/nginx-1.18.0.tar.gz dest=/usr/local/src/nginx.tar.gz checksum=\"md5:b2d33d24d89b8b1f87ff5d251aa27eb8\"' Fetch æ¨¡å— åŠŸèƒ½ï¼šä»è¿œç¨‹ä¸»æœºæå–æ–‡ä»¶è‡³ansibleçš„ä¸»æ§ç«¯ï¼Œcopyç›¸åï¼Œç›®å‰ä¸æ”¯æŒç›®å½• å¸¸è§é€‰é¡¹\nsrc #è¢«æ§åˆ¶ç«¯çš„æºæ–‡ä»¶è·¯å¾„,åªæ”¯æŒæ–‡ä»¶ dest #ansibleæ§åˆ¶ç«¯çš„ç›®å½•è·¯å¾„ èŒƒä¾‹ï¼š\nansible websrvs -m fetch -a 'src=/root/test.sh dest=/data/scripts' èŒƒä¾‹ï¼š\n[root@ansible ~]#ansible all -m fetch -a 'src=/etc/redhat-release dest=/data/os' [root@ansible ~]#tree /data/os/ /data/os/ â”œâ”€â”€ 10.0.0.6 â”‚ â””â”€â”€ etc â”‚ â””â”€â”€ redhat-release â”œâ”€â”€ 10.0.0.7 â”‚ â””â”€â”€ etc â”‚ â””â”€â”€ redhat-release â””â”€â”€ 10.0.0.8 â””â”€â”€ etc â””â”€â”€ redhat-release 6 directories, 3 files File æ¨¡å— åŠŸèƒ½ï¼šè®¾ç½®æ–‡ä»¶å±æ€§,åˆ›å»ºæ–‡ä»¶,ç›®å½•å’Œè½¯é“¾æ¥ç­‰ å¸¸è§é€‰é¡¹\npath #åœ¨è¢«æ§ç«¯åˆ›å»ºçš„è·¯å¾„ owner #å±ä¸» group #å±ç»„ mode #æƒé™ state #çŠ¶æ€ =touch #åˆ›å»ºæ–‡ä»¶ =directory #åˆ›å»ºç›®å½• =link #è½¯é“¾æ¥ =hard #ç¡¬é“¾æ¥ recurse #yesè¡¨ç¤ºé€’å½’æˆæƒ èŒƒä¾‹ï¼š\n#åˆ›å»ºç©ºæ–‡ä»¶ ansible all -m file -a 'path=/data/test.txt state=touch' ansible all -m file -a 'path=/data/test.txt state=absent' ansible all -m file -a \"path=/root/test.sh owner=wang mode=755\" #åˆ›å»ºç›®å½• ansible all -m file -a \"path=/data/mysql state=directory owner=mysql group=mysql\" #åˆ›å»ºè½¯é“¾æ¥ ansible all -m file -a 'src=/data/testfile path|dest|name=/data/testfile-link state=link' #åˆ›å»ºç›®å½• ansible all -m file -a 'path=/data/testdir state=directory' #é€’å½’ä¿®æ”¹ç›®å½•å±æ€§,ä½†ä¸é€’å½’è‡³å­ç›®å½• ansible all -m file -a \"path=/data/mysql state=directory owner=mysql group=mysql\" #é€’å½’ä¿®æ”¹ç›®å½•åŠå­ç›®å½•çš„å±æ€§ ansible all -m file -a \"path=/data/mysql state=directory owner=mysql group=mysql recurse=yes\" stat æ¨¡å— åŠŸèƒ½ï¼šæ£€æŸ¥æ–‡ä»¶æˆ–æ–‡ä»¶ç³»ç»Ÿçš„çŠ¶æ€ æ³¨æ„ï¼šå¯¹äºWindowsç›®æ ‡ï¼Œè¯·æ”¹ç”¨win_statæ¨¡å—\nå¸¸è§é€‰é¡¹\npath #æ–‡ä»¶/å¯¹è±¡çš„å®Œæ•´è·¯å¾„ï¼ˆå¿…é¡»ï¼‰ å¸¸ç”¨çš„è¿”å›å€¼åˆ¤æ–­ï¼š\nexistsï¼š åˆ¤æ–­æ˜¯å¦å­˜åœ¨ isuidï¼š è°ƒç”¨ç”¨æˆ·çš„IDä¸æ‰€æœ‰è€…IDæ˜¯å¦åŒ¹é… èŒƒä¾‹:\n[root@ansible ~]#ansible 127.0.0.1 -m stat -a 'path=/etc/passwd' 127.0.0.1 | SUCCESS =\u003e { \"changed\": false, \"stat\": { \"atime\": 1614601466.7493012, \"attr_flags\": \"\", \"attributes\": [], \"block_size\": 4096, \"blocks\": 8, \"charset\": \"us-ascii\", \"checksum\": \"8f7a9a996d24de98bf1eab4a047f8e89e9c708cf\", \"ctime\": 1614334259.4498665, \"dev\": 2050, \"device_type\": 0, \"executable\": false, \"exists\": true, \"gid\": 0, \"gr_name\": \"root\", \"inode\": 134691833, \"isblk\": false, \"ischr\": false, \"isdir\": false, \"isfifo\": false, \"isgid\": false, \"islnk\": false, \"isreg\": true, \"issock\": false, \"isuid\": false, \"mimetype\": \"text/plain\", \"mode\": \"0000\", \"mtime\": 1614334259.4498665, \"nlink\": 1, \"path\": \"/etc/passwd\", \"pw_name\": \"root\", \"readable\": true, \"rgrp\": false, \"roth\": false, \"rusr\": false, \"size\": 1030, \"uid\": 0, \"version\": \"671641160\", \"wgrp\": false, \"woth\": false, \"writeable\": true, \"wusr\": false, \"xgrp\": false, \"xoth\": false, \"xusr\": false } } æ¡ˆä¾‹ï¼š\n- name: install | Check if file is already configured. stat: path={{ nginx_file_path }} connection: local register: nginx_file_result - name: install | Download nginx file get_url: url={{ nginx_file_url }} dest={{ software_files_path }} validate_certs=no connection: local when:ï¼Œnot. nginx_file_result.stat.exists èŒƒä¾‹:\n[root@ansible ansible]#cat stat.yml --- - hosts: websrvs tasks: - name: check file stat: path=/data/mysql register: st - name: debug debug: msg: \"/data/mysql is not exist\" when: not st.stat.exists [root@ansible ansible]#ansible-playbook stat.yml PLAY [websrvs] ******************************************************************************** *************************************** TASK [Gathering Facts] ******************************************************************************** ******************************* ok: [10.0.0.7] ok: [10.0.0.8] TASK [check file] ******************************************************************************** ************************************ ok: [10.0.0.7] ok: [10.0.0.8] TASK [debug] ******************************************************************************** ***************************************** ok: [10.0.0.7] =\u003e { \"msg\": \"/data/mysql is not exist\" } ok: [10.0.0.8] =\u003e { \"msg\": \"/data/mysql is not exist\" } PLAY RECAP ******************************************************************************** ******************************************* 10.0.0.7 : ok=3 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 10.0.0.8 : ok=3 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 unarchive æ¨¡å— åŠŸèƒ½ï¼šè§£åŒ…è§£å‹ç¼© å®ç°æœ‰ä¸¤ç§ç”¨æ³•ï¼š\nå°†ansibleä¸»æœºä¸Šçš„å‹ç¼©åŒ…ä¼ åˆ°è¿œç¨‹ä¸»æœºåè§£å‹ç¼©è‡³ç‰¹å®šç›®å½•ï¼Œè®¾ç½®remote_src=no,æ­¤ä¸ºé»˜è®¤å€¼,å¯çœç•¥ å°†è¿œç¨‹æœ¬ä¸»æœºä¸Šæˆ–éansibleçš„å…¶å®ƒä¸»æœºçš„æŸä¸ªå‹ç¼©åŒ…è§£å‹ç¼©åˆ°è¿œç¨‹ä¸»æœºæœ¬æœºçš„æŒ‡å®šè·¯å¾„ä¸‹ï¼Œéœ€è¦è®¾ç½®remote_src=yes å¸¸è§å‚æ•°ï¼š\nremote_src #å’ŒcopyåŠŸèƒ½ä¸€æ ·ä¸”é€‰é¡¹äº’æ–¥ï¼Œyesè¡¨ç¤ºæºæ–‡ä»¶åœ¨è¿œç¨‹è¢«æ§ä¸»æœºæˆ–å…¶å®ƒéansibleçš„å…¶å®ƒä¸»æœºä¸Šï¼Œnoè¡¨ç¤ºæ–‡ä»¶åœ¨ansibleä¸»æœºä¸Š,é»˜è®¤å€¼ä¸ºno, æ­¤é€‰é¡¹ä»£æ›¿copyé€‰é¡¹ copy #é»˜è®¤ä¸ºyesï¼Œå½“copy=yesï¼Œæ‹·è´çš„æ–‡ä»¶æ˜¯ä»ansibleä¸»æœºå¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºä¸Šï¼Œå¦‚æœè®¾ç½®ä¸ºcopy=noï¼Œä¼šåœ¨è¿œç¨‹ä¸»æœºä¸Šå¯»æ‰¾srcæºæ–‡ä»¶,æ­¤é€‰é¡¹å·²åºŸå¼ƒ src #æºè·¯å¾„ï¼Œå¯ä»¥æ˜¯ansibleä¸»æœºä¸Šçš„è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯è¿œç¨‹ä¸»æœº(è¢«ç®¡ç†ç«¯æˆ–è€…ç¬¬ä¸‰æ–¹ä¸»æœº)ä¸Šçš„è·¯å¾„ï¼Œå¦‚æœæ˜¯è¿œç¨‹ä¸»æœºä¸Šçš„è·¯å¾„ï¼Œåˆ™éœ€è¦è®¾ç½®remote_src=yes dest #è¿œç¨‹ä¸»æœºä¸Šçš„ç›®æ ‡è·¯å¾„ mode #è®¾ç½®è§£å‹ç¼©åçš„æ–‡ä»¶æƒé™ creates=/path/file #å½“ç»å¯¹è·¯å¾„/path/fileä¸å­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ èŒƒä¾‹ï¼š\nansible all -m unarchive -a 'src=/data/foo.tgz dest=/var/lib/foo owner=wang group=bin' ansible all -m unarchive -a 'src=/tmp/foo.zip dest=/data mode=0777' ansible all -m unarchive -a 'src=https://example.com/example.zip dest=/data ' ansible websrvs -m unarchive -a 'src=https://releases.ansible.com/ansible/ansible-2.1.6.0-0.1.rc1.tar.gz dest=/data/ owner=root remote_src=yes' ansible websrvs -m unarchive -a 'src=http://nginx.org/download/nginx- 1.18.0.tar.gz dest=/usr/local/src/ remote_src=yes'' Archive æ¨¡å— åŠŸèƒ½ï¼šæ‰“åŒ…å‹ç¼©ä¿å­˜åœ¨è¢«ç®¡ç†èŠ‚ç‚¹\nå¸¸è§é€‰é¡¹\npath #å‹ç¼©çš„æ–‡ä»¶æˆ–ç›®å½• dest #å‹ç¼©åçš„æ–‡ä»¶ format #å‹ç¼©æ ¼å¼,æ”¯æŒgz,bz2,xz,tar,zip èŒƒä¾‹ï¼š\nansible websrvs -m archive -a 'path=/var/log/ dest=/data/log.tar.bz2 format=bz2 owner=wang mode=0600' Hostname æ¨¡å— åŠŸèƒ½ï¼šç®¡ç†ä¸»æœºå å¸¸è§é€‰é¡¹\nname #ä¿®æ”¹åçš„ä¸»æœºåç§° èŒƒä¾‹ï¼š\nansible node1 -m hostname -a \"name=websrv\" ansible 10.0.0.18 -m hostname -a 'name=node18.wang.org' Cron æ¨¡å— åŠŸèƒ½ï¼šè®¡åˆ’ä»»åŠ¡ æ”¯æŒæ—¶é—´ï¼šminuteï¼Œhourï¼Œdayï¼Œmonthï¼Œweekday å¸¸è§é€‰é¡¹\nname #æè¿°è„šæœ¬çš„ä½œç”¨ minute #åˆ†é’Ÿ hour #å°æ—¶ weekday #å‘¨ user #ä»»åŠ¡ç”±å“ªä¸ªç”¨æˆ·è¿è¡Œï¼›é»˜è®¤root job #ä»»åŠ¡ èŒƒä¾‹ï¼š\n#å¤‡ä»½æ•°æ®åº“è„šæœ¬ [root@centos8 ~]#cat /root/mysql_backup.sh #!/bin/bash mysqldump -A -F --single-transaction --master-data=2 -q -uroot |gzip \u003e /data/mysql_`date +%F_%T`.sql.gz #åˆ›å»ºä»»åŠ¡ ansible 10.0.0.8 -m cron -a 'hour=2 minute=30 weekday=1-5 name=\"backup mysql\" job=/root/mysql_backup.sh' ansible websrvs -m cron -a \"minute=*/5 job='/usr/sbin/ntpdate ntp.aliyun.com \u0026\u003e/dev/null' name=Synctime\" #ç¦ç”¨è®¡åˆ’ä»»åŠ¡ ansible websrvs -m cron -a \"minute=*/5 job='/usr/sbin/ntpdate 172.20.0.1 \u0026\u003e/dev/null' name=Synctime disabled=yes\" #å¯ç”¨è®¡åˆ’ä»»åŠ¡ ansible websrvs -m cron -a \"minute=*/5 job='/usr/sbin/ntpdate 172.20.0.1 \u0026\u003e /dev/null' name=Synctime disabled=no\" #åˆ é™¤ä»»åŠ¡ ansible websrvs -m cron -a \"name='backup mysql' state=absent\" ansible websrvs -m cron -a 'state=absent name=Synctime' Yum å’Œ Apt æ¨¡å— åŠŸèƒ½ï¼šç®¡ç†è½¯ä»¶åŒ… yum ç®¡ç†è½¯ä»¶åŒ…ï¼Œåªæ”¯æŒRHELï¼ŒCentOSï¼Œfedoraï¼Œä¸æ”¯æŒUbuntuå…¶å®ƒç‰ˆæœ¬ apt æ¨¡å—ç®¡ç† Debian ç›¸å…³ç‰ˆæœ¬çš„è½¯ä»¶åŒ… yumå¸¸è§é€‰é¡¹\nname #è½¯ä»¶åŒ…åç§° state #çŠ¶æ€ =present #å®‰è£…,æ­¤ä¸ºé»˜è®¤å€¼ =absent #åˆ é™¤ =latest #æœ€æ–°ç‰ˆ list #åˆ—å‡ºæŒ‡å®šåŒ… enablerepo #å¯ç”¨å“ªä¸ªä»“åº“å®‰è£… disablerepo #ä¸ä½¿ç”¨å“ªäº›ä»“åº“çš„åŒ… exclude #æ’é™¤æŒ‡å®šçš„åŒ… validate #æ˜¯å¦æ£€éªŒ,é»˜è®¤ä¸ºyes èŒƒä¾‹ï¼š\n[root@ansible ~]#ansible websrvs -m yum -a 'name=httpd state=present' #å®‰è£…zabbix agent rpmåŒ… [root@ansible ~]#ansible websrvs -m yum -a 'name=https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/5.0/rhel/8/x86_64/zabbix-agent2-5.0.24-1.el8.x86_64.rpm state=present validate_certs=no' #å¯ç”¨epelæºè¿›è¡Œå®‰è£… [root@ansible ~]#ansible websrvs -m yum -a 'name=nginx state=present enablerepo=epel' #å‡çº§é™¤kernelå’Œfooå¼€å¤´ä»¥å¤–çš„æ‰€æœ‰åŒ… [root@ansible ~]#ansible websrvs -m yum -a 'name=* state=lastest exclude=kernel*,foo*' #åˆ é™¤ [root@ansible ~]#ansible websrvs -m yum -a 'name=httpd state=absent' [root@ansible ~]#ansible websrvs -m yum -a 'name=sl,cowsay' yum_repository æ¨¡å— åŠŸèƒ½: æ­¤æ¨¡å—å®ç°yumçš„ä»“åº“é…ç½®ç®¡ç† å¸¸è§é€‰é¡¹\nname #ä»“åº“id description #ä»“åº“æè¿°åç§°,å¯¹åº”é…ç½®æ–‡ä»¶ä¸­çš„name= baseurl #ä»“åº“çš„åœ°å€ gpgcheck #éªŒè¯å¼€å¯ gpgkey #ä»“åº“å…¬é’¥è·¯å¾„ state=absen #åˆ é™¤ èŒƒä¾‹ï¼š\nansible websrvs -m yum_repository -a 'name=ansible_nginx description=\"nginx repo\" baseurl=\"http://nginx.org/packages/centos/$releasever/$basearch/\" gpgcheck=yes gpgkey=\"https://nginx.org/keys/nginx_signing.key\"' [root@rocky8 ~]#cat /etc/yum.repos.d/ansible_nginx.repo [ansible_nginx] baseurl = http://nginx.org/packages/centos/$releasever/$basearch/ gpgcheck = 1 gpgkey = https://nginx.org/keys/nginx_signing.key name = nginx repo Service æ¨¡å— æ­¤æ¨¡å—å’ŒsytemdåŠŸèƒ½ç›¸ä¼¼,é€‰é¡¹å¾ˆå¤šç›¸åŒ åŠŸèƒ½ï¼šç®¡ç†æœåŠ¡ å¸¸è§é€‰é¡¹\nname #æœåŠ¡åç§° state #æœåŠ¡çŠ¶æ€ =started #å¯åŠ¨ =stopped #åœæ­¢ =restarted #é‡å¯ =reloaded #é‡è½½ enabled #å¼€å¯è‡ªå¯åŠ¨ daemon_reload #åŠ è½½æ–°çš„é…ç½®æ–‡ä»¶,é€‚ç”¨äºsystemdæ¨¡å— èŒƒä¾‹ï¼š\nansible all -m service -a 'name=httpd state=started enabled=yes' ansible all -m service -a 'name=httpd state=stopped' ansible all -m service -a 'name=httpd state=reloaded' ansible all -m shell -a \"sed -i 's/^Listen 80/Listen 8080/' /etc/httpd/conf/httpd.conf\" ansible all -m service -a 'name=httpd state=restarted' #é‡å¯åŠ¨æŒ‡å®šç½‘å¡æœåŠ¡ ansible all -m service -a 'name=network state=absent args=eth0' User æ¨¡å— åŠŸèƒ½ï¼šç®¡ç†ç”¨æˆ· å¸¸è§é€‰é¡¹\nname #åˆ›å»ºçš„åç§° uid #æŒ‡å®šuid group #æŒ‡å®šåŸºæœ¬ç»„ shell #ç™»å½•shellç±»å‹é»˜è®¤/bin/bash create_home #æ˜¯å¦åˆ›å»ºå®¶ç›®å½• password #è®¾å®šå¯¹åº”çš„å¯†ç ï¼Œå¿…é¡»æ˜¯åŠ å¯†åçš„å­—ç¬¦ä¸²æ‰è¡Œï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆ system #yesè¡¨ç¤ºç³»ç»Ÿç”¨æˆ· groups #é™„åŠ ç»„ append #è¿½åŠ é™„åŠ ç»„ä½¿ç”¨,yesè¡¨ç¤ºå¢åŠ æ–°çš„é™„åŠ ç»„ state #absenåˆ é™¤ remove #yesè¡¨ç¤ºåˆ é™¤ç”¨æˆ·æ—¶å°†å®¶ç›®å½•ä¸€èµ·åˆ é™¤ generate_ssh_key #åˆ›å»ºç§é’¥ ssh_keyu_bits #ç§é’¥ä½æ•° ssh_key_file #ç§é’¥æ–‡ä»¶è·¯å¾„ èŒƒä¾‹ï¼š\n#åˆ›å»ºç”¨æˆ· ansible all -m user -a 'name=user1 comment=\"test user\" uid=2048 home=/app/user1group=root' ansible all -m user -a 'name=nginx comment=nginx uid=88 group=nginxgroups=\"root,daemon\" shell=/sbin/nologin system=yes create_home=nohome=/data/nginx non_unique=yes' #remove=yesè¡¨ç¤ºåˆ é™¤ç”¨æˆ·åŠå®¶ç›®å½•ç­‰æ•°æ®,é»˜è®¤remove=no ansible all -m user -a 'name=nginx state=absent remove=yes' #ç”Ÿæˆ123456åŠ å¯†çš„å¯†ç  ansible localhost -m debug -a \"msg={{ '123456'| password_hash('sha512','salt')}}\" localhost | SUCCESS =\u003e { \"msg\": \"$6$salt$MktMKPZJ6t59GfxcJU20DwcwQzfMvOlHFVZiOVD71w.\" } #ç”¨ä¸Šé¢åˆ›å»ºçš„å¯†ç åˆ›å»ºç”¨æˆ· ansible websrvs -m user -a 'name=www group=www system=yes shell=/sbin/nlogin password=\"$6$salt$MktMKPZJ6t59GfxcJU20DwcwQzfMvOlHFVZiOVD71w.\"' #åˆ›å»ºç”¨æˆ·test,å¹¶ç”Ÿæˆ4096bitçš„ç§é’¥ ansible websrvs -m user -a 'name=test generate_ssh_key=yes ssh_key_bits=4096 ssh_key_file=.ssh/id_rsa' Group æ¨¡å— åŠŸèƒ½ï¼šç®¡ç†ç»„ å¸¸è§é€‰é¡¹\nname #æŒ‡å®šç»„åç§° gid #æŒ‡å®šgid state =present #åˆ›å»º,é»˜è®¤ =absent #åˆ é™¤ èŒƒä¾‹ï¼š\n#åˆ›å»ºç»„ ansible websrvs -m group -a 'name=nginx gid=88 system=yes' #åˆ é™¤ç»„ ansible websrvs -m group -a 'name=nginx state=absent' Lineinfile æ¨¡å— ansibleåœ¨ä½¿ç”¨sedè¿›è¡Œæ›¿æ¢æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦è½¬ä¹‰çš„é—®é¢˜ï¼Œè€Œä¸”ansibleåœ¨é‡åˆ°ç‰¹æ®Šç¬¦å·è¿›è¡Œæ›¿æ¢æ—¶ï¼Œ ä¼šå­˜åœ¨é—®é¢˜ï¼Œæ— æ³•æ­£å¸¸è¿›è¡Œæ›¿æ¢ ã€‚\nansibleè‡ªèº«æä¾›äº†ä¸¤ä¸ªæ¨¡å—ï¼šlineinfileæ¨¡å—å’Œreplaceæ¨¡å—ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œæ›¿æ¢ä¸€èˆ¬åœ¨ansibleå½“ä¸­å»ä¿®æ”¹æŸä¸ªæ–‡ä»¶çš„å•è¡Œè¿›è¡Œæ›¿æ¢çš„æ—¶å€™éœ€è¦ä½¿ç”¨lineinfileæ¨¡å— åŠŸèƒ½ï¼šç›¸å½“äºsedï¼Œä¸»è¦ç”¨äºä¿®æ”¹ä¸€è¡Œçš„æ–‡ä»¶å†…å®¹ å¸¸è§é€‰é¡¹\npath #è¢«æ§ç«¯æ–‡ä»¶çš„è·¯å¾„ regexp #æ­£åˆ™åŒ¹é…è¯­æ³•æ ¼å¼,è¡¨ç¤ºè¢«æ›¿æ¢çš„å†…å®¹ line #æ›¿æ¢ä¸ºçš„å†…å®¹ state #absentè¡¨ç¤ºåˆ é™¤ insertafter #æ’å…¥åˆ°æ›¿æ¢å†…å®¹å‰é¢,å¦‚å’ŒregexpåŒæ—¶å­˜åœ¨,åªåœ¨æ²¡æ‰¾åˆ°ä¸regexpåŒ¹é…æ—¶æ‰ä½¿ç”¨ insertafter insertbefore #æ’å…¥åˆ°æ›¿æ¢å†…å®¹åé¢,å¦‚å’ŒregexpåŒæ—¶å­˜åœ¨,åªåœ¨æ²¡æ‰¾åˆ°ä¸regexpåŒ¹é…æ—¶æ‰ä½¿ç”¨ insertafter backrefs #æ”¯æŒåé¢å¼•ç”¨,yeså’Œno backup #ä¿®æ”¹å‰å…ˆå¤‡ä»½ create #å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨,åˆ™åˆ›å»º,é»˜è®¤ä¸å­˜åœ¨ä¼šå‡ºé”™ mode #æŒ‡å®šæƒé™ owner #æŒ‡å®šç”¨æˆ· group #æŒ‡å®šç»„ #æ³¨æ„ regexpå‚æ•° ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¯¹åº”çš„è¡Œï¼Œå½“æ›¿æ¢æ–‡æœ¬æ—¶ï¼Œå¦‚æœæœ‰å¤šè¡Œæ–‡æœ¬éƒ½èƒ½è¢«åŒ¹é…ï¼Œåˆ™åªæœ‰æœ€åé¢è¢« åŒ¹é…åˆ°çš„é‚£è¡Œæ–‡æœ¬æ‰ä¼šè¢«æ›¿æ¢ï¼Œå½“åˆ é™¤æ–‡æœ¬æ—¶ï¼Œå¦‚æœæœ‰å¤šè¡Œæ–‡æœ¬éƒ½èƒ½è¢«åŒ¹é…ï¼Œè¿™ä¹ˆè¿™äº›è¡Œéƒ½ä¼šè¢«åˆ é™¤ã€‚ æ³¨æ„: å¦‚æœæƒ³è¿›è¡Œå¤šè¡ŒåŒ¹é…è¿›è¡Œæ›¿æ¢éœ€è¦ä½¿ç”¨replaceæ¨¡å— èŒƒä¾‹ï¼š\n#ä¿®æ”¹ç›‘å¬ç«¯å£ ansible websrvs -m lineinfile -a \"path=/etc/httpd/conf/httpd.conf regexp='^Listen' line='Listen 8080'\" #ä¿®æ”¹SELinux ansible all -m lineinfile -a \"path=/etc/selinux/config regexp='^SELINUX='line='SELINUX=disabled'\" #æ·»åŠ ç½‘å…³ ansible webservers -m lineinfile -a 'path=/etc/sysconfig/network-scripts/ifcfg-eth0 line=\"GATEWAY=10.0.0.254\"' #ç»™ä¸»æœºå¢åŠ ä¸€ä¸ªç½‘å…³ï¼Œä½†éœ€è¦å¢åŠ åˆ°NAME=ä¸‹é¢ ansible webservers -m lineinfile -a 'path=/etc/sysconfig/network-scripts/ifcfg-eth0 insertafter=\"^NAME=\" line=\"GATEWAY=10.0.0.254\"' #æ•ˆæœå¦‚ä¸‹ cat /etc/sysconfig/network-scripts/ifcfg-eth0 DEVICE=eth0 NAME=eth0 GATEWAY=10.0.0.254 #ç»™ä¸»æœºå¢åŠ ä¸€ä¸ªç½‘å…³ï¼Œä½†éœ€è¦å¢åŠ åˆ°NAME=ä¸Šé¢ ansible webservers -m lineinfile -a 'path=/etc/sysconfig/network-scripts/ifcfg- eth0 insertbefore=\"^NAME=\" line=\"GATEWAY=10.0.0.254\"' #æ•ˆæœå¦‚ä¸‹ cat /etc/sysconfig/network-scripts/ifcfg-eth0 DEVICE=eth0 GATEWAY=10.0.0.254 NAME=eth0 #åˆ é™¤ç½‘å…³ ansible webservers -m lineinfile -a 'path=/etc/sysconfig/network-scripts/ifcfg-eth0 regexp=\"^GATEWAY\" state=absent' #åˆ é™¤#å¼€å¤´çš„è¡Œ ansible all -m lineinfile -a 'dest=/etc/fstab state=absent regexp=\"^#\"' Replace æ¨¡å— è¯¥æ¨¡å—æœ‰ç‚¹ç±»ä¼¼äºsedå‘½ä»¤ï¼Œä¸»è¦ä¹Ÿæ˜¯åŸºäºæ­£åˆ™è¿›è¡ŒåŒ¹é…å’Œæ›¿æ¢ï¼Œå»ºè®®ä½¿ç”¨ åŠŸèƒ½: å¤šè¡Œä¿®æ”¹æ›¿æ¢ å¸¸è§é€‰é¡¹\npath #è¢«æ§ç«¯æ–‡ä»¶çš„è·¯å¾„ regexp #æ­£åˆ™åŒ¹é…è¯­æ³•æ ¼å¼,è¡¨ç¤ºè¢«æ›¿æ¢çš„å†…å®¹ replace #æ›¿æ¢ä¸ºçš„å†…å®¹ after #æ’å…¥åˆ°æ›¿æ¢å†…å®¹å‰é¢, before #æ’å…¥åˆ°æ›¿æ¢å†…å®¹åé¢ backup #ä¿®æ”¹å‰å…ˆå¤‡ä»½ mode #æŒ‡å®šæƒé™ owner #æŒ‡å®šç”¨æˆ· group #æŒ‡å®šç»„ èŒƒä¾‹\nansible all -m replace -a \"path=/etc/fstab regexp='^(UUID.*)' replace='#\\1'\" ansible all -m replace -a \"path=/etc/fstab regexp='^#(UUID.*)' replace='\\1'\" SELinux æ¨¡å— åŠŸèƒ½: è¯¥æ¨¡å—ç®¡ç† SELInux ç­–ç•¥ å¸¸è§é€‰é¡¹\npolicy #æŒ‡å®šSELINUXTYPE=targeted state #æŒ‡å®šSELINUX=disabled èŒƒä¾‹\n[root@rocky ansible-apps]# ansible 192.168.32.132 -m selinux -a 'state=disabled' 192.168.32.132 | FAILED! =\u003e { \"msg\": \"The module selinux was redirected to ansible.posix.selinux, which could not be loaded.\" } # ansibleç‰ˆæœ¬2.13.3å‡ºç°å¦‚ä¸‹é”™è¯¯ \"msg\": \"The module selinux was redirected to ansible.posix.selinux, which could not be loaded.\" # è§£å†³æ–¹æ³• [root@rocky ansible-apps]# ansible-galaxy collection install ansible.posix # å†æ¬¡æ‰§è¡Œï¼Œæ˜¾ç¤ºæˆåŠŸ [root@rocky ansible-apps]# ansible 192.168.32.132 -m selinux -a 'state=disabled' [WARNING]: SELinux state temporarily changed from 'enforcing' to 'permissive'. State change will take effect next reboot. 192.168.32.132 | CHANGED =\u003e { \"ansible_facts\": { \"discovered_interpreter_python\": \"/usr/libexec/platform-python\" }, \"changed\": true, \"configfile\": \"/etc/selinux/config\", \"msg\": \"Config SELinux state changed from 'enforcing' to 'disabled'\", \"policy\": \"targeted\", \"reboot_required\": true, \"state\": \"disabled\" } reboot æ¨¡å— åŠŸèƒ½: é‡å¯ å¸¸è§é€‰é¡¹\nmsg #é‡å¯æç¤º pre_reboot_delay #é‡å¯å‰å»¶è¿Ÿæ—¶é—´çš„ç§’æ•° post_reboot_delay #é‡å¯åå»¶è¿Ÿæ—¶é—´çš„ç§’æ•°å,å†éªŒè¯ç³»ç»Ÿæ­£å¸¸å¯åŠ¨ reboot_timeout #é‡å¯åå»¶è¿Ÿæ—¶é—´å†æ‰§è¡Œæµ‹è¯•æˆåŠŸä¸å¦çš„å‘½ä»¤ test_command #æ‰§è¡Œæµ‹è¯•æˆåŠŸä¸å¦çš„å‘½ä»¤ èŒƒä¾‹:\n[root@ansible ~]#ansible websrvs -m reboot -a 'msg=\"host will be reboot\"' mount æ¨¡å— åŠŸèƒ½: æŒ‚è½½å’Œå¸è½½æ–‡ä»¶ç³»ç»Ÿ å¸¸è§é€‰é¡¹\nsrc #æºè®¾å¤‡è·¯å¾„ï¼Œæˆ–ç½‘ç»œåœ°å€ path #æŒ‚è½½è‡³æœ¬åœ°å“ªä¸ªè·¯å¾„ä¸‹ fstype #è®¾å¤‡ç±»å‹ï¼› nfs opts #æŒ‚è½½çš„é€‰é¡¹ state #æŒ‚è½½è¿˜æ˜¯å¸è½½ =present #æ°¸ä¹…æŒ‚è½½ï¼Œä½†æ²¡æœ‰ç«‹å³ç”Ÿæ•ˆ =absent #å¸è½½ä¸´æ—¶æŒ‚è½½,å¹¶åˆ é™¤æ°¸ä¹…æŒ‚è½½ =mounted #ä¸´æ—¶æŒ‚è½½ =unmounted #ä¸´æ—¶å¸è½½ èŒƒä¾‹:\n#ä¿®æ”¹fstabæ–‡ä»¶æ°¸ä¹…æŒ‚è½½,ä½†ä¸ç«‹å³ç”Ÿæ•ˆ mount websrvs -m mount -a 'src=\"UUID=b3e48f45-f933-4c8e-a700-22a159ec9077\" path=/home fstype=xfs opts=noatime state=present' #ä¸´æ—¶å–æ¶ˆæŒ‚è½½ mount websrvs -m mount -a 'path=/home fstype=xfs opts=noatime state=unmounted' #æ°¸ä¹…æŒ‚è½½,å¹¶ç«‹å³ç”Ÿæ•ˆ ansible websrvs -m mount -a 'src=10.0.0.8:/data/wordpress path=/var/www/html/wp- content/uploads opts=\"_netdev\" state=mounted' #æ°¸ä¹…å¸è½½,å¹¶ç«‹å³ç”Ÿæ•ˆ ansible websrvs -m mount -a 'src=10.0.0.8:/data/wordpress path=/var/www/html/wp- content/uploads state=absent' Setup æ¨¡å— åŠŸèƒ½ï¼š setup æ¨¡å—æ¥æ”¶é›†ä¸»æœºçš„ç³»ç»Ÿä¿¡æ¯ï¼Œè¿™äº› facts ä¿¡æ¯å¯ä»¥ç›´æ¥ä»¥å˜é‡çš„å½¢å¼ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœä¸»æœº è¾ƒå¤šï¼Œä¼šå½±å“æ‰§è¡Œé€Ÿåº¦ å¯ä»¥ä½¿ç”¨ gather_facts: no æ¥ç¦æ­¢ Ansible æ”¶é›† facts ä¿¡æ¯ å¸¸è§é€‰é¡¹\nfilter #æŒ‡å®šè¿‡æ»¤æ¡ä»¶ èŒƒä¾‹:\nansible all -m setup ansible all -m setup -a \"filter=ansible_nodename\" ansible all -m setup -a \"filter=ansible_hostname\" # ä¸»æœºåç§° ansible all -m setup -a \"filter=ansible_domain\" ansible all -m setup -a \"filter=ansible_memtotal_mb\" ansible all -m setup -a \"filter=ansible_memory_mb\" ansible all -m setup -a \"filter=ansible_memfree_mb\" ansible all -m setup -a \"filter=ansible_os_family\" ansible all -m setup -a \"filter=ansible_distribution\" ansible all -m setup -a \"filter=ansible_distribution_major_version\" ansible all -m setup -a \"filter=ansible_distribution_version\" ansible all -m setup -a \"filter=ansible_processor_vcpus\" ansible all -m setup -a \"filter=ansible_all_ipv4_addresses\" ansible all -m setup -a \"filter=ansible_architecture\" ansible all -m setup -a \"filter=ansible_uptime_seconds\" ansible all -m setup -a \"filter=ansible_processor*\" ansible all -m setup -a 'filter=ansible_env' èŒƒä¾‹ï¼š\n[root@ansible ~]#ansible all -m setup -a 'filter=ansible_python_version' 10.0.0.7 | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_python_version\": \"2.7.5\", \"discovered_interpreter_python\": \"/usr/bin/python\" }, \"changed\": false } 10.0.0.6 | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_python_version\": \"2.6.6\", \"discovered_interpreter_python\": \"/usr/bin/python\" }, \"changed\": false } 10.0.0.8 | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_python_version\": \"3.6.8\", \"discovered_interpreter_python\": \"/usr/libexec/platform-python\" }, \"changed\": false } [root@ansible ~]# èŒƒä¾‹ï¼šå–IPåœ°å€\n#å–æ‰€æœ‰IP ansible 10.0.0.101 -m setup -a 'filter=ansible_all_ipv4_addresses' 10.0.0.101 | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_all_ipv4_addresses\": [ \"192.168.0.1\", \"192.168.0.2\", \"192.168.64.238\", \"192.168.13.36\", \"10.0.0.101\", \"172.16.1.0\", \"172.17.0.1\" ] }, \"changed\": false } #å–é»˜è®¤IP ansible all -m setup -a 'filter=\"ansible_default_ipv4\"' 10.0.0.101 | SUCCESS =\u003e { \"ansible_facts\": { \"ansible_default_ipv4\": { \"address\": \"10.0.0.101\", \"alias\": \"eth0\", \"broadcast\": \"10.0.0.255\", \"gateway\": \"10.0.0.2\", \"interface\": \"eth0\", \"macaddress\": \"00:0c:29:e8:c7:9b\", \"mtu\": 1500, \"netmask\": \"255.255.255.0\", \"network\": \"10.0.0.0\", \"type\": \"ether\" } }, \"changed\": false } debug æ¨¡å— åŠŸèƒ½: æ­¤æ¨¡å—å¯ä»¥ç”¨äºè¾“å‡ºä¿¡æ¯,å¹¶ä¸”é€šè¿‡ msg å®šåˆ¶è¾“å‡ºçš„ä¿¡æ¯å†…å®¹,åŠŸèƒ½ç±»ä¼¼äºechoå‘½ä»¤ æ³¨æ„: msgåé¢çš„å˜é‡æœ‰æ—¶éœ€è¦åŠ  \" \" å¼•èµ·æ¥ å¸¸è§é€‰é¡¹\nmsg #æŒ‡å®šå‘½ä»¤è¾“å‡ºçš„ä¿¡æ¯ var #æŒ‡å®šå˜é‡å,å’Œmsgäº’æ–¥ verbosity #è¯¦ç»†åº¦ èŒƒä¾‹: debug æ¨¡å—é»˜è®¤è¾“å‡ºHello world\n[root@ansible ~]#ansible 10.0.0.18 -m debug 10.0.0.18 | SUCCESS =\u003e { \"msg\": \"Hello world!\" } [root@ansible ansible]#cat debug.yml --- - hosts: websrvs tasks: - name: output Hello world debug: #é»˜è®¤æ²¡æœ‰æŒ‡å®šmsg,é»˜è®¤è¾“å‡º\"Hello world!\" [root@ansible ansible]#ansible-playbook debug.yml ..... TASK [output variables] ******************************************************************************** ****************************** ok: [10.0.0.7] =\u003e { \"msg\": \"Hello world!\" } ok: [10.0.0.8] =\u003e { \"msg\": \"Hello world!\" } PLAY RECAP ******************************************************************************** ******************************************* 10.0.0.7 : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 10.0.0.8 : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 èŒƒä¾‹: åˆ©ç”¨debug æ¨¡å—è¾“å‡ºå˜é‡\n[root@centos8 ~]#cat debug.yaml --- - hosts: websrvs tasks: - name: output variables debug: msg: Host \"{{ ansible_nodename }}\" Ip \"{{ ansible_default_ipv4.address }}\" [root@centos8 ~]#ansible-playbook debug.yaml PLAY [websrvs] ******************************************************************************** *************************************** TASK [Gathering Facts] ******************************************************************************** ******************************* ok: [10.0.0.7] ok: [10.0.0.8] TASK [output variables] ******************************************************************************** ****************************** ok: [10.0.0.7] =\u003e { \"msg\": \"Host \\\"centos7.wangxiaochun.com\\\" Ip \\\"10.0.0.7\\\"\" } ok: [10.0.0.8] =\u003e { \"msg\": \"Host \\\"centos8.wangxiaochun.com\\\" Ip \\\"10.0.0.8\\\"\" } PLAY RECAP ******************************************************************************** ******************************************* 10.0.0.7 : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 10.0.0.8 : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 èŒƒä¾‹: æ˜¾ç¤ºå­—ç¬¦ä¸²ç‰¹å®šå­—ç¬¦\n# cat debug.yml - hosts: all gather_facts: no vars: a: \"12345\" tasks: - debug: msg: - \"{{a[0]}}\" - \"{{a[1]}}\" - \"{{a[2]}}\" #å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡aï¼Œå¦‚æœæƒ³è¦è·å–aå­—ç¬¦ä¸²çš„ç¬¬3ä¸ªå­—ç¬¦ï¼Œåˆ™å¯ä»¥ä½¿ç”¨â€a[2]â€è·å–ï¼Œç´¢å¼•ä»0å¼€å§‹ï¼Œæ‰§è¡Œä¸Šä¾‹playbookï¼Œdebugçš„è¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š TASK [debug] ************************* ok: [test1] =\u003e { \"msg\": \"1\" \"msg\": \"2\" \"msg\": \"3\" } sysctl æ¨¡å— åŠŸèƒ½: ä¿®æ”¹å†…æ ¸å‚æ•° å¸¸è§é€‰é¡¹\nname #å†…æ ¸å‚æ•° value #æŒ‡å®šå€¼ state #æ˜¯å¦ä¿å­˜åœ¨sysctl.confæ–‡ä»¶ä¸­,é»˜è®¤present sysctl_set #ä½¿ç”¨sysctl -w éªŒè¯å€¼ç”Ÿæ•ˆ èŒƒä¾‹:\nansible websrvs -m sysctl -a 'name=net.ipv4.ip_forward value=1 state=present' èŒƒä¾‹: å†…æ ¸å‚æ•°ä¼˜åŒ–\n- name: Change Port Range sysctl: name: net.ipv4.ip_local_port_range value: '1024 65000' sysctl_set: yes - name: Enabled Forward sysctl: name: net.ipv4.ip_forward value: '1' sysctl_set: yes - name: Enabled tcp_reuse sysctl: name: net.ipv4.tcp_tw_reuse value: '1' sysctl_set: yes - name: Chanage tcp tw_buckets sysctl: name: net.ipv4.tcp_max_tw_buckets value: '5000' sysctl_set: yes - name: Chanage tcp_syncookies sysctl: name: net.ipv4.tcp_syncookies value: '1' sysctl_set: yes - name: Chanage tcp max_syn_backlog sysctl: name: net.ipv4.tcp_max_syn_backlog value: '8192' sysctl_set: yes - name: Chanage tcp Established Maxconn sysctl: name: net.core.somaxconn value: '32768' sysctl_set: yes state: present - name: Chanage tcp_syn_retries sysctl: name: net.ipv4.tcp_syn_retries value: '2' sysctl_set: yes state: present - name: Chanage net.ipv4.tcp_synack_retries sysctl: name: net.ipv4.tcp_synack_retries value: '2' sysctl_set: yes state: presen pam_limits åŠŸèƒ½: ç®¡ç†èµ„æºé™åˆ¶ èŒƒä¾‹\n- name: Change Limit /etc/security/limit.conf pam_limits: domain: \"*\" limit_type: \"{{ item.limit_type }}\" limit_item: \"{{ item.limit_item }}\" value: \"{{ item.value }}\" loop: - { limit_type: 'soft', limit_item: 'nofile',value: '100000' } - { limit_type: 'hard', limit_item: 'nofile',value: '10000' } apt_repository æ¨¡å— åŠŸèƒ½: æ­¤æ¨¡å—å®ç°aptçš„ä»“åº“é…ç½®ç®¡ç† å¸¸è§é€‰é¡¹\nrepo #ä»“åº“ä¿¡æ¯ state #æ·»åŠ æˆ–åˆ é™¤ update_cache #æ˜¯å¦apt update,é»˜è®¤yes filename #ä»“åº“æ–‡ä»¶,é»˜è®¤æ”¾åœ¨/etc/apt/sources.list.d/file.list èŒƒä¾‹:\nansible ubuntu-servers -m apt_repository -a 'repo=\"deb http://archive.canonical.com/ubuntu focal partner\" filename=google-chrome' [root@ubuntu2004 ~]#cat /etc/apt/sources.list.d/google-chrome.list deb http://archive.canonical.com/ubuntu focal partner apt_key æ¨¡å— åŠŸèƒ½: æ·»åŠ å’Œåˆ é™¤apt key å¸¸è§é€‰é¡¹\nurl #keyè·¯å¾„ state #æ·»åŠ æˆ–åˆ é™¤ èŒƒä¾‹: ç”Ÿæˆcephä»“åº“é…ç½®\n#å…ˆå¯¼å…¥key,æ³¨æ„å…ˆåé¡ºåº ansible ubuntu-servers -m apt_key -a 'url=https://download.ceph.com/keys/release.asc state=present' #å†ç”Ÿæˆapté…ç½®,å¦‚æœä¸å¯¼å…¥keyæ­¤æ­¥ä¼šå‡ºé”™ ansible ubuntu-servers -m apt_repository -a 'repo=\"deb http://mirror.tuna.tsinghua.edu.cn/ceph/debian-pacific focal main\" filename=ansible_ceph' #éªŒè¯ç»“æœ [root@ubuntu2004 ~]#cat /etc/apt/sources.list.d/ansible_ceph.list deb http://mirror.tuna.tsinghua.edu.cn/ceph/debian-pacific focal main å…¶å®ƒæ¨¡å— ansible è¿˜æä¾›äº†å¾ˆå¤šé’ˆå¯¹å„ç§åº”ç”¨çš„æ¨¡å—,æ¯”å¦‚\nnginx_status_info nginx_status_facts mysql_db #éœ€è¦å®‰è£…MySQL-pythonåŒ… mysql_user #éœ€è¦å®‰è£…MySQL-pythonåŒ… redis mongodb* postgresql* haproxy git ",
  "wordCount" : "13552",
  "inLanguage": "en",
  "image":"https://colorfulgz.com/posts.images/banner/8.jpg","datePublished": "2023-02-21T19:12:21Z",
  "dateModified": "2023-02-21T19:12:21Z",
  "author":[{
    "@type": "Person",
    "name": ""
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://colorfulgz.com/posts/ansible/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "DevOpsHub",
    "logo": {
      "@type": "ImageObject",
      "url": "https://colorfulgz.com/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://colorfulgz.com" accesskey="h" title="DevOpsHub (Alt + H)">
            <img src="https://colorfulgz.com/img/Q.gif" alt="logo" aria-label="logo"
                 height="35">DevOpsHub</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://colorfulgz.com/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                <span>ğŸ” æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://colorfulgz.com/" title="ğŸ  ä¸»é¡µ">
                <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://colorfulgz.com/posts" title="ğŸ“š æ–‡ç« ">
                <span>ğŸ“š æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://colorfulgz.com/tags" title="ğŸ§© æ ‡ç­¾">
                <span>ğŸ§© æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://colorfulgz.com/archives/" title="â±ï¸ æ—¶é—´è½´">
                <span>â±ï¸ æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://colorfulgz.com/about" title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº">
                <span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://colorfulgz.com">ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://colorfulgz.com/posts/">ğŸ“šæ–‡ç« </a></div>
            <h1 class="post-title">
                è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(ä¸€)
            </h1>
            <div class="post-description">
                Ansible çš„åç§°æ¥è‡ªç§‘å¹»å°è¯´ã€Šå®‰å¾·çš„æ¸¸æˆã€‹ä¸­è·¨è¶Šæ—¶ç©ºçš„å³æ—¶é€šä¿¡å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ç›¸è·æ•°å…‰å¹´çš„è·ç¦»,è¿œç¨‹å®æ—¶æ§åˆ¶å‰çº¿çš„èˆ°é˜Ÿæˆ˜æ–—
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-02-21
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>13552å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>28åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://colorfulgz.com/tags/ansible/" style="color: var(--secondary)!important;">Ansible</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "https://colorfulgz.com"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="https://colorfulgz.com/posts.images/banner/8.jpg" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">æ–‡ç« ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#ansible%e4%bb%8b%e7%bb%8d%e5%92%8c%e6%9e%b6%e6%9e%84" aria-label="Ansibleä»‹ç»å’Œæ¶æ„">Ansibleä»‹ç»å’Œæ¶æ„</a></li>
                <li>
                    <a href="#ansible%e5%8f%91%e5%b1%95%e5%8f%b2" aria-label="Ansibleå‘å±•å²">Ansibleå‘å±•å²</a></li>
                <li>
                    <a href="#ansible-%e5%8a%9f%e8%83%bd" aria-label="Ansible åŠŸèƒ½">Ansible åŠŸèƒ½</a></li>
                <li>
                    <a href="#ansible-%e7%89%b9%e7%82%b9" aria-label="Ansible ç‰¹ç‚¹">Ansible ç‰¹ç‚¹</a></li>
                <li>
                    <a href="#ansible-%e6%9e%b6%e6%9e%84" aria-label="Ansible æ¶æ„">Ansible æ¶æ„</a><ul>
                        
                <li>
                    <a href="#ansible-%e7%bb%84%e6%88%90" aria-label="Ansible ç»„æˆ">Ansible ç»„æˆ</a></li>
                <li>
                    <a href="#ansible-%e5%91%bd%e4%bb%a4%e6%89%a7%e8%a1%8c%e6%9d%a5%e6%ba%90" aria-label="Ansible å‘½ä»¤æ‰§è¡Œæ¥æº">Ansible å‘½ä»¤æ‰§è¡Œæ¥æº</a></li>
                <li>
                    <a href="#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" aria-label="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</a></li></ul>
                </li>
                <li>
                    <a href="#ansible-%e5%ae%89%e8%a3%85%e5%92%8c%e5%b8%b8%e8%a7%81%e6%a8%a1%e5%9d%97" aria-label="Ansible å®‰è£…å’Œå¸¸è§æ¨¡å—">Ansible å®‰è£…å’Œå¸¸è§æ¨¡å—</a></li>
                <li>
                    <a href="#ansible-%e5%ae%89%e8%a3%85" aria-label="Ansible å®‰è£…">Ansible å®‰è£…</a><ul>
                        
                <li>
                    <a href="#%e5%8c%85%e5%ae%89%e8%a3%85%e6%96%b9%e5%bc%8f" aria-label="åŒ…å®‰è£…æ–¹å¼">åŒ…å®‰è£…æ–¹å¼</a></li>
                <li>
                    <a href="#pip%e5%ae%89%e8%a3%85" aria-label="pipå®‰è£…">pipå®‰è£…</a></li>
                <li>
                    <a href="#%e7%a1%ae%e8%ae%a4%e5%ae%89%e8%a3%85" aria-label="ç¡®è®¤å®‰è£…">ç¡®è®¤å®‰è£…</a></li></ul>
                </li>
                <li>
                    <a href="#ansible-%e7%9b%b8%e5%85%b3%e6%96%87%e4%bb%b6" aria-label="Ansible ç›¸å…³æ–‡ä»¶">Ansible ç›¸å…³æ–‡ä»¶</a><ul>
                        
                <li>
                    <a href="#ansible-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e5%88%97%e8%a1%a8" aria-label="Ansible é…ç½®æ–‡ä»¶åˆ—è¡¨">Ansible é…ç½®æ–‡ä»¶åˆ—è¡¨</a></li>
                <li>
                    <a href="#ansible-%e4%b8%bb%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6" aria-label="Ansible ä¸»é…ç½®æ–‡ä»¶">Ansible ä¸»é…ç½®æ–‡ä»¶</a></li>
                <li>
                    <a href="#inventory-%e4%b8%bb%e6%9c%ba%e6%b8%85%e5%8d%95%e6%96%87%e4%bb%b6" aria-label="Inventory ä¸»æœºæ¸…å•æ–‡ä»¶">Inventory ä¸»æœºæ¸…å•æ–‡ä»¶</a></li></ul>
                </li>
                <li>
                    <a href="#ansible%e7%9b%b8%e5%85%b3%e5%b7%a5%e5%85%b7" aria-label="Ansibleç›¸å…³å·¥å…·">Ansibleç›¸å…³å·¥å…·</a><ul>
                        
                <li>
                    <a href="#ansible" aria-label="ansible">ansible</a><ul>
                        
                <li>
                    <a href="#ansible-ad-hoc-%e4%bb%8b%e7%bb%8d" aria-label="Ansible Ad-Hoc ä»‹ç»">Ansible Ad-Hoc ä»‹ç»</a></li>
                <li>
                    <a href="#ansible-%e5%91%bd%e4%bb%a4%e7%94%a8%e6%b3%95" aria-label="ansible å‘½ä»¤ç”¨æ³•">ansible å‘½ä»¤ç”¨æ³•</a></li>
                <li>
                    <a href="#ansible%e7%9a%84host-pattern" aria-label="ansibleçš„Host-pattern">ansibleçš„Host-pattern</a><ul>
                        
                <li>
                    <a href="#ansible-%e5%91%bd%e4%bb%a4%e7%9a%84%e6%89%a7%e8%a1%8c%e8%bf%87%e7%a8%8b" aria-label="ansible å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹">ansible å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹</a></li>
                <li>
                    <a href="#ansible-%e5%91%bd%e4%bb%a4%e7%9a%84%e6%89%a7%e8%a1%8c%e7%8a%b6%e6%80%81" aria-label="ansible å‘½ä»¤çš„æ‰§è¡ŒçŠ¶æ€">ansible å‘½ä»¤çš„æ‰§è¡ŒçŠ¶æ€</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#ansible-console" aria-label="ansible-console">ansible-console</a></li>
                <li>
                    <a href="#ansible-playbook" aria-label="ansible-playbook">ansible-playbook</a></li>
                <li>
                    <a href="#ansible-vault" aria-label="ansible-vault">ansible-vault</a></li>
                <li>
                    <a href="#ansible-galaxy" aria-label="ansible-galaxy">ansible-galaxy</a></li></ul>
                </li>
                <li>
                    <a href="#ansible%e5%b8%b8%e7%94%a8%e6%a8%a1%e5%9d%97" aria-label="Ansibleå¸¸ç”¨æ¨¡å—">Ansibleå¸¸ç”¨æ¨¡å—</a><ul>
                        
                <li>
                    <a href="#command-%e6%a8%a1%e5%9d%97" aria-label="Command æ¨¡å—">Command æ¨¡å—</a></li>
                <li>
                    <a href="#shell-%e6%a8%a1%e5%9d%97" aria-label="Shell æ¨¡å—">Shell æ¨¡å—</a></li>
                <li>
                    <a href="#script-%e6%a8%a1%e5%9d%97" aria-label="Script æ¨¡å—">Script æ¨¡å—</a></li>
                <li>
                    <a href="#copy-%e6%a8%a1%e5%9d%97" aria-label="Copy æ¨¡å—">Copy æ¨¡å—</a></li>
                <li>
                    <a href="#get_url-%e6%a8%a1%e5%9d%97" aria-label="Get_url æ¨¡å—">Get_url æ¨¡å—</a></li>
                <li>
                    <a href="#fetch-%e6%a8%a1%e5%9d%97" aria-label="Fetch æ¨¡å—">Fetch æ¨¡å—</a></li>
                <li>
                    <a href="#file-%e6%a8%a1%e5%9d%97" aria-label="File æ¨¡å—">File æ¨¡å—</a></li>
                <li>
                    <a href="#stat-%e6%a8%a1%e5%9d%97" aria-label="stat æ¨¡å—">stat æ¨¡å—</a></li>
                <li>
                    <a href="#unarchive-%e6%a8%a1%e5%9d%97" aria-label="unarchive æ¨¡å—">unarchive æ¨¡å—</a></li>
                <li>
                    <a href="#archive-%e6%a8%a1%e5%9d%97" aria-label="Archive æ¨¡å—">Archive æ¨¡å—</a></li>
                <li>
                    <a href="#hostname-%e6%a8%a1%e5%9d%97" aria-label="Hostname æ¨¡å—">Hostname æ¨¡å—</a></li>
                <li>
                    <a href="#cron-%e6%a8%a1%e5%9d%97" aria-label="Cron æ¨¡å—">Cron æ¨¡å—</a></li>
                <li>
                    <a href="#yum-%e5%92%8c-apt-%e6%a8%a1%e5%9d%97" aria-label="Yum å’Œ Apt æ¨¡å—">Yum å’Œ Apt æ¨¡å—</a></li>
                <li>
                    <a href="#yum_repository-%e6%a8%a1%e5%9d%97" aria-label="yum_repository æ¨¡å—">yum_repository æ¨¡å—</a></li>
                <li>
                    <a href="#service-%e6%a8%a1%e5%9d%97" aria-label="Service æ¨¡å—">Service æ¨¡å—</a></li>
                <li>
                    <a href="#user-%e6%a8%a1%e5%9d%97" aria-label="User æ¨¡å—">User æ¨¡å—</a></li>
                <li>
                    <a href="#group-%e6%a8%a1%e5%9d%97" aria-label="Group æ¨¡å—">Group æ¨¡å—</a></li>
                <li>
                    <a href="#lineinfile-%e6%a8%a1%e5%9d%97" aria-label="Lineinfile æ¨¡å—">Lineinfile æ¨¡å—</a></li>
                <li>
                    <a href="#replace-%e6%a8%a1%e5%9d%97" aria-label="Replace æ¨¡å—">Replace æ¨¡å—</a></li>
                <li>
                    <a href="#selinux-%e6%a8%a1%e5%9d%97" aria-label="SELinux æ¨¡å—">SELinux æ¨¡å—</a></li>
                <li>
                    <a href="#reboot-%e6%a8%a1%e5%9d%97" aria-label="reboot æ¨¡å—">reboot æ¨¡å—</a></li>
                <li>
                    <a href="#mount-%e6%a8%a1%e5%9d%97" aria-label="mount æ¨¡å—">mount æ¨¡å—</a></li>
                <li>
                    <a href="#setup-%e6%a8%a1%e5%9d%97" aria-label="Setup æ¨¡å—">Setup æ¨¡å—</a></li>
                <li>
                    <a href="#debug-%e6%a8%a1%e5%9d%97" aria-label="debug æ¨¡å—">debug æ¨¡å—</a></li>
                <li>
                    <a href="#sysctl-%e6%a8%a1%e5%9d%97" aria-label="sysctl æ¨¡å—">sysctl æ¨¡å—</a></li>
                <li>
                    <a href="#pam_limits" aria-label="pam_limits">pam_limits</a></li>
                <li>
                    <a href="#apt_repository-%e6%a8%a1%e5%9d%97" aria-label="apt_repository æ¨¡å—">apt_repository æ¨¡å—</a></li>
                <li>
                    <a href="#apt_key-%e6%a8%a1%e5%9d%97" aria-label="apt_key æ¨¡å—">apt_key æ¨¡å—</a></li>
                <li>
                    <a href="#%e5%85%b6%e5%ae%83%e6%a8%a1%e5%9d%97" aria-label="å…¶å®ƒæ¨¡å—">å…¶å®ƒæ¨¡å—</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h2 id="ansibleä»‹ç»å’Œæ¶æ„">Ansibleä»‹ç»å’Œæ¶æ„<a hidden class="anchor" aria-hidden="true" href="#ansibleä»‹ç»å’Œæ¶æ„">#</a></h2>
<h2 id="ansibleå‘å±•å²">Ansibleå‘å±•å²<a hidden class="anchor" aria-hidden="true" href="#ansibleå‘å±•å²">#</a></h2>
<p>Ansible çš„åç§°æ¥è‡ªç§‘å¹»å°è¯´ã€Šå®‰å¾·çš„æ¸¸æˆã€‹ä¸­è·¨è¶Šæ—¶ç©ºçš„å³æ—¶é€šä¿¡å·¥å…·ï¼Œä½¿ç”¨å®ƒå¯ä»¥åœ¨ç›¸è·æ•°å…‰å¹´çš„è·ç¦»ï¼Œè¿œç¨‹å®æ—¶æ§åˆ¶å‰çº¿çš„èˆ°é˜Ÿæˆ˜æ–—
2012-03-09ï¼Œå‘å¸ƒ0.0.1ç‰ˆï¼Œ2015-10-17ï¼ŒRed Hatå®£å¸ƒ1.5äº¿ç¾å…ƒæ”¶è´­
<a href="https://www.ansible.com/">å®˜ç½‘ï¼š</a>
<a href="https://docs.ansible.com/">å®˜æ–¹æ–‡æ¡£ï¼š</a></p>
<h2 id="ansible-åŠŸèƒ½">Ansible åŠŸèƒ½<a hidden class="anchor" aria-hidden="true" href="#ansible-åŠŸèƒ½">#</a></h2>
<ul>
<li>æ‰¹é‡æ‰§è¡Œè¿œç¨‹å‘½ä»¤,å¯ä»¥å¯¹è¿œç¨‹çš„å¤šå°ä¸»æœºåŒæ—¶è¿›è¡Œå‘½ä»¤çš„æ‰§è¡Œ</li>
<li>æ‰¹é‡å®‰è£…å’Œé…ç½®è½¯ä»¶æœåŠ¡ï¼Œå¯ä»¥å¯¹è¿œç¨‹çš„å¤šå°ä¸»æœºè¿›è¡Œè‡ªåŠ¨åŒ–çš„æ–¹å¼é…ç½®å’Œç®¡ç†å„ç§æœåŠ¡</li>
<li>ç¼–æ’é«˜çº§çš„ä¼ä¸šçº§å¤æ‚çš„ITæ¶æ„ä»»åŠ¡, Ansibleçš„Playbookå’Œroleå¯ä»¥è½»æ¾å®ç°å¤§å‹çš„ITå¤æ‚æ¶æ„</li>
<li>æä¾›è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·çš„å¼€å‘API, æœ‰å¾ˆå¤šè¿ç»´å·¥å…·,å¦‚jumpserverå°±æ˜¯åŸºäº ansible å®ç°è‡ªåŠ¨åŒ–ç®¡å·¥åŠŸèƒ½</li>
</ul>
<h2 id="ansible-ç‰¹ç‚¹">Ansible ç‰¹ç‚¹<a hidden class="anchor" aria-hidden="true" href="#ansible-ç‰¹ç‚¹">#</a></h2>
<p>ä¼˜ç‚¹</p>
<ul>
<li>åŠŸèƒ½ä¸°å¯Œçš„æ¨¡å—ï¼šæä¾›äº†å¤šè¾¾æ•°åƒä¸ªçš„å„ç§åŠŸèƒ½çš„æ¨¡å—,å®Œæˆç‰¹å®šä»»åŠ¡åªéœ€è°ƒç”¨ç‰¹å®šæ¨¡å—å³å¯ï¼Œè¿˜</li>
<li>æ”¯æŒè‡ªå®šä¹‰æ¨¡å—ï¼Œå¯ä½¿ç”¨ä»»ä½•ç¼–ç¨‹è¯­è¨€å†™æ¨¡å—</li>
<li>ä½¿ç”¨å’Œéƒ¨ç½²ç®€å•: æ— éœ€å®‰è£…ä¸“ç”¨ä»£ç†è½¯ä»¶,åŸºäºpythonå’ŒSSH(é»˜è®¤å·²å®‰è£…)å®ç°</li>
<li>å®‰å…¨: åŸºäºOpenSSHå®ç°å®‰å…¨é€šè®¯æ— éœ€ä¸“ç”¨åè®®</li>
<li>å¹‚ç­‰æ€§ï¼šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œ1éå’Œæ‰§è¡Œnéæ•ˆæœä¸€æ ·ï¼Œä¸å› é‡å¤æ‰§è¡Œå¸¦æ¥æ„å¤–æƒ…å†µ,æ­¤ç‰¹æ€§å’Œæ¨¡å—æœ‰å…³</li>
<li>æ”¯æŒplaybookç¼–æ’ä»»åŠ¡ï¼ŒYAMLæ ¼å¼ï¼Œç¼–æ’ä»»åŠ¡ï¼Œæ”¯æŒä¸°å¯Œçš„æ•°æ®ç»“æ„</li>
<li>è¾ƒå¼ºå¤§çš„å¤šå±‚è§£å†³æ–¹æ¡ˆ Role</li>
<li>Pythonè¯­è¨€å®ç°, åŸºäºParamikoï¼ˆpythonå¯¹sshçš„å®ç°ï¼‰ï¼ŒPyYAMLï¼ŒJinja2ï¼ˆæ¨¡æ¿è¯­è¨€ï¼‰ä¸‰ä¸ªå…³é”®æ¨¡å—</li>
<li>å±äºçº¢å¸½(IBM)å…¬å¸äº§å“,èƒŒæ™¯å¼ºå¤§,æœªæ¥å‘å±•å‰æ™¯å…‰æ˜</li>
</ul>
<p>ç¼ºç‚¹</p>
<ul>
<li>å¦‚æœç®¡ç†çš„ä¸»æœºè¾ƒå¤šæ—¶,æ‰§è¡Œæ•ˆç‡ä¸å¦‚saltstacké«˜</li>
<li>å½“å‰è¿˜ä¸æ”¯æŒåƒMySQLæ•°æ®åº“ä¸€æ ·çš„äº‹åŠ¡å›æ»š</li>
</ul>
<h2 id="ansible-æ¶æ„">Ansible æ¶æ„<a hidden class="anchor" aria-hidden="true" href="#ansible-æ¶æ„">#</a></h2>
<h3 id="ansible-ç»„æˆ">Ansible ç»„æˆ<a hidden class="anchor" aria-hidden="true" href="#ansible-ç»„æˆ">#</a></h3>
<p>ç»„åˆINVENTORYã€APIã€MODULESã€PLUGINSçš„ç»¿æ¡†ï¼Œä¸ºansibleå‘½ä»¤å·¥å…·ï¼Œå…¶ä¸ºæ ¸å¿ƒæ‰§è¡Œå·¥å…·</p>
<p><img loading="lazy" src="/posts.images/image.assets/1676984392121.png" alt="1676984392121"  />
</p>
<ul>
<li>INVENTORYï¼šAnsibleç®¡ç†ä¸»æœºçš„æ¸…å•æ–‡ä»¶,é»˜è®¤ä¸º /etc/ansible/hosts</li>
<li>MODULESï¼šAnsibleæ‰§è¡Œå‘½ä»¤çš„åŠŸèƒ½æ¨¡å—ï¼Œå¤šæ•°ä¸ºå†…ç½®æ ¸å¿ƒæ¨¡å—ï¼Œä¹Ÿå¯è‡ªå®šä¹‰</li>
<li>PLUGINSï¼šæ¨¡å—åŠŸèƒ½çš„è¡¥å……ï¼Œå¦‚è¿æ¥ç±»å‹æ’ä»¶ã€å¾ªç¯æ’ä»¶ã€å˜é‡æ’ä»¶ã€è¿‡æ»¤æ’ä»¶ç­‰ï¼Œè¯¥åŠŸèƒ½ä¸å¸¸ç”¨</li>
<li>APIï¼šä¾›ç¬¬ä¸‰æ–¹ç¨‹åºè°ƒç”¨çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£</li>
</ul>
<h3 id="ansible-å‘½ä»¤æ‰§è¡Œæ¥æº">Ansible å‘½ä»¤æ‰§è¡Œæ¥æº<a hidden class="anchor" aria-hidden="true" href="#ansible-å‘½ä»¤æ‰§è¡Œæ¥æº">#</a></h3>
<ul>
<li>USER æ™®é€šç”¨æˆ·ï¼Œå³SYSTEM ADMINISTRATOR</li>
<li>PLAYBOOKSï¼šä»»åŠ¡å‰§æœ¬ï¼ˆä»»åŠ¡é›†ï¼‰ï¼Œç¼–æ’å®šä¹‰Ansibleä»»åŠ¡é›†çš„é…ç½®æ–‡ä»¶ï¼Œç”±Ansibleé¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œé€šå¸¸æ˜¯JSONæ ¼å¼çš„YMLæ–‡ä»¶</li>
<li>CMDBï¼ˆé…ç½®ç®¡ç†æ•°æ®åº“ï¼‰ API è°ƒç”¨</li>
<li>PUBLIC/PRIVATE CLOUD APIè°ƒç”¨</li>
<li>USER-&gt; Ansible Playbook -&gt; Ansibile</li>
</ul>
<h3 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹<a hidden class="anchor" aria-hidden="true" href="#æ³¨æ„äº‹é¡¹">#</a></h3>
<ul>
<li>æ‰§è¡Œansibleçš„ä¸»æœºä¸€èˆ¬ç§°ä¸ºç®¡ç†ç«¯, ä¸»æ§ç«¯ï¼Œä¸­æ§ï¼Œmasteræˆ–å ¡å’æœº</li>
<li>ä¸»æ§ç«¯Pythonç‰ˆæœ¬éœ€è¦2.6æˆ–ä»¥ä¸Š</li>
<li>è¢«æ§ç«¯Pythonç‰ˆæœ¬å°äº2.4ï¼Œéœ€è¦å®‰è£…python-simplejson</li>
<li>è¢«æ§ç«¯å¦‚å¼€å¯SELinuxéœ€è¦å®‰è£…libselinux-python</li>
<li>windows ä¸èƒ½åšä¸ºä¸»æ§ç«¯,åªèƒ½åšä¸ºè¢«æ§åˆ¶ç«¯</li>
</ul>
<h2 id="ansible-å®‰è£…å’Œå¸¸è§æ¨¡å—">Ansible å®‰è£…å’Œå¸¸è§æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#ansible-å®‰è£…å’Œå¸¸è§æ¨¡å—">#</a></h2>
<h2 id="ansible-å®‰è£…">Ansible å®‰è£…<a hidden class="anchor" aria-hidden="true" href="#ansible-å®‰è£…">#</a></h2>
<p>ansibleçš„å®‰è£…æ–¹æ³•æœ‰å¤šç§
å®˜æ–¹æ–‡æ¡£</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html
</span></span><span style="display:flex;"><span>https://docs.ansible.com/ansible/latest/installation_guide/index.html
</span></span></code></pre></div><p>ä¸‹è½½</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>https://releases.ansible.com/ansible/
</span></span></code></pre></div><p>pip ä¸‹è½½</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>https://pypi.org/project/ansible/
</span></span></code></pre></div><h3 id="åŒ…å®‰è£…æ–¹å¼">åŒ…å®‰è£…æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#åŒ…å®‰è£…æ–¹å¼">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#CentOS çš„EPELæºçš„rpmåŒ…å®‰è£…
</span></span><span style="display:flex;"><span>[root@centos ~]#yum install ansible
</span></span><span style="display:flex;"><span>#ubuntu å®‰è£…
</span></span><span style="display:flex;"><span>[root@ubuntu ~]#apt -y install ansible
</span></span></code></pre></div><h3 id="pipå®‰è£…">pipå®‰è£…<a hidden class="anchor" aria-hidden="true" href="#pipå®‰è£…">#</a></h3>
<p>pip æ˜¯å®‰è£…PythonåŒ…çš„ç®¡ç†å™¨ï¼Œç±»ä¼¼ yum
èŒƒä¾‹: åœ¨rocky8ä¸Šé€šè¿‡pip3å®‰è£…ansible</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@rocky8 ~]#yum -y install python39 rust
</span></span><span style="display:flex;"><span>[root@rocky8 ~]#pip3 install ansible
</span></span><span style="display:flex;"><span>[root@rocky8 ~]#ansible --version
</span></span><span style="display:flex;"><span>ansible [core 2.12.6]
</span></span><span style="display:flex;"><span>config file = None
</span></span><span style="display:flex;"><span>configured module search path = [&#39;/root/.ansible/plugins/modules&#39;,
</span></span><span style="display:flex;"><span>&#39;/usr/share/ansible/plugins/modules&#39;]
</span></span><span style="display:flex;"><span>ansible python module location = /usr/lib/python3.9/site-packages/ansible
</span></span><span style="display:flex;"><span>ansible collection location =
</span></span><span style="display:flex;"><span>/root/.ansible/collections:/usr/share/ansible/collections
</span></span><span style="display:flex;"><span>executable location = /usr/bin/ansible
</span></span><span style="display:flex;"><span>python version = 3.9.6 (default, Nov 9 2021, 13:31:27) [GCC 8.5.0 20210514
</span></span><span style="display:flex;"><span>(Red Hat 8.5.0-3)]
</span></span><span style="display:flex;"><span>jinja version = 3.1.2
</span></span><span style="display:flex;"><span>libyaml = True
</span></span><span style="display:flex;"><span>[root@rocky8 ~]#ansible-doc -l 2&gt; /dev/null|wc -l
</span></span><span style="display:flex;"><span>6763
</span></span></code></pre></div><p>èŒƒä¾‹: å®‰è£…python3.8 æ”¯æŒansible2.12ä»¥ä¸Šç‰ˆæœ¬</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@rocky8 ~]#yum -y install python38 python38-pip
</span></span><span style="display:flex;"><span>[root@rocky8 ~]#pip3 install --upgrade pip -i https://pypi.douban.com/simple
</span></span><span style="display:flex;"><span>[root@rocky8 ~]#pip3 install ansible -i https://pypi.douban.com/simple/
</span></span><span style="display:flex;"><span>[root@rocky8 ~]#ansible --version
</span></span><span style="display:flex;"><span>ansible [core 2.12.6]
</span></span><span style="display:flex;"><span>config file = None
</span></span><span style="display:flex;"><span>configured module search path = [&#39;/root/.ansible/plugins/modules&#39;,
</span></span><span style="display:flex;"><span>&#39;/usr/share/ansible/plugins/modules&#39;]
</span></span><span style="display:flex;"><span>ansible python module location = /usr/local/lib/python3.8/site-
</span></span><span style="display:flex;"><span>packages/ansible
</span></span><span style="display:flex;"><span>ansible collection location =
</span></span><span style="display:flex;"><span>/root/.ansible/collections:/usr/share/ansible/collections
</span></span><span style="display:flex;"><span>executable location = /usr/local/bin/ansible
</span></span><span style="display:flex;"><span>python version = 3.8.8 (default, Nov 9 2021, 13:31:34) [GCC 8.5.0 20210514
</span></span><span style="display:flex;"><span>(Red Hat 8.5.0-3)]
</span></span><span style="display:flex;"><span>jinja version = 3.1.2
</span></span><span style="display:flex;"><span>libyaml = True
</span></span></code></pre></div><p>èŒƒä¾‹: å®‰è£…é»˜è®¤çš„python3.6ç‰ˆæœ¬ä¼šæœ‰è­¦æŠ¥æç¤º</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@rocky8 ~]#yum -y install python3
</span></span><span style="display:flex;"><span>[root@rocky8 ~]#pip3 install --upgrade pip -i https://pypi.douban.com/simple
</span></span><span style="display:flex;"><span>[root@rocky8 ~]#pip3 install ansible -i https://pypi.douban.com/simple/
</span></span><span style="display:flex;"><span>[root@rocky8 ~]#ansible --version
</span></span><span style="display:flex;"><span>[DEPRECATION WARNING]: Ansible will require Python 3.8 or newer on the
</span></span><span style="display:flex;"><span>controller starting with Ansible 2.12. Current version: 3.6.8 (default, Nov
</span></span><span style="display:flex;"><span>9 2021, 14:44:26) [GCC 8.5.0 20210514 (Red Hat 8.5.0-3)]. This feature will be
</span></span><span style="display:flex;"><span>removed from ansible-core in version 2.12. Deprecation warnings
</span></span><span style="display:flex;"><span>can be disabled by setting deprecation_warnings=False in ansible.cfg.
</span></span><span style="display:flex;"><span>/usr/local/lib/python3.6/site-packages/ansible/parsing/vault/__init__.py:44:
</span></span><span style="display:flex;"><span>CryptographyDeprecationWarning: Python 3.6 is no longer supported by the Python
</span></span><span style="display:flex;"><span>core team. Therefore, support for it is deprecated in cryptography and will be
</span></span><span style="display:flex;"><span>removed in a future release.
</span></span><span style="display:flex;"><span>from cryptography.exceptions import InvalidSignature
</span></span><span style="display:flex;"><span>ansible [core 2.11.12]
</span></span><span style="display:flex;"><span>config file = None
</span></span><span style="display:flex;"><span>configured module search path = [&#39;/root/.ansible/plugins/modules&#39;,
</span></span><span style="display:flex;"><span>&#39;/usr/share/ansible/plugins/modules&#39;]
</span></span><span style="display:flex;"><span>ansible python module location = /usr/local/lib/python3.6/site-
</span></span><span style="display:flex;"><span>packages/ansible
</span></span><span style="display:flex;"><span>ansible collection location =
</span></span><span style="display:flex;"><span>/root/.ansible/collections:/usr/share/ansible/collections
</span></span><span style="display:flex;"><span>executable location = /usr/local/bin/ansible
</span></span><span style="display:flex;"><span>python version = 3.6.8 (default, Nov 9 2021, 14:44:26) [GCC 8.5.0 20210514
</span></span><span style="display:flex;"><span>(Red Hat 8.5.0-3)]
</span></span><span style="display:flex;"><span>jinja version = 3.0.3
</span></span><span style="display:flex;"><span>libyaml = True
</span></span><span style="display:flex;"><span>[root@rocky8 ~]#ansible-doc -l 2&gt; /dev/null|wc -l
</span></span><span style="display:flex;"><span>6141
</span></span></code></pre></div><p><img loading="lazy" src="/posts.images/image.assets/1676985923345.png" alt="1676985923345"  />
</p>
<p>èŒƒä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7 ~]#yum -y install python-pip
</span></span><span style="display:flex;"><span>[root@centos7 ~]#pip install --upgrade pip
</span></span><span style="display:flex;"><span>[root@centos7 ~]#pip install ansible --upgrade
</span></span><span style="display:flex;"><span>[root@centos7 ~]#ansible --version
</span></span><span style="display:flex;"><span>/usr/lib64/python2.7/site-packages/cryptography/__init__.py:39:
</span></span><span style="display:flex;"><span>CryptographyDeprecationWarning: Python 2 is no longer supported by the Python
</span></span><span style="display:flex;"><span>core team. Support for it is now deprecated in cryptography, and will be removed
</span></span><span style="display:flex;"><span>in a future release.
</span></span><span style="display:flex;"><span>CryptographyDeprecationWarning,
</span></span><span style="display:flex;"><span>ansible 2.9.12
</span></span><span style="display:flex;"><span>config file = None
</span></span><span style="display:flex;"><span>configured module search path = [u&#39;/root/.ansible/plugins/modules&#39;,
</span></span><span style="display:flex;"><span>u&#39;/usr/share/ansible/plugins/modules&#39;]
</span></span><span style="display:flex;"><span>ansible python module location = /usr/lib/python2.7/site-packages/ansible
</span></span><span style="display:flex;"><span>executable location = /usr/bin/ansible
</span></span><span style="display:flex;"><span>python version = 2.7.5 (default, Apr 2 2020, 13:16:51) [GCC 4.8.5 20150623
</span></span><span style="display:flex;"><span>(Red Hat 4.8.5-39)]
</span></span><span style="display:flex;"><span>[root@centos7 ~]#ll /opt/etc/ansible/ansible.cfg
</span></span><span style="display:flex;"><span>-rw-r--r-- 1 wang bin 19980 Aug 11 21:34 /opt/etc/ansible/ansible.cfg
</span></span></code></pre></div><h3 id="ç¡®è®¤å®‰è£…">ç¡®è®¤å®‰è£…<a hidden class="anchor" aria-hidden="true" href="#ç¡®è®¤å®‰è£…">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@ansible ~]#ansible --version
</span></span><span style="display:flex;"><span>ansible 2.9.5
</span></span><span style="display:flex;"><span>config file = /etc/ansible/ansible.cfg
</span></span><span style="display:flex;"><span>configured module search path = [&#39;/root/.ansible/plugins/modules&#39;,
</span></span><span style="display:flex;"><span>&#39;/usr/share/ansible/plugins/modules&#39;]
</span></span><span style="display:flex;"><span>ansible python module location = /usr/lib/python3.6/site-packages/ansible
</span></span><span style="display:flex;"><span>executable location = /usr/bin/ansible
</span></span><span style="display:flex;"><span>python version = 3.6.8 (default, Nov 21 2019, 19:31:34) [GCC 8.3.1 20190507
</span></span><span style="display:flex;"><span>(Red Hat 8.3.1-4)]
</span></span></code></pre></div><h2 id="ansible-ç›¸å…³æ–‡ä»¶">Ansible ç›¸å…³æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#ansible-ç›¸å…³æ–‡ä»¶">#</a></h2>
<h3 id="ansible-é…ç½®æ–‡ä»¶åˆ—è¡¨">Ansible é…ç½®æ–‡ä»¶åˆ—è¡¨<a hidden class="anchor" aria-hidden="true" href="#ansible-é…ç½®æ–‡ä»¶åˆ—è¡¨">#</a></h3>
<ul>
<li>/etc/ansible/ansible.cfg ä¸»é…ç½®æ–‡ä»¶ï¼Œé…ç½®ansibleå·¥ä½œç‰¹æ€§,ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®çš„ç›®å½•ä¸­åˆ›å»ºæ­¤æ–‡ä»¶,å½“å‰ç›®å½•ä¸‹å¦‚æœä¹Ÿæœ‰ansible.cfg,åˆ™æ­¤æ–‡ä»¶ä¼˜å…ˆç”Ÿæ•ˆ,å»ºè®®æ¯ä¸ªé¡¹ç›®ç›®å½•ä¸‹,åˆ›å»ºç‹¬æœ‰çš„ansible.cfgæ–‡
ä»¶</li>
<li>/etc/ansible/hosts ä¸»æœºæ¸…å•</li>
<li>/etc/ansible/roles/ å­˜æ”¾è§’è‰²çš„ç›®å½•</li>
</ul>
<h3 id="ansible-ä¸»é…ç½®æ–‡ä»¶">Ansible ä¸»é…ç½®æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#ansible-ä¸»é…ç½®æ–‡ä»¶">#</a></h3>
<p>Ansible çš„é…ç½®æ–‡ä»¶å¯ä»¥æ”¾åœ¨å¤šä¸ªä¸åŒåœ°æ–¹,ä¼˜å…ˆçº§ä»é«˜åˆ°ä½é¡ºåºå¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>ANSIBLE_CONFIG #ç¯å¢ƒå˜é‡,ç›®å½•ä¸‹çš„æ–‡ä»¶å¿…é¡»å­˜åœ¨æ‰èƒ½ç”Ÿæ•ˆ
</span></span><span style="display:flex;"><span>./ansible.cfg #å½“å‰ç›®å½•ä¸‹çš„ansible.cfg,ä¸€èˆ¬ä¸€ä¸ªé¡¹ç›®å¯¹åº”ä¸€ä¸ªä¸“ç”¨é…ç½®æ–‡ä»¶,æ¨èä½¿ç”¨
</span></span><span style="display:flex;"><span>~/.ansible.cfg #å½“å‰ç”¨æˆ·å®¶ç›®å½•ä¸‹çš„.ansible.cfg
</span></span><span style="display:flex;"><span>/etc/ansible/ansible.cfg #ç³»ç»Ÿé»˜è®¤é…ç½®æ–‡ä»¶
</span></span></code></pre></div><p>Ansible çš„é»˜è®¤é…ç½®æ–‡ä»¶ /etc/ansible/ansible.cfg ,å…¶ä¸­å¤§éƒ¨åˆ†çš„é…ç½®å†…å®¹æ— éœ€è¿›è¡Œä¿®æ”¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[defaults]
</span></span><span style="display:flex;"><span>#inventory = /etc/ansible/hosts #ä¸»æœºåˆ—è¡¨é…ç½®æ–‡ä»¶
</span></span><span style="display:flex;"><span>#library = /usr/share/my_modules/ #åº“æ–‡ä»¶å­˜æ”¾ç›®å½•
</span></span><span style="display:flex;"><span>#remote_tmp = $HOME/.ansible/tmp #ä¸´æ—¶pyå‘½ä»¤æ–‡ä»¶å­˜æ”¾åœ¨è¿œç¨‹ä¸»æœºç›®å½•
</span></span><span style="display:flex;"><span>#local_tmp = $HOME/.ansible/tmp #æœ¬æœºçš„ä¸´æ—¶å‘½ä»¤æ‰§è¡Œç›®å½•
</span></span><span style="display:flex;"><span>#forks = 5 #é»˜è®¤å¹¶å‘æ•°
</span></span><span style="display:flex;"><span>#sudo_user = root #é»˜è®¤sudo ç”¨æˆ·
</span></span><span style="display:flex;"><span>#ask_sudo_pass = True #æ¯æ¬¡æ‰§è¡Œansibleå‘½ä»¤æ˜¯å¦è¯¢é—®sshå¯†ç 
</span></span><span style="display:flex;"><span>#ask_pass = True
</span></span><span style="display:flex;"><span>#remote_port = 22
</span></span><span style="display:flex;"><span>#host_key_checking = False #æ£€æŸ¥å¯¹åº”æœåŠ¡å™¨çš„host_keyï¼Œå»ºè®®å–æ¶ˆæ­¤è¡Œæ³¨é‡Š,å®ç°ç¬¬ä¸€æ¬¡è¿
</span></span><span style="display:flex;"><span>æ¥è‡ªåŠ¨ä¿¡ä»»ç›®æ ‡ä¸»æœº
</span></span><span style="display:flex;"><span>#log_path=/var/log/ansible.log #æ—¥å¿—æ–‡ä»¶ï¼Œå»ºè®®å¯ç”¨
</span></span><span style="display:flex;"><span>#module_name = command #é»˜è®¤æ¨¡å—ï¼Œå¯ä»¥ä¿®æ”¹ä¸ºshellæ¨¡å—
</span></span><span style="display:flex;"><span>[privilege_escalation] #æ™®é€šç”¨æˆ·ææƒé…ç½®
</span></span><span style="display:flex;"><span>#become=True
</span></span><span style="display:flex;"><span>#become_method=sudo
</span></span><span style="display:flex;"><span>#become_user=root
</span></span><span style="display:flex;"><span>#become_ask_pass=False
</span></span></code></pre></div><p>èŒƒä¾‹: é€šè¿‡ç¯å¢ƒå˜é‡ANSIBLE_CONFIGæŒ‡å®šansibleé…ç½®æ–‡ä»¶è·¯å¾„</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@rocky8 ~]#cd /data/ansible/
</span></span><span style="display:flex;"><span>[root@rocky8 ansible]#cat ansbile.cfg
</span></span><span style="display:flex;"><span>[defaults]
</span></span><span style="display:flex;"><span>inventory = ./hosts
</span></span><span style="display:flex;"><span>[root@rocky8 ansible]#cat hosts
</span></span><span style="display:flex;"><span>[ubuntu]
</span></span><span style="display:flex;"><span>10.0.0.100
</span></span><span style="display:flex;"><span>[centos]
</span></span><span style="display:flex;"><span>10.0.0.7
</span></span><span style="display:flex;"><span>10.0.0.8
</span></span><span style="display:flex;"><span>#å®šä¹‰å˜é‡
</span></span><span style="display:flex;"><span>[root@rocky8 ansible]#export ANSIBLE_CONFIG=./ansbile.cfg
</span></span><span style="display:flex;"><span>[root@rocky8 ansible]#ansible --version
</span></span><span style="display:flex;"><span>ansible [core 2.12.6]
</span></span><span style="display:flex;"><span>config file = /data/ansible/ansbile.cfg
</span></span><span style="display:flex;"><span>configured module search path = [&#39;/root/.ansible/plugins/modules&#39;,
</span></span><span style="display:flex;"><span>&#39;/usr/share/ansible/plugins/modules&#39;]
</span></span><span style="display:flex;"><span>ansible python module location = /usr/lib/python3.9/site-packages/ansible
</span></span><span style="display:flex;"><span>ansible collection location =
</span></span><span style="display:flex;"><span>/root/.ansible/collections:/usr/share/ansible/collections
</span></span><span style="display:flex;"><span>executable location = /usr/bin/ansible
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>python version = 3.9.6 (default, Nov 9 2021, 13:31:27) [GCC 8.5.0 20210514
</span></span><span style="display:flex;"><span>(Red Hat 8.5.0-3)]
</span></span><span style="display:flex;"><span>jinja version = 3.1.2
</span></span><span style="display:flex;"><span>libyaml = True
</span></span><span style="display:flex;"><span>[root@rocky8 ansible]#ansible --list-hosts all
</span></span><span style="display:flex;"><span>hosts (3):
</span></span><span style="display:flex;"><span>10.0.0.100
</span></span><span style="display:flex;"><span>10.0.0.7
</span></span><span style="display:flex;"><span>10.0.0.8
</span></span></code></pre></div><p>èŒƒä¾‹: åˆ›å»ºansible æŒ‡å®šé¡¹ç›®ä¸“ç”¨çš„é…ç½®æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@ubuntu2004 ~]#ansible --version
</span></span><span style="display:flex;"><span>ansible 2.9.6
</span></span><span style="display:flex;"><span>config file = /etc/ansible/ansible.cfg
</span></span><span style="display:flex;"><span>configured module search path = [&#39;/root/.ansible/plugins/modules&#39;,
</span></span><span style="display:flex;"><span>&#39;/usr/share/ansible/plugins/modules&#39;]
</span></span><span style="display:flex;"><span>ansible python module location = /usr/lib/python3/dist-packages/ansible
</span></span><span style="display:flex;"><span>executable location = /usr/bin/ansible
</span></span><span style="display:flex;"><span>python version = 3.8.10 (default, Mar 15 2022, 12:22:08) [GCC 9.4.0]
</span></span><span style="display:flex;"><span>[root@ubuntu2004 ~]#mkdir /data/ansible -p
</span></span><span style="display:flex;"><span>[root@ubuntu2004 ~]#cd /data/ansible/
</span></span><span style="display:flex;"><span>[root@ubuntu2004 ansible]#touch ansible.cfg
</span></span><span style="display:flex;"><span>[root@ubuntu2004 ansible]#ansible --version
</span></span><span style="display:flex;"><span>ansible 2.9.6
</span></span><span style="display:flex;"><span>config file = /data/ansible/ansible.cfg
</span></span><span style="display:flex;"><span>configured module search path = [&#39;/root/.ansible/plugins/modules&#39;,
</span></span><span style="display:flex;"><span>&#39;/usr/share/ansible/plugins/modules&#39;]
</span></span><span style="display:flex;"><span>ansible python module location = /usr/lib/python3/dist-packages/ansible
</span></span><span style="display:flex;"><span>executable location = /usr/bin/ansible
</span></span><span style="display:flex;"><span>python version = 3.8.10 (default, Mar 15 2022, 12:22:08) [GCC 9.4.0]
</span></span><span style="display:flex;"><span>[root@ubuntu2004 ansible]#cd
</span></span><span style="display:flex;"><span>[root@ubuntu2004 ~]#ansible --version
</span></span><span style="display:flex;"><span>ansible 2.9.6
</span></span><span style="display:flex;"><span>config file = /etc/ansible/ansible.cfg
</span></span><span style="display:flex;"><span>configured module search path = [&#39;/root/.ansible/plugins/modules&#39;,
</span></span><span style="display:flex;"><span>&#39;/usr/share/ansible/plugins/modules&#39;]
</span></span><span style="display:flex;"><span>ansible python module location = /usr/lib/python3/dist-packages/ansible
</span></span><span style="display:flex;"><span>executable location = /usr/bin/ansible
</span></span><span style="display:flex;"><span>python version = 3.8.10 (default, Mar 15 2022, 12:22:08) [GCC 9.4.0]
</span></span></code></pre></div><p>èŒƒä¾‹: å½“å‰ç›®å½•ä¸‹çš„ansibleçš„é…ç½®æ–‡ä»¶ä¼˜å…ˆç”Ÿæ•ˆ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@ansible ~]#ansible --version
</span></span><span style="display:flex;"><span>ansible 2.9.17
</span></span><span style="display:flex;"><span>config file = /etc/ansible/ansible.cfg
</span></span><span style="display:flex;"><span>configured module search path = [&#39;/root/.ansible/plugins/modules&#39;,
</span></span><span style="display:flex;"><span>&#39;/usr/share/ansible/plugins/modules&#39;]
</span></span><span style="display:flex;"><span>ansible python module location = /usr/lib/python3.6/site-packages/ansible
</span></span><span style="display:flex;"><span>executable location = /usr/bin/ansible
</span></span><span style="display:flex;"><span>python version = 3.6.8 (default, Apr 16 2020, 01:36:27) [GCC 8.3.1 20191121
</span></span><span style="display:flex;"><span>(Red Hat 8.3.1-5)]
</span></span><span style="display:flex;"><span>[root@ansible ~]#cp /etc/ansible/ansible.cfg .
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[root@ansible ~]#ansible --version
</span></span><span style="display:flex;"><span>ansible 2.9.17
</span></span><span style="display:flex;"><span>config file = /root/ansible.cfg #æ³¨æ„é…ç½®æ–‡ä»¶è·¯å¾„
</span></span><span style="display:flex;"><span>configured module search path = [&#39;/root/.ansible/plugins/modules&#39;,
</span></span><span style="display:flex;"><span>&#39;/usr/share/ansible/plugins/modules&#39;]
</span></span><span style="display:flex;"><span>ansible python module location = /usr/lib/python3.6/site-packages/ansible
</span></span><span style="display:flex;"><span>executable location = /usr/bin/ansible
</span></span><span style="display:flex;"><span>python version = 3.6.8 (default, Apr 16 2020, 01:36:27) [GCC 8.3.1 20191121
</span></span><span style="display:flex;"><span>(Red Hat 8.3.1-5)]
</span></span><span style="display:flex;"><span>[root@ansible ~]#
</span></span></code></pre></div><h3 id="inventory-ä¸»æœºæ¸…å•æ–‡ä»¶">Inventory ä¸»æœºæ¸…å•æ–‡ä»¶<a hidden class="anchor" aria-hidden="true" href="#inventory-ä¸»æœºæ¸…å•æ–‡ä»¶">#</a></h3>
<p>ansibleçš„ä¸»è¦åŠŸç”¨åœ¨äºæ‰¹é‡ä¸»æœºæ“ä½œï¼Œä¸ºäº†ä¾¿æ·åœ°ä½¿ç”¨å…¶ä¸­çš„éƒ¨åˆ†ä¸»æœºï¼Œå¯ä»¥åœ¨inventory ä¸»æœºæ¸…å•æ–‡ä»¶ä¸­å°†å…¶åˆ†ç»„ç»„ç»‡
é»˜è®¤çš„inventory fileä¸º /etc/ansible/hosts
inventory fileå¯ä»¥æœ‰å¤šä¸ªï¼Œä¸”ä¹Ÿå¯ä»¥é€šè¿‡Dynamic Inventoryæ¥åŠ¨æ€ç”Ÿæˆ
æ³¨æ„:</p>
<ul>
<li>ç”Ÿäº§å»ºè®®åœ¨æ¯ä¸ªé¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºé¡¹ç›®ç‹¬ç«‹çš„hostsæ–‡ä»¶</li>
<li>é€šè¿‡é¡¹ç›®ç›®å½•ä¸‹çš„ansible.cfgæ–‡ä»¶ä¸­çš„ inventory = ./hostså®ç°</li>
</ul>
<p>å®˜æ–¹æ–‡æ¡£:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html
</span></span></code></pre></div><p><strong>ä¸»æœºæ¸…å•æ–‡ä»¶æ ¼å¼</strong>
inventoryæ–‡ä»¶éµå¾ªINIæ–‡ä»¶é£æ ¼ï¼Œä¸­æ‹¬å·ä¸­çš„å­—ç¬¦ä¸ºç»„åã€‚å¯ä»¥å°†åŒä¸€ä¸ªä¸»æœºåŒæ—¶å½’å¹¶åˆ°å¤šä¸ªä¸åŒçš„ç»„ä¸­,æ­¤å¤–ï¼Œå½“å¦‚è‹¥ç›®æ ‡ä¸»æœºä½¿ç”¨äº†éé»˜è®¤çš„SSHç«¯å£ï¼Œè¿˜å¯ä»¥åœ¨ä¸»æœºåç§°ä¹‹åä½¿ç”¨å†’å·åŠ ç«¯å£å·æ¥æ ‡æ˜,å¦‚æœä¸»æœºåç§°éµå¾ªç›¸ä¼¼çš„å‘½åæ¨¡å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åˆ—è¡¨çš„æ–¹å¼æ ‡è¯†å„ä¸»æœº
<strong>Inventory å‚æ•°è¯´æ˜</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>ansible_ssh_host #å°†è¦è¿æ¥çš„è¿œç¨‹ä¸»æœºå.ä¸ä½ æƒ³è¦è®¾å®šçš„ä¸»æœºçš„åˆ«åä¸åŒçš„è¯,å¯é€šè¿‡æ­¤å˜é‡è®¾ç½®.
</span></span><span style="display:flex;"><span>ansible_ssh_port #sshç«¯å£å·.å¦‚æœä¸æ˜¯é»˜è®¤çš„ç«¯å£å·,é€šè¿‡æ­¤å˜é‡è®¾ç½®.è¿™ç§å¯ä»¥ä½¿ç”¨ ip:ç«¯å£
</span></span><span style="display:flex;"><span>192.168.1.100:2222
</span></span><span style="display:flex;"><span>ansible_ssh_user #é»˜è®¤çš„ ssh ç”¨æˆ·å
</span></span><span style="display:flex;"><span>ansible_ssh_pass #ssh å¯†ç (è¿™ç§æ–¹å¼å¹¶ä¸å®‰å…¨,æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨ --ask-pass æˆ– SSH å¯†é’¥)
</span></span><span style="display:flex;"><span>ansible_sudo_pass #sudo å¯†ç (è¿™ç§æ–¹å¼å¹¶ä¸å®‰å…¨,æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨ --ask-sudo-pass)
</span></span><span style="display:flex;"><span>ansible_sudo_exe (new in version 1.8) #sudo å‘½ä»¤è·¯å¾„(é€‚ç”¨äº1.8åŠä»¥ä¸Šç‰ˆæœ¬)
</span></span><span style="display:flex;"><span>ansible_connection #ä¸ä¸»æœºçš„è¿æ¥ç±»å‹.æ¯”å¦‚:local, ssh æˆ–è€… paramiko. Ansible 1.2 ä»¥å‰é»˜è®¤ä½¿ç”¨ paramiko.1.2 ä»¥åé»˜è®¤ä½¿ç”¨ &#39;smart&#39;,&#39;smart&#39; æ–¹å¼ä¼šæ ¹æ®æ˜¯å¦æ”¯æŒ ControlPersist,æ¥åˆ¤æ–­&#39;ssh&#39; æ–¹å¼æ˜¯å¦å¯è¡Œ.
</span></span><span style="display:flex;"><span>ansible_ssh_private_key_file #ssh ä½¿ç”¨çš„ç§é’¥æ–‡ä»¶.é€‚ç”¨äºæœ‰å¤šä¸ªå¯†é’¥,è€Œä½ ä¸æƒ³ä½¿ç”¨ SSH ä»£ç†çš„æƒ…å†µ.
</span></span><span style="display:flex;"><span>ansible_shell_type #ç›®æ ‡ç³»ç»Ÿçš„shellç±»å‹.é»˜è®¤æƒ…å†µä¸‹,å‘½ä»¤çš„æ‰§è¡Œä½¿ç”¨ &#39;sh&#39; è¯­æ³•,å¯è®¾ç½®ä¸º&#39;csh&#39; æˆ– &#39;fish&#39;.
</span></span><span style="display:flex;"><span>ansible_python_interpreter #ç›®æ ‡ä¸»æœºçš„ python è·¯å¾„.é€‚ç”¨äºçš„æƒ…å†µ: ç³»ç»Ÿä¸­æœ‰å¤šä¸ª Python,æˆ–è€…å‘½ä»¤è·¯å¾„ä¸æ˜¯&#34;/usr/bin/python&#34;,æ¯”å¦‚ \*BSD, æˆ–è€… /usr/bin/python ä¸æ˜¯ 2.X ç‰ˆæœ¬çš„Python.ä¹‹æ‰€ä»¥ä¸ä½¿ç”¨ &#34;/usr/bin/env&#34; æœºåˆ¶,å› ä¸ºè¿™è¦æ±‚è¿œç¨‹ç”¨æˆ·çš„è·¯å¾„è®¾ç½®æ­£ç¡®,ä¸”è¦æ±‚ &#34;python&#34;å¯æ‰§è¡Œç¨‹åºåä¸å¯ä¸º pythonä»¥å¤–çš„åå­—(å®é™…æœ‰å¯èƒ½åä¸ºpython26).ä¸ansible_python_interpreter çš„å·¥ä½œæ–¹å¼ç›¸åŒ,å¯è®¾å®šå¦‚ ruby æˆ– perl çš„è·¯å¾„....
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>ntp.wang.org
</span></span><span style="display:flex;"><span>[webservers]
</span></span><span style="display:flex;"><span>www1.wang.org:2222
</span></span><span style="display:flex;"><span>www2.wang.org
</span></span><span style="display:flex;"><span>[dbservers]
</span></span><span style="display:flex;"><span>db1.wang.org
</span></span><span style="display:flex;"><span>db2.wang.org
</span></span><span style="display:flex;"><span>db3.wang.org
</span></span><span style="display:flex;"><span>#æˆ–è€…
</span></span><span style="display:flex;"><span>db[1:3].wang.org
</span></span></code></pre></div><p>èŒƒä¾‹: ç»„åµŒå¥—</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[webservers]
</span></span><span style="display:flex;"><span>www[1:100].example.com
</span></span><span style="display:flex;"><span>[dbservers]
</span></span><span style="display:flex;"><span>db-[a:f].example.com
</span></span><span style="display:flex;"><span>[appservers]
</span></span><span style="display:flex;"><span>10.0.0.[1:100]
</span></span><span style="display:flex;"><span>#å®šä¹‰testsrvsç»„ä¸­åŒ…æ‹¬ä¸¤ä¸ªå…¶å®ƒåˆ†ç»„,å®ç°ç»„åµŒå¥—
</span></span><span style="display:flex;"><span>[testsrvs:children]
</span></span><span style="display:flex;"><span>webservers
</span></span><span style="display:flex;"><span>dbservers
</span></span></code></pre></div><p>èŒƒä¾‹: åŸºäºç”¨æˆ·åå’Œå¯†ç çš„sshè¿æ¥ä¸»æœºæ¸…å•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[test]
</span></span><span style="display:flex;"><span>10.0.0.8 ansible_connection=local #æŒ‡å®šæœ¬åœ°è¿æ¥,æ— éœ€sshé…ç½®
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#æ¯ä¸ªä¸»æœºåˆ†åˆ«æŒ‡å®šç”¨æˆ·å’Œå¯†ç ,ansible_connection=ssh éœ€è¦StrictHostKeyChecking no æˆ–è€…host_key_checking = False
</span></span><span style="display:flex;"><span>10.0.0.7 ansible_connection=ssh ansible_ssh_port=2222 ansible_ssh_user=wangansible_ssh_password=123456
</span></span><span style="display:flex;"><span>10.0.0.6 ansible_ssh_user=root ansible_ssh_password=123456
</span></span><span style="display:flex;"><span>#å¯¹æ¯ä¸ªåˆ†ç»„çš„æ‰€æœ‰ä¸»æœºç»Ÿä¸€å®šä¹‰ç”¨æˆ·å’Œå¯†ç ,æ‰§è¡Œansibleå‘½ä»¤æ—¶æ˜¾ç¤ºåˆ«å,å¦‚web01
</span></span><span style="display:flex;"><span>[websrvs]
</span></span><span style="display:flex;"><span>web01 ansible_ssh_host=10.0.0.101
</span></span><span style="display:flex;"><span>web02 ansible_ssh_host=10.0.0.102
</span></span><span style="display:flex;"><span>[websrvs:vars]
</span></span><span style="display:flex;"><span>ansible_ssh_password=magedu
</span></span><span style="display:flex;"><span>some_host ansible_ssh_port=2222 ansible_ssh_user=manager
</span></span><span style="display:flex;"><span>aws_host ansible_ssh_private_key_file=/home/example/.ssh/aws.pem
</span></span><span style="display:flex;"><span>freebsd_host ansible_python_interpreter=/usr/local/bin/python
</span></span><span style="display:flex;"><span>ruby_module_host ansible_ruby_interpreter=/usr/bin/ruby.1.9.3
</span></span></code></pre></div><h2 id="ansibleç›¸å…³å·¥å…·">Ansibleç›¸å…³å·¥å…·<a hidden class="anchor" aria-hidden="true" href="#ansibleç›¸å…³å·¥å…·">#</a></h2>
<ul>
<li>
<p>/usr/bin/ansible ä¸»ç¨‹åºï¼Œä¸´æ—¶å‘½ä»¤æ‰§è¡Œå·¥å…·</p>
</li>
<li>
<p>/usr/bin/ansible-doc æŸ¥çœ‹é…ç½®æ–‡æ¡£ï¼Œæ¨¡å—åŠŸèƒ½æŸ¥çœ‹å·¥å…·,ç›¸å½“äºman</p>
</li>
<li>
<p>/usr/bin/ansible-playbook å®šåˆ¶è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼Œç¼–æ’å‰§æœ¬å·¥å…·,ç›¸å½“äºè„šæœ¬</p>
</li>
<li>
<p>/usr/bin/ansible-pull è¿œç¨‹æ‰§è¡Œå‘½ä»¤çš„å·¥å…·</p>
</li>
<li>
<p>/usr/bin/ansible-vault æ–‡ä»¶åŠ å¯†å·¥å…·</p>
</li>
<li>
<p>/usr/bin/ansible-console åŸºäºConsoleç•Œé¢ä¸ç”¨æˆ·äº¤äº’çš„æ‰§è¡Œå·¥å…·</p>
</li>
<li>
<p>/usr/bin/ansible-galaxy ä¸‹è½½/ä¸Šä¼ ä¼˜ç§€ä»£ç æˆ–Rolesæ¨¡å—çš„å®˜ç½‘å¹³å°</p>
</li>
</ul>
<p><strong>åˆ©ç”¨ansibleå®ç°ç®¡ç†çš„ä¸»è¦æ–¹å¼ï¼š</strong></p>
<ul>
<li>
<p>Ansible Ad-Hoc å³åˆ©ç”¨ansibleå‘½ä»¤ï¼Œä¸»è¦ç”¨äºä¸´æ—¶å‘½ä»¤ä½¿ç”¨åœºæ™¯</p>
</li>
<li>
<p>Ansible playbook ä¸»è¦ç”¨äºé•¿æœŸè§„åˆ’å¥½çš„ï¼Œå¤§å‹é¡¹ç›®çš„åœºæ™¯ï¼Œéœ€è¦æœ‰å‰æœŸçš„è§„åˆ’è¿‡ç¨‹</p>
</li>
</ul>
<p><strong>ansible ä½¿ç”¨å‰å‡†å¤‡</strong>
ansible ç›¸å…³å·¥å…·å¤§å¤šæ•°æ˜¯é€šè¿‡sshåè®®ï¼Œå®ç°å¯¹è¿œç¨‹ä¸»æœºçš„é…ç½®ç®¡ç†ã€åº”ç”¨éƒ¨ç½²ã€ä»»åŠ¡æ‰§è¡Œç­‰åŠŸèƒ½
å»ºè®®ï¼šä½¿ç”¨æ­¤å·¥å…·å‰ï¼Œå…ˆé…ç½®ansibleä¸»æ§ç«¯èƒ½åŸºäºå¯†é’¥è®¤è¯çš„æ–¹å¼è”ç³»å„ä¸ªè¢«ç®¡ç†èŠ‚ç‚¹
èŒƒä¾‹ï¼šåˆ©ç”¨sshpassæ‰¹é‡å®ç°åŸºäºkeyéªŒè¯è„šæœ¬1</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos8 ~]#vim /etc/ssh/ssh_config
</span></span><span style="display:flex;"><span>#ä¿®æ”¹ä¸‹é¢ä¸€è¡Œ
</span></span><span style="display:flex;"><span>StrictHostKeyChecking no
</span></span><span style="display:flex;"><span>[root@centos8 ~]#cat hosts.list
</span></span><span style="display:flex;"><span>192.168.32.178
</span></span><span style="display:flex;"><span>192.168.32.179
</span></span><span style="display:flex;"><span>[root@centos8 ~]#vim push_ssh_key.sh
</span></span><span style="display:flex;"><span>#!/bin/bash
</span></span><span style="display:flex;"><span>rpm -ql shpass &amp;&gt; /dev/null || yum -y install sshpass
</span></span><span style="display:flex;"><span>[ -f /root/.ssh/id_rsa ] || ssh-keygen -f /root/.ssh/id_rsa -P &#39;&#39;
</span></span><span style="display:flex;"><span>export SSHPASS=123456
</span></span><span style="display:flex;"><span>while read IP;do
</span></span><span style="display:flex;"><span>sshpass -e ssh-copy-id -o StrictHostKeyChecking=no $IP
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>done &lt; hosts.list
</span></span></code></pre></div><p>èŒƒä¾‹: å®ç°åŸºäºkeyéªŒè¯çš„è„šæœ¬2</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos8 ~]#cat ssh_key.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#!/bin/bash
</span></span><span style="display:flex;"><span>PLIST=&#34;
</span></span><span style="display:flex;"><span>192.168.32.178
</span></span><span style="display:flex;"><span>192.168.32.179&#34;
</span></span><span style="display:flex;"><span>rpm -q sshpass &amp;&gt; /dev/null || yum -y install sshpass
</span></span><span style="display:flex;"><span>[ -f /root/.ssh/id_rsa ] || ssh-keygen -f /root/.ssh/id_rsa -P &#39;&#39;
</span></span><span style="display:flex;"><span>export SSHPASS=123456
</span></span><span style="display:flex;"><span>for IP in $IPLIST;do
</span></span><span style="display:flex;"><span>       { sshpass -e ssh-copy-id -o StrictHostKeyChecking=no $IP; } &amp;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>done
</span></span><span style="display:flex;"><span>wait
</span></span></code></pre></div><p>æ­¤å·¥å…·ç”¨æ¥æ˜¾ç¤ºæ¨¡å—å¸®åŠ©,ç›¸å½“äºman
æ ¼å¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible-doc <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>module...<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>-l, --list <span style="color:#75715e">#åˆ—å‡ºå¯ç”¨æ¨¡å—</span>
</span></span><span style="display:flex;"><span>-s, --snippet <span style="color:#75715e">#æ˜¾ç¤ºæŒ‡å®šæ¨¡å—çš„playbookç‰‡æ®µ</span>
</span></span></code></pre></div><p>èŒƒä¾‹: æŸ¥çœ‹å¸®åŠ©</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@rocky ~<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-doc --help</span>
</span></span><span style="display:flex;"><span>usage: ansible-doc <span style="color:#f92672">[</span>-h<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--version<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-v<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-M MODULE_PATH<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--playbook-dir BASEDIR<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>                   <span style="color:#f92672">[</span>-t <span style="color:#f92672">{</span>become,cache,callback,cliconf,connection,httpapi,inventory,lookup,netconf,shell,vars,module,strategy,role,keyword<span style="color:#f92672">}]</span>
</span></span><span style="display:flex;"><span>                   <span style="color:#f92672">[</span>-j<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-r ROLES_PATH<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-e ENTRY_POINT | -s | -F | -l | --metadata-dump<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--no-fail-on-errors<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>                   <span style="color:#f92672">[</span>plugin ...<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>plugin documentation tool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>positional arguments:
</span></span><span style="display:flex;"><span>  plugin                Plugin
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#åˆ—å‡ºæ‰€æœ‰æ¨¡å—</span>
</span></span><span style="display:flex;"><span>ansible-doc -l
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æŸ¥çœ‹æŒ‡å®šæ¨¡å—å¸®åŠ©ç”¨æ³•</span>
</span></span><span style="display:flex;"><span>ansible-doc ping
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æŸ¥çœ‹æŒ‡å®šæ¨¡å—å¸®åŠ©ç”¨æ³•</span>
</span></span><span style="display:flex;"><span>ansible-doc -s ping
</span></span></code></pre></div><p>èŒƒä¾‹: æŸ¥çœ‹æŒ‡å®šçš„æ’ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@rocky ~<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-doc -t connection -l</span>
</span></span><span style="display:flex;"><span>local        execute on controller                                                                                                 
</span></span><span style="display:flex;"><span>paramiko_ssh Run tasks via python ssh <span style="color:#f92672">(</span>paramiko<span style="color:#f92672">)</span>                                                                                   
</span></span><span style="display:flex;"><span>psrp         Run tasks over Microsoft PowerShell Remoting Protocol                                                                 
</span></span><span style="display:flex;"><span>ssh          connect via SSH client binary                                                                                         
</span></span><span style="display:flex;"><span>winrm        Run tasks over Microsoft<span style="color:#e6db74">&#39;s WinRM                                                                                      
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[root@rocky ~]# 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[root@rocky ~]# ansible-doc -t lookup -l
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">config              Lookup current Ansible configuration values                                                                    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">csvfile             read data from a TSV or CSV file                                                                               
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">dict                returns key/value pair items from dictionaries                                                                 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">env                 Read the value of environment variables                                                                        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">file                read file contents                                                                                             
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">fileglob            list files matching a pattern                                                                                  
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">first_found         return first file found from list                                                                              
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">indexed_items       rewrites lists to return &#39;</span>indexed items<span style="color:#960050;background-color:#1e0010">&#39;</span>                                                                       
</span></span><span style="display:flex;"><span>ini                 read data from an ini file                                                                                     
</span></span><span style="display:flex;"><span>inventory_hostnames list of inventory hosts matching a host pattern                                                                
</span></span><span style="display:flex;"><span>items               list of items                                                                                                  
</span></span><span style="display:flex;"><span>lines               read lines from command                                                                                        
</span></span><span style="display:flex;"><span>list                simply returns what it is given                                                                                
</span></span><span style="display:flex;"><span>nested              composes a list with nested elements of other lists                                                            
</span></span><span style="display:flex;"><span>password            retrieve or generate a random password, stored in a file                                                       
</span></span><span style="display:flex;"><span>pipe                read output from a command                                                                                     
</span></span><span style="display:flex;"><span>random_choice       <span style="color:#66d9ef">return</span> random element from list                                                                                
</span></span><span style="display:flex;"><span>sequence            generate a list based on a number sequence                                                                     
</span></span><span style="display:flex;"><span>subelements         traverse nested key from a list of dictionaries                                                                
</span></span><span style="display:flex;"><span>template            retrieve contents of file after templating with Jinja2                                                         
</span></span><span style="display:flex;"><span>together            merges lists into synchronized list                                                                            
</span></span><span style="display:flex;"><span>unvault             read vaulted file<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> contents                                                                                  
</span></span><span style="display:flex;"><span>url                 <span style="color:#66d9ef">return</span> contents from URL                                                                                       
</span></span><span style="display:flex;"><span>varnames            Lookup matching variable names                                                                                 
</span></span><span style="display:flex;"><span>vars                Lookup templated value of variables                                                                            
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@rocky ~<span style="color:#f92672">]</span><span style="color:#75715e"># </span>
</span></span></code></pre></div><h3 id="ansible">ansible<a hidden class="anchor" aria-hidden="true" href="#ansible">#</a></h3>
<h4 id="ansible-ad-hoc-ä»‹ç»">Ansible Ad-Hoc ä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#ansible-ad-hoc-ä»‹ç»">#</a></h4>
<p>Ansible Ad-Hoc çš„æ‰§è¡Œæ–¹å¼çš„ä¸»è¦å·¥å…·å°±æ˜¯ ansible
ç‰¹ç‚¹: ä¸€æ¬¡æ€§çš„æ‰§è¡Œ,ä¸ä¼šä¿å­˜æ‰§è¡Œå‘½ä»¤ä¿¡æ¯,åªé€‚åˆä¸´æ—¶æ€§æˆ–æµ‹è¯•æ€§çš„ä»»åŠ¡</p>
<h4 id="ansible-å‘½ä»¤ç”¨æ³•">ansible å‘½ä»¤ç”¨æ³•<a hidden class="anchor" aria-hidden="true" href="#ansible-å‘½ä»¤ç”¨æ³•">#</a></h4>
<p>æ ¼å¼ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible &lt;host-pattern&gt; <span style="color:#f92672">[</span>-m module_name<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-a args<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>é€‰é¡¹è¯´æ˜ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>--version <span style="color:#75715e">#æ˜¾ç¤ºç‰ˆæœ¬</span>
</span></span><span style="display:flex;"><span>-m module <span style="color:#75715e">#æŒ‡å®šæ¨¡å—ï¼Œé»˜è®¤ä¸ºcommand</span>
</span></span><span style="display:flex;"><span>-v <span style="color:#75715e">#è¯¦ç»†è¿‡ç¨‹ -vv -vvvæ›´è¯¦ç»†</span>
</span></span><span style="display:flex;"><span>--list-hosts <span style="color:#75715e">#æ˜¾ç¤ºä¸»æœºåˆ—è¡¨ï¼Œå¯ç®€å†™ --list</span>
</span></span><span style="display:flex;"><span>-C, --check <span style="color:#75715e">#æ£€æŸ¥ï¼Œå¹¶ä¸æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>-T, --timeout<span style="color:#f92672">=</span>TIMEOUT <span style="color:#75715e">#æ‰§è¡Œå‘½ä»¤çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤10s</span>
</span></span><span style="display:flex;"><span>-k, --ask-pass <span style="color:#75715e">#æç¤ºè¾“å…¥sshè¿æ¥å¯†ç ï¼Œé»˜è®¤KeyéªŒè¯</span>
</span></span><span style="display:flex;"><span>-u, --user<span style="color:#f92672">=</span>REMOTE_USER <span style="color:#75715e">#æ‰§è¡Œè¿œç¨‹æ‰§è¡Œçš„ç”¨æˆ·,é»˜è®¤root</span>
</span></span><span style="display:flex;"><span>-b, --become <span style="color:#75715e">#ä»£æ›¿æ—§ç‰ˆçš„sudoå®ç°é€šè¿‡sudoæœºåˆ¶å®ç°æå‡æƒé™</span>
</span></span><span style="display:flex;"><span>--become-user<span style="color:#f92672">=</span>USERNAME <span style="color:#75715e">#æŒ‡å®šsudoçš„runasç”¨æˆ·ï¼Œé»˜è®¤ä¸ºroot</span>
</span></span><span style="display:flex;"><span>-K, --ask-become-pass <span style="color:#75715e">#æç¤ºè¾“å…¥sudoæ—¶çš„å£ä»¤</span>
</span></span><span style="display:flex;"><span>-f FORKS, --forks FORKS <span style="color:#75715e">#æŒ‡å®šå¹¶å‘åŒæ—¶æ‰§è¡Œansibleä»»åŠ¡çš„ä¸»æœºæ•°</span>
</span></span><span style="display:flex;"><span>-i INVENTORY, --inventory INVENTORY <span style="color:#75715e">#æŒ‡å®šä¸»æœºæ¸…å•æ–‡ä»¶</span>
</span></span></code></pre></div><p>èŒƒä¾‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#ä»¥wangç”¨æˆ·æ‰§è¡Œpingå­˜æ´»æ£€æµ‹</span>
</span></span><span style="display:flex;"><span>ansible all -m ping -u wang -k
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä»¥wang sudoè‡³rootæ‰§è¡Œpingå­˜æ´»æ£€æµ‹</span>
</span></span><span style="display:flex;"><span>ansible all -m ping -u wang -k -b
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä»¥wang sudoè‡³mageç”¨æˆ·æ‰§è¡Œpingå­˜æ´»æ£€æµ‹</span>
</span></span><span style="display:flex;"><span>ansible all -m ping -u wang -k -b --become-user<span style="color:#f92672">=</span>mage
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä»¥wang sudoè‡³rootç”¨æˆ·æ‰§è¡Œls</span>
</span></span><span style="display:flex;"><span>ansible all -m command -u wang -a <span style="color:#e6db74">&#39;ls /root&#39;</span> -b --become-user<span style="color:#f92672">=</span>root -k -K
</span></span></code></pre></div><p>èŒƒä¾‹: å¹¶å‘æ‰§è¡Œæ§åˆ¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#åˆ†åˆ«æ‰§è¡Œä¸‹é¢ä¸¤æ¡å‘½ä»¤è§‚å¯Ÿç»“æœ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible all -a &#39;sleep 5&#39; -f1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible all -a &#39;sleep 5&#39; -f10</span>
</span></span></code></pre></div><p>èŒƒä¾‹: ä½¿ç”¨æ™®èƒ½ç”¨æˆ·è¿›è¡Œè¿œç¨‹ç®¡ç†</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#åœ¨æ‰€æœ‰æ§åˆ¶ç«¯å’Œè¢«æ§åˆ¶ç«¯åˆ›å»ºç”¨æˆ·å’Œå¯†ç </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@rocky8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#useradd wang</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@rocky8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#echo wang:123456 | chpasswd</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åœ¨æ‰€æœ‰è¢«æ§åˆ¶ç«¯å¯¹ç”¨æˆ·sudoæˆæƒ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@rocky8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#visudo</span>
</span></span><span style="display:flex;"><span>wang ALL<span style="color:#f92672">=(</span>ALL<span style="color:#f92672">)</span> NOPASSWD: ALL
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@rocky8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#visudo -c</span>
</span></span><span style="display:flex;"><span>/etc/sudoers: parsed OK
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å®ç°ä»æ§åˆ¶ç«¯åˆ°è¢«æ§åˆ¶ç«¯çš„åŸºäºkeyéªŒè¯</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#su - wang</span>
</span></span><span style="display:flex;"><span>wang@ansible:~$ssh-keygen -f ~/.ssh/id_rsa -P <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>wang@ansible:~$$ssh-copy-id wang@<span style="color:#e6db74">&#39;10.0.0.8&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä½¿ç”¨æ™®é€šç”¨æˆ·æµ‹è¯•è¿æ¥,é»˜è®¤è¿æ¥æƒé™ä¸è¶³å¤±è´¥</span>
</span></span><span style="display:flex;"><span>wang@ansible:~$ ansible 10.0.0.8 -m shell -a <span style="color:#e6db74">&#39;ls /root&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.8 | FAILED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> &gt;&gt;
</span></span><span style="display:flex;"><span>ls: cannot open directory <span style="color:#e6db74">&#39;/root&#39;</span>: Permission deniednon-zero <span style="color:#66d9ef">return</span> code
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä½¿ç”¨æ™®é€šç”¨æˆ·é€šè¿‡-bé€‰é¡¹è¿æ¥å®ç°sudoææƒåè¿æ¥æˆåŠŸ</span>
</span></span><span style="display:flex;"><span>wang@ansible:~$ ansible 10.0.0.8 -m shell -a <span style="color:#e6db74">&#39;ls /root&#39;</span> -b --become-user root
</span></span><span style="display:flex;"><span>10.0.0.8 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>anaconda-ks.cfg
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä¿®æ”¹é…ç½®æ–‡ä»¶æŒ‡å®šsudoæœºåˆ¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#vim /etc/ansible/ansible.cfg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å–æ¶ˆä¸‹é¢è¡Œå‰é¢çš„æ³¨é‡Š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>privilege_escalation<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>become<span style="color:#f92672">=</span>True
</span></span><span style="display:flex;"><span>become_method<span style="color:#f92672">=</span>sudo
</span></span><span style="display:flex;"><span>become_user<span style="color:#f92672">=</span>root
</span></span><span style="display:flex;"><span>become_ask_pass<span style="color:#f92672">=</span>False
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å†æ¬¡æµ‹è¯•</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#su - wang</span>
</span></span><span style="display:flex;"><span>wang@ansible:~$ ansible 10.0.0.8 -m shell -a <span style="color:#e6db74">&#39;ls /root&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.8 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>anaconda-ks.cfg
</span></span></code></pre></div><p>èŒƒä¾‹: ä½¿ç”¨æ™®é€šç”¨æˆ·è¿æ¥è¿œç¨‹ä¸»æœºæ‰§è¡Œä»£æ›¿å¦ä¸€ä¸ªç”¨æˆ·èº«ä»½æ‰§è¡Œæ“ä½œ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#useradd wang</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#echo wang:123456 | chpasswd</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å…ˆåœ¨è¢«æ§åˆ¶ç«¯èƒ½è¿‡sudoå¯¹æ™®é€šç”¨æˆ·æˆæƒ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#grep wang /etc/sudoers</span>
</span></span><span style="display:flex;"><span>wang ALL<span style="color:#f92672">=(</span>ALL<span style="color:#f92672">)</span> NOPASSWD: ALL
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä»¥wangçš„ç”¨æˆ·è¿æ¥ç”¨æˆ·,å¹¶åˆ©ç”¨sudoä»£è¡¨mageæ‰§è¡Œwhoamiå‘½ä»¤</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible 10.0.0.8 -m shell -a &#39;whoami&#39; -u wang -k -b --become-</span>
</span></span><span style="display:flex;"><span>user<span style="color:#f92672">=</span>mage
</span></span><span style="display:flex;"><span>SSH password: <span style="color:#75715e">#è¾“å…¥è¿œç¨‹ä¸»æœºwangç”¨æˆ·sshè¿æ¥å¯†ç </span>
</span></span><span style="display:flex;"><span>10.0.0.8 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>mage
</span></span></code></pre></div><h4 id="ansibleçš„host-pattern">ansibleçš„Host-pattern<a hidden class="anchor" aria-hidden="true" href="#ansibleçš„host-pattern">#</a></h4>
<p>ç”¨äºåŒ¹é…è¢«æ§åˆ¶çš„ä¸»æœºçš„åˆ—è¡¨
All ï¼šè¡¨ç¤ºæ‰€æœ‰Inventoryä¸­çš„æ‰€æœ‰ä¸»æœº
èŒƒä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible all -m ping
</span></span></code></pre></div><p>*:é€šé…ç¬¦</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible <span style="color:#e6db74">&#34;*&#34;</span> -m ping
</span></span><span style="display:flex;"><span>ansible 192.168.1.* -m ping
</span></span><span style="display:flex;"><span>ansible <span style="color:#e6db74">&#34;srvs&#34;</span> -m ping
</span></span><span style="display:flex;"><span>ansible <span style="color:#e6db74">&#34;10.0.0.6 10.0.0.7&#34;</span> -m ping
</span></span></code></pre></div><p>æˆ–å…³ç³»</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible <span style="color:#e6db74">&#34;websrvs:appsrvs&#34;</span> -m ping
</span></span><span style="display:flex;"><span>ansible <span style="color:#e6db74">&#34;192.168.1.10:192.168.1.20&#34;</span> -m ping
</span></span></code></pre></div><p>é€»è¾‘ä¸</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#åœ¨websrvsç»„å¹¶ä¸”åœ¨dbsrvsç»„ä¸­çš„ä¸»æœº</span>
</span></span><span style="display:flex;"><span>ansible <span style="color:#e6db74">&#34;websrvs:&amp;dbsrvs&#34;</span> -m ping
</span></span></code></pre></div><p>é€»è¾‘é</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#åœ¨æ‰€æœ‰ä¸»æœº,ä½†ä¸åœ¨websrvsç»„å’Œdbsrvsç»„ä¸­çš„ä¸»æœº</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ³¨æ„ï¼šæ­¤å¤„ä¸ºå•å¼•å·</span>
</span></span><span style="display:flex;"><span>ansible <span style="color:#e6db74">&#39;all:!dbsrvs:!websrvs&#39;</span> -m ping
</span></span></code></pre></div><p>ç»¼åˆé€»è¾‘</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible <span style="color:#e6db74">&#39;websrvs:dbsrvs:&amp;appsrvs:!ftpsrvs&#39;</span> -m ping
</span></span></code></pre></div><p>æ­£åˆ™è¡¨è¾¾å¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible <span style="color:#e6db74">&#34;websrvs:dbsrvs&#34;</span> -m ping
</span></span><span style="display:flex;"><span>ansible <span style="color:#e6db74">&#34;~(web|db).*\.magedu\.com&#34;</span> -m ping
</span></span></code></pre></div><h5 id="ansible-å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹">ansible å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹<a hidden class="anchor" aria-hidden="true" href="#ansible-å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹">#</a></h5>
<ol>
<li>åŠ è½½è‡ªå·±çš„é…ç½®æ–‡ä»¶,é»˜è®¤/etc/ansible/ansible.cfg</li>
<li>æŸ¥æ‰¾ä¸»æœºæ¸…å•ä¸­å¯¹åº”çš„ä¸»æœºæˆ–ä¸»æœºç»„</li>
<li>åŠ è½½è‡ªå·±å¯¹åº”çš„æ¨¡å—æ–‡ä»¶ï¼Œå¦‚ï¼šcommand</li>
<li>é€šè¿‡ansibleå°†æ¨¡å—æˆ–å‘½ä»¤ç”Ÿæˆå¯¹åº”çš„ä¸´æ—¶pyæ–‡ä»¶ï¼Œå¹¶å°†è¯¥æ–‡ä»¶ä¼ è¾“è‡³è¿œç¨‹æœåŠ¡å™¨çš„å¯¹åº”æ‰§è¡Œç”¨æˆ·
$HOME/.ansible/tmp/ansible-tmp-æ•°å­—/XXX.PYæ–‡ä»¶</li>
<li>ç»™æ–‡ä»¶+xæ‰§è¡Œ</li>
<li>æ‰§è¡Œå¹¶è¿”å›ç»“æœ</li>
<li>åˆ é™¤ä¸´æ—¶pyæ–‡ä»¶ï¼Œé€€å‡º</li>
</ol>
<h5 id="ansible-å‘½ä»¤çš„æ‰§è¡ŒçŠ¶æ€">ansible å‘½ä»¤çš„æ‰§è¡ŒçŠ¶æ€<a hidden class="anchor" aria-hidden="true" href="#ansible-å‘½ä»¤çš„æ‰§è¡ŒçŠ¶æ€">#</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#grep -A 14 &#39;\[colors\]&#39; /etc/ansible/ansible.cfg</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>colors<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#highlight = white</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#verbose = blue</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#warn = bright purple</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#error = red</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#debug = dark gray</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#deprecate = purple</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#skip = cyan</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#unreachable = red</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ok = green</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#changed = yellow</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#diff_add = green</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#diff_remove = red</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#diff_lines = cyan</span>
</span></span></code></pre></div><ul>
<li>ç»¿è‰²ï¼šæ‰§è¡ŒæˆåŠŸå¹¶ä¸”å¯¹ç›®æ ‡ä¸»æœºä¸éœ€è¦åšæ”¹å˜çš„æ“ä½œ</li>
<li>é»„è‰²ï¼šæ‰§è¡ŒæˆåŠŸå¹¶ä¸”å¯¹ç›®æ ‡ä¸»æœºåšå˜æ›´</li>
<li>çº¢è‰²ï¼šæ‰§è¡Œå¤±è´¥</li>
</ul>
<h3 id="ansible-console">ansible-console<a hidden class="anchor" aria-hidden="true" href="#ansible-console">#</a></h3>
<p>æ­¤å·¥å…·å¯äº¤äº’æ‰§è¡Œå‘½ä»¤ï¼Œæ”¯æŒtabï¼Œansible 2.0+æ–°å¢
æç¤ºç¬¦æ ¼å¼ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>æ‰§è¡Œç”¨æˆ·@å½“å‰æ“ä½œçš„ä¸»æœºç»„ <span style="color:#f92672">(</span>å½“å‰ç»„çš„ä¸»æœºæ•°é‡<span style="color:#f92672">)[</span>f:å¹¶å‘æ•°<span style="color:#f92672">]</span>$
</span></span></code></pre></div><p>å¸¸ç”¨å­å‘½ä»¤ï¼š</p>
<ul>
<li>è®¾ç½®å¹¶å‘æ•°ï¼š forks n ä¾‹å¦‚ï¼š forks 10</li>
<li>åˆ‡æ¢ç»„ï¼š cd ä¸»æœºç»„ ä¾‹å¦‚ï¼š cd web</li>
<li>åˆ—å‡ºå½“å‰ç»„ä¸»æœºåˆ—è¡¨ï¼š list</li>
<li>åˆ—å‡ºæ‰€æœ‰çš„å†…ç½®å‘½ä»¤ï¼š ?æˆ–help</li>
</ul>
<p>èŒƒä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-console</span>
</span></span><span style="display:flex;"><span>Welcome to the ansible console.
</span></span><span style="display:flex;"><span>Type help or ? to list commands.
</span></span><span style="display:flex;"><span>root@all <span style="color:#f92672">(</span>3<span style="color:#f92672">)[</span>f:5<span style="color:#f92672">]</span>$ ping
</span></span><span style="display:flex;"><span>10.0.0.7 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_facts&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;discovered_interpreter_python&#34;</span>: <span style="color:#e6db74">&#34;/usr/bin/python&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;changed&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ping&#34;</span>: <span style="color:#e6db74">&#34;pong&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>10.0.0.6 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_facts&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;discovered_interpreter_python&#34;</span>: <span style="color:#e6db74">&#34;/usr/bin/python&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;changed&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ping&#34;</span>: <span style="color:#e6db74">&#34;pong&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>10.0.0.8 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_facts&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;discovered_interpreter_python&#34;</span>: <span style="color:#e6db74">&#34;/usr/libexec/platform-python&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;changed&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ping&#34;</span>: <span style="color:#e6db74">&#34;pong&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>root@all <span style="color:#f92672">(</span>3<span style="color:#f92672">)[</span>f:5<span style="color:#f92672">]</span>$ list
</span></span><span style="display:flex;"><span>10.0.0.8
</span></span><span style="display:flex;"><span>10.0.0.7
</span></span><span style="display:flex;"><span>10.0.0.6
</span></span><span style="display:flex;"><span>root@all <span style="color:#f92672">(</span>3<span style="color:#f92672">)[</span>f:5<span style="color:#f92672">]</span>$ cd websrvs
</span></span><span style="display:flex;"><span>root@websrvs <span style="color:#f92672">(</span>2<span style="color:#f92672">)[</span>f:5<span style="color:#f92672">]</span>$ list
</span></span><span style="display:flex;"><span>10.0.0.7
</span></span><span style="display:flex;"><span>10.0.0.8
</span></span><span style="display:flex;"><span>root@websrvs <span style="color:#f92672">(</span>2<span style="color:#f92672">)[</span>f:5<span style="color:#f92672">]</span>$ forks <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>root@websrvs <span style="color:#f92672">(</span>2<span style="color:#f92672">)[</span>f:10<span style="color:#f92672">]</span>$ cd appsrvs
</span></span><span style="display:flex;"><span>root@appsrvs <span style="color:#f92672">(</span>2<span style="color:#f92672">)[</span>f:5<span style="color:#f92672">]</span>$ yum name<span style="color:#f92672">=</span>httpd state<span style="color:#f92672">=</span>present
</span></span><span style="display:flex;"><span>root@appsrvs <span style="color:#f92672">(</span>2<span style="color:#f92672">)[</span>f:5<span style="color:#f92672">]</span>$ service name<span style="color:#f92672">=</span>httpd state<span style="color:#f92672">=</span>started
</span></span></code></pre></div><h3 id="ansible-playbook">ansible-playbook<a hidden class="anchor" aria-hidden="true" href="#ansible-playbook">#</a></h3>
<p>æ­¤å·¥å…·ç”¨äºæ‰§è¡Œç¼–å†™å¥½çš„ playbook ä»»åŠ¡
èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible-playbook hello.yml
</span></span><span style="display:flex;"><span>cat hello.yml
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#75715e">#hello world yml file</span>
</span></span><span style="display:flex;"><span>- hosts: websrvs
</span></span><span style="display:flex;"><span>  remote_user: root
</span></span><span style="display:flex;"><span>  gather_facts: no
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: hello world
</span></span><span style="display:flex;"><span>    command: /usr/bin/wall hello world
</span></span></code></pre></div><h3 id="ansible-vault">ansible-vault<a hidden class="anchor" aria-hidden="true" href="#ansible-vault">#</a></h3>
<p>æ­¤å·¥å…·å¯ä»¥ç”¨äºåŠ å¯†è§£å¯†ymlæ–‡ä»¶
æ ¼å¼ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible-vault <span style="color:#f92672">[</span>create|decrypt|edit|encrypt|rekey|view<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>èŒƒä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible-vault encrypt hello.yml <span style="color:#75715e">#åŠ å¯†</span>
</span></span><span style="display:flex;"><span>ansible-vault decrypt hello.yml <span style="color:#75715e">#è§£å¯†</span>
</span></span><span style="display:flex;"><span>ansible-vault view hello.yml <span style="color:#75715e">#æŸ¥çœ‹</span>
</span></span><span style="display:flex;"><span>ansible-vault edit hello.yml <span style="color:#75715e">#ç¼–è¾‘åŠ å¯†æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>ansible-vault rekey hello.yml <span style="color:#75715e">#ä¿®æ”¹å£ä»¤</span>
</span></span><span style="display:flex;"><span>ansible-vault create new.yml <span style="color:#75715e">#åˆ›å»ºæ–°æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ‰§è¡ŒåŠ å¯†çš„playbook,äº¤äº’å¼è¾“å…¥å¯†ç </span>
</span></span><span style="display:flex;"><span>chmod <span style="color:#ae81ff">600</span> hello.yml
</span></span><span style="display:flex;"><span>ansible-playbook --ask-vault-pass hello.yml
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä»pass.txtæ–‡ä»¶ä¸­è¯»å–å¯†ç </span>
</span></span><span style="display:flex;"><span>ansible-playbook --vault-password-file pass.txt hello.yml
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä»é…ç½®æ–‡ä»¶ä¸­å–å¾—å¯†ç </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#vi /etc/ansible/ansible.cfg</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>defaults<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ault-password-file<span style="color:#f92672">=</span>pass.txt
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å¯ä»¥ç›´æ¥æ‰§è¡ŒåŠ å¯†æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>ansible-playbook hello.yml
</span></span></code></pre></div><h3 id="ansible-galaxy">ansible-galaxy<a hidden class="anchor" aria-hidden="true" href="#ansible-galaxy">#</a></h3>
<p>Galaxy æ˜¯ä¸€ä¸ªå…è´¹ç½‘ç«™, ç±»ä¼¼äºgithubç½‘ç«™, ç½‘ç«™ä¸Šå‘å¸ƒäº†å¾ˆå¤šçš„å…±äº«çš„rolesè§’è‰²ã€‚
Ansible æä¾›äº†ansible-galaxyå‘½ä»¤è¡Œå·¥å…·è¿æ¥ <a href="https://galaxy.ansible.com">url</a> ç½‘ç«™ä¸‹è½½ç›¸åº”çš„roles, è¿›è¡Œinit(åˆå§‹åŒ–ã€search( æŸ¥æ‹˜ã€install(å®‰è£…ã€ remove(ç§»é™¤)ç­‰æ“ä½œã€‚</p>
<p><img loading="lazy" src="/posts.images/image.assets/1677156776774.png" alt="1677156776774"  />
</p>
<p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#æœç´¢é¡¹ç›®</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-galaxy search lamp</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„galaxy</span>
</span></span><span style="display:flex;"><span>ansible-galaxy list
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å®‰è£…galaxy,é»˜è®¤ä¸‹è½½åˆ°~/.ansible/rolesä¸‹</span>
</span></span><span style="display:flex;"><span>ansible-galaxy install geerlingguy.mysql
</span></span><span style="display:flex;"><span>ansible-galaxy install geerlingguy.redis
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ é™¤galaxy</span>
</span></span><span style="display:flex;"><span>ansible-galaxy remove geerlingguy.redis
</span></span></code></pre></div><h2 id="ansibleå¸¸ç”¨æ¨¡å—">Ansibleå¸¸ç”¨æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#ansibleå¸¸ç”¨æ¨¡å—">#</a></h2>
<p>2015å¹´12æœˆåª270å¤šä¸ªæ¨¡å—
2016å¹´12å¹´26æ—¥ansible 1.9.2 æœ‰540ä¸ªæ¨¡å—
2018å¹´01æœˆ12æ—¥ansible 2.3.8 æœ‰1378ä¸ªæ¨¡å—
2018å¹´05æœˆ28æ—¥ansible 2.5.3 æœ‰1562ä¸ªæ¨¡å—
2018å¹´07æœˆ15æ—¥ansible 2.6.3 æœ‰1852ä¸ªæ¨¡å—
2018å¹´11æœˆ19æ—¥ansible 2.7.2 æœ‰2080ä¸ªæ¨¡å—
2020å¹´03æœˆ02æ—¥ansible 2.9.5 æœ‰3387ä¸ªæ¨¡å—
2021å¹´12æœˆ22æ—¥ansible 2.11.8 æœ‰6141ä¸ªæ¨¡å—
2022å¹´06æœˆ04æ—¥ansible 2.12.6 æœ‰6763ä¸ªæ¨¡å—
è™½ç„¶æ¨¡å—ä¼—å¤šï¼Œä½†æœ€å¸¸ç”¨çš„æ¨¡å—ä¹Ÿå°±2ï¼Œ30ä¸ªè€Œå·²ï¼Œé’ˆå¯¹ç‰¹å®šä¸šåŠ¡åªéœ€è¦ç†Ÿæ‚‰10å‡ ä¸ªæ¨¡å—å³å¯
å¸¸ç”¨æ¨¡å—å¸®åŠ©æ–‡æ¡£å‚è€ƒï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>https://docs.ansible.com/ansible/2.9/modules/modules_by_category.html
</span></span><span style="display:flex;"><span>https://docs.ansible.com/ansible/2.9/modules/list_of_all_modules.html
</span></span><span style="display:flex;"><span>https://docs.ansible.com/ansible/latest/modules/list_of_all_modules.html
</span></span><span style="display:flex;"><span>https://docs.ansible.com/ansible/latest/modules/modules_by_category.html
</span></span></code></pre></div><h3 id="command-æ¨¡å—">Command æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#command-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šåœ¨è¿œç¨‹ä¸»æœºæ‰§è¡Œå‘½ä»¤ï¼Œæ­¤ä¸ºé»˜è®¤æ¨¡å—ï¼Œå¯å¿½ç•¥ -m é€‰é¡¹
æ³¨æ„ï¼šæ­¤å‘½ä»¤ä¸æ”¯æŒ $VARNAME &lt; &gt; | ; &amp; ç­‰ï¼Œå¯ç”¨shellæ¨¡å—å®ç°
æ³¨æ„ï¼šæ­¤æ¨¡å—ä¸å…·æœ‰å¹‚ç­‰æ€§
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chdir<span style="color:#f92672">=</span>dir <span style="color:#75715e">#æ‰§è¡Œå‘½ä»¤å‰,å…ˆåˆ‡æ¢è‡³ç›®å½•dir</span>
</span></span><span style="display:flex;"><span>creates<span style="color:#f92672">=</span>file <span style="color:#75715e">#å½“fileä¸å­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>removes<span style="color:#f92672">=</span>file <span style="color:#75715e">#å½“fileå­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m command -a &#39;chdir=/etc cat centos-release&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.7 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>CentOS Linux release 7.7.1908 <span style="color:#f92672">(</span>Core<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>10.0.0.8 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>CentOS Linux release 8.1.1911 <span style="color:#f92672">(</span>Core<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m command -a &#39;chdir=/etc creates=/data/f1.txt cat centos-release&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.7 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>CentOS Linux release 7.7.1908 <span style="color:#f92672">(</span>Core<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>10.0.0.8 | SUCCESS | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>skipped, since /data/f1.txt exists
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m command -a &#39;chdir=/etc removes=/data/f1.txt cat centos-release&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.7 | SUCCESS | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>skipped, since /data/f1.txt does not exist
</span></span><span style="display:flex;"><span>10.0.0.8 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>CentOS Linux release 8.1.1911 <span style="color:#f92672">(</span>Core<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m command -a <span style="color:#e6db74">&#39;service vsftpd start&#39;</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m command -a <span style="color:#e6db74">&#39;echo magedu |passwd --stdin wang&#39;</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m command -a <span style="color:#e6db74">&#39;rm -rf /data/&#39;</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m command -a <span style="color:#e6db74">&#39;echo hello &gt; /data/hello.log&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ansible websrvs -m command -a <span style="color:#e6db74">&#34;echo </span>$HOSTNAME<span style="color:#e6db74">&#34;</span>
</span></span></code></pre></div><h3 id="shell-æ¨¡å—">Shell æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#shell-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šå’Œcommandç›¸ä¼¼ï¼Œç”¨shellæ‰§è¡Œå‘½ä»¤,æ”¯æŒå„ç§ç¬¦å·,æ¯”å¦‚:*,$, &gt; , ç›¸å½“äºå¢å¼ºç‰ˆçš„commandæ¨¡å—
æ³¨æ„ï¼šæ­¤æ¨¡å—ä¸å…·æœ‰å¹‚ç­‰æ€§,å»ºè®®èƒ½ä¸èƒ½å°±ç”¨æ­¤æ¨¡å—,æœ€å¥½ä½¿ç”¨ä¸“ç”¨æ¨¡å—
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chdir<span style="color:#f92672">=</span>dir <span style="color:#75715e">#æ‰§è¡Œå‘½ä»¤å‰,å…ˆåˆ‡æ¢è‡³ç›®å½•dir</span>
</span></span><span style="display:flex;"><span>creates<span style="color:#f92672">=</span>file <span style="color:#75715e">#å½“fileä¸å­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>removes<span style="color:#f92672">=</span>file <span style="color:#75715e">#å½“fileå­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m shell -a &#34;echo $HOSTNAME&#34;</span>
</span></span><span style="display:flex;"><span>10.0.0.7 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>ansible
</span></span><span style="display:flex;"><span>10.0.0.8 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>ansible
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m shell -a &#39;echo $HOSTNAME&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.7 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>centos7.wangxiaochun.com
</span></span><span style="display:flex;"><span>10.0.0.8 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>centos8.localdomain
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m shell -a &#39;echo centos | passwd --stdin wang&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.7 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>Changing password <span style="color:#66d9ef">for</span> user wang.
</span></span><span style="display:flex;"><span>passwd: all authentication tokens updated successfully.
</span></span><span style="display:flex;"><span>10.0.0.8 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>Changing password <span style="color:#66d9ef">for</span> user wang.
</span></span><span style="display:flex;"><span>passwd: all authentication tokens updated successfully.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m shell -a &#39;ls -l /etc/shadow&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.7 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>---------- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">889</span> Mar <span style="color:#ae81ff">2</span> 14:34 /etc/shadow
</span></span><span style="display:flex;"><span>10.0.0.8 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>---------- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">944</span> Mar <span style="color:#ae81ff">2</span> 14:34 /etc/shadow
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m shell -a &#39;echo hello &gt; /data/hello.log&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.7 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>10.0.0.8 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m shell -a &#39;cat /data/hello.log&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.7 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>hello
</span></span><span style="display:flex;"><span>10.0.0.8 | CHANGED | rc<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> &gt;&gt;
</span></span><span style="display:flex;"><span>hello
</span></span></code></pre></div><p>æ³¨æ„ï¼šè°ƒç”¨bashæ‰§è¡Œå‘½ä»¤ ç±»ä¼¼ cat /tmp/test.md | awk -F&rsquo;|&rsquo; &lsquo;{print $1,$2}&rsquo; &amp;&gt; /tmp/example.txt è¿™äº›å¤æ‚å‘½ä»¤ï¼Œå³ä½¿ä½¿ç”¨shellä¹Ÿå¯èƒ½ä¼šå¤±è´¥ï¼Œè§£å†³åŠæ³•ï¼šå†™åˆ°è„šæœ¬æ—¶ï¼Œcopyåˆ°è¿œç¨‹ï¼Œæ‰§è¡Œï¼Œå†æŠŠéœ€è¦çš„ç»“æœæ‹‰å›æ‰§è¡Œå‘½ä»¤çš„æœºå™¨
èŒƒä¾‹ï¼šå°†shellæ¨¡å—ä»£æ›¿commandï¼Œè®¾ä¸ºæ¨¡å—</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#vim /etc/ansible/ansible.cfg</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä¿®æ”¹ä¸‹é¢ä¸€è¡Œ</span>
</span></span><span style="display:flex;"><span>module_name <span style="color:#f92672">=</span> shell
</span></span></code></pre></div><h3 id="script-æ¨¡å—">Script æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#script-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šåœ¨è¿œç¨‹ä¸»æœºä¸Šè¿è¡ŒansibleæœåŠ¡å™¨ä¸Šçš„è„šæœ¬(æ— éœ€æ‰§è¡Œæƒé™)
æ³¨æ„ï¼šæ­¤æ¨¡å—ä¸å…·æœ‰å¹‚ç­‰æ€§
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chdir<span style="color:#f92672">=</span>dir <span style="color:#75715e">#æ‰§è¡Œå‘½ä»¤å‰,å…ˆåˆ‡æ¢è‡³ç›®å½•dir</span>
</span></span><span style="display:flex;"><span>cmd <span style="color:#75715e">#æŒ‡å®šansibleä¸»æœºçš„å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>creates<span style="color:#f92672">=</span>file <span style="color:#75715e">#å½“fileä¸å­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>removes<span style="color:#f92672">=</span>file <span style="color:#75715e">#å½“fileå­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible websrvs -m script -a /data/test.sh
</span></span></code></pre></div><h3 id="copy-æ¨¡å—">Copy æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#copy-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šå¤åˆ¶ansibleæœåŠ¡å™¨ä¸»æ§ç«¯æˆ–è¿œç¨‹çš„æœ¬æœºçš„æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœº
æ³¨æ„: src=file å¦‚æœæ˜¯æ²¡æŒ‡æ˜è·¯å¾„,åˆ™ä¸ºå½“å‰ç›®å½•æˆ–å½“å‰ç›®å½•ä¸‹çš„filesç›®å½•ä¸‹çš„fileæ–‡ä»¶
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>src <span style="color:#75715e">#æ§åˆ¶ç«¯çš„æºæ–‡ä»¶è·¯å¾„</span>
</span></span><span style="display:flex;"><span>dest <span style="color:#75715e">#è¢«æ§ç«¯çš„æ–‡ä»¶è·¯å¾„</span>
</span></span><span style="display:flex;"><span>owner <span style="color:#75715e">#å±ä¸»</span>
</span></span><span style="display:flex;"><span>group <span style="color:#75715e">#å±ç»„</span>
</span></span><span style="display:flex;"><span>mode <span style="color:#75715e">#æƒé™</span>
</span></span><span style="display:flex;"><span>backup <span style="color:#75715e">#æ˜¯å¦å¤‡ä»½</span>
</span></span><span style="display:flex;"><span>validate <span style="color:#75715e">#éªŒè¯æˆåŠŸæ‰ä¼šæ‰§è¡Œcopy</span>
</span></span><span style="display:flex;"><span>remote_src <span style="color:#75715e">#noæ˜¯é»˜è®¤å€¼,è¡¨ç¤ºsrcæ–‡ä»¶åœ¨ansibleä¸»æœº,yesè¡¨ç¤ºsrcæ–‡ä»¶åœ¨è¿œç¨‹ä¸»æœº</span>
</span></span></code></pre></div><p>èŒƒä¾‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#å¦‚ç›®æ ‡å­˜åœ¨ï¼Œé»˜è®¤è¦†ç›–ï¼Œæ­¤å¤„æŒ‡å®šå…ˆå¤‡</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m copy -a <span style="color:#e6db74">&#34;src=/root/test1.sh dest=/tmp/test2.sh owner=wang mode=600 backup=yes&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æŒ‡å®šå†…å®¹ï¼Œç›´æ¥ç”Ÿæˆç›®æ ‡æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m copy -a <span style="color:#e6db74">&#34;content=&#39;wang 123456\nxiao 654321\n&#39; dest=/etc/rsync.pas owner=root group=root mode=0600&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å¤åˆ¶/etcç›®å½•è‡ªèº«,æ³¨æ„/etc/åé¢æ²¡æœ‰/</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m copy -a <span style="color:#e6db74">&#34;src=/etc dest=/backup&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å¤åˆ¶/etc/ä¸‹çš„æ–‡ä»¶ï¼Œä¸åŒ…æ‹¬/etc/ç›®å½•è‡ªèº«,æ³¨æ„/etc/åé¢æœ‰/</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m copy -a <span style="color:#e6db74">&#34;src=/etc/ dest=/backup&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å¤åˆ¶/etc/suders,å¹¶æ ¡éªŒè¯­æ³•</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m copy -a <span style="color:#e6db74">&#34;src=/etc/suders dest=/etc/sudoers.edit remote_src=yes validate=/usr/sbin/visudo -csf %s&#34;</span>
</span></span></code></pre></div><h3 id="get_url-æ¨¡å—">Get_url æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#get_url-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½: ç”¨äºå°†æ–‡ä»¶ä»httpã€httpsæˆ–ftpä¸‹è½½åˆ°è¢«ç®¡ç†æœºèŠ‚ç‚¹ä¸Š
å¸¸ç”¨å‚æ•°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>url <span style="color:#75715e">#ä¸‹è½½æ–‡ä»¶çš„URL,æ”¯æŒHTTPï¼ŒHTTPSæˆ–FTPåè®®</span>
</span></span><span style="display:flex;"><span>dest <span style="color:#75715e">#ä¸‹è½½åˆ°ç›®æ ‡è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼‰ï¼Œå¦‚æœç›®æ ‡æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå°±ç”¨åŸæ–‡ä»¶åï¼Œå¦‚æœç›®æ ‡è®¾ç½®äº†åç§°å°±ç”¨ç›®æ ‡</span>
</span></span><span style="display:flex;"><span>è®¾ç½®çš„åç§°
</span></span><span style="display:flex;"><span>owner <span style="color:#75715e">#æŒ‡å®šå±ä¸»</span>
</span></span><span style="display:flex;"><span>group <span style="color:#75715e">#æŒ‡å®šå±ç»„</span>
</span></span><span style="display:flex;"><span>mode <span style="color:#75715e">#æŒ‡å®šæƒé™</span>
</span></span><span style="display:flex;"><span>force <span style="color:#75715e">#å¦‚æœyesï¼Œdestä¸æ˜¯ç›®å½•ï¼Œå°†æ¯æ¬¡ä¸‹è½½æ–‡ä»¶ï¼Œå¦‚æœå†…å®¹æ”¹å˜æ›¿æ¢æ–‡ä»¶ã€‚å¦‚æœnoï¼Œåˆ™åªæœ‰åœ¨ç›®æ ‡ä¸å­˜</span>
</span></span><span style="display:flex;"><span>åœ¨æ—¶æ‰ä¼šä¸‹è½½
</span></span><span style="display:flex;"><span>checksum <span style="color:#75715e">#å¯¹ç›®æ ‡æ–‡ä»¶åœ¨ä¸‹è½½åè®¡ç®—æ‘˜è¦ï¼Œä»¥ç¡®ä¿å…¶å®Œæ•´æ€§</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ç¤ºä¾‹: checksum=&#34;sha256:D98291AC[...]B6DC7B97&#34;,</span>
</span></span><span style="display:flex;"><span>checksum<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sha256:http://example.com/path/sha256sum.txt&#34;</span>
</span></span><span style="display:flex;"><span>url_username <span style="color:#75715e">#ç”¨äºHTTPåŸºæœ¬è®¤è¯çš„ç”¨æˆ·åã€‚ å¯¹äºå…è®¸ç©ºå¯†ç çš„ç«™ç‚¹ï¼Œæ­¤å‚æ•°å¯ä»¥ä¸ä½¿ç”¨`url_password&#39;</span>
</span></span><span style="display:flex;"><span>url_password <span style="color:#75715e">#ç”¨äºHTTPåŸºæœ¬è®¤è¯çš„å¯†ç ã€‚ å¦‚æœæœªæŒ‡å®š`url_username&#39;å‚æ•°ï¼Œåˆ™ä¸ä¼šä½¿ç”¨`url_password&#39;å‚æ•°</span>
</span></span><span style="display:flex;"><span>validate_certs <span style="color:#75715e">#å¦‚æœâ€œnoâ€ï¼ŒSSLè¯ä¹¦å°†ä¸ä¼šè¢«éªŒè¯ã€‚ é€‚ç”¨äºè‡ªç­¾åè¯ä¹¦åœ¨ç§æœ‰ç½‘ç«™ä¸Šä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>timeout <span style="color:#75715e">#URLè¯·æ±‚çš„è¶…æ—¶æ—¶é—´,ç§’ä¸ºå•ä½</span>
</span></span></code></pre></div><p>èŒƒä¾‹: ä¸‹è½½å¹¶MD5éªŒè¯</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m get_url -a &#39;url=http://nginx.org/download/nginx-1.18.0.tar.gz dest=/usr/local/src/nginx.tar.gz checksum=&#34;md5:b2d33d24d89b8b1f87ff5d251aa27eb8&#34;&#39;</span>
</span></span></code></pre></div><h3 id="fetch-æ¨¡å—">Fetch æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#fetch-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šä»è¿œç¨‹ä¸»æœºæå–æ–‡ä»¶è‡³ansibleçš„ä¸»æ§ç«¯ï¼Œcopyç›¸åï¼Œç›®å‰ä¸æ”¯æŒç›®å½•
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>src <span style="color:#75715e">#è¢«æ§åˆ¶ç«¯çš„æºæ–‡ä»¶è·¯å¾„,åªæ”¯æŒæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>dest <span style="color:#75715e">#ansibleæ§åˆ¶ç«¯çš„ç›®å½•è·¯å¾„</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible websrvs -m fetch -a <span style="color:#e6db74">&#39;src=/root/test.sh dest=/data/scripts&#39;</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible all -m fetch -a &#39;src=/etc/redhat-release</span>
</span></span><span style="display:flex;"><span>dest<span style="color:#f92672">=</span>/data/os<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#tree /data/os/</span>
</span></span><span style="display:flex;"><span>/data/os/
</span></span><span style="display:flex;"><span>â”œâ”€â”€ 10.0.0.6
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ etc
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ redhat-release
</span></span><span style="display:flex;"><span>â”œâ”€â”€ 10.0.0.7
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ etc
</span></span><span style="display:flex;"><span>â”‚ â””â”€â”€ redhat-release
</span></span><span style="display:flex;"><span>â””â”€â”€ 10.0.0.8
</span></span><span style="display:flex;"><span>â””â”€â”€ etc
</span></span><span style="display:flex;"><span>â””â”€â”€ redhat-release
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span> directories, <span style="color:#ae81ff">3</span> files
</span></span></code></pre></div><h3 id="file-æ¨¡å—">File æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#file-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šè®¾ç½®æ–‡ä»¶å±æ€§,åˆ›å»ºæ–‡ä»¶,ç›®å½•å’Œè½¯é“¾æ¥ç­‰
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>path <span style="color:#75715e">#åœ¨è¢«æ§ç«¯åˆ›å»ºçš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>owner <span style="color:#75715e">#å±ä¸»</span>
</span></span><span style="display:flex;"><span>group <span style="color:#75715e">#å±ç»„</span>
</span></span><span style="display:flex;"><span>mode <span style="color:#75715e">#æƒé™</span>
</span></span><span style="display:flex;"><span>state <span style="color:#75715e">#çŠ¶æ€</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>touch <span style="color:#75715e">#åˆ›å»ºæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>directory <span style="color:#75715e">#åˆ›å»ºç›®å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>link <span style="color:#75715e">#è½¯é“¾æ¥</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>hard <span style="color:#75715e">#ç¡¬é“¾æ¥</span>
</span></span><span style="display:flex;"><span>recurse <span style="color:#75715e">#yesè¡¨ç¤ºé€’å½’æˆæƒ</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºç©ºæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>ansible all -m file -a <span style="color:#e6db74">&#39;path=/data/test.txt state=touch&#39;</span>
</span></span><span style="display:flex;"><span>ansible all -m file -a <span style="color:#e6db74">&#39;path=/data/test.txt state=absent&#39;</span>
</span></span><span style="display:flex;"><span>ansible all -m file -a <span style="color:#e6db74">&#34;path=/root/test.sh owner=wang mode=755&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºç›®å½•</span>
</span></span><span style="display:flex;"><span>ansible all -m file -a <span style="color:#e6db74">&#34;path=/data/mysql state=directory owner=mysql group=mysql&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºè½¯é“¾æ¥</span>
</span></span><span style="display:flex;"><span>ansible all -m file -a <span style="color:#e6db74">&#39;src=/data/testfile path|dest|name=/data/testfile-link state=link&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºç›®å½•</span>
</span></span><span style="display:flex;"><span>ansible all -m file -a <span style="color:#e6db74">&#39;path=/data/testdir state=directory&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#é€’å½’ä¿®æ”¹ç›®å½•å±æ€§,ä½†ä¸é€’å½’è‡³å­ç›®å½•</span>
</span></span><span style="display:flex;"><span>ansible all -m file -a <span style="color:#e6db74">&#34;path=/data/mysql state=directory owner=mysql group=mysql&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#é€’å½’ä¿®æ”¹ç›®å½•åŠå­ç›®å½•çš„å±æ€§</span>
</span></span><span style="display:flex;"><span>ansible all -m file -a <span style="color:#e6db74">&#34;path=/data/mysql state=directory owner=mysql group=mysql recurse=yes&#34;</span>
</span></span></code></pre></div><h3 id="stat-æ¨¡å—">stat æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#stat-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šæ£€æŸ¥æ–‡ä»¶æˆ–æ–‡ä»¶ç³»ç»Ÿçš„çŠ¶æ€
æ³¨æ„ï¼šå¯¹äºWindowsç›®æ ‡ï¼Œè¯·æ”¹ç”¨win_statæ¨¡å—</p>
<p>å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>path <span style="color:#75715e">#æ–‡ä»¶/å¯¹è±¡çš„å®Œæ•´è·¯å¾„ï¼ˆå¿…é¡»ï¼‰</span>
</span></span></code></pre></div><p>å¸¸ç”¨çš„è¿”å›å€¼åˆ¤æ–­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>existsï¼š åˆ¤æ–­æ˜¯å¦å­˜åœ¨
</span></span><span style="display:flex;"><span>isuidï¼š è°ƒç”¨ç”¨æˆ·çš„IDä¸æ‰€æœ‰è€…IDæ˜¯å¦åŒ¹é…
</span></span></code></pre></div><p>èŒƒä¾‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible 127.0.0.1 -m stat -a &#39;path=/etc/passwd&#39;</span>
</span></span><span style="display:flex;"><span>127.0.0.1 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;changed&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;stat&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;atime&#34;</span>: 1614601466.7493012,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;attr_flags&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;attributes&#34;</span>: <span style="color:#f92672">[]</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;block_size&#34;</span>: 4096,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;blocks&#34;</span>: 8,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;us-ascii&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;checksum&#34;</span>: <span style="color:#e6db74">&#34;8f7a9a996d24de98bf1eab4a047f8e89e9c708cf&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ctime&#34;</span>: 1614334259.4498665,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;dev&#34;</span>: 2050,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;device_type&#34;</span>: 0,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;executable&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;exists&#34;</span>: true,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;gid&#34;</span>: 0,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;gr_name&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;inode&#34;</span>: 134691833,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;isblk&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ischr&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;isdir&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;isfifo&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;isgid&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;islnk&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;isreg&#34;</span>: true,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;issock&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;isuid&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;mimetype&#34;</span>: <span style="color:#e6db74">&#34;text/plain&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;mode&#34;</span>: <span style="color:#e6db74">&#34;0000&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;mtime&#34;</span>: 1614334259.4498665,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;nlink&#34;</span>: 1,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/etc/passwd&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;pw_name&#34;</span>: <span style="color:#e6db74">&#34;root&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;readable&#34;</span>: true,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;rgrp&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;roth&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;rusr&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;size&#34;</span>: 1030,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;uid&#34;</span>: 0,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;version&#34;</span>: <span style="color:#e6db74">&#34;671641160&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;wgrp&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;woth&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;writeable&#34;</span>: true,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;wusr&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;xgrp&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;xoth&#34;</span>: false,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;xusr&#34;</span>: false
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>æ¡ˆä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- name: install | Check <span style="color:#66d9ef">if</span> file is already configured.
</span></span><span style="display:flex;"><span>  stat: path<span style="color:#f92672">={{</span> nginx_file_path <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  connection: local
</span></span><span style="display:flex;"><span>  register: nginx_file_result
</span></span><span style="display:flex;"><span>- name: install | Download nginx file
</span></span><span style="display:flex;"><span>  get_url: url<span style="color:#f92672">={{</span> nginx_file_url <span style="color:#f92672">}}</span> dest<span style="color:#f92672">={{</span> software_files_path <span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>  validate_certs<span style="color:#f92672">=</span>no
</span></span><span style="display:flex;"><span>  connection: local
</span></span><span style="display:flex;"><span>  when:ï¼Œnot. nginx_file_result.stat.exists
</span></span></code></pre></div><p>èŒƒä¾‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#cat stat.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: websrvs
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - name: check file
</span></span><span style="display:flex;"><span>    stat: path<span style="color:#f92672">=</span>/data/mysql
</span></span><span style="display:flex;"><span>    register: st
</span></span><span style="display:flex;"><span>  - name: debug
</span></span><span style="display:flex;"><span>    debug:
</span></span><span style="display:flex;"><span>      msg: <span style="color:#e6db74">&#34;/data/mysql is not exist&#34;</span>
</span></span><span style="display:flex;"><span>    when: not st.stat.exists
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook stat.yml</span>
</span></span><span style="display:flex;"><span>PLAY <span style="color:#f92672">[</span>websrvs<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>***************************************
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>Gathering Facts<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>*******************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.7<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.8<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>check file<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>************************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.7<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.8<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>debug<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>*****************************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.7<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;/data/mysql is not exist&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.8<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;/data/mysql is not exist&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>PLAY RECAP
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>*******************************************
</span></span><span style="display:flex;"><span>10.0.0.7 : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> changed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>10.0.0.8 : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> changed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span></code></pre></div><h3 id="unarchive-æ¨¡å—">unarchive æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#unarchive-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šè§£åŒ…è§£å‹ç¼©
å®ç°æœ‰ä¸¤ç§ç”¨æ³•ï¼š</p>
<ul>
<li>å°†ansibleä¸»æœºä¸Šçš„å‹ç¼©åŒ…ä¼ åˆ°è¿œç¨‹ä¸»æœºåè§£å‹ç¼©è‡³ç‰¹å®šç›®å½•ï¼Œè®¾ç½®remote_src=no,æ­¤ä¸ºé»˜è®¤å€¼,å¯çœç•¥</li>
<li>å°†è¿œç¨‹æœ¬ä¸»æœºä¸Šæˆ–éansibleçš„å…¶å®ƒä¸»æœºçš„æŸä¸ªå‹ç¼©åŒ…è§£å‹ç¼©åˆ°è¿œç¨‹ä¸»æœºæœ¬æœºçš„æŒ‡å®šè·¯å¾„ä¸‹ï¼Œéœ€è¦è®¾ç½®remote_src=yes</li>
</ul>
<p>å¸¸è§å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>remote_src <span style="color:#75715e">#å’ŒcopyåŠŸèƒ½ä¸€æ ·ä¸”é€‰é¡¹äº’æ–¥ï¼Œyesè¡¨ç¤ºæºæ–‡ä»¶åœ¨è¿œç¨‹è¢«æ§ä¸»æœºæˆ–å…¶å®ƒéansibleçš„å…¶å®ƒä¸»æœºä¸Šï¼Œnoè¡¨ç¤ºæ–‡ä»¶åœ¨ansibleä¸»æœºä¸Š,é»˜è®¤å€¼ä¸ºno, æ­¤é€‰é¡¹ä»£æ›¿copyé€‰é¡¹</span>
</span></span><span style="display:flex;"><span>copy <span style="color:#75715e">#é»˜è®¤ä¸ºyesï¼Œå½“copy=yesï¼Œæ‹·è´çš„æ–‡ä»¶æ˜¯ä»ansibleä¸»æœºå¤åˆ¶åˆ°è¿œç¨‹ä¸»æœºä¸Šï¼Œå¦‚æœè®¾ç½®ä¸ºcopy=noï¼Œä¼šåœ¨è¿œç¨‹ä¸»æœºä¸Šå¯»æ‰¾srcæºæ–‡ä»¶,æ­¤é€‰é¡¹å·²åºŸå¼ƒ</span>
</span></span><span style="display:flex;"><span>src <span style="color:#75715e">#æºè·¯å¾„ï¼Œå¯ä»¥æ˜¯ansibleä¸»æœºä¸Šçš„è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯è¿œç¨‹ä¸»æœº(è¢«ç®¡ç†ç«¯æˆ–è€…ç¬¬ä¸‰æ–¹ä¸»æœº)ä¸Šçš„è·¯å¾„ï¼Œå¦‚æœæ˜¯è¿œç¨‹ä¸»æœºä¸Šçš„è·¯å¾„ï¼Œåˆ™éœ€è¦è®¾ç½®remote_src=yes</span>
</span></span><span style="display:flex;"><span>dest <span style="color:#75715e">#è¿œç¨‹ä¸»æœºä¸Šçš„ç›®æ ‡è·¯å¾„</span>
</span></span><span style="display:flex;"><span>mode <span style="color:#75715e">#è®¾ç½®è§£å‹ç¼©åçš„æ–‡ä»¶æƒé™</span>
</span></span><span style="display:flex;"><span>creates<span style="color:#f92672">=</span>/path/file <span style="color:#75715e">#å½“ç»å¯¹è·¯å¾„/path/fileä¸å­˜åœ¨æ—¶æ‰ä¼šæ‰§è¡Œ</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible all -m unarchive -a <span style="color:#e6db74">&#39;src=/data/foo.tgz dest=/var/lib/foo owner=wang group=bin&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ansible all -m unarchive -a <span style="color:#e6db74">&#39;src=/tmp/foo.zip dest=/data  mode=0777&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ansible all -m unarchive -a <span style="color:#e6db74">&#39;src=https://example.com/example.zip dest=/data &#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ansible websrvs -m unarchive -a <span style="color:#e6db74">&#39;src=https://releases.ansible.com/ansible/ansible-2.1.6.0-0.1.rc1.tar.gz dest=/data/ owner=root remote_src=yes&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ansible websrvs -m unarchive -a <span style="color:#e6db74">&#39;src=http://nginx.org/download/nginx- 1.18.0.tar.gz dest=/usr/local/src/ remote_src=yes&#39;</span><span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span></code></pre></div><h3 id="archive-æ¨¡å—">Archive æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#archive-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šæ‰“åŒ…å‹ç¼©ä¿å­˜åœ¨è¢«ç®¡ç†èŠ‚ç‚¹</p>
<p>å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>path <span style="color:#75715e">#å‹ç¼©çš„æ–‡ä»¶æˆ–ç›®å½•</span>
</span></span><span style="display:flex;"><span>dest <span style="color:#75715e">#å‹ç¼©åçš„æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>format <span style="color:#75715e">#å‹ç¼©æ ¼å¼,æ”¯æŒgz,bz2,xz,tar,zip</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible websrvs -m archive -a <span style="color:#e6db74">&#39;path=/var/log/ dest=/data/log.tar.bz2 format=bz2 owner=wang mode=0600&#39;</span>
</span></span></code></pre></div><h3 id="hostname-æ¨¡å—">Hostname æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#hostname-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šç®¡ç†ä¸»æœºå
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name <span style="color:#75715e">#ä¿®æ”¹åçš„ä¸»æœºåç§°</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible node1 -m hostname -a <span style="color:#e6db74">&#34;name=websrv&#34;</span>
</span></span><span style="display:flex;"><span>ansible 10.0.0.18 -m hostname -a <span style="color:#e6db74">&#39;name=node18.wang.org&#39;</span>
</span></span></code></pre></div><h3 id="cron-æ¨¡å—">Cron æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#cron-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šè®¡åˆ’ä»»åŠ¡
æ”¯æŒæ—¶é—´ï¼šminuteï¼Œhourï¼Œdayï¼Œmonthï¼Œweekday
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name <span style="color:#75715e">#æè¿°è„šæœ¬çš„ä½œç”¨</span>
</span></span><span style="display:flex;"><span>minute <span style="color:#75715e">#åˆ†é’Ÿ</span>
</span></span><span style="display:flex;"><span>hour <span style="color:#75715e">#å°æ—¶</span>
</span></span><span style="display:flex;"><span>weekday <span style="color:#75715e">#å‘¨</span>
</span></span><span style="display:flex;"><span>user <span style="color:#75715e">#ä»»åŠ¡ç”±å“ªä¸ªç”¨æˆ·è¿è¡Œï¼›é»˜è®¤root</span>
</span></span><span style="display:flex;"><span>job <span style="color:#75715e">#ä»»åŠ¡</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#å¤‡ä»½æ•°æ®åº“è„šæœ¬</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#cat /root/mysql_backup.sh</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash</span>
</span></span><span style="display:flex;"><span>mysqldump -A -F --single-transaction --master-data<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> -q -uroot |gzip &gt; /data/mysql_<span style="color:#e6db74">`</span>date +%F_%T<span style="color:#e6db74">`</span>.sql.gz
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>ansible 10.0.0.8 -m cron -a <span style="color:#e6db74">&#39;hour=2 minute=30 weekday=1-5 name=&#34;backup mysql&#34; job=/root/mysql_backup.sh&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ansible websrvs -m cron -a <span style="color:#e6db74">&#34;minute=*/5 job=&#39;/usr/sbin/ntpdate ntp.aliyun.com &amp;&gt;/dev/null&#39; name=Synctime&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ç¦ç”¨è®¡åˆ’ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m cron -a <span style="color:#e6db74">&#34;minute=*/5 job=&#39;/usr/sbin/ntpdate 172.20.0.1 &amp;&gt;/dev/null&#39; name=Synctime disabled=yes&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å¯ç”¨è®¡åˆ’ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m cron -a <span style="color:#e6db74">&#34;minute=*/5 job=&#39;/usr/sbin/ntpdate 172.20.0.1 &amp;&gt; /dev/null&#39; name=Synctime disabled=no&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ é™¤ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m cron -a <span style="color:#e6db74">&#34;name=&#39;backup mysql&#39; state=absent&#34;</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m cron -a <span style="color:#e6db74">&#39;state=absent name=Synctime&#39;</span>
</span></span></code></pre></div><h3 id="yum-å’Œ-apt-æ¨¡å—">Yum å’Œ Apt æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#yum-å’Œ-apt-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šç®¡ç†è½¯ä»¶åŒ…
yum ç®¡ç†è½¯ä»¶åŒ…ï¼Œåªæ”¯æŒRHELï¼ŒCentOSï¼Œfedoraï¼Œä¸æ”¯æŒUbuntuå…¶å®ƒç‰ˆæœ¬
apt æ¨¡å—ç®¡ç† Debian ç›¸å…³ç‰ˆæœ¬çš„è½¯ä»¶åŒ…
yumå¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name <span style="color:#75715e">#è½¯ä»¶åŒ…åç§°</span>
</span></span><span style="display:flex;"><span>state <span style="color:#75715e">#çŠ¶æ€</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>present <span style="color:#75715e">#å®‰è£…,æ­¤ä¸ºé»˜è®¤å€¼</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>absent <span style="color:#75715e">#åˆ é™¤</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>latest <span style="color:#75715e">#æœ€æ–°ç‰ˆ</span>
</span></span><span style="display:flex;"><span>list <span style="color:#75715e">#åˆ—å‡ºæŒ‡å®šåŒ…</span>
</span></span><span style="display:flex;"><span>enablerepo <span style="color:#75715e">#å¯ç”¨å“ªä¸ªä»“åº“å®‰è£…</span>
</span></span><span style="display:flex;"><span>disablerepo <span style="color:#75715e">#ä¸ä½¿ç”¨å“ªäº›ä»“åº“çš„åŒ…</span>
</span></span><span style="display:flex;"><span>exclude <span style="color:#75715e">#æ’é™¤æŒ‡å®šçš„åŒ…</span>
</span></span><span style="display:flex;"><span>validate <span style="color:#75715e">#æ˜¯å¦æ£€éªŒ,é»˜è®¤ä¸ºyes</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m yum -a &#39;name=httpd state=present&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å®‰è£…zabbix agent rpmåŒ…</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m yum -a &#39;name=https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/5.0/rhel/8/x86_64/zabbix-agent2-5.0.24-1.el8.x86_64.rpm state=present validate_certs=no&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å¯ç”¨epelæºè¿›è¡Œå®‰è£…</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m yum -a &#39;name=nginx state=present enablerepo=epel&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å‡çº§é™¤kernelå’Œfooå¼€å¤´ä»¥å¤–çš„æ‰€æœ‰åŒ…</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m yum -a &#39;name=* state=lastest exclude=kernel*,foo*&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ é™¤</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m yum -a &#39;name=httpd state=absent&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m yum -a &#39;name=sl,cowsay&#39;</span>
</span></span></code></pre></div><h3 id="yum_repository-æ¨¡å—">yum_repository æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#yum_repository-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½: æ­¤æ¨¡å—å®ç°yumçš„ä»“åº“é…ç½®ç®¡ç†
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name <span style="color:#75715e">#ä»“åº“id</span>
</span></span><span style="display:flex;"><span>description <span style="color:#75715e">#ä»“åº“æè¿°åç§°,å¯¹åº”é…ç½®æ–‡ä»¶ä¸­çš„name=</span>
</span></span><span style="display:flex;"><span>baseurl <span style="color:#75715e">#ä»“åº“çš„åœ°å€</span>
</span></span><span style="display:flex;"><span>gpgcheck <span style="color:#75715e">#éªŒè¯å¼€å¯</span>
</span></span><span style="display:flex;"><span>gpgkey <span style="color:#75715e">#ä»“åº“å…¬é’¥è·¯å¾„</span>
</span></span><span style="display:flex;"><span>state<span style="color:#f92672">=</span>absen  <span style="color:#75715e">#åˆ é™¤</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible websrvs -m yum_repository -a <span style="color:#e6db74">&#39;name=ansible_nginx description=&#34;nginx repo&#34; baseurl=&#34;http://nginx.org/packages/centos/$releasever/$basearch/&#34; gpgcheck=yes gpgkey=&#34;https://nginx.org/keys/nginx_signing.key&#34;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@rocky8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#cat /etc/yum.repos.d/ansible_nginx.repo</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>ansible_nginx<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>baseurl <span style="color:#f92672">=</span> http://nginx.org/packages/centos/$releasever/$basearch/
</span></span><span style="display:flex;"><span>gpgcheck <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>gpgkey <span style="color:#f92672">=</span> https://nginx.org/keys/nginx_signing.key
</span></span><span style="display:flex;"><span>name <span style="color:#f92672">=</span> nginx repo
</span></span></code></pre></div><h3 id="service-æ¨¡å—">Service æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#service-æ¨¡å—">#</a></h3>
<p>æ­¤æ¨¡å—å’ŒsytemdåŠŸèƒ½ç›¸ä¼¼,é€‰é¡¹å¾ˆå¤šç›¸åŒ
åŠŸèƒ½ï¼šç®¡ç†æœåŠ¡
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name <span style="color:#75715e">#æœåŠ¡åç§°</span>
</span></span><span style="display:flex;"><span>state <span style="color:#75715e">#æœåŠ¡çŠ¶æ€</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>started <span style="color:#75715e">#å¯åŠ¨</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>stopped <span style="color:#75715e">#åœæ­¢</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>restarted <span style="color:#75715e">#é‡å¯</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>reloaded <span style="color:#75715e">#é‡è½½</span>
</span></span><span style="display:flex;"><span>enabled <span style="color:#75715e">#å¼€å¯è‡ªå¯åŠ¨</span>
</span></span><span style="display:flex;"><span>daemon_reload <span style="color:#75715e">#åŠ è½½æ–°çš„é…ç½®æ–‡ä»¶,é€‚ç”¨äºsystemdæ¨¡å—</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible all -m service -a <span style="color:#e6db74">&#39;name=httpd state=started enabled=yes&#39;</span>
</span></span><span style="display:flex;"><span>ansible all -m service -a <span style="color:#e6db74">&#39;name=httpd state=stopped&#39;</span>
</span></span><span style="display:flex;"><span>ansible all -m service -a <span style="color:#e6db74">&#39;name=httpd state=reloaded&#39;</span>
</span></span><span style="display:flex;"><span>ansible all -m shell -a <span style="color:#e6db74">&#34;sed -i &#39;s/^Listen 80/Listen 8080/&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/etc/httpd/conf/httpd.conf&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m service -a <span style="color:#e6db74">&#39;name=httpd state=restarted&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#é‡å¯åŠ¨æŒ‡å®šç½‘å¡æœåŠ¡</span>
</span></span><span style="display:flex;"><span>ansible all -m service -a <span style="color:#e6db74">&#39;name=network state=absent args=eth0&#39;</span>
</span></span></code></pre></div><h3 id="user-æ¨¡å—">User æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#user-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šç®¡ç†ç”¨æˆ·
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name <span style="color:#75715e">#åˆ›å»ºçš„åç§°</span>
</span></span><span style="display:flex;"><span>uid <span style="color:#75715e">#æŒ‡å®šuid</span>
</span></span><span style="display:flex;"><span>group <span style="color:#75715e">#æŒ‡å®šåŸºæœ¬ç»„</span>
</span></span><span style="display:flex;"><span>shell <span style="color:#75715e">#ç™»å½•shellç±»å‹é»˜è®¤/bin/bash</span>
</span></span><span style="display:flex;"><span>create_home <span style="color:#75715e">#æ˜¯å¦åˆ›å»ºå®¶ç›®å½•</span>
</span></span><span style="display:flex;"><span>password <span style="color:#75715e">#è®¾å®šå¯¹åº”çš„å¯†ç ï¼Œå¿…é¡»æ˜¯åŠ å¯†åçš„å­—ç¬¦ä¸²æ‰è¡Œï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>system <span style="color:#75715e">#yesè¡¨ç¤ºç³»ç»Ÿç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>groups <span style="color:#75715e">#é™„åŠ ç»„</span>
</span></span><span style="display:flex;"><span>append <span style="color:#75715e">#è¿½åŠ é™„åŠ ç»„ä½¿ç”¨,yesè¡¨ç¤ºå¢åŠ æ–°çš„é™„åŠ ç»„</span>
</span></span><span style="display:flex;"><span>state <span style="color:#75715e">#absenåˆ é™¤</span>
</span></span><span style="display:flex;"><span>remove <span style="color:#75715e">#yesè¡¨ç¤ºåˆ é™¤ç”¨æˆ·æ—¶å°†å®¶ç›®å½•ä¸€èµ·åˆ é™¤</span>
</span></span><span style="display:flex;"><span>generate_ssh_key <span style="color:#75715e">#åˆ›å»ºç§é’¥</span>
</span></span><span style="display:flex;"><span>ssh_keyu_bits <span style="color:#75715e">#ç§é’¥ä½æ•°</span>
</span></span><span style="display:flex;"><span>ssh_key_file <span style="color:#75715e">#ç§é’¥æ–‡ä»¶è·¯å¾„</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>ansible all -m user -a <span style="color:#e6db74">&#39;name=user1 comment=&#34;test user&#34; uid=2048 home=/app/user1group=root&#39;</span>
</span></span><span style="display:flex;"><span>ansible all -m user -a <span style="color:#e6db74">&#39;name=nginx comment=nginx uid=88 group=nginxgroups=&#34;root,daemon&#34; shell=/sbin/nologin system=yes create_home=nohome=/data/nginx non_unique=yes&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#remove=yesè¡¨ç¤ºåˆ é™¤ç”¨æˆ·åŠå®¶ç›®å½•ç­‰æ•°æ®,é»˜è®¤remove=no</span>
</span></span><span style="display:flex;"><span>ansible all -m user -a <span style="color:#e6db74">&#39;name=nginx state=absent remove=yes&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ç”Ÿæˆ123456åŠ å¯†çš„å¯†ç </span>
</span></span><span style="display:flex;"><span>ansible localhost -m debug -a <span style="color:#e6db74">&#34;msg={{ &#39;123456&#39;| password_hash(&#39;sha512&#39;,&#39;salt&#39;)}}&#34;</span> localhost | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span> <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;</span>$6$salt$MktMKPZJ6t59GfxcJU20DwcwQzfMvOlHFVZiOVD71w<span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ç”¨ä¸Šé¢åˆ›å»ºçš„å¯†ç åˆ›å»ºç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m user -a <span style="color:#e6db74">&#39;name=www group=www system=yes shell=/sbin/nlogin password=&#34;$6$salt$MktMKPZJ6t59GfxcJU20DwcwQzfMvOlHFVZiOVD71w.&#34;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºç”¨æˆ·test,å¹¶ç”Ÿæˆ4096bitçš„ç§é’¥</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m user -a <span style="color:#e6db74">&#39;name=test generate_ssh_key=yes ssh_key_bits=4096 ssh_key_file=.ssh/id_rsa&#39;</span>
</span></span></code></pre></div><h3 id="group-æ¨¡å—">Group æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#group-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼šç®¡ç†ç»„
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name <span style="color:#75715e">#æŒ‡å®šç»„åç§°</span>
</span></span><span style="display:flex;"><span>gid <span style="color:#75715e">#æŒ‡å®šgid</span>
</span></span><span style="display:flex;"><span>state
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>present <span style="color:#75715e">#åˆ›å»º,é»˜è®¤</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>absent <span style="color:#75715e">#åˆ é™¤</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#åˆ›å»ºç»„</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m group -a <span style="color:#e6db74">&#39;name=nginx gid=88 system=yes&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ é™¤ç»„</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m group -a <span style="color:#e6db74">&#39;name=nginx state=absent&#39;</span>
</span></span></code></pre></div><h3 id="lineinfile-æ¨¡å—">Lineinfile æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#lineinfile-æ¨¡å—">#</a></h3>
<p>ansibleåœ¨ä½¿ç”¨sedè¿›è¡Œæ›¿æ¢æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°éœ€è¦è½¬ä¹‰çš„é—®é¢˜ï¼Œè€Œä¸”ansibleåœ¨é‡åˆ°ç‰¹æ®Šç¬¦å·è¿›è¡Œæ›¿æ¢æ—¶ï¼Œ
ä¼šå­˜åœ¨é—®é¢˜ï¼Œæ— æ³•æ­£å¸¸è¿›è¡Œæ›¿æ¢ ã€‚</p>
<p>ansibleè‡ªèº«æä¾›äº†ä¸¤ä¸ªæ¨¡å—ï¼šlineinfileæ¨¡å—å’Œreplaceæ¨¡å—ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œæ›¿æ¢ä¸€èˆ¬åœ¨ansibleå½“ä¸­å»ä¿®æ”¹æŸä¸ªæ–‡ä»¶çš„å•è¡Œè¿›è¡Œæ›¿æ¢çš„æ—¶å€™éœ€è¦ä½¿ç”¨lineinfileæ¨¡å—
åŠŸèƒ½ï¼šç›¸å½“äºsedï¼Œä¸»è¦ç”¨äºä¿®æ”¹ä¸€è¡Œçš„æ–‡ä»¶å†…å®¹
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>path <span style="color:#75715e">#è¢«æ§ç«¯æ–‡ä»¶çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>regexp <span style="color:#75715e">#æ­£åˆ™åŒ¹é…è¯­æ³•æ ¼å¼,è¡¨ç¤ºè¢«æ›¿æ¢çš„å†…å®¹</span>
</span></span><span style="display:flex;"><span>line <span style="color:#75715e">#æ›¿æ¢ä¸ºçš„å†…å®¹</span>
</span></span><span style="display:flex;"><span>state <span style="color:#75715e">#absentè¡¨ç¤ºåˆ é™¤</span>
</span></span><span style="display:flex;"><span>insertafter <span style="color:#75715e">#æ’å…¥åˆ°æ›¿æ¢å†…å®¹å‰é¢,å¦‚å’ŒregexpåŒæ—¶å­˜åœ¨,åªåœ¨æ²¡æ‰¾åˆ°ä¸regexpåŒ¹é…æ—¶æ‰ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>insertafter
</span></span><span style="display:flex;"><span>insertbefore <span style="color:#75715e">#æ’å…¥åˆ°æ›¿æ¢å†…å®¹åé¢,å¦‚å’ŒregexpåŒæ—¶å­˜åœ¨,åªåœ¨æ²¡æ‰¾åˆ°ä¸regexpåŒ¹é…æ—¶æ‰ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>insertafter
</span></span><span style="display:flex;"><span>backrefs <span style="color:#75715e">#æ”¯æŒåé¢å¼•ç”¨,yeså’Œno</span>
</span></span><span style="display:flex;"><span>backup <span style="color:#75715e">#ä¿®æ”¹å‰å…ˆå¤‡ä»½</span>
</span></span><span style="display:flex;"><span>create <span style="color:#75715e">#å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨,åˆ™åˆ›å»º,é»˜è®¤ä¸å­˜åœ¨ä¼šå‡ºé”™</span>
</span></span><span style="display:flex;"><span>mode <span style="color:#75715e">#æŒ‡å®šæƒé™</span>
</span></span><span style="display:flex;"><span>owner <span style="color:#75715e">#æŒ‡å®šç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>group <span style="color:#75715e">#æŒ‡å®šç»„</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ³¨æ„</span>
</span></span><span style="display:flex;"><span>regexpå‚æ•° ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¯¹åº”çš„è¡Œï¼Œå½“æ›¿æ¢æ–‡æœ¬æ—¶ï¼Œå¦‚æœæœ‰å¤šè¡Œæ–‡æœ¬éƒ½èƒ½è¢«åŒ¹é…ï¼Œåˆ™åªæœ‰æœ€åé¢è¢«
</span></span><span style="display:flex;"><span>åŒ¹é…åˆ°çš„é‚£è¡Œæ–‡æœ¬æ‰ä¼šè¢«æ›¿æ¢ï¼Œå½“åˆ é™¤æ–‡æœ¬æ—¶ï¼Œå¦‚æœæœ‰å¤šè¡Œæ–‡æœ¬éƒ½èƒ½è¢«åŒ¹é…ï¼Œè¿™ä¹ˆè¿™äº›è¡Œéƒ½ä¼šè¢«åˆ é™¤ã€‚
</span></span></code></pre></div><p>æ³¨æ„: å¦‚æœæƒ³è¿›è¡Œå¤šè¡ŒåŒ¹é…è¿›è¡Œæ›¿æ¢éœ€è¦ä½¿ç”¨replaceæ¨¡å—
èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#ä¿®æ”¹ç›‘å¬ç«¯å£</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m lineinfile -a <span style="color:#e6db74">&#34;path=/etc/httpd/conf/httpd.conf regexp=&#39;^Listen&#39; line=&#39;Listen 8080&#39;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä¿®æ”¹SELinux</span>
</span></span><span style="display:flex;"><span>ansible all -m lineinfile -a <span style="color:#e6db74">&#34;path=/etc/selinux/config regexp=&#39;^SELINUX=&#39;line=&#39;SELINUX=disabled&#39;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ·»åŠ ç½‘å…³</span>
</span></span><span style="display:flex;"><span>ansible webservers -m lineinfile -a <span style="color:#e6db74">&#39;path=/etc/sysconfig/network-scripts/ifcfg-eth0 line=&#34;GATEWAY=10.0.0.254&#34;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ç»™ä¸»æœºå¢åŠ ä¸€ä¸ªç½‘å…³ï¼Œä½†éœ€è¦å¢åŠ åˆ°NAME=ä¸‹é¢</span>
</span></span><span style="display:flex;"><span>ansible webservers -m lineinfile -a <span style="color:#e6db74">&#39;path=/etc/sysconfig/network-scripts/ifcfg-eth0 insertafter=&#34;^NAME=&#34; line=&#34;GATEWAY=10.0.0.254&#34;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ•ˆæœå¦‚ä¸‹</span>
</span></span><span style="display:flex;"><span>cat /etc/sysconfig/network-scripts/ifcfg-eth0
</span></span><span style="display:flex;"><span>DEVICE<span style="color:#f92672">=</span>eth0
</span></span><span style="display:flex;"><span>NAME<span style="color:#f92672">=</span>eth0
</span></span><span style="display:flex;"><span>GATEWAY<span style="color:#f92672">=</span>10.0.0.254
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ç»™ä¸»æœºå¢åŠ ä¸€ä¸ªç½‘å…³ï¼Œä½†éœ€è¦å¢åŠ åˆ°NAME=ä¸Šé¢</span>
</span></span><span style="display:flex;"><span>ansible webservers -m lineinfile -a <span style="color:#e6db74">&#39;path=/etc/sysconfig/network-scripts/ifcfg-
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">eth0 insertbefore=&#34;^NAME=&#34; line=&#34;GATEWAY=10.0.0.254&#34;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ•ˆæœå¦‚ä¸‹</span>
</span></span><span style="display:flex;"><span>cat /etc/sysconfig/network-scripts/ifcfg-eth0
</span></span><span style="display:flex;"><span>DEVICE<span style="color:#f92672">=</span>eth0
</span></span><span style="display:flex;"><span>GATEWAY<span style="color:#f92672">=</span>10.0.0.254
</span></span><span style="display:flex;"><span>NAME<span style="color:#f92672">=</span>eth0
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ é™¤ç½‘å…³</span>
</span></span><span style="display:flex;"><span>ansible webservers -m lineinfile -a <span style="color:#e6db74">&#39;path=/etc/sysconfig/network-scripts/ifcfg-eth0 regexp=&#34;^GATEWAY&#34; state=absent&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#åˆ é™¤#å¼€å¤´çš„è¡Œ</span>
</span></span><span style="display:flex;"><span>ansible all -m lineinfile -a <span style="color:#e6db74">&#39;dest=/etc/fstab state=absent regexp=&#34;^#&#34;&#39;</span>
</span></span></code></pre></div><h3 id="replace-æ¨¡å—">Replace æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#replace-æ¨¡å—">#</a></h3>
<p>è¯¥æ¨¡å—æœ‰ç‚¹ç±»ä¼¼äºsedå‘½ä»¤ï¼Œä¸»è¦ä¹Ÿæ˜¯åŸºäºæ­£åˆ™è¿›è¡ŒåŒ¹é…å’Œæ›¿æ¢ï¼Œå»ºè®®ä½¿ç”¨
åŠŸèƒ½: å¤šè¡Œä¿®æ”¹æ›¿æ¢
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>path <span style="color:#75715e">#è¢«æ§ç«¯æ–‡ä»¶çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span>regexp <span style="color:#75715e">#æ­£åˆ™åŒ¹é…è¯­æ³•æ ¼å¼,è¡¨ç¤ºè¢«æ›¿æ¢çš„å†…å®¹</span>
</span></span><span style="display:flex;"><span>replace <span style="color:#75715e">#æ›¿æ¢ä¸ºçš„å†…å®¹</span>
</span></span><span style="display:flex;"><span>after <span style="color:#75715e">#æ’å…¥åˆ°æ›¿æ¢å†…å®¹å‰é¢,</span>
</span></span><span style="display:flex;"><span>before <span style="color:#75715e">#æ’å…¥åˆ°æ›¿æ¢å†…å®¹åé¢</span>
</span></span><span style="display:flex;"><span>backup <span style="color:#75715e">#ä¿®æ”¹å‰å…ˆå¤‡ä»½</span>
</span></span><span style="display:flex;"><span>mode <span style="color:#75715e">#æŒ‡å®šæƒé™</span>
</span></span><span style="display:flex;"><span>owner <span style="color:#75715e">#æŒ‡å®šç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>group <span style="color:#75715e">#æŒ‡å®šç»„</span>
</span></span></code></pre></div><p>èŒƒä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible all -m replace -a <span style="color:#e6db74">&#34;path=/etc/fstab regexp=&#39;^(UUID.*)&#39; replace=&#39;#\1&#39;&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m replace -a <span style="color:#e6db74">&#34;path=/etc/fstab regexp=&#39;^#(UUID.*)&#39; replace=&#39;\1&#39;&#34;</span>
</span></span></code></pre></div><h3 id="selinux-æ¨¡å—">SELinux æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#selinux-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½: è¯¥æ¨¡å—ç®¡ç† SELInux ç­–ç•¥
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>policy <span style="color:#75715e">#æŒ‡å®šSELINUXTYPE=targeted</span>
</span></span><span style="display:flex;"><span>state <span style="color:#75715e">#æŒ‡å®šSELINUX=disabled</span>
</span></span></code></pre></div><p>èŒƒä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@rocky ansible-apps<span style="color:#f92672">]</span><span style="color:#75715e"># ansible 192.168.32.132 -m selinux -a &#39;state=disabled&#39;</span>
</span></span><span style="display:flex;"><span>192.168.32.132 | FAILED! <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;The module selinux was redirected to ansible.posix.selinux, which could not be loaded.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ansibleç‰ˆæœ¬2.13.3å‡ºç°å¦‚ä¸‹é”™è¯¯</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;The module selinux was redirected to ansible.posix.selinux, which could not be loaded.&#34;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># è§£å†³æ–¹æ³•</span>
</span></span><span style="display:flex;"><span> <span style="color:#f92672">[</span>root@rocky ansible-apps<span style="color:#f92672">]</span><span style="color:#75715e"># ansible-galaxy collection install ansible.posix</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å†æ¬¡æ‰§è¡Œï¼Œæ˜¾ç¤ºæˆåŠŸ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@rocky ansible-apps<span style="color:#f92672">]</span><span style="color:#75715e"># ansible 192.168.32.132 -m selinux -a &#39;state=disabled&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>WARNING<span style="color:#f92672">]</span>: SELinux state temporarily changed from <span style="color:#e6db74">&#39;enforcing&#39;</span> to <span style="color:#e6db74">&#39;permissive&#39;</span>. State change will take effect next reboot.
</span></span><span style="display:flex;"><span>192.168.32.132 | CHANGED <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;ansible_facts&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;discovered_interpreter_python&#34;</span>: <span style="color:#e6db74">&#34;/usr/libexec/platform-python&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;changed&#34;</span>: true,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;configfile&#34;</span>: <span style="color:#e6db74">&#34;/etc/selinux/config&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;Config SELinux state changed from &#39;enforcing&#39; to &#39;disabled&#39;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;policy&#34;</span>: <span style="color:#e6db74">&#34;targeted&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;reboot_required&#34;</span>: true,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;state&#34;</span>: <span style="color:#e6db74">&#34;disabled&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="reboot-æ¨¡å—">reboot æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#reboot-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½: é‡å¯
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msg <span style="color:#75715e">#é‡å¯æç¤º</span>
</span></span><span style="display:flex;"><span>pre_reboot_delay <span style="color:#75715e">#é‡å¯å‰å»¶è¿Ÿæ—¶é—´çš„ç§’æ•°</span>
</span></span><span style="display:flex;"><span>post_reboot_delay <span style="color:#75715e">#é‡å¯åå»¶è¿Ÿæ—¶é—´çš„ç§’æ•°å,å†éªŒè¯ç³»ç»Ÿæ­£å¸¸å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>reboot_timeout <span style="color:#75715e">#é‡å¯åå»¶è¿Ÿæ—¶é—´å†æ‰§è¡Œæµ‹è¯•æˆåŠŸä¸å¦çš„å‘½ä»¤</span>
</span></span><span style="display:flex;"><span>test_command <span style="color:#75715e">#æ‰§è¡Œæµ‹è¯•æˆåŠŸä¸å¦çš„å‘½ä»¤</span>
</span></span></code></pre></div><p>èŒƒä¾‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible websrvs -m reboot -a &#39;msg=&#34;host will be reboot&#34;&#39;</span>
</span></span></code></pre></div><h3 id="mount-æ¨¡å—">mount æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#mount-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½: æŒ‚è½½å’Œå¸è½½æ–‡ä»¶ç³»ç»Ÿ
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>src <span style="color:#75715e">#æºè®¾å¤‡è·¯å¾„ï¼Œæˆ–ç½‘ç»œåœ°å€</span>
</span></span><span style="display:flex;"><span>path <span style="color:#75715e">#æŒ‚è½½è‡³æœ¬åœ°å“ªä¸ªè·¯å¾„ä¸‹</span>
</span></span><span style="display:flex;"><span>fstype <span style="color:#75715e">#è®¾å¤‡ç±»å‹ï¼› nfs</span>
</span></span><span style="display:flex;"><span>opts <span style="color:#75715e">#æŒ‚è½½çš„é€‰é¡¹</span>
</span></span><span style="display:flex;"><span>state <span style="color:#75715e">#æŒ‚è½½è¿˜æ˜¯å¸è½½</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>present <span style="color:#75715e">#æ°¸ä¹…æŒ‚è½½ï¼Œä½†æ²¡æœ‰ç«‹å³ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>absent <span style="color:#75715e">#å¸è½½ä¸´æ—¶æŒ‚è½½,å¹¶åˆ é™¤æ°¸ä¹…æŒ‚è½½</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>mounted <span style="color:#75715e">#ä¸´æ—¶æŒ‚è½½</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>unmounted <span style="color:#75715e">#ä¸´æ—¶å¸è½½</span>
</span></span></code></pre></div><p>èŒƒä¾‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#ä¿®æ”¹fstabæ–‡ä»¶æ°¸ä¹…æŒ‚è½½,ä½†ä¸ç«‹å³ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>mount websrvs -m mount -a <span style="color:#e6db74">&#39;src=&#34;UUID=b3e48f45-f933-4c8e-a700-22a159ec9077&#34; path=/home fstype=xfs opts=noatime state=present&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ä¸´æ—¶å–æ¶ˆæŒ‚è½½</span>
</span></span><span style="display:flex;"><span>mount websrvs -m mount -a <span style="color:#e6db74">&#39;path=/home fstype=xfs opts=noatime state=unmounted&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ°¸ä¹…æŒ‚è½½,å¹¶ç«‹å³ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m mount -a <span style="color:#e6db74">&#39;src=10.0.0.8:/data/wordpress path=/var/www/html/wp- content/uploads opts=&#34;_netdev&#34; state=mounted&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ°¸ä¹…å¸è½½,å¹¶ç«‹å³ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span>ansible websrvs -m mount -a <span style="color:#e6db74">&#39;src=10.0.0.8:/data/wordpress path=/var/www/html/wp- content/uploads state=absent&#39;</span>
</span></span></code></pre></div><h3 id="setup-æ¨¡å—">Setup æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#setup-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½ï¼š setup æ¨¡å—æ¥æ”¶é›†ä¸»æœºçš„ç³»ç»Ÿä¿¡æ¯ï¼Œè¿™äº› facts ä¿¡æ¯å¯ä»¥ç›´æ¥ä»¥å˜é‡çš„å½¢å¼ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœä¸»æœº
è¾ƒå¤šï¼Œä¼šå½±å“æ‰§è¡Œé€Ÿåº¦
å¯ä»¥ä½¿ç”¨ gather_facts: no æ¥ç¦æ­¢ Ansible æ”¶é›† facts ä¿¡æ¯
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>filter <span style="color:#75715e">#æŒ‡å®šè¿‡æ»¤æ¡ä»¶</span>
</span></span></code></pre></div><p>èŒƒä¾‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible all -m setup
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_nodename&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_hostname&#34;</span>  <span style="color:#75715e">#  ä¸»æœºåç§°</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_domain&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_memtotal_mb&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_memory_mb&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_memfree_mb&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_os_family&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_distribution&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_distribution_major_version&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_distribution_version&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_processor_vcpus&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_all_ipv4_addresses&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_architecture&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_uptime_seconds&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#34;filter=ansible_processor*&#34;</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#39;filter=ansible_env&#39;</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible all -m setup -a &#39;filter=ansible_python_version&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.7 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_facts&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_python_version&#34;</span>: <span style="color:#e6db74">&#34;2.7.5&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;discovered_interpreter_python&#34;</span>: <span style="color:#e6db74">&#34;/usr/bin/python&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;changed&#34;</span>: false
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>10.0.0.6 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_facts&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_python_version&#34;</span>: <span style="color:#e6db74">&#34;2.6.6&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;discovered_interpreter_python&#34;</span>: <span style="color:#e6db74">&#34;/usr/bin/python&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;changed&#34;</span>: false
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>10.0.0.8 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_facts&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_python_version&#34;</span>: <span style="color:#e6db74">&#34;3.6.8&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;discovered_interpreter_python&#34;</span>: <span style="color:#e6db74">&#34;/usr/libexec/platform-python&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;changed&#34;</span>: false
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šå–IPåœ°å€</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#å–æ‰€æœ‰IP</span>
</span></span><span style="display:flex;"><span>ansible 10.0.0.101 -m setup -a <span style="color:#e6db74">&#39;filter=ansible_all_ipv4_addresses&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.101 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_facts&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_all_ipv4_addresses&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;192.168.0.1&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;192.168.0.2&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;192.168.64.238&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;192.168.13.36&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;10.0.0.101&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;172.16.1.0&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;172.17.0.1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;changed&#34;</span>: false
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å–é»˜è®¤IP</span>
</span></span><span style="display:flex;"><span>ansible all -m setup -a <span style="color:#e6db74">&#39;filter=&#34;ansible_default_ipv4&#34;&#39;</span>
</span></span><span style="display:flex;"><span>10.0.0.101 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_facts&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;ansible_default_ipv4&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;address&#34;</span>: <span style="color:#e6db74">&#34;10.0.0.101&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;alias&#34;</span>: <span style="color:#e6db74">&#34;eth0&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;broadcast&#34;</span>: <span style="color:#e6db74">&#34;10.0.0.255&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;gateway&#34;</span>: <span style="color:#e6db74">&#34;10.0.0.2&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;interface&#34;</span>: <span style="color:#e6db74">&#34;eth0&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;macaddress&#34;</span>: <span style="color:#e6db74">&#34;00:0c:29:e8:c7:9b&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;mtu&#34;</span>: 1500,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;netmask&#34;</span>: <span style="color:#e6db74">&#34;255.255.255.0&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;network&#34;</span>: <span style="color:#e6db74">&#34;10.0.0.0&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;ether&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;changed&#34;</span>: false
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="debug-æ¨¡å—">debug æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#debug-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½: æ­¤æ¨¡å—å¯ä»¥ç”¨äºè¾“å‡ºä¿¡æ¯,å¹¶ä¸”é€šè¿‡ msg å®šåˆ¶è¾“å‡ºçš„ä¿¡æ¯å†…å®¹,åŠŸèƒ½ç±»ä¼¼äºechoå‘½ä»¤
æ³¨æ„: msgåé¢çš„å˜é‡æœ‰æ—¶éœ€è¦åŠ  &quot; &quot; å¼•èµ·æ¥
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msg <span style="color:#75715e">#æŒ‡å®šå‘½ä»¤è¾“å‡ºçš„ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>var <span style="color:#75715e">#æŒ‡å®šå˜é‡å,å’Œmsgäº’æ–¥</span>
</span></span><span style="display:flex;"><span>verbosity <span style="color:#75715e">#è¯¦ç»†åº¦</span>
</span></span></code></pre></div><p>èŒƒä¾‹: debug æ¨¡å—é»˜è®¤è¾“å‡ºHello world</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible 10.0.0.18 -m debug</span>
</span></span><span style="display:flex;"><span>10.0.0.18 | SUCCESS <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;Hello world!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#cat debug.yml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: websrvs
</span></span><span style="display:flex;"><span>tasks:
</span></span><span style="display:flex;"><span>- name: output Hello world
</span></span><span style="display:flex;"><span>debug:
</span></span><span style="display:flex;"><span><span style="color:#75715e">#é»˜è®¤æ²¡æœ‰æŒ‡å®šmsg,é»˜è®¤è¾“å‡º&#34;Hello world!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ansible ansible<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook debug.yml</span>
</span></span><span style="display:flex;"><span>.....
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>output variables<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>******************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.7<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;Hello world!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.8<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;Hello world!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>PLAY RECAP
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>*******************************************
</span></span><span style="display:flex;"><span>10.0.0.7 : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> changed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>10.0.0.8 : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> changed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>èŒƒä¾‹: åˆ©ç”¨debug æ¨¡å—è¾“å‡ºå˜é‡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#cat debug.yaml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- hosts: websrvs
</span></span><span style="display:flex;"><span>tasks:
</span></span><span style="display:flex;"><span>- name: output variables
</span></span><span style="display:flex;"><span>debug:
</span></span><span style="display:flex;"><span>msg: Host <span style="color:#e6db74">&#34;{{ ansible_nodename }}&#34;</span> Ip <span style="color:#e6db74">&#34;{{ ansible_default_ipv4.address
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#ansible-playbook debug.yaml</span>
</span></span><span style="display:flex;"><span>PLAY <span style="color:#f92672">[</span>websrvs<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>***************************************
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>Gathering Facts<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>*******************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.7<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.8<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>output variables<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>******************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.7<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;Host \&#34;centos7.wangxiaochun.com\&#34; Ip \&#34;10.0.0.7\&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>10.0.0.8<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;Host \&#34;centos8.wangxiaochun.com\&#34; Ip \&#34;10.0.0.8\&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>PLAY RECAP
</span></span><span style="display:flex;"><span>********************************************************************************
</span></span><span style="display:flex;"><span>*******************************************
</span></span><span style="display:flex;"><span>10.0.0.7 : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> changed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>10.0.0.8 : ok<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span> changed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> unreachable<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> failed<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>skipped<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> rescued<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> ignored<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>èŒƒä¾‹: æ˜¾ç¤ºå­—ç¬¦ä¸²ç‰¹å®šå­—ç¬¦</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># cat debug.yml</span>
</span></span><span style="display:flex;"><span>- hosts: all
</span></span><span style="display:flex;"><span>  gather_facts: no
</span></span><span style="display:flex;"><span>  vars:
</span></span><span style="display:flex;"><span>    a: <span style="color:#e6db74">&#34;12345&#34;</span>
</span></span><span style="display:flex;"><span>  tasks:
</span></span><span style="display:flex;"><span>  - debug:
</span></span><span style="display:flex;"><span>    msg:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;{{a[0]}}&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;{{a[1]}}&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;{{a[2]}}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡aï¼Œå¦‚æœæƒ³è¦è·å–aå­—ç¬¦ä¸²çš„ç¬¬3ä¸ªå­—ç¬¦ï¼Œåˆ™å¯ä»¥ä½¿ç”¨â€a[2]â€è·å–ï¼Œç´¢å¼•ä»0å¼€å§‹ï¼Œæ‰§è¡Œä¸Šä¾‹playbookï¼Œdebugçš„è¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š</span>
</span></span><span style="display:flex;"><span>TASK <span style="color:#f92672">[</span>debug<span style="color:#f92672">]</span> *************************
</span></span><span style="display:flex;"><span>ok: <span style="color:#f92672">[</span>test1<span style="color:#f92672">]</span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;2&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;msg&#34;</span>: <span style="color:#e6db74">&#34;3&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="sysctl-æ¨¡å—">sysctl æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#sysctl-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½: ä¿®æ”¹å†…æ ¸å‚æ•°
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>name <span style="color:#75715e">#å†…æ ¸å‚æ•°</span>
</span></span><span style="display:flex;"><span>value <span style="color:#75715e">#æŒ‡å®šå€¼</span>
</span></span><span style="display:flex;"><span>state <span style="color:#75715e">#æ˜¯å¦ä¿å­˜åœ¨sysctl.confæ–‡ä»¶ä¸­,é»˜è®¤present</span>
</span></span><span style="display:flex;"><span>sysctl_set <span style="color:#75715e">#ä½¿ç”¨sysctl -w éªŒè¯å€¼ç”Ÿæ•ˆ</span>
</span></span></code></pre></div><p>èŒƒä¾‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible websrvs -m sysctl -a <span style="color:#e6db74">&#39;name=net.ipv4.ip_forward value=1 state=present&#39;</span>
</span></span></code></pre></div><p>èŒƒä¾‹: å†…æ ¸å‚æ•°ä¼˜åŒ–</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- name: Change Port Range
</span></span><span style="display:flex;"><span>  sysctl:
</span></span><span style="display:flex;"><span>    name: net.ipv4.ip_local_port_range
</span></span><span style="display:flex;"><span>  value: <span style="color:#e6db74">&#39;1024 65000&#39;</span>
</span></span><span style="display:flex;"><span>  sysctl_set: yes
</span></span><span style="display:flex;"><span>- name: Enabled Forward
</span></span><span style="display:flex;"><span>  sysctl:
</span></span><span style="display:flex;"><span>  name: net.ipv4.ip_forward
</span></span><span style="display:flex;"><span>  value: <span style="color:#e6db74">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>  sysctl_set: yes
</span></span><span style="display:flex;"><span>- name: Enabled tcp_reuse
</span></span><span style="display:flex;"><span>  sysctl:
</span></span><span style="display:flex;"><span>    name: net.ipv4.tcp_tw_reuse
</span></span><span style="display:flex;"><span>    value: <span style="color:#e6db74">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>    sysctl_set: yes
</span></span><span style="display:flex;"><span>- name: Chanage tcp tw_buckets
</span></span><span style="display:flex;"><span>  sysctl:
</span></span><span style="display:flex;"><span>    name: net.ipv4.tcp_max_tw_buckets
</span></span><span style="display:flex;"><span>    value: <span style="color:#e6db74">&#39;5000&#39;</span>
</span></span><span style="display:flex;"><span>    sysctl_set: yes
</span></span><span style="display:flex;"><span>- name: Chanage tcp_syncookies
</span></span><span style="display:flex;"><span>  sysctl:
</span></span><span style="display:flex;"><span>    name: net.ipv4.tcp_syncookies
</span></span><span style="display:flex;"><span>    value: <span style="color:#e6db74">&#39;1&#39;</span>
</span></span><span style="display:flex;"><span>    sysctl_set: yes
</span></span><span style="display:flex;"><span>- name: Chanage tcp max_syn_backlog
</span></span><span style="display:flex;"><span>  sysctl:
</span></span><span style="display:flex;"><span>    name: net.ipv4.tcp_max_syn_backlog
</span></span><span style="display:flex;"><span>    value: <span style="color:#e6db74">&#39;8192&#39;</span>
</span></span><span style="display:flex;"><span>    sysctl_set: yes
</span></span><span style="display:flex;"><span>- name: Chanage tcp Established Maxconn
</span></span><span style="display:flex;"><span>  sysctl:
</span></span><span style="display:flex;"><span>    name: net.core.somaxconn
</span></span><span style="display:flex;"><span>    value: <span style="color:#e6db74">&#39;32768&#39;</span>
</span></span><span style="display:flex;"><span>    sysctl_set: yes
</span></span><span style="display:flex;"><span>    state: present
</span></span><span style="display:flex;"><span>- name: Chanage tcp_syn_retries
</span></span><span style="display:flex;"><span>  sysctl:
</span></span><span style="display:flex;"><span>    name: net.ipv4.tcp_syn_retries
</span></span><span style="display:flex;"><span>    value: <span style="color:#e6db74">&#39;2&#39;</span>
</span></span><span style="display:flex;"><span>    sysctl_set: yes
</span></span><span style="display:flex;"><span>    state: present
</span></span><span style="display:flex;"><span>- name: Chanage net.ipv4.tcp_synack_retries
</span></span><span style="display:flex;"><span>  sysctl:
</span></span><span style="display:flex;"><span>    name: net.ipv4.tcp_synack_retries
</span></span><span style="display:flex;"><span>    value: <span style="color:#e6db74">&#39;2&#39;</span>
</span></span><span style="display:flex;"><span>    sysctl_set: yes
</span></span><span style="display:flex;"><span>    state: presen
</span></span></code></pre></div><h3 id="pam_limits">pam_limits<a hidden class="anchor" aria-hidden="true" href="#pam_limits">#</a></h3>
<p>åŠŸèƒ½: ç®¡ç†èµ„æºé™åˆ¶
èŒƒä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>- name: Change Limit /etc/security/limit.conf
</span></span><span style="display:flex;"><span>  pam_limits:
</span></span><span style="display:flex;"><span>  domain: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>    limit_type: <span style="color:#e6db74">&#34;{{ item.limit_type }}&#34;</span>
</span></span><span style="display:flex;"><span>    limit_item: <span style="color:#e6db74">&#34;{{ item.limit_item }}&#34;</span>
</span></span><span style="display:flex;"><span>    value: <span style="color:#e6db74">&#34;{{ item.value }}&#34;</span>
</span></span><span style="display:flex;"><span>  loop:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">{</span> limit_type: <span style="color:#e6db74">&#39;soft&#39;</span>, limit_item: <span style="color:#e6db74">&#39;nofile&#39;</span>,value: <span style="color:#e6db74">&#39;100000&#39;</span> <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">{</span> limit_type: <span style="color:#e6db74">&#39;hard&#39;</span>, limit_item: <span style="color:#e6db74">&#39;nofile&#39;</span>,value: <span style="color:#e6db74">&#39;10000&#39;</span> <span style="color:#f92672">}</span>
</span></span></code></pre></div><h3 id="apt_repository-æ¨¡å—">apt_repository æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#apt_repository-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½: æ­¤æ¨¡å—å®ç°aptçš„ä»“åº“é…ç½®ç®¡ç†
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>repo <span style="color:#75715e">#ä»“åº“ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>state <span style="color:#75715e">#æ·»åŠ æˆ–åˆ é™¤</span>
</span></span><span style="display:flex;"><span>update_cache <span style="color:#75715e">#æ˜¯å¦apt update,é»˜è®¤yes</span>
</span></span><span style="display:flex;"><span>filename <span style="color:#75715e">#ä»“åº“æ–‡ä»¶,é»˜è®¤æ”¾åœ¨/etc/apt/sources.list.d/file.list</span>
</span></span></code></pre></div><p>èŒƒä¾‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ansible ubuntu-servers -m apt_repository -a <span style="color:#e6db74">&#39;repo=&#34;deb
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http://archive.canonical.com/ubuntu focal partner&#34; filename=google-chrome&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ubuntu2004 ~<span style="color:#f92672">]</span><span style="color:#75715e">#cat /etc/apt/sources.list.d/google-chrome.list</span>
</span></span><span style="display:flex;"><span>deb http://archive.canonical.com/ubuntu focal partner
</span></span></code></pre></div><h3 id="apt_key-æ¨¡å—">apt_key æ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#apt_key-æ¨¡å—">#</a></h3>
<p>åŠŸèƒ½: æ·»åŠ å’Œåˆ é™¤apt key
å¸¸è§é€‰é¡¹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>url <span style="color:#75715e">#keyè·¯å¾„</span>
</span></span><span style="display:flex;"><span>state <span style="color:#75715e">#æ·»åŠ æˆ–åˆ é™¤</span>
</span></span></code></pre></div><p>èŒƒä¾‹: ç”Ÿæˆcephä»“åº“é…ç½®</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#å…ˆå¯¼å…¥key,æ³¨æ„å…ˆåé¡ºåº</span>
</span></span><span style="display:flex;"><span>ansible ubuntu-servers -m apt_key -a
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;url=https://download.ceph.com/keys/release.asc state=present&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#å†ç”Ÿæˆapté…ç½®,å¦‚æœä¸å¯¼å…¥keyæ­¤æ­¥ä¼šå‡ºé”™</span>
</span></span><span style="display:flex;"><span>ansible ubuntu-servers -m apt_repository -a <span style="color:#e6db74">&#39;repo=&#34;deb
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">http://mirror.tuna.tsinghua.edu.cn/ceph/debian-pacific focal main&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">filename=ansible_ceph&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#éªŒè¯ç»“æœ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@ubuntu2004 ~<span style="color:#f92672">]</span><span style="color:#75715e">#cat /etc/apt/sources.list.d/ansible_ceph.list</span>
</span></span><span style="display:flex;"><span>deb http://mirror.tuna.tsinghua.edu.cn/ceph/debian-pacific focal main
</span></span></code></pre></div><h3 id="å…¶å®ƒæ¨¡å—">å…¶å®ƒæ¨¡å—<a hidden class="anchor" aria-hidden="true" href="#å…¶å®ƒæ¨¡å—">#</a></h3>
<p>ansible è¿˜æä¾›äº†å¾ˆå¤šé’ˆå¯¹å„ç§åº”ç”¨çš„æ¨¡å—,æ¯”å¦‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nginx_status_info
</span></span><span style="display:flex;"><span>nginx_status_facts
</span></span><span style="display:flex;"><span>mysql_db <span style="color:#75715e">#éœ€è¦å®‰è£…MySQL-pythonåŒ…</span>
</span></span><span style="display:flex;"><span>mysql_user <span style="color:#75715e">#éœ€è¦å®‰è£…MySQL-pythonåŒ…</span>
</span></span><span style="display:flex;"><span>redis
</span></span><span style="display:flex;"><span>mongodb*
</span></span><span style="display:flex;"><span>postgresql*
</span></span><span style="display:flex;"><span>haproxy
</span></span><span style="display:flex;"><span>git
</span></span></code></pre></div>

        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://colorfulgz.com/posts/ansible2/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>è¿ç»´è‡ªåŠ¨åŒ–å·¥å…·Ansible(äºŒ)</span>
  </a>
  <a class="next" href="https://colorfulgz.com/posts/redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>Rediså­¦ä¹ ç¬”è®°</span>
  </a>
</nav>

        </footer>
    </div>

<style>
    .comments_details summary::marker {
        font-size: 20px;
        content: 'ğŸ‘‰å±•å¼€è¯„è®º';
        color: var(--content);
    }
    .comments_details[open] summary::marker{
        font-size: 20px;
        content: 'ğŸ‘‡å…³é—­è¯„è®º';
        color: var(--content);
    }
</style>


<div>
    <details class="comments_details">
        <summary style="cursor: pointer; margin: 50px 0 20px 0;width: 130px;">
            <span style="font-size: 20px;color: var(--content);">...</span>
        </summary>
        <div id="tcomment"></div>
    </details>
    <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js">
    </script>
    <script>
        twikoo.init({
            envId:  null ,
        el: "#tcomment",
            lang: 'zh-CN',
            region:  null ,
        path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
        })
    </script>
</div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        2022-2023
        <a href="https://colorfulgz.com" style="color:#939393;">DevOpsHub</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;">é»”ICPå¤‡2023014549å·</a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="/img/beian.png" style="float:left;margin: 0px 5px 0px 0px;"/>
            ç²¤å…¬ç½‘å®‰å¤‡44030002001370å·
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"DevOpsHub"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"DevOpsHub"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'ğŸ“„å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'ğŸ‘ŒğŸ»å·²å¤åˆ¶!';
            setTimeout(() => {
                copybutton.innerText = 'ğŸ“„å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"DevOpsHub"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>
</body>

</html>
