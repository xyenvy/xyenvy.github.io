<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Rediséƒ¨ç½²å’ŒåŸºç¡€ä½¿ç”¨ | DevOpsHub</title>
<meta name="keywords" content="Redis">
<meta name="description" content="Redis (Remote Dictionary Serverè¿œç¨‹å­—å…¸æœåŠ¡)æ˜¯ä¸€ä¸ªéµå¾ªBSD MITå¼€æºåè®®çš„é«˜æ€§èƒ½çš„NoSQL">
<meta name="author" content="">
<link rel="canonical" href="https://xyenvy.github.io/posts/redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://xyenvy.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://xyenvy.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://xyenvy.github.io/img/Q.gif">
<link rel="apple-touch-icon" href="https://xyenvy.github.io/img/Q.gif">
<link rel="mask-icon" href="https://xyenvy.github.io/img/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="Rediséƒ¨ç½²å’ŒåŸºç¡€ä½¿ç”¨" />
<meta property="og:description" content="Redis (Remote Dictionary Serverè¿œç¨‹å­—å…¸æœåŠ¡)æ˜¯ä¸€ä¸ªéµå¾ªBSD MITå¼€æºåè®®çš„é«˜æ€§èƒ½çš„NoSQL" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xyenvy.github.io/posts/redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/" />
<meta property="og:image" content="https://xyenvy.github.io/posts.images/banner/29.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-07T21:16:33+00:00" />
<meta property="article:modified_time" content="2022-12-07T21:16:33+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://xyenvy.github.io/posts.images/banner/29.jpg" />
<meta name="twitter:title" content="Rediséƒ¨ç½²å’ŒåŸºç¡€ä½¿ç”¨"/>
<meta name="twitter:description" content="Redis (Remote Dictionary Serverè¿œç¨‹å­—å…¸æœåŠ¡)æ˜¯ä¸€ä¸ªéµå¾ªBSD MITå¼€æºåè®®çš„é«˜æ€§èƒ½çš„NoSQL"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  1 ,
          "name": "ğŸ“šæ–‡ç« ",
          "item": "https://xyenvy.github.io/posts/"
        }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Rediséƒ¨ç½²å’ŒåŸºç¡€ä½¿ç”¨",
      "item": "https://xyenvy.github.io/posts/redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Rediséƒ¨ç½²å’ŒåŸºç¡€ä½¿ç”¨",
  "name": "Rediséƒ¨ç½²å’ŒåŸºç¡€ä½¿ç”¨",
  "description": "Redis (Remote Dictionary Serverè¿œç¨‹å­—å…¸æœåŠ¡)æ˜¯ä¸€ä¸ªéµå¾ªBSD MITå¼€æºåè®®çš„é«˜æ€§èƒ½çš„NoSQL",
  "keywords": [
    "Redis"
  ],
  "articleBody": "RedisåŸºç¡€ ç®€ä»‹ Redis (Remote Dictionary Serverè¿œç¨‹å­—å…¸æœåŠ¡)æ˜¯ä¸€ä¸ªéµå¾ªBSD MITå¼€æºåè®®çš„é«˜æ€§èƒ½çš„NoSQL.RedisåŸºäºANSI Cè¯­è¨€è¯­è¨€)ç¼–å†™çš„key-valueæ•°æ®åº“,æ˜¯æ„å¤§åˆ©çš„Salvatore Sanfilippoåœ¨2009å¹´å‘å¸ƒï¼Œä»2010å¹´3æœˆ15æ—¥èµ·ï¼ŒRedisçš„å¼€å‘å·¥ä½œç”±VMwareä¸»æŒã€‚ä»2013å¹´5æœˆå¼€å§‹ï¼ŒRedisçš„å¼€å‘ç”±Pivotalå…¬å¸èµåŠ©ã€‚ç›®å‰å›½å†…å¤–ä½¿ç”¨çš„å…¬å¸ä¼—å¤š,æ¯”å¦‚:é˜¿é‡Œ,è…¾è®¯,ç™¾åº¦,äº¬ä¸œ,æ–°æµªå¾®åš,GitHub,Twitter ç­‰Redisçš„å‡ºç°ï¼Œå¾ˆå¤§ç¨‹åº¦è¡¥å¿äº†memcachedè¿™ç±»key/valueå­˜å‚¨çš„ä¸è¶³ï¼Œåœ¨éƒ¨åˆ†åœºåˆå¯ä»¥å¯¹å…³ç³»æ•°æ®åº“èµ·åˆ°å¾ˆå¥½çš„è¡¥å……ä½œç”¨ã€‚å®ƒæä¾›äº†Javaï¼ŒC/C++ï¼ŒGo, C#ï¼ŒPHPï¼ŒJavaScriptï¼ŒPerlï¼ŒObject-Cï¼ŒPythonï¼ŒRubyï¼ŒErlangç­‰å®¢æˆ·ç«¯ DB-Engineæœˆåº¦æ’è¡Œæ¦œRedisåœ¨é”®å€¼å‹å­˜å‚¨ç±»çš„æ•°æ®åº“é•¿æœŸå±…äºé¦–ä½,è¿œè¿œé«˜äºç¬¬äºŒä½çš„memcached\nç‰¹æ€§ é€Ÿåº¦å¿«: 10W QPS,åŸºäºå†…å­˜,Cè¯­è¨€å®ç° å•çº¿ç¨‹ æŒä¹…åŒ– æ”¯æŒå¤šç§æ•°æ®ç»“æ„ æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ åŠŸèƒ½ä¸°å¯Œ: æ”¯æŒLuaè„šæœ¬,å‘å¸ƒè®¢é˜…,äº‹åŠ¡,pipelineç­‰åŠŸèƒ½ ç®€å•: ä»£ç çŸ­å°ç²¾æ‚(å•æœºæ ¸å¿ƒä»£ç åªæœ‰23000è¡Œå·¦å³),å•çº¿ç¨‹å¼€å‘å®¹æ˜“,ä¸ä¾èµ–å¤–éƒ¨åº“,ä½¿ç”¨ç®€å• ä¸»ä»å¤åˆ¶ æ”¯æŒé«˜å¯ç”¨å’Œåˆ†å¸ƒå¼ å•çº¿ç¨‹ Redis 6.0ç‰ˆæœ¬å‰ä¸€ç›´æ˜¯å•çº¿ç¨‹æ–¹å¼å¤„ç†ç”¨æˆ·çš„è¯·æ±‚\nå•çº¿ç¨‹ä¸ºä½•å¦‚æ­¤å¿«?\nçº¯å†…å­˜ éé˜»å¡é¿å…çº¿ç¨‹åˆ‡æ¢å’Œç«æ€æ¶ˆè€— æ³¨æ„äº‹é¡¹\nä¸€æ¬¡åªè¿è¡Œä¸€æ¡å‘½ä»¤ é¿å…æ‰§è¡Œé•¿(æ…¢)å‘½ä»¤:keys *, flushall, flushdb, slow lua script, mutil/exec, operate bigvalue(collection) å…¶å®ä¸æ˜¯å•çº¿ç¨‹: æ—©æœŸç‰ˆæœ¬æ˜¯å•è¿›ç¨‹å•çº¿ç¨‹,3.0 ç‰ˆæœ¬åå®é™…è¿˜æœ‰å…¶å®ƒçš„çº¿ç¨‹, å®ç°ç‰¹å®šåŠŸèƒ½,å¦‚: fysnc file descriptor,close file descriptor å¸¸è§åº”ç”¨åœºæ™¯ ç¼“å­˜ï¼šç¼“å­˜RDBMSä¸­æ•°æ®,æ¯”å¦‚ç½‘ç«™çš„æŸ¥è¯¢ç»“æœã€å•†å“ä¿¡æ¯ã€å¾®åšã€æ–°é—»ã€æ¶ˆæ¯ Session å…±äº«ï¼šå®ç°Webé›†ç¾¤ä¸­çš„å¤šæœåŠ¡å™¨é—´çš„sessionå…±äº« è®¡æ•°å™¨ï¼šå•†å“è®¿é—®æ’è¡Œæ¦œã€æµè§ˆæ•°ã€ç²‰ä¸æ•°ã€å…³æ³¨ã€ç‚¹èµã€è¯„è®ºç­‰å’Œæ¬¡æ•°ç›¸å…³çš„æ•°å€¼ç»Ÿè®¡åœºæ™¯ ç¤¾äº¤ï¼šæœ‹å‹åœˆã€å…±åŒå¥½å‹ã€å¯èƒ½è®¤è¯†ä»–ä»¬ç­‰ åœ°ç†ä½ç½®: åŸºäºåœ°ç†ä¿¡æ¯ç³»ç»ŸGISï¼ˆGeographic Information System)å®ç°æ‘‡ä¸€æ‘‡ã€é™„è¿‘çš„äººã€å¤–å–ç­‰åŠŸèƒ½ æ¶ˆæ¯é˜Ÿåˆ—ï¼šELKç­‰æ—¥å¿—ç³»ç»Ÿç¼“å­˜ã€ä¸šåŠ¡çš„è®¢é˜…/å‘å¸ƒç³»ç»Ÿ ç¼“å­˜çš„å®ç°æµç¨‹ æ•°æ®æ›´æ–°æ“ä½œæµç¨‹ï¼š\næ•°æ®è¯»æ“ä½œæµç¨‹ï¼š\nRediså®‰è£…åŠè¿æ¥ å®˜ç½‘ä¸‹è½½åœ°å€\nhttp://download.redis.io/releases/ yumå®‰è£… æŸ¥çœ‹yumåº“redisç‰ˆæœ¬\nyum info redis æˆ–è€… yum info redis yum å®‰è£… redis\nyum install -y redis # å¯åŠ¨ systemctl enable --now redis # è¿æ¥ [root@centos8-backup www]# redis-cli 127.0.0.1:6379\u003e # æŸ¥çœ‹ä¿¡æ¯ 127.0.0.1:6379\u003e info # Server redis_version:5.0.3 redis_git_sha1:00000000 redis_git_dirty:0 redis_build_id:9529b692c0384fb7 redis_mode:standalone os:Linux 4.18.0-348.7.1.el8_5.x86_64 x86_64 arch_bits:64 multiplexing_api:epoll ...... ...... ...... ç¼–è¯‘å®‰è£… Redisæºç åŒ…ä¸‹è½½åœ°å€ http://download.redis.io/releases/ ä¸‹è½½æºç åŒ… [root@centos7-master ~]# wget http://download.redis.io/releases/redis-6.2.6.tar.gz [root@centos7-master ~]# tar xf redis-6.2.6.tar.gz å®‰è£…ä¾èµ– # centos [root@centos7-master ~]# yum -y install gcc jemalloc-devel systemd-devel # ubuntu apt -y install make gcc libjemalloc-dev libsystemd-dev ç¼–è¯‘å®‰è£… [root@centos7-master ~]# cd redis-6.2.6 #å¦‚æœæ”¯æŒsystemd,éœ€è¦æ‰§è¡Œä¸‹é¢ [root@centos7-master redis-6.2.6]# make -j 2 USE_SYSTEMD=yes PREFIX=/usr/local/src/redis install # é…ç½®ç¯å¢ƒå˜é‡ [root@centos7-master ~]# echo 'PATH=/usr/local/src/redis/bin:$PATH' \u003e /etc/profile.d/redis.sh [root@centos7-master ~]# [root@centos7-master ~]# . /etc/profile.d/redis.sh [root@centos7-master ~]# #å‡†å¤‡ç›¸å…³ç›®å½•å’Œé…ç½®æ–‡ä»¶ #åˆ›å»ºé…ç½®æ–‡ä»¶ã€æ—¥å¿—ã€æ•°æ®ç­‰ç›®å½• [root@centos7-master redis]# mkdir /usr/local/src/redis/{etc,log,data,run} [root@centos7-master redis-6.2.6]# cp redis.conf /usr/local/src/redis/etc/ ä¿®æ”¹é…ç½®æ–‡ä»¶ logfile â€œ/usr/local/src/redis/log/redis_6379.logâ€\n# Specify the log file name. Also the empty string can be used to force # Redis to log on the standard output. Note that if you use standard # output for logging but daemonize, logs will be sent to /dev/null logfile \"/usr/local/src/redis/log/redis_6379.log\" # To enable logging to the system logger, just set 'syslog-enabled' to yes, # and optionally update the other syslog parameters to suit your needs. # syslog-enabled no # Specify the syslog identity. # syslog-ident redis pidfile /usr/local/src/redis/run/redis_6379.pid\n# Note that on modern Linux systems \"/run/redis.pid\" is more conforming # and should be used instead. #pidfile /var/run/redis_6379.pid pidfile /usr/local/src/redis/run/redis_6379.pid # Specify the server verbosity level. # This can be one of: # debug (a lot of information, useful for development/testing) # verbose (many rarely useful info, but not a mess like the debug level) # notice (moderately verbose, what you want in production probably) # warning (only very important / critical messages are logged) loglevel notice dir â€œ/usr/local/src/redis/data/6379â€\n# Note that you must specify a directory here, not a file name. dir \"/usr/local/src/redis/data/6379\" ################################# REPLICATION ################################# # Master-Replica replication. Use replicaof to make a Redis instance a copy of # another Redis server. A few things to understand ASAP about Redis replication. dbfilename â€˜dump.rdbâ€™\n# sanitize-dump-payload no # The filename where to dump the DB dbfilename 'dump.rdb' å‰å°å¯åŠ¨redis [root@centos7-master ~]# redis-server /usr/local/src/redis/etc/redis.conf 51487:C 07 Dec 2022 22:27:26.620 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo 51487:C 07 Dec 2022 22:27:26.620 # Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=51487, just started 51487:C 07 Dec 2022 22:27:26.620 # Configuration loaded 51487:M 07 Dec 2022 22:27:26.620 * Increased maximum number of open files to 10032 (it was originally set to 1024). 51487:M 07 Dec 2022 22:27:26.620 * monotonic clock: POSIX clock_gettime _._ _.-``__ ''-._ _.-`` `. `_. ''-._ Redis 6.2.6 (00000000/0) 64 bit .-`` .-```. ```\\/ _.,_ ''-._ ( ' , .-` | `, ) Running in standalone mode |`-._`-...-` __...-.``-._|'` _.-'| Port: 6379 | `-._ `._ / _.-' | PID: 51487 `-._ `-._ `-./ _.-' _.-' |`-._`-._ `-.__.-' _.-'_.-'| | `-._`-._ _.-'_.-' | https://redis.io `-._ `-._`-.__.-'_.-' _.-' |`-._`-._ `-.__.-' _.-'_.-'| | `-._`-._ _.-'_.-' | `-._ `-._`-.__.-'_.-' _.-' `-._ `-.__.-' _.-' `-._ _.-' `-.__.-' 51487:M 07 Dec 2022 22:27:26.621 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128. 51487:M 07 Dec 2022 22:27:26.621 # Server initialized 51487:M 07 Dec 2022 22:27:26.621 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect. 51487:M 07 Dec 2022 22:27:26.621 * Ready to accept connections å¸®åŠ© [root@centos7-master ~]# redis-server -h Usage: ./redis-server [/path/to/redis.conf] [options] [-] ./redis-server - (read config from stdin) ./redis-server -v or --version ./redis-server -h or --help ./redis-server --test-memory Examples: ./redis-server (run the server with default conf) ./redis-server /etc/redis/6379.conf ./redis-server --port 7777 ./redis-server --port 7777 --replicaof 127.0.0.1 8888 ./redis-server /etc/myredis.conf --loglevel verbose - ./redis-server /etc/myredis.conf --loglevel verbose Sentinel mode: ./redis-server /etc/sentinel.conf --sentinel [root@centos7-master ~]# æ¶ˆé™¤å¯åŠ¨æ—¶çš„ä¸‰ä¸ªWarningæç¤ºä¿¡æ¯(å¯é€‰) Tcp backlog\nWARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128. Tcp backlog æ˜¯æŒ‡TCPçš„ç¬¬ä¸‰æ¬¡æ¡æ‰‹æœåŠ¡å™¨ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ ackç¡®è®¤å·ä¹‹ååˆ°æœåŠ¡å™¨ç”¨Acceptå‡½æ•°å¤„ç†è¯·æ±‚å‰çš„é˜Ÿåˆ—é•¿åº¦ï¼Œå³å…¨è¿æ¥é˜Ÿåˆ—\n#vim /etc/sysctl.conf net.core.somaxconn = 511 #sysctl -p overcommit_memory\nWARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect. å†…æ ¸å‚æ•°è¯´æ˜\nå†…æ ¸å‚æ•°overcommit_memory å®ç°å†…å­˜åˆ†é…ç­–ç•¥,å¯é€‰å€¼æœ‰ä¸‰ä¸ªï¼š0ã€1ã€2 0 è¡¨ç¤ºå†…æ ¸å°†æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ä¾›åº”ç”¨è¿›ç¨‹ä½¿ç”¨ï¼›å¦‚æœæœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ï¼Œå†…å­˜ç”³è¯·å…è®¸ï¼›å¦åˆ™å†…å­˜ ç”³è¯·å¤±è´¥ï¼Œå¹¶æŠŠé”™è¯¯è¿”å›ç»™åº”ç”¨è¿›ç¨‹ 1 è¡¨ç¤ºå†…æ ¸å…è®¸åˆ†é…æ‰€æœ‰çš„ç‰©ç†å†…å­˜ï¼Œè€Œä¸ç®¡å½“å‰çš„å†…å­˜çŠ¶æ€å¦‚ä½• 2 è¡¨ç¤ºå†…æ ¸å…è®¸åˆ†é…è¶…è¿‡æ‰€æœ‰ç‰©ç†å†…å­˜å’Œäº¤æ¢ç©ºé—´æ€»å’Œçš„å†…å­˜ #vim /etc/sysctl.conf vm.overcommit_memory = 1 #sysctl -p transparent hugepage\nWARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never \u003e /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled. è­¦å‘Šï¼šæ‚¨åœ¨å†…æ ¸ä¸­å¯ç”¨äº†é€æ˜å¤§é¡µé¢ï¼ˆTHP,ä¸åŒäºä¸€èˆ¬4kå†…å­˜é¡µ,è€Œä¸º2Mï¼‰æ”¯æŒã€‚ è¿™å°†åœ¨Redisä¸­é€ æˆå»¶è¿Ÿ å’Œå†…å­˜ä½¿ç”¨é—®é¢˜ã€‚ è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·ä»¥root ç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤â€œecho never\u003e /sys/kernel/mm/transparent_hugepage/enabledâ€ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æ‚¨çš„/etc/rc.localä¸­ï¼Œä»¥ä¾¿åœ¨ é‡å¯åä¿ç•™è®¾ç½®ã€‚ç¦ç”¨THPåï¼Œå¿…é¡»é‡æ–°å¯åŠ¨Redisã€‚ æ³¨æ„ï¼šubuntu20.04, Rocky8/CentOS8 é»˜è®¤ä¸º neverï¼Œæ‰€ä»¥æ­¤å€¼æ— éœ€ä¼˜åŒ–\néªŒè¯æ˜¯å¦æ¶ˆé™¤warning\n[root@centos7-master ~]# redis-server /usr/local/src/redis/etc/redis.conf 51540:C 07 Dec 2022 22:38:45.196 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo 51540:C 07 Dec 2022 22:38:45.196 # Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=51540, just started 51540:C 07 Dec 2022 22:38:45.196 # Configuration loaded 51540:M 07 Dec 2022 22:38:45.197 * Increased maximum number of open files to 10032 (it was originally set to 1024). 51540:M 07 Dec 2022 22:38:45.197 * monotonic clock: POSIX clock_gettime _._ _.-``__ ''-._ _.-`` `. `_. ''-._ Redis 6.2.6 (00000000/0) 64 bit .-`` .-```. ```\\/ _.,_ ''-._ ( ' , .-` | `, ) Running in standalone mode |`-._`-...-` __...-.``-._|'` _.-'| Port: 6379 | `-._ `._ / _.-' | PID: 51540 `-._ `-._ `-./ _.-' _.-' |`-._`-._ `-.__.-' _.-'_.-'| | `-._`-._ _.-'_.-' | https://redis.io `-._ `-._`-.__.-'_.-' _.-' |`-._`-._ `-.__.-' _.-'_.-'| | `-._`-._ _.-'_.-' | `-._ `-._`-.__.-'_.-' _.-' `-._ `-.__.-' _.-' `-._ _.-' `-.__.-' 51540:M 07 Dec 2022 22:38:45.197 # Server initialized 51540:M 07 Dec 2022 22:38:45.198 * Loading RDB produced by version 6.2.6 51540:M 07 Dec 2022 22:38:45.198 * RDB age 2 seconds 51540:M 07 Dec 2022 22:38:45.198 * RDB memory usage when created 0.77 Mb 51540:M 07 Dec 2022 22:38:45.198 # Done loading RDB, keys loaded: 0, keys expired: 0. 51540:M 07 Dec 2022 22:38:45.198 * DB loaded from disk: 0.000 seconds 51540:M 07 Dec 2022 22:38:45.198 * Ready to accept connections åˆ›å»º Redis ç”¨æˆ·å’Œè®¾ç½®æ•°æ®ç›®å½•æƒé™ [root@centos7-master ~]# useradd -r -s /sbin/nologin redis [root@centos7-master ~]# chown -R redis.redis /usr/local/src/redis/ [root@centos7-master ~]# åˆ›å»º Redis æœåŠ¡ Service æ–‡ä»¶ [root@centos7-master ~]# vim /lib/systemd/system/redis.service [Unit] Description=Redis persistent key-value database After=network.target [Service] ExecStart=/usr/local/src/redis/bin/redis-server /usr/local/src/redis/etc/redis.conf --supervised systemd ExecStop=/bin/kill -s QUIT $MAINPID Type=notify User=redis Group=redis RuntimeDirectory=redis RuntimeDirectoryMode=0755 LimitNOFILE=1000000 [Install] WantedBy=multi-user.target Redis é€šè¿‡Serviceæ–¹å¼å¯åŠ¨ systemctl daemon-reload systemctl restart redis systemctl status redis Rediså¤šå®ä¾‹ åŸºäºæºç ç¼–è¯‘å®‰è£…çš„å‰æä¸‹å®ç°redisçš„å¤šå®ä¾‹\n# è¿›å…¥/usr/local/src/redis/etc [root@centos7-master ~]# cd /usr/local/src/redis/etc/ [root@centos7-master etc]# # ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨6380,6381ç«¯å£å¯åŠ¨å®ä¾‹ [root@centos7-master etc]# sed 's/6379/6380/' redis.conf \u003e redis6380.conf [root@centos7-master etc]# sed 's/6379/6380/' redis.conf \u003e redis6381.conf # ä¿®æ”¹æ‰€å±ç»„ [root@centos7-master etc]# chown -R redis.redis * # ä¿®æ”¹å¯åŠ¨æ–‡ä»¶ [root@centos7-master etc]# cp /lib/systemd/system/redis.service /lib/systemd/system/redis6380.service [root@centos7-master etc]# [root@centos7-master etc]# vim /lib/systemd/system/redis6380.service [Unit] Description=Redis persistent key-value database After=network.target [Service] ExecStart=/usr/local/src/redis/bin/redis-server /usr/local/src/redis/etc/redis6380.conf --supervised systemd ExecStop=/bin/kill -s QUIT $MAINPID Type=notify User=redis Group=redis RuntimeDirectory=redis RuntimeDirectoryMode=0755 LimitNOFILE=1000000 [Install] WantedBy=multi-user.target # ä½¿ç”¨ç›¸åŒæ–¹æ³•åˆ›å»º/lib/systemd/system/redis6381.serviceæ–‡ä»¶å¹¶ä¿®æ”¹å†…å®¹ # å¯åŠ¨å®ä¾‹ [root@centos7-master etc]# systemctl status redis.service [root@centos7-master etc]# systemctl status redis6380.service [root@centos7-master etc]# systemctl status redis6381.service # æŸ¥çœ‹6379 6380 6381 ç«¯å£æ˜¯å¦å¯ç”¨ è¿æ¥æµ‹è¯• [root@centos7-master etc]# redis-cli -p 6379 [root@centos7-master etc]# redis-cli -p 6380 [root@centos7-master etc]# redis-cli -p 6381 Redis é…ç½®ç®¡ç† é…ç½®æ–‡ä»¶è¯´æ˜ bind 0.0.0.0 #æŒ‡å®šç›‘å¬åœ°å€ï¼Œæ”¯æŒç”¨ç©ºæ ¼éš”å¼€çš„å¤šä¸ªç›‘å¬IP protected-mode yes #redis3.2ä¹‹ååŠ å…¥çš„æ–°ç‰¹æ€§ï¼Œåœ¨æ²¡æœ‰è®¾ç½®bind IPå’Œå¯†ç çš„æ—¶å€™,redisåªå…è®¸è®¿ é—®127.0.0.1:6379ï¼Œå¯ä»¥è¿œç¨‹è¿æ¥ï¼Œä½†å½“è®¿é—®å°†æç¤ºè­¦å‘Šä¿¡æ¯å¹¶æ‹’ç»è¿œç¨‹è®¿é—® port 6379 #ç›‘å¬ç«¯å£,é»˜è®¤6379/tcp tcp-backlog 511 #ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™serverç«¯æ”¶åˆ°client ackç¡®è®¤å·ä¹‹åçš„é˜Ÿåˆ—å€¼ï¼Œå³å…¨è¿æ¥é˜Ÿåˆ—é•¿åº¦ timeout 0 #å®¢æˆ·ç«¯å’ŒRedisæœåŠ¡ç«¯çš„è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯0ï¼Œè¡¨ç¤ºæ°¸ä¸è¶…æ—¶ tcp-keepalive 300 #tcp ä¼šè¯ä¿æŒæ—¶é—´300s daemonize no #é»˜è®¤no,å³ç›´æ¥è¿è¡Œredis-serverç¨‹åºæ—¶,ä¸ä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œè€Œæ˜¯ä»¥å‰å°æ–¹å¼è¿è¡Œï¼Œ å¦‚æœæƒ³åœ¨åå°è¿è¡Œéœ€æ”¹æˆyes,å½“redisä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šå†™ä¸€ä¸ª pid åˆ° /var/run/redis.pid æ–‡ä»¶ supervised no #å’ŒOSç›¸å…³å‚æ•°ï¼Œå¯è®¾ç½®é€šè¿‡upstartå’Œsystemdç®¡ç†Rediså®ˆæŠ¤è¿›ç¨‹ï¼Œcentos7åéƒ½ä½¿ ç”¨systemd pidfile /var/run/redis_6379.pid #pidæ–‡ä»¶è·¯å¾„,å¯ä»¥ä¿®æ”¹ ä¸º/apps/redis/run/redis_6379.pid loglevel notice #æ—¥å¿—çº§åˆ« logfile \"/path/redis.log\" #æ—¥å¿—è·¯å¾„,ç¤ºä¾‹:logfile \"/apps/redis/log/redis_6379.log\" databases 16 #è®¾ç½®æ•°æ®åº“æ•°é‡ï¼Œé»˜è®¤ï¼š0-15ï¼Œå…±16ä¸ªåº“ always-show-logo yes #åœ¨å¯åŠ¨redis æ—¶æ˜¯å¦æ˜¾ç¤ºæˆ–åœ¨æ—¥å¿—ä¸­è®°å½•è®°å½•redisçš„logo save 900 1 #åœ¨900ç§’å†…æœ‰1ä¸ªkeyå†…å®¹å‘ç”Ÿæ›´æ”¹,å°±æ‰§è¡Œå¿«ç…§æœºåˆ¶ save 300 10 #åœ¨300ç§’å†…æœ‰10ä¸ªkeyå†…å®¹å‘ç”Ÿæ›´æ”¹,å°±æ‰§è¡Œå¿«ç…§æœºåˆ¶ save 60 10000 #60ç§’å†…å¦‚æœæœ‰10000ä¸ªkeyä»¥ä¸Šçš„å˜åŒ–ï¼Œå°±è‡ªåŠ¨å¿«ç…§å¤‡ä»½ stop-writes-on-bgsave-error yes #é»˜è®¤ä¸ºyesæ—¶,å¯èƒ½ä¼šå› ç©ºé—´æ»¡ç­‰åŸå› å¿«ç…§æ— æ³•ä¿å­˜å‡ºé”™æ—¶ï¼Œä¼šç¦ æ­¢rediså†™å…¥æ“ä½œï¼Œç”Ÿäº§å»ºè®®ä¸ºno #æ­¤é¡¹åªé’ˆå¯¹é…ç½®æ–‡ä»¶ä¸­çš„è‡ªåŠ¨saveæœ‰æ•ˆ rdbcompression yes #æŒä¹…åŒ–åˆ°RDBæ–‡ä»¶æ—¶ï¼Œæ˜¯å¦å‹ç¼©ï¼Œ\"yes\"ä¸ºå‹ç¼©ï¼Œ\"no\"åˆ™åä¹‹ rdbchecksum yes #æ˜¯å¦å¯¹å¤‡ä»½æ–‡ä»¶å¼€å¯RC64æ ¡éªŒï¼Œé»˜è®¤æ˜¯å¼€å¯ dbfilename dump.rdb #å¿«ç…§æ–‡ä»¶å dir ./ #å¿«ç…§æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œç¤ºä¾‹ï¼šdir \"/apps/redis/data\" #ä¸»ä»å¤åˆ¶ç›¸å…³ # replicaof #æŒ‡å®šå¤åˆ¶çš„masterä¸»æœºåœ°å€å’Œç«¯å£ï¼Œ5.0ç‰ˆä¹‹å‰çš„æŒ‡ä»¤ä¸º slaveof # masterauth #æŒ‡å®šå¤åˆ¶çš„masterä¸»æœºçš„å¯†ç  replica-serve-stale-data yes #å½“ä»åº“åŒä¸»åº“å¤±å»è¿æ¥æˆ–è€…å¤åˆ¶æ­£åœ¨è¿›è¡Œï¼Œä»æœºåº“æœ‰ä¸¤ç§è¿è¡Œæ–¹å¼ï¼š 1ã€è®¾ç½®ä¸ºyes(é»˜è®¤è®¾ç½®)ï¼Œä»åº“ä¼šç»§ç»­å“åº”å®¢æˆ·ç«¯çš„è¯»è¯·æ±‚ï¼Œæ­¤ä¸ºå»ºè®®å€¼ 2ã€è®¾ç½®ä¸ºnoï¼Œé™¤å»ç‰¹å®šå‘½ä»¤å¤–çš„ä»»ä½•è¯·æ±‚éƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯\"SYNC with master in progress\"ã€‚ replica-read-only yes #æ˜¯å¦è®¾ç½®ä»åº“åªè¯»ï¼Œå»ºè®®å€¼ä¸ºyes,å¦åˆ™ä¸»åº“åŒæ­¥ä»åº“æ—¶å¯èƒ½ä¼šè¦†ç›–æ•°æ®ï¼Œé€ æˆ æ•°æ®ä¸¢å¤± repl-diskless-sync no #æ˜¯å¦ä½¿ç”¨socketæ–¹å¼å¤åˆ¶æ•°æ®(æ— ç›˜åŒæ­¥)ï¼Œæ–°slaveç¬¬ä¸€æ¬¡è¿æ¥masteræ—¶éœ€ è¦åšæ•°æ®çš„å…¨é‡åŒæ­¥ï¼Œredis serverå°±è¦ä»å†…å­˜dumpå‡ºæ–°çš„RDBæ–‡ä»¶ï¼Œç„¶åä»masterä¼ åˆ°slaveï¼Œæœ‰ä¸¤ç§ æ–¹å¼æŠŠRDBæ–‡ä»¶ä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼š 1ã€åŸºäºç¡¬ç›˜ï¼ˆdisk-backedï¼‰ï¼šä¸ºnoæ—¶ï¼Œmasteråˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹dumpç”ŸæˆRDBç£ç›˜æ–‡ä»¶ï¼ŒRDBå®Œæˆä¹‹åç”± çˆ¶è¿›ç¨‹ï¼ˆå³ä¸»è¿›ç¨‹ï¼‰å°†RDBæ–‡ä»¶å‘é€ç»™slavesï¼Œæ­¤ä¸ºé»˜è®¤å€¼ 2ã€åŸºäºsocketï¼ˆdisklessï¼‰ï¼šmasteråˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ç›´æ¥dump RDBè‡³slaveçš„ç½‘ç»œsocketï¼Œä¸ç»è¿‡ä¸» è¿›ç¨‹å’Œç¡¬ç›˜ #æ¨èä½¿ç”¨åŸºäºç¡¬ç›˜ï¼ˆä¸ºnoï¼‰ï¼Œæ˜¯å› ä¸ºRDBæ–‡ä»¶åˆ›å»ºåï¼Œå¯ä»¥åŒæ—¶ä¼ è¾“ç»™æ›´å¤šçš„slaveï¼Œä½†æ˜¯åŸºäºsocket(ä¸º yes)ï¼Œ æ–°slaveè¿æ¥åˆ°masterä¹‹åå¾—é€ä¸ªåŒæ­¥æ•°æ®ã€‚åªæœ‰å½“ç£ç›˜I/Oè¾ƒæ…¢ä¸”ç½‘ç»œè¾ƒå¿«æ—¶ï¼Œå¯ç”¨ diskless(yes),å¦åˆ™ä¸€èˆ¬å»ºè®®ä½¿ç”¨ç£ç›˜(no) repl-diskless-sync-delay 5 #disklessæ—¶å¤åˆ¶çš„æœåŠ¡å™¨ç­‰å¾…çš„å»¶è¿Ÿæ—¶é—´ï¼Œè®¾ç½®0ä¸ºå…³é—­ï¼Œåœ¨å»¶è¿Ÿæ—¶é—´ å†…åˆ°è¾¾çš„å®¢æˆ·ç«¯ï¼Œä¼šä¸€èµ·é€šè¿‡disklessæ–¹å¼åŒæ­¥æ•°æ®ï¼Œä½†æ˜¯ä¸€æ—¦å¤åˆ¶å¼€å§‹ï¼ŒmasterèŠ‚ç‚¹ä¸ä¼šå†æ¥æ”¶æ–°slave çš„å¤åˆ¶è¯·æ±‚ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡åŒæ­¥å¼€å§‹æ‰å†æ¥æ”¶æ–°è¯·æ±‚ã€‚å³æ— æ³•ä¸ºå»¶è¿Ÿæ—¶é—´ååˆ°è¾¾çš„æ–°å‰¯æœ¬æä¾›æœåŠ¡ï¼Œæ–°å‰¯æœ¬å°†æ’ é˜Ÿç­‰å¾…ä¸‹ä¸€æ¬¡RDBä¼ è¾“ï¼Œå› æ­¤æœåŠ¡å™¨ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´æ‰èƒ½è®©æ›´å¤šå‰¯æœ¬åˆ°è¾¾ã€‚æ¨èå€¼ï¼š30-60 repl-ping-replica-period 10 #slaveæ ¹æ®masteræŒ‡å®šçš„æ—¶é—´è¿›è¡Œå‘¨æœŸæ€§çš„PING master,ç”¨äºç›‘æµ‹ masterçŠ¶æ€,é»˜è®¤10s repl-timeout 60 #å¤åˆ¶è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œéœ€è¦å¤§äºrepl-ping-slave-periodï¼Œå¦åˆ™ä¼šç»å¸¸æŠ¥è¶…æ—¶ repl-disable-tcp-nodelay no #æ˜¯å¦åœ¨slaveå¥—æ¥å­—å‘é€SYNCä¹‹åç¦ç”¨ TCP_NODELAYï¼Œå¦‚æœé€‰ æ‹©\"yes\"ï¼ŒRediså°†åˆå¹¶å¤šä¸ªæŠ¥æ–‡ä¸ºä¸€ä¸ªå¤§çš„æŠ¥æ–‡ï¼Œä»è€Œä½¿ç”¨æ›´å°‘æ•°é‡çš„åŒ…å‘slaveså‘é€æ•°æ®ï¼Œä½†æ˜¯å°†ä½¿æ•°æ® ä¼ è¾“åˆ°slaveä¸Šæœ‰å»¶è¿Ÿï¼ŒLinuxå†…æ ¸çš„é»˜è®¤é…ç½®ä¼šè¾¾åˆ°40æ¯«ç§’ï¼Œå¦‚æœ \"no\" ï¼Œæ•°æ®ä¼ è¾“åˆ°slaveçš„å»¶è¿Ÿå°†ä¼š å‡å°‘ï¼Œä½†è¦ä½¿ç”¨æ›´å¤šçš„å¸¦å®½ repl-backlog-size 512mb #å¤åˆ¶ç¼“å†²åŒºå†…å­˜å¤§å°ï¼Œå½“slaveæ–­å¼€è¿æ¥ä¸€æ®µæ—¶é—´åï¼Œè¯¥ç¼“å†²åŒºä¼šç´¯ç§¯å¤åˆ¶ å‰¯æœ¬æ•°æ®ï¼Œå› æ­¤å½“slave é‡æ–°è¿æ¥æ—¶ï¼Œé€šå¸¸ä¸éœ€è¦å®Œå…¨é‡æ–°åŒæ­¥ï¼Œåªéœ€ä¼ é€’åœ¨å‰¯æœ¬ä¸­çš„æ–­å¼€è¿æ¥åæ²¡æœ‰åŒæ­¥çš„ éƒ¨åˆ†æ•°æ®å³å¯ã€‚åªæœ‰åœ¨è‡³å°‘æœ‰ä¸€ä¸ªslaveè¿æ¥ä¹‹åæ‰åˆ†é…æ­¤å†…å­˜ç©ºé—´,å»ºè®®å»ºç«‹ä¸»ä»æ—¶æ­¤å€¼è¦è°ƒå¤§ä¸€äº›æˆ–åœ¨ä½å³° æœŸé…ç½®,å¦åˆ™ä¼šå¯¼è‡´åŒæ­¥åˆ°slaveå¤±è´¥ repl-backlog-ttl 3600 #å¤šé•¿æ—¶é—´å†…masteræ²¡æœ‰slaveè¿æ¥ï¼Œå°±æ¸…ç©ºbacklogç¼“å†²åŒº replica-priority 100 #å½“masterä¸å¯ç”¨ï¼Œå“¨å…µSentinelä¼šæ ¹æ®slaveçš„ä¼˜å…ˆçº§é€‰ä¸¾ä¸€ä¸ªmasterï¼Œæ­¤ å€¼æœ€ä½çš„slaveä¼šä¼˜å…ˆå½“é€‰masterï¼Œè€Œé…ç½®æˆ0ï¼Œæ°¸è¿œä¸ä¼šè¢«é€‰ä¸¾ï¼Œä¸€èˆ¬å¤šä¸ªslaveéƒ½è®¾ä¸ºä¸€æ ·çš„å€¼ï¼Œè®©å…¶è‡ª åŠ¨é€‰æ‹© #min-replicas-to-write 3 #è‡³å°‘æœ‰3ä¸ªå¯è¿æ¥çš„slaveï¼Œmateræ‰æ¥å—å†™æ“ä½œ #min-replicas-max-lag 10 #å’Œä¸Šé¢è‡³å°‘3ä¸ªslaveçš„pingå»¶è¿Ÿä¸èƒ½è¶…è¿‡10ç§’ï¼Œå¦åˆ™masterä¹Ÿå°†åœæ­¢ å†™æ“ä½œ requirepass foobared #è®¾ç½®redisè¿æ¥å¯†ç ï¼Œä¹‹åéœ€è¦AUTH pass,å¦‚æœæœ‰ç‰¹æ®Šç¬¦å·ï¼Œç”¨\" \"å¼•èµ·æ¥,ç”Ÿ äº§å»ºè®®è®¾ç½® rename-command #é‡å‘½åä¸€äº›é«˜å±å‘½ä»¤ï¼Œç¤ºä¾‹ï¼šrename-command FLUSHALL \"\" ç¦ç”¨å‘½ä»¤ #ç¤ºä¾‹: rename-command del magedu maxclients 10000 #Redisæœ€å¤§è¿æ¥å®¢æˆ·ç«¯ maxmemory #redisä½¿ç”¨çš„æœ€å¤§å†…å­˜ï¼Œå•ä½ä¸ºbyteså­—èŠ‚ï¼Œ0ä¸ºä¸é™åˆ¶ï¼Œå»ºè®®è®¾ä¸ºç‰©ç†å†…å­˜ä¸€åŠï¼Œ 8Gå†…å­˜çš„è®¡ç®—æ–¹å¼8(G)*1024(MB)1024(KB)*1024(Kbyte)ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç¼“å†²åŒºæ˜¯ä¸è®¡ç®—åœ¨maxmemory å†…,ç”Ÿäº§ä¸­å¦‚æœä¸è®¾ç½®æ­¤é¡¹,å¯èƒ½ä¼šå¯¼è‡´OOM #maxmemory-policy noeviction æ­¤ä¸ºé»˜è®¤å€¼ # MAXMEMORY POLICYï¼šå½“è¾¾åˆ°æœ€å¤§å†…å­˜æ—¶ï¼ŒRedis å°†å¦‚ä½•é€‰æ‹©è¦åˆ é™¤çš„å†…å®¹ã€‚æ‚¨å¯ä»¥ä»ä»¥ä¸‹è¡Œä¸ºä¸­é€‰æ‹©ä¸€ ç§ï¼š # # volatile-lru -\u003e Evict ä½¿ç”¨è¿‘ä¼¼ LRUï¼Œåªæœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ã€‚ # allkeys-lru -\u003e ä½¿ç”¨è¿‘ä¼¼ LRU é©±é€ä»»ä½•é”®ã€‚ # volatile-lfu -\u003e ä½¿ç”¨è¿‘ä¼¼ LFU é©±é€ï¼Œåªæœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ã€‚ # allkeys-lfu -\u003e ä½¿ç”¨è¿‘ä¼¼ LFU é©±é€ä»»ä½•é”®ã€‚ # volatile-random -\u003e åˆ é™¤è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„éšæœºå¯†é’¥ã€‚ # allkeys-random -\u003e åˆ é™¤ä¸€ä¸ªéšæœºå¯†é’¥ï¼Œä»»ä½•å¯†é’¥ã€‚ # volatile-ttl -\u003e åˆ é™¤è¿‡æœŸæ—¶é—´æœ€è¿‘çš„keyï¼ˆæ¬¡TTLï¼‰ # noeviction -\u003e ä¸è¦é©±é€ä»»ä½•ä¸œè¥¿ï¼Œåªæ˜¯åœ¨å†™æ“ä½œæ—¶è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ # # LRU è¡¨ç¤ºæœ€è¿‘æœ€å°‘ä½¿ç”¨ # LFU è¡¨ç¤ºæœ€ä¸å¸¸ç”¨ # # LRUã€LFU å’Œ volatile-ttl éƒ½æ˜¯ä½¿ç”¨è¿‘ä¼¼éšæœºç®—æ³•å®ç°çš„ã€‚ # # æ³¨æ„ï¼šä½¿ç”¨ä¸Šè¿°ä»»ä½•ä¸€ç§ç­–ç•¥ï¼Œå½“æ²¡æœ‰åˆé€‚çš„é”®ç”¨äºé©±é€æ—¶ï¼ŒRedis å°†åœ¨éœ€è¦æ›´å¤šå†…å­˜çš„å†™æ“ä½œæ—¶è¿”å›é”™ è¯¯ã€‚è¿™äº›é€šå¸¸æ˜¯åˆ›å»ºæ–°å¯†é’¥ã€æ·»åŠ æ•°æ®æˆ–ä¿®æ”¹ç°æœ‰å¯†é’¥çš„å‘½ä»¤ã€‚ä¸€äº›ç¤ºä¾‹æ˜¯ï¼šSETã€INCRã€HSETã€LPUSHã€ SUNIONSTOREã€SORTï¼ˆç”±äº STORE å‚æ•°ï¼‰å’Œ EXECï¼ˆå¦‚æœäº‹åŠ¡åŒ…æ‹¬ä»»ä½•éœ€è¦å†…å­˜çš„å‘½ä»¤ï¼‰ã€‚ #MAXMEMORY POLICYï¼šå½“è¾¾åˆ°æœ€å¤§å†…å­˜æ—¶ï¼ŒRedis å°†å¦‚ä½•é€‰æ‹©è¦åˆ é™¤çš„å†…å®¹ã€‚å¯ä»¥ä»ä¸‹é¢è¡Œä¸ºä¸­è¿›è¡Œé€‰ æ‹©ï¼š # volatile-lru -\u003e åœ¨å…·æœ‰è¿‡æœŸé›†çš„é”®ä¸­ä½¿ç”¨è¿‘ä¼¼ LRU é©±é€ã€‚ # allkeys-lru -\u003e ä½¿ç”¨è¿‘ä¼¼ LRU é©±é€ä»»ä½•é”®ã€‚ # volatile-lfu -\u003e åœ¨å…·æœ‰è¿‡æœŸé›†çš„é”®ä¸­ä½¿ç”¨è¿‘ä¼¼ LFU é©±é€ã€‚ # allkeys-lfu -\u003e ä½¿ç”¨è¿‘ä¼¼ LFU é©±é€ä»»ä½•é”®ã€‚ # volatile-random -\u003e ä»å…·æœ‰è¿‡æœŸè®¾ç½®çš„å¯†é’¥ä¸­åˆ é™¤ä¸€ä¸ªéšæœºå¯†é’¥ã€‚ # allkeys-random -\u003e åˆ é™¤ä¸€ä¸ªéšæœºå¯†é’¥ï¼Œä»»ä½•å¯†é’¥ã€‚ # volatile-ttl -\u003e åˆ é™¤è¿‡æœŸæ—¶é—´æœ€è¿‘çš„keyï¼ˆæ¬¡TTLï¼‰ # noeviction -\u003e ä¸è¦é©±é€ä»»ä½•ä¸œè¥¿ï¼Œåªæ˜¯åœ¨å†™æ“ä½œæ—¶è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ # # LRU è¡¨ç¤ºæœ€è¿‘æœ€å°‘ä½¿ç”¨ # LFU è¡¨ç¤ºæœ€ä¸å¸¸ç”¨ # # LRUã€LFU å’Œ volatile-ttl å‡ä½¿ç”¨è¿‘ä¼¼å®ç°éšæœºç®—æ³•ã€‚ # # æ³¨æ„ï¼šä½¿ç”¨ä¸Šè¿°ä»»ä½•ä¸€ç§ç­–ç•¥ï¼ŒRedis éƒ½ä¼šåœ¨å†™å…¥æ—¶è¿”å›é”™è¯¯æ“ä½œï¼Œå½“æ²¡æœ‰åˆé€‚çš„é”®ç”¨äºé©±é€æ—¶ã€‚ appendonly no #æ˜¯å¦å¼€å¯AOFæ—¥å¿—è®°å½•ï¼Œé»˜è®¤redisä½¿ç”¨çš„æ˜¯rdbæ–¹å¼æŒä¹…åŒ–ï¼Œè¿™ç§æ–¹å¼åœ¨è®¸å¤šåº”ç”¨ä¸­å·²ç» è¶³å¤Ÿç”¨äº†ï¼Œä½†æ˜¯rediså¦‚æœä¸­é€”å®•æœºï¼Œä¼šå¯¼è‡´å¯èƒ½æœ‰å‡ åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±(å–å†³äºdumpæ•°æ®çš„é—´éš”æ—¶é—´)ï¼Œæ ¹æ® saveæ¥ç­–ç•¥è¿›è¡ŒæŒä¹…åŒ–ï¼ŒAppend Only Fileæ˜¯å¦ä¸€ç§æŒä¹…åŒ–æ–¹å¼ï¼Œå¯ä»¥æä¾›æ›´å¥½çš„æŒä¹…åŒ–ç‰¹æ€§ï¼ŒRedisä¼š æŠŠæ¯æ¬¡å†™å…¥çš„æ•°æ®åœ¨æ¥æ”¶åéƒ½å†™å…¥ appendonly.aof æ–‡ä»¶ï¼Œæ¯æ¬¡å¯åŠ¨æ—¶Rediséƒ½ä¼šå…ˆæŠŠè¿™ä¸ªæ–‡ä»¶çš„æ•°æ®è¯»å…¥ å†…å­˜é‡Œï¼Œå…ˆå¿½ç•¥RDBæ–‡ä»¶ã€‚é»˜è®¤ä¸å¯ç”¨æ­¤åŠŸèƒ½ appendfilename \"appendonly.aof\" #æ–‡æœ¬æ–‡ä»¶AOFçš„æ–‡ä»¶åï¼Œå­˜æ”¾åœ¨diræŒ‡ä»¤æŒ‡å®šçš„ç›®å½•ä¸­ appendfsync everysec #aofæŒä¹…åŒ–ç­–ç•¥çš„é…ç½® #noè¡¨ç¤ºç”±æ“ä½œç³»ç»Ÿä¿è¯æ•°æ®åŒæ­¥åˆ°ç£ç›˜,Linuxçš„é»˜è®¤fsyncç­–ç•¥æ˜¯30ç§’ï¼Œæœ€å¤šä¼šä¸¢å¤±30sçš„æ•°æ® #alwaysè¡¨ç¤ºæ¯æ¬¡å†™å…¥éƒ½æ‰§è¡Œfsyncï¼Œä»¥ä¿è¯æ•°æ®åŒæ­¥åˆ°ç£ç›˜,å®‰å…¨æ€§é«˜,æ€§èƒ½è¾ƒå·® #everysecè¡¨ç¤ºæ¯ç§’æ‰§è¡Œä¸€æ¬¡fsyncï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸¢å¤±è¿™1sæ•°æ®,æ­¤ä¸ºé»˜è®¤å€¼,ä¹Ÿç”Ÿäº§å»ºè®®å€¼ #åŒæ—¶åœ¨æ‰§è¡Œbgrewriteaofæ“ä½œå’Œä¸»è¿›ç¨‹å†™aofæ–‡ä»¶çš„æ“ä½œï¼Œä¸¤è€…éƒ½ä¼šæ“ä½œç£ç›˜ï¼Œè€Œbgrewriteaofå¾€å¾€ä¼š æ¶‰åŠå¤§é‡ç£ç›˜æ“ä½œï¼Œè¿™æ ·å°±ä¼šé€ æˆä¸»è¿›ç¨‹åœ¨å†™aofæ–‡ä»¶çš„æ—¶å€™å‡ºç°é˜»å¡çš„æƒ…å½¢,ä»¥ä¸‹å‚æ•°å®ç°æ§åˆ¶ no-appendfsync-on-rewrite no #åœ¨aof rewriteæœŸé—´,æ˜¯å¦å¯¹aofæ–°è®°å½•çš„appendæš‚ç¼“ä½¿ç”¨æ–‡ä»¶åŒæ­¥ ç­–ç•¥,ä¸»è¦è€ƒè™‘ç£ç›˜IOå¼€æ”¯å’Œè¯·æ±‚é˜»å¡æ—¶é—´ã€‚ #é»˜è®¤ä¸ºno,è¡¨ç¤º\"ä¸æš‚ç¼“\",æ–°çš„aofè®°å½•ä»ç„¶ä¼šè¢«ç«‹å³åŒæ­¥åˆ°ç£ç›˜ï¼Œæ˜¯æœ€å®‰å…¨çš„æ–¹å¼ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä½†æ˜¯è¦ å¿å—é˜»å¡çš„é—®é¢˜ #ä¸ºyes,ç›¸å½“äºå°†appendfsyncè®¾ç½®ä¸ºnoï¼Œè¿™è¯´æ˜å¹¶æ²¡æœ‰æ‰§è¡Œç£ç›˜æ“ä½œï¼Œåªæ˜¯å†™å…¥äº†ç¼“å†²åŒºï¼Œå› æ­¤è¿™æ ·å¹¶ä¸ ä¼šé€ æˆé˜»å¡ï¼ˆå› ä¸ºæ²¡æœ‰ç«äº‰ç£ç›˜ï¼‰ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªæ—¶å€™redisæŒ‚æ‰ï¼Œå°±ä¼šä¸¢å¤±æ•°æ®ã€‚ä¸¢å¤±å¤šå°‘æ•°æ®å‘¢ï¼ŸLinux çš„é»˜è®¤fsyncç­–ç•¥æ˜¯30ç§’ï¼Œæœ€å¤šä¼šä¸¢å¤±30sçš„æ•°æ®,ä½†ç”±äºyesæ€§èƒ½è¾ƒå¥½è€Œä¸”ä¼šé¿å…å‡ºç°é˜»å¡å› æ­¤æ¯”è¾ƒæ¨è #rewrite å³å¯¹aofæ–‡ä»¶è¿›è¡Œæ•´ç†,å°†ç©ºé—²ç©ºé—´å›æ”¶,ä»è€Œå¯ä»¥å‡å°‘æ¢å¤æ•°æ®æ—¶é—´ auto-aof-rewrite-percentage 100 #å½“Aof logå¢é•¿è¶…è¿‡æŒ‡å®šç™¾åˆ†æ¯”ä¾‹æ—¶ï¼Œé‡å†™AOFæ–‡ä»¶ï¼Œè®¾ç½®ä¸º0è¡¨ ç¤ºä¸è‡ªåŠ¨é‡å†™Aofæ—¥å¿—ï¼Œé‡å†™æ˜¯ä¸ºäº†ä½¿aofä½“ç§¯ä¿æŒæœ€å°ï¼Œä½†æ˜¯è¿˜å¯ä»¥ç¡®ä¿ä¿å­˜æœ€å®Œæ•´çš„æ•°æ® auto-aof-rewrite-min-size 64mb #è§¦å‘aof rewriteçš„æœ€å°æ–‡ä»¶å¤§å° aof-load-truncated yes #æ˜¯å¦åŠ è½½ç”±äºæŸäº›åŸå› å¯¼è‡´çš„æœ«å°¾å¼‚å¸¸çš„AOFæ–‡ä»¶(ä¸»è¿›ç¨‹è¢«kill/æ–­ç”µç­‰)ï¼Œ å»ºè®®yes aof-use-rdb-preamble no #redis4.0æ–°å¢RDB-AOFæ··åˆæŒä¹…åŒ–æ ¼å¼ï¼Œåœ¨å¼€å¯äº†è¿™ä¸ªåŠŸèƒ½ä¹‹åï¼ŒAOFé‡ å†™äº§ç”Ÿçš„æ–‡ä»¶å°†åŒæ—¶åŒ…å«RDBæ ¼å¼çš„å†…å®¹å’ŒAOFæ ¼å¼çš„å†…å®¹ï¼Œå…¶ä¸­RDBæ ¼å¼çš„å†…å®¹ç”¨äºè®°å½•å·²æœ‰çš„æ•°æ®ï¼Œè€ŒAOF æ ¼å¼çš„å†…å®¹åˆ™ç”¨äºè®°å½•æœ€è¿‘å‘ç”Ÿäº†å˜åŒ–çš„æ•°æ®ï¼Œè¿™æ ·Rediså°±å¯ä»¥åŒæ—¶å…¼æœ‰RDBæŒä¹…åŒ–å’ŒAOFæŒä¹…åŒ–çš„ä¼˜ç‚¹ï¼ˆæ—¢ èƒ½å¤Ÿå¿«é€Ÿåœ°ç”Ÿæˆé‡å†™æ–‡ä»¶ï¼Œä¹Ÿèƒ½å¤Ÿåœ¨å‡ºç°é—®é¢˜æ—¶ï¼Œå¿«é€Ÿåœ°è½½å…¥æ•°æ®ï¼‰,é»˜è®¤ä¸ºno,å³ä¸å¯ç”¨æ­¤åŠŸèƒ½ lua-time-limit 5000 #luaè„šæœ¬çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ cluster-enabled yes #æ˜¯å¦å¼€å¯é›†ç¾¤æ¨¡å¼ï¼Œé»˜è®¤ä¸å¼€å¯,å³å•æœºæ¨¡å¼ cluster-config-file nodes-6379.conf #ç”±nodeèŠ‚ç‚¹è‡ªåŠ¨ç”Ÿæˆçš„é›†ç¾¤é…ç½®æ–‡ä»¶åç§° cluster-node-timeout 15000 #é›†ç¾¤ä¸­nodeèŠ‚ç‚¹è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ms,è¶…è¿‡æ­¤æ—¶é—´ï¼Œä¼šè¸¢å‡ºé›†ç¾¤ cluster-replica-validity-factor 10 #å•ä½ä¸ºæ¬¡,åœ¨æ‰§è¡Œæ•…éšœè½¬ç§»çš„æ—¶å€™å¯èƒ½æœ‰äº›èŠ‚ç‚¹å’Œmasteræ–­ å¼€ä¸€æ®µæ—¶é—´å¯¼è‡´æ•°æ®æ¯”è¾ƒæ—§ï¼Œè¿™äº›èŠ‚ç‚¹å°±ä¸é€‚ç”¨äºé€‰ä¸¾ä¸ºmasterï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´çš„å°±ä¸ä¼šè¢«è¿›è¡Œæ•…éšœè½¬ç§»,ä¸ èƒ½å½“é€‰masterï¼Œè®¡ç®—å…¬å¼ï¼š(node-timeout * replica-validity-factor) + repl-ping- replica-period cluster-migration-barrier 1 #é›†ç¾¤è¿ç§»å±éšœï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹è‡³å°‘æ‹¥æœ‰1ä¸ªæ­£å¸¸å·¥ä½œçš„ä»èŠ‚ç‚¹ï¼Œå³å¦‚æœä¸» èŠ‚ç‚¹çš„slaveèŠ‚ç‚¹æ•…éšœåä¼šå°†å¤šä½™çš„ä»èŠ‚ç‚¹åˆ†é…åˆ°å½“å‰ä¸»èŠ‚ç‚¹æˆä¸ºå…¶æ–°çš„ä»èŠ‚ç‚¹ã€‚ cluster-require-full-coverage yes #é›†ç¾¤è¯·æ±‚æ§½ä½å…¨éƒ¨è¦†ç›–ï¼Œå¦‚æœä¸€ä¸ªä¸»åº“å®•æœºä¸”æ²¡æœ‰å¤‡åº“å°±ä¼šå‡º ç°é›†ç¾¤æ§½ä½ä¸å…¨ï¼Œé‚£ä¹ˆyesæ—¶redisé›†ç¾¤æ§½ä½éªŒè¯ä¸å…¨,å°±ä¸å†å¯¹å¤–æä¾›æœåŠ¡(å¯¹keyèµ‹å€¼æ—¶,ä¼šå‡ºç° CLUSTERDOWN The cluster is downçš„æç¤º,cluster_state:fail,ä½†ping ä»PONG)ï¼Œè€Œnoåˆ™å¯ä»¥ ç»§ç»­ä½¿ç”¨,ä½†æ˜¯ä¼šå‡ºç°æŸ¥è¯¢æ•°æ®æŸ¥ä¸åˆ°çš„æƒ…å†µ(å› ä¸ºæœ‰æ•°æ®ä¸¢å¤±)ã€‚ç”Ÿäº§å»ºè®®ä¸ºno cluster-replica-no-failover no #å¦‚æœä¸ºyes,æ­¤é€‰é¡¹é˜»æ­¢åœ¨ä¸»æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶å°è¯•å¯¹å…¶ä¸»æœåŠ¡å™¨è¿› è¡Œæ•…éšœè½¬ç§»ã€‚ ä½†æ˜¯ï¼Œä¸»æœåŠ¡å™¨ä»ç„¶å¯ä»¥æ‰§è¡Œæ‰‹åŠ¨å¼ºåˆ¶æ•…éšœè½¬ç§»ï¼Œä¸€èˆ¬ä¸ºno #Slow log æ˜¯ Redis ç”¨æ¥è®°å½•è¶…è¿‡æŒ‡å®šæ‰§è¡Œæ—¶é—´çš„æ—¥å¿—ç³»ç»Ÿï¼Œæ‰§è¡Œæ—¶é—´ä¸åŒ…æ‹¬ä¸å®¢æˆ·ç«¯äº¤è°ˆï¼Œå‘é€å›å¤ç­‰ I/Oæ“ä½œï¼Œè€Œæ˜¯å®é™…æ‰§è¡Œå‘½ä»¤æ‰€éœ€çš„æ—¶é—´ï¼ˆåœ¨è¯¥é˜¶æ®µçº¿ç¨‹è¢«é˜»å¡å¹¶ä¸”ä¸èƒ½åŒæ—¶ä¸ºå…¶å®ƒè¯·æ±‚æä¾›æœåŠ¡ï¼‰,ç”±äº slow log ä¿å­˜åœ¨å†…å­˜é‡Œé¢ï¼Œè¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤å¯æ”¾å¿ƒåœ°ä½¿ç”¨ï¼Œä¸å¿…æ‹…å¿ƒå› ä¸ºå¼€å¯ slow log è€Œå½±å“ Redis çš„é€Ÿåº¦ slowlog-log-slower-than 10000 #ä»¥å¾®ç§’ä¸ºå•ä½çš„æ…¢æ—¥å¿—è®°å½•ï¼Œä¸ºè´Ÿæ•°ä¼šç¦ç”¨æ…¢æ—¥å¿—ï¼Œä¸º0ä¼šè®°å½•æ¯ä¸ª å‘½ä»¤æ“ä½œã€‚é»˜è®¤å€¼ä¸º10ms,ä¸€èˆ¬ä¸€æ¡å‘½ä»¤æ‰§è¡Œéƒ½åœ¨å¾®ç§’çº§,ç”Ÿäº§å»ºè®®è®¾ä¸º1ms-10msä¹‹é—´ slowlog-max-len 128 #æœ€å¤šè®°å½•å¤šå°‘æ¡æ…¢æ—¥å¿—çš„ä¿å­˜é˜Ÿåˆ—é•¿åº¦ï¼Œè¾¾åˆ°æ­¤é•¿åº¦åï¼Œè®°å½•æ–°å‘½ä»¤ä¼šå°†æœ€æ—§çš„å‘½ ä»¤ä»å‘½ä»¤é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œä»¥æ­¤æ»šåŠ¨åˆ é™¤,å³,å…ˆè¿›å…ˆå‡º,é˜Ÿåˆ—å›ºå®šé•¿åº¦,é»˜è®¤128,å€¼åå°,ç”Ÿäº§å»ºè®®è®¾ä¸º1000ä»¥ä¸Š Redisçš„é…ç½®æ–‡ä»¶ä»‹ç»\nconfig å‘½ä»¤å®ç°åŠ¨æ€ä¿®æ”¹é…ç½® config å‘½ä»¤ç”¨äºæŸ¥çœ‹å½“å‰redisé…ç½®ã€ä»¥åŠä¸é‡å¯redisæœåŠ¡å®ç°åŠ¨æ€æ›´æ”¹redisé…ç½®ç­‰ æ³¨æ„ï¼šä¸æ˜¯æ‰€æœ‰é…ç½®éƒ½å¯ä»¥åŠ¨æ€ä¿®æ”¹,ä¸”æ­¤æ–¹å¼æ— æ³•æŒä¹…ä¿å­˜\nCONFIG SET parameter value æ—¶é—´å¤æ‚åº¦ï¼šO(1) CONFIG SET å‘½ä»¤å¯ä»¥åŠ¨æ€åœ°è°ƒæ•´ Redis æœåŠ¡å™¨çš„é…ç½®(configuration)è€Œæ— é¡»é‡å¯ã€‚ å¯ä»¥ä½¿ç”¨å®ƒä¿®æ”¹é…ç½®å‚æ•°ï¼Œæˆ–è€…æ”¹å˜ Redis çš„æŒä¹…åŒ–(Persistence)æ–¹å¼ã€‚ CONFIG SET å¯ä»¥ä¿®æ”¹çš„é…ç½®å‚æ•°å¯ä»¥ä½¿ç”¨å‘½ä»¤ CONFIG GET * æ¥åˆ—å‡ºï¼Œæ‰€æœ‰è¢« CONFIG SET ä¿®æ”¹çš„é… ç½®å‚æ•°éƒ½ä¼šç«‹å³ç”Ÿæ•ˆã€‚ CONFIG GET parameter æ—¶é—´å¤æ‚åº¦ï¼š O(N)ï¼Œå…¶ä¸­ N ä¸ºå‘½ä»¤è¿”å›çš„é…ç½®é€‰é¡¹æ•°é‡ã€‚ CONFIG GET å‘½ä»¤ç”¨äºå–å¾—è¿è¡Œä¸­çš„ Redis æœåŠ¡å™¨çš„é…ç½®å‚æ•°(configuration parameters)ï¼Œåœ¨ Redis 2.4 ç‰ˆæœ¬ä¸­ï¼Œ æœ‰éƒ¨åˆ†å‚æ•°æ²¡æœ‰åŠæ³•ç”¨ CONFIG GET è®¿é—®ï¼Œä½†æ˜¯åœ¨æœ€æ–°çš„ Redis 2.6 ç‰ˆæœ¬ä¸­ï¼Œæ‰€ æœ‰é…ç½®å‚æ•°éƒ½å·²ç»å¯ä»¥ç”¨ CONFIG GET è®¿é—®äº†ã€‚ CONFIG GET æ¥å—å•ä¸ªå‚æ•° parameter ä½œä¸ºæœç´¢å…³é”®å­—ï¼ŒæŸ¥æ‰¾æ‰€æœ‰åŒ¹é…çš„é…ç½®å‚æ•°ï¼Œå…¶ä¸­å‚æ•°å’Œå€¼ä»¥â€œé”®- å€¼å¯¹â€(key-value pairs)çš„æ–¹å¼æ’åˆ—ã€‚ æ¯”å¦‚æ‰§è¡Œ CONFIG GET s* å‘½ä»¤ï¼ŒæœåŠ¡å™¨å°±ä¼šè¿”å›æ‰€æœ‰ä»¥ s å¼€å¤´çš„é…ç½®å‚æ•°åŠå‚æ•°çš„å€¼ï¼š è®¾ç½®å®¢æˆ·ç«¯è¿æ¥å¯†ç  #è®¾ç½®è¿æ¥å¯†ç  127.0.0.1:6379\u003e CONFIG SET requirepass 123456 OK #æŸ¥çœ‹è¿æ¥å¯†ç  127.0.0.1:6379\u003e CONFIG GET requirepass 1) \"requirepass\" 2) \"123456\" è·å–å½“å‰é…ç½® #å¥‡æ•°è¡Œä¸ºé”®ï¼Œå¶æ•°è¡Œä¸ºå€¼ 127.0.0.1:6379\u003e CONFIG GET * 1) \"dbfilename\" 2) \"dump.rdb\" 3) \"requirepass\" 4) \"\" 5) \"masterauth\" 6) \"\" 7) \"cluster-announce-ip\" 8) \"\" 9) \"unixsocket\" 10) \"\" 11) \"logfile\" 12) \"/var/log/redis/redis.log\" 13) \"pidfile\" 14) \"/var/run/redis_6379.pid\" 15) \"slave-announce-ip\" 16) \"\" 17) \"replica-announce-ip\" 18) \"\" 19) \"maxmemory\" 20) \"0\" ...... #æŸ¥çœ‹bind 127.0.0.1:6379\u003e CONFIG GET bind 1) \"bind\" 2) \"0.0.0.0\" #Redis5.0æœ‰äº›è®¾ç½®æ— æ³•ä¿®æ”¹,Redis6.2.6ç‰ˆæœ¬æ”¯æŒä¿®æ”¹bind 127.0.0.1:6379\u003e CONFIG SET bind 127.0.0.1 (error) ERR Unsupported CONFIG parameter: bind è®¾ç½®Redisä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡ 127.0.0.1:6379\u003e CONFIG SET maxmemory 8589934592 OK 127.0.0.1:6379\u003e CONFIG GET maxmemory 1) \"maxmemory\" 2) \"8589934592\" æ…¢æŸ¥è¯¢ èŒƒä¾‹ï¼šSLOW LOG\nvim /etc/redis.conf slowlog-log-slower-than 1 #æŒ‡å®šè¶…è¿‡1uså³ä¸ºæ…¢çš„æŒ‡ä»¤ï¼Œé»˜è®¤å€¼ä¸º10000us slowlog-max-len 1024 #æŒ‡å®šåªä¿å­˜æœ€è¿‘çš„1024æ¡æ…¢è®°å½•ï¼Œé»˜è®¤å€¼ä¸º128 127.0.0.1:6379\u003e SLOWLOG LEN #æŸ¥çœ‹æ…¢æ—¥å¿—çš„è®°å½•æ¡æ•° (integer) 14 127.0.0.1:6379\u003e SLOWLOG GET [n] #æŸ¥çœ‹æ…¢æ—¥å¿—çš„næ¡è®°å½• 1) 1) (integer) 14 2) (integer) 1544690617 3) (integer) 4 #ç¬¬3)è¡Œè¡¨ç¤ºæ¯æ¡æŒ‡ä»¤çš„æ‰§è¡Œæ—¶é•¿ 4) 1) \"slowlog\" 127.0.0.1:6379\u003e SLOWLOG GET 3 1) 1) (integer) 7 2) (integer) 1602901545 3) (integer) 26 4) 1) \"SLOWLOG\" 2) \"get\" 5) \"127.0.0.1:38258\" 6) \"\" 2) 1) (integer) 6 2) (integer) 1602901540 3) (integer) 22 4) 1) \"SLOWLOG\" 2) \"get\" 3) \"2\" 5) \"127.0.0.1:38258\" 6) \"\" 3) 1) (integer) 5 2) (integer) 1602901497 3) (integer) 22 4) 1) \"SLOWLOG\" 2) \"GET\" 5) \"127.0.0.1:38258\" 6) \"\" 127.0.0.1:6379\u003e SLOWLOG RESET #æ¸…ç©ºæ…¢æ—¥å¿— OK RedisæŒä¹…åŒ– RDB RDB å·¥ä½œåŸç†\né…ç½® AOF ",
  "wordCount" : "8920",
  "inLanguage": "en",
  "image":"https://xyenvy.github.io/posts.images/banner/29.jpg","datePublished": "2022-12-07T21:16:33Z",
  "dateModified": "2022-12-07T21:16:33Z",
  "author":[{
    "@type": "Person",
    "name": ""
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://xyenvy.github.io/posts/redis%E9%83%A8%E7%BD%B2%E5%92%8C%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "DevOpsHub",
    "logo": {
      "@type": "ImageObject",
      "url": "https://xyenvy.github.io/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://xyenvy.github.io/" accesskey="h" title="DevOpsHub (Alt + H)">
            <img src="https://xyenvy.github.io/img/Q.gif" alt="logo" aria-label="logo"
                 height="35">DevOpsHub</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://xyenvy.github.io/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                <span>ğŸ” æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/" title="ğŸ  ä¸»é¡µ">
                <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/posts" title="ğŸ“š æ–‡ç« ">
                <span>ğŸ“š æ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/tags" title="ğŸ§© æ ‡ç­¾">
                <span>ğŸ§© æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/archives/" title="â±ï¸ æ—¶é—´è½´">
                <span>â±ï¸ æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://xyenvy.github.io/about" title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº">
                <span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://xyenvy.github.io/">ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="https://xyenvy.github.io/posts/">ğŸ“šæ–‡ç« </a></div>
            <h1 class="post-title">
                Rediséƒ¨ç½²å’ŒåŸºç¡€ä½¿ç”¨
            </h1>
            <div class="post-description">
                Redis (Remote Dictionary Serverè¿œç¨‹å­—å…¸æœåŠ¡)æ˜¯ä¸€ä¸ªéµå¾ªBSD MITå¼€æºåè®®çš„é«˜æ€§èƒ½çš„NoSQL
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2022-12-07
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>8920å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>18åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://xyenvy.github.io/tags/redis/" style="color: var(--secondary)!important;">Redis</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "https://xyenvy.github.io/"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="https://xyenvy.github.io/posts.images/banner/29.jpg" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">æ–‡ç« ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#redis%e5%9f%ba%e7%a1%80" aria-label="RedisåŸºç¡€">RedisåŸºç¡€</a></li>
                <li>
                    <a href="#%e7%ae%80%e4%bb%8b" aria-label="ç®€ä»‹">ç®€ä»‹</a></li>
                <li>
                    <a href="#%e7%89%b9%e6%80%a7" aria-label="ç‰¹æ€§">ç‰¹æ€§</a></li>
                <li>
                    <a href="#%e5%8d%95%e7%ba%bf%e7%a8%8b" aria-label="å•çº¿ç¨‹">å•çº¿ç¨‹</a></li>
                <li>
                    <a href="#%e5%b8%b8%e8%a7%81%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af" aria-label="å¸¸è§åº”ç”¨åœºæ™¯">å¸¸è§åº”ç”¨åœºæ™¯</a></li>
                <li>
                    <a href="#%e7%bc%93%e5%ad%98%e7%9a%84%e5%ae%9e%e7%8e%b0%e6%b5%81%e7%a8%8b" aria-label="ç¼“å­˜çš„å®ç°æµç¨‹">ç¼“å­˜çš„å®ç°æµç¨‹</a></li>
                <li>
                    <a href="#redis%e5%ae%89%e8%a3%85%e5%8f%8a%e8%bf%9e%e6%8e%a5" aria-label="Rediså®‰è£…åŠè¿æ¥">Rediså®‰è£…åŠè¿æ¥</a></li>
                <li>
                    <a href="#yum%e5%ae%89%e8%a3%85" aria-label="yumå®‰è£…">yumå®‰è£…</a></li>
                <li>
                    <a href="#%e7%bc%96%e8%af%91%e5%ae%89%e8%a3%85" aria-label="ç¼–è¯‘å®‰è£…">ç¼–è¯‘å®‰è£…</a></li>
                <li>
                    <a href="#redis%e5%a4%9a%e5%ae%9e%e4%be%8b" aria-label="Rediså¤šå®ä¾‹">Rediså¤šå®ä¾‹</a></li>
                <li>
                    <a href="#redis-%e9%85%8d%e7%bd%ae%e7%ae%a1%e7%90%86" aria-label="Redis é…ç½®ç®¡ç†">Redis é…ç½®ç®¡ç†</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e8%af%b4%e6%98%8e" aria-label="é…ç½®æ–‡ä»¶è¯´æ˜">é…ç½®æ–‡ä»¶è¯´æ˜</a></li>
                <li>
                    <a href="#config-%e5%91%bd%e4%bb%a4%e5%ae%9e%e7%8e%b0%e5%8a%a8%e6%80%81%e4%bf%ae%e6%94%b9%e9%85%8d%e7%bd%ae" aria-label="config å‘½ä»¤å®ç°åŠ¨æ€ä¿®æ”¹é…ç½®">config å‘½ä»¤å®ç°åŠ¨æ€ä¿®æ”¹é…ç½®</a><ul>
                        
                <li>
                    <a href="#%e8%ae%be%e7%bd%ae%e5%ae%a2%e6%88%b7%e7%ab%af%e8%bf%9e%e6%8e%a5%e5%af%86%e7%a0%81" aria-label="è®¾ç½®å®¢æˆ·ç«¯è¿æ¥å¯†ç ">è®¾ç½®å®¢æˆ·ç«¯è¿æ¥å¯†ç </a></li>
                <li>
                    <a href="#%e8%8e%b7%e5%8f%96%e5%bd%93%e5%89%8d%e9%85%8d%e7%bd%ae" aria-label="è·å–å½“å‰é…ç½®">è·å–å½“å‰é…ç½®</a></li>
                <li>
                    <a href="#%e8%ae%be%e7%bd%aeredis%e4%bd%bf%e7%94%a8%e7%9a%84%e6%9c%80%e5%a4%a7%e5%86%85%e5%ad%98%e9%87%8f" aria-label="è®¾ç½®Redisä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡">è®¾ç½®Redisä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡</a></li>
                <li>
                    <a href="#%e6%85%a2%e6%9f%a5%e8%af%a2" aria-label="æ…¢æŸ¥è¯¢">æ…¢æŸ¥è¯¢</a></li>
                <li>
                    <a href="#redis%e6%8c%81%e4%b9%85%e5%8c%96" aria-label="RedisæŒä¹…åŒ–">RedisæŒä¹…åŒ–</a><ul>
                        
                <li>
                    <a href="#rdb" aria-label="RDB">RDB</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae" aria-label="é…ç½®">é…ç½®</a></li>
                <li>
                    <a href="#aof" aria-label="AOF">AOF</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h2 id="redisåŸºç¡€">RedisåŸºç¡€<a hidden class="anchor" aria-hidden="true" href="#redisåŸºç¡€">#</a></h2>
<h2 id="ç®€ä»‹">ç®€ä»‹<a hidden class="anchor" aria-hidden="true" href="#ç®€ä»‹">#</a></h2>
<p>Redis (Remote Dictionary Serverè¿œç¨‹å­—å…¸æœåŠ¡)æ˜¯ä¸€ä¸ªéµå¾ªBSD MITå¼€æºåè®®çš„é«˜æ€§èƒ½çš„NoSQL.RedisåŸºäºANSI Cè¯­è¨€è¯­è¨€)ç¼–å†™çš„key-valueæ•°æ®åº“,æ˜¯æ„å¤§åˆ©çš„Salvatore Sanfilippoåœ¨2009å¹´å‘å¸ƒï¼Œä»2010å¹´3æœˆ15æ—¥èµ·ï¼ŒRedisçš„å¼€å‘å·¥ä½œç”±VMwareä¸»æŒã€‚ä»2013å¹´5æœˆå¼€å§‹ï¼ŒRedisçš„å¼€å‘ç”±Pivotalå…¬å¸èµåŠ©ã€‚ç›®å‰å›½å†…å¤–ä½¿ç”¨çš„å…¬å¸ä¼—å¤š,æ¯”å¦‚:é˜¿é‡Œ,è…¾è®¯,ç™¾åº¦,äº¬ä¸œ,æ–°æµªå¾®åš,GitHub,Twitter ç­‰Redisçš„å‡ºç°ï¼Œå¾ˆå¤§ç¨‹åº¦è¡¥å¿äº†memcachedè¿™ç±»key/valueå­˜å‚¨çš„ä¸è¶³ï¼Œåœ¨éƒ¨åˆ†åœºåˆå¯ä»¥å¯¹å…³ç³»æ•°æ®åº“èµ·åˆ°å¾ˆå¥½çš„è¡¥å……ä½œç”¨ã€‚å®ƒæä¾›äº†Javaï¼ŒC/C++ï¼ŒGo, C#ï¼ŒPHPï¼ŒJavaScriptï¼ŒPerlï¼ŒObject-Cï¼ŒPythonï¼ŒRubyï¼ŒErlangç­‰å®¢æˆ·ç«¯
DB-Engineæœˆåº¦æ’è¡Œæ¦œRedisåœ¨é”®å€¼å‹å­˜å‚¨ç±»çš„æ•°æ®åº“é•¿æœŸå±…äºé¦–ä½,è¿œè¿œé«˜äºç¬¬äºŒä½çš„memcached</p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§<a hidden class="anchor" aria-hidden="true" href="#ç‰¹æ€§">#</a></h2>
<ul>
<li>é€Ÿåº¦å¿«: 10W QPS,åŸºäºå†…å­˜,Cè¯­è¨€å®ç°</li>
<li>å•çº¿ç¨‹</li>
<li>æŒä¹…åŒ–</li>
<li>æ”¯æŒå¤šç§æ•°æ®ç»“æ„</li>
<li>æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€</li>
<li>åŠŸèƒ½ä¸°å¯Œ: æ”¯æŒLuaè„šæœ¬,å‘å¸ƒè®¢é˜…,äº‹åŠ¡,pipelineç­‰åŠŸèƒ½</li>
<li>ç®€å•: ä»£ç çŸ­å°ç²¾æ‚(å•æœºæ ¸å¿ƒä»£ç åªæœ‰23000è¡Œå·¦å³),å•çº¿ç¨‹å¼€å‘å®¹æ˜“,ä¸ä¾èµ–å¤–éƒ¨åº“,ä½¿ç”¨ç®€å•</li>
<li>ä¸»ä»å¤åˆ¶</li>
<li>æ”¯æŒé«˜å¯ç”¨å’Œåˆ†å¸ƒå¼</li>
</ul>
<h2 id="å•çº¿ç¨‹">å•çº¿ç¨‹<a hidden class="anchor" aria-hidden="true" href="#å•çº¿ç¨‹">#</a></h2>
<p>Redis 6.0ç‰ˆæœ¬å‰ä¸€ç›´æ˜¯å•çº¿ç¨‹æ–¹å¼å¤„ç†ç”¨æˆ·çš„è¯·æ±‚</p>
<p><img loading="lazy" src="/posts.images/image.assets/1670419301827.png" alt="1670419301827"  />
</p>
<p>å•çº¿ç¨‹ä¸ºä½•å¦‚æ­¤å¿«?</p>
<ul>
<li>çº¯å†…å­˜</li>
<li>éé˜»å¡é¿å…çº¿ç¨‹åˆ‡æ¢å’Œç«æ€æ¶ˆè€—</li>
</ul>
<p><img loading="lazy" src="/posts.images/image.assets/1670419331717.png" alt="1670419331717"  />
</p>
<p>æ³¨æ„äº‹é¡¹</p>
<ul>
<li>ä¸€æ¬¡åªè¿è¡Œä¸€æ¡å‘½ä»¤</li>
<li>é¿å…æ‰§è¡Œé•¿(æ…¢)å‘½ä»¤:keys *, flushall, flushdb, slow lua script, mutil/exec, operate bigvalue(collection)</li>
<li>å…¶å®ä¸æ˜¯å•çº¿ç¨‹: æ—©æœŸç‰ˆæœ¬æ˜¯å•è¿›ç¨‹å•çº¿ç¨‹,3.0 ç‰ˆæœ¬åå®é™…è¿˜æœ‰å…¶å®ƒçš„çº¿ç¨‹, å®ç°ç‰¹å®šåŠŸèƒ½,å¦‚: fysnc file descriptor,close file descriptor</li>
</ul>
<h2 id="å¸¸è§åº”ç”¨åœºæ™¯">å¸¸è§åº”ç”¨åœºæ™¯<a hidden class="anchor" aria-hidden="true" href="#å¸¸è§åº”ç”¨åœºæ™¯">#</a></h2>
<ul>
<li>ç¼“å­˜ï¼šç¼“å­˜RDBMSä¸­æ•°æ®,æ¯”å¦‚ç½‘ç«™çš„æŸ¥è¯¢ç»“æœã€å•†å“ä¿¡æ¯ã€å¾®åšã€æ–°é—»ã€æ¶ˆæ¯</li>
<li>Session å…±äº«ï¼šå®ç°Webé›†ç¾¤ä¸­çš„å¤šæœåŠ¡å™¨é—´çš„sessionå…±äº«</li>
<li>è®¡æ•°å™¨ï¼šå•†å“è®¿é—®æ’è¡Œæ¦œã€æµè§ˆæ•°ã€ç²‰ä¸æ•°ã€å…³æ³¨ã€ç‚¹èµã€è¯„è®ºç­‰å’Œæ¬¡æ•°ç›¸å…³çš„æ•°å€¼ç»Ÿè®¡åœºæ™¯</li>
<li>ç¤¾äº¤ï¼šæœ‹å‹åœˆã€å…±åŒå¥½å‹ã€å¯èƒ½è®¤è¯†ä»–ä»¬ç­‰</li>
<li>åœ°ç†ä½ç½®: åŸºäºåœ°ç†ä¿¡æ¯ç³»ç»ŸGISï¼ˆGeographic Information System)å®ç°æ‘‡ä¸€æ‘‡ã€é™„è¿‘çš„äººã€å¤–å–ç­‰åŠŸèƒ½</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šELKç­‰æ—¥å¿—ç³»ç»Ÿç¼“å­˜ã€ä¸šåŠ¡çš„è®¢é˜…/å‘å¸ƒç³»ç»Ÿ</li>
</ul>
<h2 id="ç¼“å­˜çš„å®ç°æµç¨‹">ç¼“å­˜çš„å®ç°æµç¨‹<a hidden class="anchor" aria-hidden="true" href="#ç¼“å­˜çš„å®ç°æµç¨‹">#</a></h2>
<p>æ•°æ®æ›´æ–°æ“ä½œæµç¨‹ï¼š</p>
<p><img loading="lazy" src="/posts.images/image.assets/1670419470181.png" alt="1670419470181"  />
</p>
<p>æ•°æ®è¯»æ“ä½œæµç¨‹ï¼š</p>
<p><img loading="lazy" src="/posts.images/image.assets/1670419490780.png" alt="1670419490780"  />
</p>
<h2 id="rediså®‰è£…åŠè¿æ¥">Rediså®‰è£…åŠè¿æ¥<a hidden class="anchor" aria-hidden="true" href="#rediså®‰è£…åŠè¿æ¥">#</a></h2>
<p>å®˜ç½‘ä¸‹è½½åœ°å€</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>http://download.redis.io/releases/
</span></span></code></pre></div><h2 id="yumå®‰è£…">yumå®‰è£…<a hidden class="anchor" aria-hidden="true" href="#yumå®‰è£…">#</a></h2>
<p>æŸ¥çœ‹yumåº“redisç‰ˆæœ¬</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>yum info redis   æˆ–è€…  yum info redis
</span></span></code></pre></div><p>yum å®‰è£… redis</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>yum install -y redis
</span></span><span style="display:flex;"><span># å¯åŠ¨
</span></span><span style="display:flex;"><span>systemctl enable --now redis
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># è¿æ¥
</span></span><span style="display:flex;"><span>[root@centos8-backup www]# redis-cli
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># æŸ¥çœ‹ä¿¡æ¯
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; info
</span></span><span style="display:flex;"><span># Server
</span></span><span style="display:flex;"><span>redis_version:5.0.3
</span></span><span style="display:flex;"><span>redis_git_sha1:00000000
</span></span><span style="display:flex;"><span>redis_git_dirty:0
</span></span><span style="display:flex;"><span>redis_build_id:9529b692c0384fb7
</span></span><span style="display:flex;"><span>redis_mode:standalone
</span></span><span style="display:flex;"><span>os:Linux 4.18.0-348.7.1.el8_5.x86_64 x86_64
</span></span><span style="display:flex;"><span>arch_bits:64
</span></span><span style="display:flex;"><span>multiplexing_api:epoll
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>......
</span></span></code></pre></div><h2 id="ç¼–è¯‘å®‰è£…">ç¼–è¯‘å®‰è£…<a hidden class="anchor" aria-hidden="true" href="#ç¼–è¯‘å®‰è£…">#</a></h2>
<ul>
<li>Redisæºç åŒ…ä¸‹è½½åœ°å€</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>http://download.redis.io/releases/
</span></span></code></pre></div><ul>
<li>ä¸‹è½½æºç åŒ…</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7-master ~]# wget http://download.redis.io/releases/redis-6.2.6.tar.gz
</span></span><span style="display:flex;"><span>[root@centos7-master ~]# tar xf redis-6.2.6.tar.gz
</span></span></code></pre></div><ul>
<li>å®‰è£…ä¾èµ–</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># centos
</span></span><span style="display:flex;"><span>[root@centos7-master ~]# yum -y install gcc jemalloc-devel systemd-devel
</span></span><span style="display:flex;"><span># ubuntu
</span></span><span style="display:flex;"><span>apt -y install make gcc libjemalloc-dev libsystemd-dev
</span></span></code></pre></div><ul>
<li>ç¼–è¯‘å®‰è£…</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7-master ~]# cd redis-6.2.6
</span></span><span style="display:flex;"><span>#å¦‚æœæ”¯æŒsystemd,éœ€è¦æ‰§è¡Œä¸‹é¢
</span></span><span style="display:flex;"><span>[root@centos7-master redis-6.2.6]# make -j 2 USE_SYSTEMD=yes PREFIX=/usr/local/src/redis  install
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># é…ç½®ç¯å¢ƒå˜é‡
</span></span><span style="display:flex;"><span>[root@centos7-master ~]# echo &#39;PATH=/usr/local/src/redis/bin:$PATH&#39; &gt; /etc/profile.d/redis.sh
</span></span><span style="display:flex;"><span>[root@centos7-master ~]# 
</span></span><span style="display:flex;"><span>[root@centos7-master ~]# . /etc/profile.d/redis.sh
</span></span><span style="display:flex;"><span>[root@centos7-master ~]# 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#å‡†å¤‡ç›¸å…³ç›®å½•å’Œé…ç½®æ–‡ä»¶
</span></span><span style="display:flex;"><span>#åˆ›å»ºé…ç½®æ–‡ä»¶ã€æ—¥å¿—ã€æ•°æ®ç­‰ç›®å½•
</span></span><span style="display:flex;"><span>[root@centos7-master redis]# mkdir /usr/local/src/redis/{etc,log,data,run}
</span></span><span style="display:flex;"><span>[root@centos7-master redis-6.2.6]# cp redis.conf /usr/local/src/redis/etc/
</span></span></code></pre></div><ul>
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶</li>
</ul>
<p>logfile  &ldquo;/usr/local/src/redis/log/redis_6379.log&rdquo;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># Specify the log file name. Also the empty string can be used to force
</span></span><span style="display:flex;"><span># Redis to log on the standard output. Note that if you use standard
</span></span><span style="display:flex;"><span># output for logging but daemonize, logs will be sent to /dev/null
</span></span><span style="display:flex;"><span>logfile &#34;/usr/local/src/redis/log/redis_6379.log&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># To enable logging to the system logger, just set &#39;syslog-enabled&#39; to yes,
</span></span><span style="display:flex;"><span># and optionally update the other syslog parameters to suit your needs.
</span></span><span style="display:flex;"><span># syslog-enabled no
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Specify the syslog identity.
</span></span><span style="display:flex;"><span># syslog-ident redis
</span></span></code></pre></div><p>pidfile /usr/local/src/redis/run/redis_6379.pid</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># Note that on modern Linux systems &#34;/run/redis.pid&#34; is more conforming
</span></span><span style="display:flex;"><span># and should be used instead.
</span></span><span style="display:flex;"><span>#pidfile /var/run/redis_6379.pid
</span></span><span style="display:flex;"><span>pidfile /usr/local/src/redis/run/redis_6379.pid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Specify the server verbosity level.
</span></span><span style="display:flex;"><span># This can be one of:
</span></span><span style="display:flex;"><span># debug (a lot of information, useful for development/testing)
</span></span><span style="display:flex;"><span># verbose (many rarely useful info, but not a mess like the debug level)
</span></span><span style="display:flex;"><span># notice (moderately verbose, what you want in production probably)
</span></span><span style="display:flex;"><span># warning (only very important / critical messages are logged)
</span></span><span style="display:flex;"><span>loglevel notice
</span></span></code></pre></div><p>dir &ldquo;/usr/local/src/redis/data/6379&rdquo;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># Note that you must specify a directory here, not a file name.
</span></span><span style="display:flex;"><span>dir &#34;/usr/local/src/redis/data/6379&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>################################# REPLICATION #################################
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># Master-Replica replication. Use replicaof to make a Redis instance a copy of
</span></span><span style="display:flex;"><span># another Redis server. A few things to understand ASAP about Redis replication.
</span></span></code></pre></div><p>dbfilename &lsquo;dump.rdb&rsquo;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># sanitize-dump-payload no
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># The filename where to dump the DB
</span></span><span style="display:flex;"><span>dbfilename &#39;dump.rdb&#39;
</span></span></code></pre></div><ul>
<li>å‰å°å¯åŠ¨redis</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7-master ~]# redis-server /usr/local/src/redis/etc/redis.conf 
</span></span><span style="display:flex;"><span>51487:C 07 Dec 2022 22:27:26.620 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
</span></span><span style="display:flex;"><span>51487:C 07 Dec 2022 22:27:26.620 # Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=51487, just started
</span></span><span style="display:flex;"><span>51487:C 07 Dec 2022 22:27:26.620 # Configuration loaded
</span></span><span style="display:flex;"><span>51487:M 07 Dec 2022 22:27:26.620 * Increased maximum number of open files to 10032 (it was originally set to 1024).
</span></span><span style="display:flex;"><span>51487:M 07 Dec 2022 22:27:26.620 * monotonic clock: POSIX clock_gettime
</span></span><span style="display:flex;"><span>                _._                                                  
</span></span><span style="display:flex;"><span>           _.-``__ &#39;&#39;-._                                             
</span></span><span style="display:flex;"><span>      _.-``    `.  `_.  &#39;&#39;-._           Redis 6.2.6 (00000000/0) 64 bit
</span></span><span style="display:flex;"><span>  .-`` .-```.  ```\/    _.,_ &#39;&#39;-._                                  
</span></span><span style="display:flex;"><span> (    &#39;      ,       .-`  | `,    )     Running in standalone mode
</span></span><span style="display:flex;"><span> |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 6379
</span></span><span style="display:flex;"><span> |    `-._   `._    /     _.-&#39;    |     PID: 51487
</span></span><span style="display:flex;"><span>  `-._    `-._  `-./  _.-&#39;    _.-&#39;                                   
</span></span><span style="display:flex;"><span> |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
</span></span><span style="display:flex;"><span> |    `-._`-._        _.-&#39;_.-&#39;    |           https://redis.io       
</span></span><span style="display:flex;"><span>  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
</span></span><span style="display:flex;"><span> |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
</span></span><span style="display:flex;"><span> |    `-._`-._        _.-&#39;_.-&#39;    |                                  
</span></span><span style="display:flex;"><span>  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
</span></span><span style="display:flex;"><span>      `-._    `-.__.-&#39;    _.-&#39;                                       
</span></span><span style="display:flex;"><span>          `-._        _.-&#39;                                           
</span></span><span style="display:flex;"><span>              `-.__.-&#39;                                               
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>51487:M 07 Dec 2022 22:27:26.621 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.
</span></span><span style="display:flex;"><span>51487:M 07 Dec 2022 22:27:26.621 # Server initialized
</span></span><span style="display:flex;"><span>51487:M 07 Dec 2022 22:27:26.621 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.
</span></span><span style="display:flex;"><span>51487:M 07 Dec 2022 22:27:26.621 * Ready to accept connections
</span></span></code></pre></div><ul>
<li>å¸®åŠ©</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7-master ~]# redis-server -h
</span></span><span style="display:flex;"><span>Usage: ./redis-server [/path/to/redis.conf] [options] [-]
</span></span><span style="display:flex;"><span>       ./redis-server - (read config from stdin)
</span></span><span style="display:flex;"><span>       ./redis-server -v or --version
</span></span><span style="display:flex;"><span>       ./redis-server -h or --help
</span></span><span style="display:flex;"><span>       ./redis-server --test-memory &lt;megabytes&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Examples:
</span></span><span style="display:flex;"><span>       ./redis-server (run the server with default conf)
</span></span><span style="display:flex;"><span>       ./redis-server /etc/redis/6379.conf
</span></span><span style="display:flex;"><span>       ./redis-server --port 7777
</span></span><span style="display:flex;"><span>       ./redis-server --port 7777 --replicaof 127.0.0.1 8888
</span></span><span style="display:flex;"><span>       ./redis-server /etc/myredis.conf --loglevel verbose -
</span></span><span style="display:flex;"><span>       ./redis-server /etc/myredis.conf --loglevel verbose
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Sentinel mode:
</span></span><span style="display:flex;"><span>       ./redis-server /etc/sentinel.conf --sentinel
</span></span><span style="display:flex;"><span>[root@centos7-master ~]# 
</span></span></code></pre></div><ul>
<li>æ¶ˆé™¤å¯åŠ¨æ—¶çš„ä¸‰ä¸ªWarningæç¤ºä¿¡æ¯(å¯é€‰)</li>
</ul>
<p>Tcp backlog</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>WARNING: The TCP backlog setting of 511 cannot be enforced because
</span></span><span style="display:flex;"><span>/proc/sys/net/core/somaxconn is set to the lower value of 128.
</span></span></code></pre></div><p>Tcp backlog æ˜¯æŒ‡TCPçš„ç¬¬ä¸‰æ¬¡æ¡æ‰‹æœåŠ¡å™¨ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ ackç¡®è®¤å·ä¹‹ååˆ°æœåŠ¡å™¨ç”¨Acceptå‡½æ•°å¤„ç†è¯·æ±‚å‰çš„é˜Ÿåˆ—é•¿åº¦ï¼Œå³å…¨è¿æ¥é˜Ÿåˆ—</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#vim /etc/sysctl.conf
</span></span><span style="display:flex;"><span>net.core.somaxconn = 511
</span></span><span style="display:flex;"><span>#sysctl -p
</span></span></code></pre></div><p>overcommit_memory</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>WARNING overcommit_memory is set to 0! Background save may fail under low memory
</span></span><span style="display:flex;"><span>condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf
</span></span><span style="display:flex;"><span>and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to
</span></span><span style="display:flex;"><span>take effect.
</span></span></code></pre></div><p>å†…æ ¸å‚æ•°è¯´æ˜</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>å†…æ ¸å‚æ•°overcommit_memory å®ç°å†…å­˜åˆ†é…ç­–ç•¥,å¯é€‰å€¼æœ‰ä¸‰ä¸ªï¼š0ã€1ã€2
</span></span><span style="display:flex;"><span>0 è¡¨ç¤ºå†…æ ¸å°†æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ä¾›åº”ç”¨è¿›ç¨‹ä½¿ç”¨ï¼›å¦‚æœæœ‰è¶³å¤Ÿçš„å¯ç”¨å†…å­˜ï¼Œå†…å­˜ç”³è¯·å…è®¸ï¼›å¦åˆ™å†…å­˜
</span></span><span style="display:flex;"><span>ç”³è¯·å¤±è´¥ï¼Œå¹¶æŠŠé”™è¯¯è¿”å›ç»™åº”ç”¨è¿›ç¨‹
</span></span><span style="display:flex;"><span>1 è¡¨ç¤ºå†…æ ¸å…è®¸åˆ†é…æ‰€æœ‰çš„ç‰©ç†å†…å­˜ï¼Œè€Œä¸ç®¡å½“å‰çš„å†…å­˜çŠ¶æ€å¦‚ä½•
</span></span><span style="display:flex;"><span>2 è¡¨ç¤ºå†…æ ¸å…è®¸åˆ†é…è¶…è¿‡æ‰€æœ‰ç‰©ç†å†…å­˜å’Œäº¤æ¢ç©ºé—´æ€»å’Œçš„å†…å­˜
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#vim /etc/sysctl.conf
</span></span><span style="display:flex;"><span>vm.overcommit_memory = 1
</span></span><span style="display:flex;"><span>#sysctl -p
</span></span></code></pre></div><p>transparent hugepage</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>WARNING you have Transparent Huge Pages (THP) support enabled in your kernel.
</span></span><span style="display:flex;"><span>This will create latency and memory usage issues with Redis. To fix this issue
</span></span><span style="display:flex;"><span>run the command &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as
</span></span><span style="display:flex;"><span>root, and add it to your /etc/rc.local in order to retain the setting after a
</span></span><span style="display:flex;"><span>reboot. Redis must be restarted after THP is disabled.
</span></span><span style="display:flex;"><span>è­¦å‘Šï¼šæ‚¨åœ¨å†…æ ¸ä¸­å¯ç”¨äº†é€æ˜å¤§é¡µé¢ï¼ˆTHP,ä¸åŒäºä¸€èˆ¬4kå†…å­˜é¡µ,è€Œä¸º2Mï¼‰æ”¯æŒã€‚ è¿™å°†åœ¨Redisä¸­é€ æˆå»¶è¿Ÿ
</span></span><span style="display:flex;"><span>å’Œå†…å­˜ä½¿ç”¨é—®é¢˜ã€‚ è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·ä»¥root ç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤â€œecho never&gt;
</span></span><span style="display:flex;"><span>/sys/kernel/mm/transparent_hugepage/enabledâ€ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æ‚¨çš„/etc/rc.localä¸­ï¼Œä»¥ä¾¿åœ¨
</span></span><span style="display:flex;"><span>é‡å¯åä¿ç•™è®¾ç½®ã€‚ç¦ç”¨THPåï¼Œå¿…é¡»é‡æ–°å¯åŠ¨Redisã€‚
</span></span></code></pre></div><p>æ³¨æ„ï¼šubuntu20.04, Rocky8/CentOS8 é»˜è®¤ä¸º neverï¼Œæ‰€ä»¥æ­¤å€¼æ— éœ€ä¼˜åŒ–</p>
<p>éªŒè¯æ˜¯å¦æ¶ˆé™¤warning</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7-master ~]# redis-server /usr/local/src/redis/etc/redis.conf 
</span></span><span style="display:flex;"><span>51540:C 07 Dec 2022 22:38:45.196 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
</span></span><span style="display:flex;"><span>51540:C 07 Dec 2022 22:38:45.196 # Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=51540, just started
</span></span><span style="display:flex;"><span>51540:C 07 Dec 2022 22:38:45.196 # Configuration loaded
</span></span><span style="display:flex;"><span>51540:M 07 Dec 2022 22:38:45.197 * Increased maximum number of open files to 10032 (it was originally set to 1024).
</span></span><span style="display:flex;"><span>51540:M 07 Dec 2022 22:38:45.197 * monotonic clock: POSIX clock_gettime
</span></span><span style="display:flex;"><span>                _._                                                  
</span></span><span style="display:flex;"><span>           _.-``__ &#39;&#39;-._                                             
</span></span><span style="display:flex;"><span>      _.-``    `.  `_.  &#39;&#39;-._           Redis 6.2.6 (00000000/0) 64 bit
</span></span><span style="display:flex;"><span>  .-`` .-```.  ```\/    _.,_ &#39;&#39;-._                                  
</span></span><span style="display:flex;"><span> (    &#39;      ,       .-`  | `,    )     Running in standalone mode
</span></span><span style="display:flex;"><span> |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 6379
</span></span><span style="display:flex;"><span> |    `-._   `._    /     _.-&#39;    |     PID: 51540
</span></span><span style="display:flex;"><span>  `-._    `-._  `-./  _.-&#39;    _.-&#39;                                   
</span></span><span style="display:flex;"><span> |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
</span></span><span style="display:flex;"><span> |    `-._`-._        _.-&#39;_.-&#39;    |           https://redis.io       
</span></span><span style="display:flex;"><span>  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
</span></span><span style="display:flex;"><span> |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|                                  
</span></span><span style="display:flex;"><span> |    `-._`-._        _.-&#39;_.-&#39;    |                                  
</span></span><span style="display:flex;"><span>  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;                                   
</span></span><span style="display:flex;"><span>      `-._    `-.__.-&#39;    _.-&#39;                                       
</span></span><span style="display:flex;"><span>          `-._        _.-&#39;                                           
</span></span><span style="display:flex;"><span>              `-.__.-&#39;                                               
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>51540:M 07 Dec 2022 22:38:45.197 # Server initialized
</span></span><span style="display:flex;"><span>51540:M 07 Dec 2022 22:38:45.198 * Loading RDB produced by version 6.2.6
</span></span><span style="display:flex;"><span>51540:M 07 Dec 2022 22:38:45.198 * RDB age 2 seconds
</span></span><span style="display:flex;"><span>51540:M 07 Dec 2022 22:38:45.198 * RDB memory usage when created 0.77 Mb
</span></span><span style="display:flex;"><span>51540:M 07 Dec 2022 22:38:45.198 # Done loading RDB, keys loaded: 0, keys expired: 0.
</span></span><span style="display:flex;"><span>51540:M 07 Dec 2022 22:38:45.198 * DB loaded from disk: 0.000 seconds
</span></span><span style="display:flex;"><span>51540:M 07 Dec 2022 22:38:45.198 * Ready to accept connections
</span></span></code></pre></div><ul>
<li>åˆ›å»º Redis ç”¨æˆ·å’Œè®¾ç½®æ•°æ®ç›®å½•æƒé™</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7-master ~]# useradd -r -s /sbin/nologin redis
</span></span><span style="display:flex;"><span>[root@centos7-master ~]# chown -R  redis.redis /usr/local/src/redis/
</span></span><span style="display:flex;"><span>[root@centos7-master ~]# 
</span></span></code></pre></div><ul>
<li>åˆ›å»º Redis æœåŠ¡ Service æ–‡ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7-master ~]# vim /lib/systemd/system/redis.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[Unit]
</span></span><span style="display:flex;"><span>Description=Redis persistent key-value database
</span></span><span style="display:flex;"><span>After=network.target
</span></span><span style="display:flex;"><span>[Service]
</span></span><span style="display:flex;"><span>ExecStart=/usr/local/src/redis/bin/redis-server /usr/local/src/redis/etc/redis.conf --supervised systemd
</span></span><span style="display:flex;"><span>ExecStop=/bin/kill -s QUIT $MAINPID
</span></span><span style="display:flex;"><span>Type=notify 
</span></span><span style="display:flex;"><span>User=redis
</span></span><span style="display:flex;"><span>Group=redis
</span></span><span style="display:flex;"><span>RuntimeDirectory=redis
</span></span><span style="display:flex;"><span>RuntimeDirectoryMode=0755
</span></span><span style="display:flex;"><span>LimitNOFILE=1000000 
</span></span><span style="display:flex;"><span>[Install]
</span></span><span style="display:flex;"><span>WantedBy=multi-user.target
</span></span></code></pre></div><ul>
<li>Redis é€šè¿‡Serviceæ–¹å¼å¯åŠ¨</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>systemctl restart redis
</span></span><span style="display:flex;"><span>systemctl status redis
</span></span></code></pre></div><h2 id="rediså¤šå®ä¾‹">Rediså¤šå®ä¾‹<a hidden class="anchor" aria-hidden="true" href="#rediså¤šå®ä¾‹">#</a></h2>
<p>åŸºäºæºç ç¼–è¯‘å®‰è£…çš„å‰æä¸‹å®ç°redisçš„å¤šå®ä¾‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># è¿›å…¥/usr/local/src/redis/etc
</span></span><span style="display:flex;"><span>[root@centos7-master ~]# cd /usr/local/src/redis/etc/
</span></span><span style="display:flex;"><span>[root@centos7-master etc]# 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨6380,6381ç«¯å£å¯åŠ¨å®ä¾‹
</span></span><span style="display:flex;"><span>[root@centos7-master etc]# sed &#39;s/6379/6380/&#39; redis.conf &gt; redis6380.conf
</span></span><span style="display:flex;"><span>[root@centos7-master etc]# sed &#39;s/6379/6380/&#39; redis.conf &gt; redis6381.conf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># ä¿®æ”¹æ‰€å±ç»„
</span></span><span style="display:flex;"><span>[root@centos7-master etc]# chown -R redis.redis *
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># ä¿®æ”¹å¯åŠ¨æ–‡ä»¶
</span></span><span style="display:flex;"><span>[root@centos7-master etc]# cp /lib/systemd/system/redis.service /lib/systemd/system/redis6380.service 
</span></span><span style="display:flex;"><span>[root@centos7-master etc]# 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[root@centos7-master etc]# vim /lib/systemd/system/redis6380.service 
</span></span><span style="display:flex;"><span>[Unit]
</span></span><span style="display:flex;"><span>Description=Redis persistent key-value database
</span></span><span style="display:flex;"><span>After=network.target
</span></span><span style="display:flex;"><span>[Service]
</span></span><span style="display:flex;"><span>ExecStart=/usr/local/src/redis/bin/redis-server /usr/local/src/redis/etc/redis6380.conf --supervised systemd
</span></span><span style="display:flex;"><span>ExecStop=/bin/kill -s QUIT $MAINPID
</span></span><span style="display:flex;"><span>Type=notify
</span></span><span style="display:flex;"><span>User=redis
</span></span><span style="display:flex;"><span>Group=redis
</span></span><span style="display:flex;"><span>RuntimeDirectory=redis
</span></span><span style="display:flex;"><span>RuntimeDirectoryMode=0755
</span></span><span style="display:flex;"><span>LimitNOFILE=1000000
</span></span><span style="display:flex;"><span>[Install]
</span></span><span style="display:flex;"><span>WantedBy=multi-user.target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># ä½¿ç”¨ç›¸åŒæ–¹æ³•åˆ›å»º/lib/systemd/system/redis6381.serviceæ–‡ä»¶å¹¶ä¿®æ”¹å†…å®¹
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># å¯åŠ¨å®ä¾‹
</span></span><span style="display:flex;"><span>[root@centos7-master etc]# systemctl status redis.service
</span></span><span style="display:flex;"><span>[root@centos7-master etc]# systemctl status redis6380.service
</span></span><span style="display:flex;"><span>[root@centos7-master etc]# systemctl status redis6381.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># æŸ¥çœ‹6379 6380 6381 ç«¯å£æ˜¯å¦å¯ç”¨
</span></span></code></pre></div><p><img loading="lazy" src="/posts.images/image.assets/1670507070884.png" alt="1670507070884"  />
</p>
<ul>
<li>è¿æ¥æµ‹è¯•</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>[root@centos7-master etc]# redis-cli -p 6379
</span></span><span style="display:flex;"><span>[root@centos7-master etc]# redis-cli -p 6380
</span></span><span style="display:flex;"><span>[root@centos7-master etc]# redis-cli -p 6381
</span></span></code></pre></div><h2 id="redis-é…ç½®ç®¡ç†">Redis é…ç½®ç®¡ç†<a hidden class="anchor" aria-hidden="true" href="#redis-é…ç½®ç®¡ç†">#</a></h2>
<h2 id="é…ç½®æ–‡ä»¶è¯´æ˜">é…ç½®æ–‡ä»¶è¯´æ˜<a hidden class="anchor" aria-hidden="true" href="#é…ç½®æ–‡ä»¶è¯´æ˜">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>bind 0.0.0.0 #æŒ‡å®šç›‘å¬åœ°å€ï¼Œæ”¯æŒç”¨ç©ºæ ¼éš”å¼€çš„å¤šä¸ªç›‘å¬IP
</span></span><span style="display:flex;"><span>protected-mode yes #redis3.2ä¹‹ååŠ å…¥çš„æ–°ç‰¹æ€§ï¼Œåœ¨æ²¡æœ‰è®¾ç½®bind IPå’Œå¯†ç çš„æ—¶å€™,redisåªå…è®¸è®¿
</span></span><span style="display:flex;"><span>é—®127.0.0.1:6379ï¼Œå¯ä»¥è¿œç¨‹è¿æ¥ï¼Œä½†å½“è®¿é—®å°†æç¤ºè­¦å‘Šä¿¡æ¯å¹¶æ‹’ç»è¿œç¨‹è®¿é—®
</span></span><span style="display:flex;"><span>port 6379 #ç›‘å¬ç«¯å£,é»˜è®¤6379/tcp
</span></span><span style="display:flex;"><span>tcp-backlog 511 #ä¸‰æ¬¡æ¡æ‰‹çš„æ—¶å€™serverç«¯æ”¶åˆ°client ackç¡®è®¤å·ä¹‹åçš„é˜Ÿåˆ—å€¼ï¼Œå³å…¨è¿æ¥é˜Ÿåˆ—é•¿åº¦
</span></span><span style="display:flex;"><span>timeout 0 #å®¢æˆ·ç«¯å’ŒRedisæœåŠ¡ç«¯çš„è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯0ï¼Œè¡¨ç¤ºæ°¸ä¸è¶…æ—¶
</span></span><span style="display:flex;"><span>tcp-keepalive 300 #tcp ä¼šè¯ä¿æŒæ—¶é—´300s
</span></span><span style="display:flex;"><span>daemonize no #é»˜è®¤no,å³ç›´æ¥è¿è¡Œredis-serverç¨‹åºæ—¶,ä¸ä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œï¼Œè€Œæ˜¯ä»¥å‰å°æ–¹å¼è¿è¡Œï¼Œ
</span></span><span style="display:flex;"><span>å¦‚æœæƒ³åœ¨åå°è¿è¡Œéœ€æ”¹æˆyes,å½“redisä½œä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šå†™ä¸€ä¸ª pid åˆ°
</span></span><span style="display:flex;"><span>/var/run/redis.pid æ–‡ä»¶
</span></span><span style="display:flex;"><span>supervised no #å’ŒOSç›¸å…³å‚æ•°ï¼Œå¯è®¾ç½®é€šè¿‡upstartå’Œsystemdç®¡ç†Rediså®ˆæŠ¤è¿›ç¨‹ï¼Œcentos7åéƒ½ä½¿
</span></span><span style="display:flex;"><span>ç”¨systemd
</span></span><span style="display:flex;"><span>pidfile /var/run/redis_6379.pid #pidæ–‡ä»¶è·¯å¾„,å¯ä»¥ä¿®æ”¹
</span></span><span style="display:flex;"><span>ä¸º/apps/redis/run/redis_6379.pid
</span></span><span style="display:flex;"><span>loglevel notice #æ—¥å¿—çº§åˆ«
</span></span><span style="display:flex;"><span>logfile &#34;/path/redis.log&#34; #æ—¥å¿—è·¯å¾„,ç¤ºä¾‹:logfile &#34;/apps/redis/log/redis_6379.log&#34;
</span></span><span style="display:flex;"><span>databases 16 #è®¾ç½®æ•°æ®åº“æ•°é‡ï¼Œé»˜è®¤ï¼š0-15ï¼Œå…±16ä¸ªåº“
</span></span><span style="display:flex;"><span>always-show-logo yes #åœ¨å¯åŠ¨redis æ—¶æ˜¯å¦æ˜¾ç¤ºæˆ–åœ¨æ—¥å¿—ä¸­è®°å½•è®°å½•redisçš„logo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>save 900 1 #åœ¨900ç§’å†…æœ‰1ä¸ªkeyå†…å®¹å‘ç”Ÿæ›´æ”¹,å°±æ‰§è¡Œå¿«ç…§æœºåˆ¶
</span></span><span style="display:flex;"><span>save 300 10 #åœ¨300ç§’å†…æœ‰10ä¸ªkeyå†…å®¹å‘ç”Ÿæ›´æ”¹,å°±æ‰§è¡Œå¿«ç…§æœºåˆ¶
</span></span><span style="display:flex;"><span>save 60 10000 #60ç§’å†…å¦‚æœæœ‰10000ä¸ªkeyä»¥ä¸Šçš„å˜åŒ–ï¼Œå°±è‡ªåŠ¨å¿«ç…§å¤‡ä»½
</span></span><span style="display:flex;"><span>stop-writes-on-bgsave-error yes #é»˜è®¤ä¸ºyesæ—¶,å¯èƒ½ä¼šå› ç©ºé—´æ»¡ç­‰åŸå› å¿«ç…§æ— æ³•ä¿å­˜å‡ºé”™æ—¶ï¼Œä¼šç¦
</span></span><span style="display:flex;"><span>æ­¢rediså†™å…¥æ“ä½œï¼Œç”Ÿäº§å»ºè®®ä¸ºno
</span></span><span style="display:flex;"><span>#æ­¤é¡¹åªé’ˆå¯¹é…ç½®æ–‡ä»¶ä¸­çš„è‡ªåŠ¨saveæœ‰æ•ˆ
</span></span><span style="display:flex;"><span>rdbcompression yes #æŒä¹…åŒ–åˆ°RDBæ–‡ä»¶æ—¶ï¼Œæ˜¯å¦å‹ç¼©ï¼Œ&#34;yes&#34;ä¸ºå‹ç¼©ï¼Œ&#34;no&#34;åˆ™åä¹‹
</span></span><span style="display:flex;"><span>rdbchecksum yes #æ˜¯å¦å¯¹å¤‡ä»½æ–‡ä»¶å¼€å¯RC64æ ¡éªŒï¼Œé»˜è®¤æ˜¯å¼€å¯
</span></span><span style="display:flex;"><span>dbfilename dump.rdb #å¿«ç…§æ–‡ä»¶å
</span></span><span style="display:flex;"><span>dir ./ #å¿«ç…§æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œç¤ºä¾‹ï¼šdir &#34;/apps/redis/data&#34;
</span></span><span style="display:flex;"><span>#ä¸»ä»å¤åˆ¶ç›¸å…³
</span></span><span style="display:flex;"><span># replicaof &lt;masterip&gt; &lt;masterport&gt; #æŒ‡å®šå¤åˆ¶çš„masterä¸»æœºåœ°å€å’Œç«¯å£ï¼Œ5.0ç‰ˆä¹‹å‰çš„æŒ‡ä»¤ä¸º
</span></span><span style="display:flex;"><span>slaveof
</span></span><span style="display:flex;"><span># masterauth &lt;master-password&gt; #æŒ‡å®šå¤åˆ¶çš„masterä¸»æœºçš„å¯†ç 
</span></span><span style="display:flex;"><span>replica-serve-stale-data yes #å½“ä»åº“åŒä¸»åº“å¤±å»è¿æ¥æˆ–è€…å¤åˆ¶æ­£åœ¨è¿›è¡Œï¼Œä»æœºåº“æœ‰ä¸¤ç§è¿è¡Œæ–¹å¼ï¼š
</span></span><span style="display:flex;"><span>1ã€è®¾ç½®ä¸ºyes(é»˜è®¤è®¾ç½®)ï¼Œä»åº“ä¼šç»§ç»­å“åº”å®¢æˆ·ç«¯çš„è¯»è¯·æ±‚ï¼Œæ­¤ä¸ºå»ºè®®å€¼
</span></span><span style="display:flex;"><span>2ã€è®¾ç½®ä¸ºnoï¼Œé™¤å»ç‰¹å®šå‘½ä»¤å¤–çš„ä»»ä½•è¯·æ±‚éƒ½ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯&#34;SYNC with master in progress&#34;ã€‚
</span></span><span style="display:flex;"><span>replica-read-only yes #æ˜¯å¦è®¾ç½®ä»åº“åªè¯»ï¼Œå»ºè®®å€¼ä¸ºyes,å¦åˆ™ä¸»åº“åŒæ­¥ä»åº“æ—¶å¯èƒ½ä¼šè¦†ç›–æ•°æ®ï¼Œé€ æˆ
</span></span><span style="display:flex;"><span>æ•°æ®ä¸¢å¤±
</span></span><span style="display:flex;"><span>repl-diskless-sync no #æ˜¯å¦ä½¿ç”¨socketæ–¹å¼å¤åˆ¶æ•°æ®(æ— ç›˜åŒæ­¥)ï¼Œæ–°slaveç¬¬ä¸€æ¬¡è¿æ¥masteræ—¶éœ€
</span></span><span style="display:flex;"><span>è¦åšæ•°æ®çš„å…¨é‡åŒæ­¥ï¼Œredis serverå°±è¦ä»å†…å­˜dumpå‡ºæ–°çš„RDBæ–‡ä»¶ï¼Œç„¶åä»masterä¼ åˆ°slaveï¼Œæœ‰ä¸¤ç§
</span></span><span style="display:flex;"><span>æ–¹å¼æŠŠRDBæ–‡ä»¶ä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼š
</span></span><span style="display:flex;"><span>1ã€åŸºäºç¡¬ç›˜ï¼ˆdisk-backedï¼‰ï¼šä¸ºnoæ—¶ï¼Œmasteråˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹dumpç”ŸæˆRDBç£ç›˜æ–‡ä»¶ï¼ŒRDBå®Œæˆä¹‹åç”±
</span></span><span style="display:flex;"><span>çˆ¶è¿›ç¨‹ï¼ˆå³ä¸»è¿›ç¨‹ï¼‰å°†RDBæ–‡ä»¶å‘é€ç»™slavesï¼Œæ­¤ä¸ºé»˜è®¤å€¼
</span></span><span style="display:flex;"><span>2ã€åŸºäºsocketï¼ˆdisklessï¼‰ï¼šmasteråˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ç›´æ¥dump RDBè‡³slaveçš„ç½‘ç»œsocketï¼Œä¸ç»è¿‡ä¸»
</span></span><span style="display:flex;"><span>è¿›ç¨‹å’Œç¡¬ç›˜
</span></span><span style="display:flex;"><span>#æ¨èä½¿ç”¨åŸºäºç¡¬ç›˜ï¼ˆä¸ºnoï¼‰ï¼Œæ˜¯å› ä¸ºRDBæ–‡ä»¶åˆ›å»ºåï¼Œå¯ä»¥åŒæ—¶ä¼ è¾“ç»™æ›´å¤šçš„slaveï¼Œä½†æ˜¯åŸºäºsocket(ä¸º
</span></span><span style="display:flex;"><span>yes)ï¼Œ æ–°slaveè¿æ¥åˆ°masterä¹‹åå¾—é€ä¸ªåŒæ­¥æ•°æ®ã€‚åªæœ‰å½“ç£ç›˜I/Oè¾ƒæ…¢ä¸”ç½‘ç»œè¾ƒå¿«æ—¶ï¼Œå¯ç”¨
</span></span><span style="display:flex;"><span>diskless(yes),å¦åˆ™ä¸€èˆ¬å»ºè®®ä½¿ç”¨ç£ç›˜(no)
</span></span><span style="display:flex;"><span>repl-diskless-sync-delay 5 #disklessæ—¶å¤åˆ¶çš„æœåŠ¡å™¨ç­‰å¾…çš„å»¶è¿Ÿæ—¶é—´ï¼Œè®¾ç½®0ä¸ºå…³é—­ï¼Œåœ¨å»¶è¿Ÿæ—¶é—´
</span></span><span style="display:flex;"><span>å†…åˆ°è¾¾çš„å®¢æˆ·ç«¯ï¼Œä¼šä¸€èµ·é€šè¿‡disklessæ–¹å¼åŒæ­¥æ•°æ®ï¼Œä½†æ˜¯ä¸€æ—¦å¤åˆ¶å¼€å§‹ï¼ŒmasterèŠ‚ç‚¹ä¸ä¼šå†æ¥æ”¶æ–°slave
</span></span><span style="display:flex;"><span>çš„å¤åˆ¶è¯·æ±‚ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡åŒæ­¥å¼€å§‹æ‰å†æ¥æ”¶æ–°è¯·æ±‚ã€‚å³æ— æ³•ä¸ºå»¶è¿Ÿæ—¶é—´ååˆ°è¾¾çš„æ–°å‰¯æœ¬æä¾›æœåŠ¡ï¼Œæ–°å‰¯æœ¬å°†æ’
</span></span><span style="display:flex;"><span>é˜Ÿç­‰å¾…ä¸‹ä¸€æ¬¡RDBä¼ è¾“ï¼Œå› æ­¤æœåŠ¡å™¨ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´æ‰èƒ½è®©æ›´å¤šå‰¯æœ¬åˆ°è¾¾ã€‚æ¨èå€¼ï¼š30-60
</span></span><span style="display:flex;"><span>repl-ping-replica-period 10 #slaveæ ¹æ®masteræŒ‡å®šçš„æ—¶é—´è¿›è¡Œå‘¨æœŸæ€§çš„PING master,ç”¨äºç›‘æµ‹
</span></span><span style="display:flex;"><span>masterçŠ¶æ€,é»˜è®¤10s
</span></span><span style="display:flex;"><span>repl-timeout 60 #å¤åˆ¶è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œéœ€è¦å¤§äºrepl-ping-slave-periodï¼Œå¦åˆ™ä¼šç»å¸¸æŠ¥è¶…æ—¶
</span></span><span style="display:flex;"><span>repl-disable-tcp-nodelay no #æ˜¯å¦åœ¨slaveå¥—æ¥å­—å‘é€SYNCä¹‹åç¦ç”¨ TCP_NODELAYï¼Œå¦‚æœé€‰
</span></span><span style="display:flex;"><span>æ‹©&#34;yes&#34;ï¼ŒRediså°†åˆå¹¶å¤šä¸ªæŠ¥æ–‡ä¸ºä¸€ä¸ªå¤§çš„æŠ¥æ–‡ï¼Œä»è€Œä½¿ç”¨æ›´å°‘æ•°é‡çš„åŒ…å‘slaveså‘é€æ•°æ®ï¼Œä½†æ˜¯å°†ä½¿æ•°æ®
</span></span><span style="display:flex;"><span>ä¼ è¾“åˆ°slaveä¸Šæœ‰å»¶è¿Ÿï¼ŒLinuxå†…æ ¸çš„é»˜è®¤é…ç½®ä¼šè¾¾åˆ°40æ¯«ç§’ï¼Œå¦‚æœ &#34;no&#34; ï¼Œæ•°æ®ä¼ è¾“åˆ°slaveçš„å»¶è¿Ÿå°†ä¼š
</span></span><span style="display:flex;"><span>å‡å°‘ï¼Œä½†è¦ä½¿ç”¨æ›´å¤šçš„å¸¦å®½
</span></span><span style="display:flex;"><span>repl-backlog-size 512mb #å¤åˆ¶ç¼“å†²åŒºå†…å­˜å¤§å°ï¼Œå½“slaveæ–­å¼€è¿æ¥ä¸€æ®µæ—¶é—´åï¼Œè¯¥ç¼“å†²åŒºä¼šç´¯ç§¯å¤åˆ¶
</span></span><span style="display:flex;"><span>å‰¯æœ¬æ•°æ®ï¼Œå› æ­¤å½“slave é‡æ–°è¿æ¥æ—¶ï¼Œé€šå¸¸ä¸éœ€è¦å®Œå…¨é‡æ–°åŒæ­¥ï¼Œåªéœ€ä¼ é€’åœ¨å‰¯æœ¬ä¸­çš„æ–­å¼€è¿æ¥åæ²¡æœ‰åŒæ­¥çš„
</span></span><span style="display:flex;"><span>éƒ¨åˆ†æ•°æ®å³å¯ã€‚åªæœ‰åœ¨è‡³å°‘æœ‰ä¸€ä¸ªslaveè¿æ¥ä¹‹åæ‰åˆ†é…æ­¤å†…å­˜ç©ºé—´,å»ºè®®å»ºç«‹ä¸»ä»æ—¶æ­¤å€¼è¦è°ƒå¤§ä¸€äº›æˆ–åœ¨ä½å³°
</span></span><span style="display:flex;"><span>æœŸé…ç½®,å¦åˆ™ä¼šå¯¼è‡´åŒæ­¥åˆ°slaveå¤±è´¥
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>repl-backlog-ttl 3600 #å¤šé•¿æ—¶é—´å†…masteræ²¡æœ‰slaveè¿æ¥ï¼Œå°±æ¸…ç©ºbacklogç¼“å†²åŒº
</span></span><span style="display:flex;"><span>replica-priority 100 #å½“masterä¸å¯ç”¨ï¼Œå“¨å…µSentinelä¼šæ ¹æ®slaveçš„ä¼˜å…ˆçº§é€‰ä¸¾ä¸€ä¸ªmasterï¼Œæ­¤
</span></span><span style="display:flex;"><span>å€¼æœ€ä½çš„slaveä¼šä¼˜å…ˆå½“é€‰masterï¼Œè€Œé…ç½®æˆ0ï¼Œæ°¸è¿œä¸ä¼šè¢«é€‰ä¸¾ï¼Œä¸€èˆ¬å¤šä¸ªslaveéƒ½è®¾ä¸ºä¸€æ ·çš„å€¼ï¼Œè®©å…¶è‡ª
</span></span><span style="display:flex;"><span>åŠ¨é€‰æ‹©
</span></span><span style="display:flex;"><span>#min-replicas-to-write 3 #è‡³å°‘æœ‰3ä¸ªå¯è¿æ¥çš„slaveï¼Œmateræ‰æ¥å—å†™æ“ä½œ
</span></span><span style="display:flex;"><span>#min-replicas-max-lag 10 #å’Œä¸Šé¢è‡³å°‘3ä¸ªslaveçš„pingå»¶è¿Ÿä¸èƒ½è¶…è¿‡10ç§’ï¼Œå¦åˆ™masterä¹Ÿå°†åœæ­¢
</span></span><span style="display:flex;"><span>å†™æ“ä½œ
</span></span><span style="display:flex;"><span>requirepass foobared #è®¾ç½®redisè¿æ¥å¯†ç ï¼Œä¹‹åéœ€è¦AUTH pass,å¦‚æœæœ‰ç‰¹æ®Šç¬¦å·ï¼Œç”¨&#34; &#34;å¼•èµ·æ¥,ç”Ÿ
</span></span><span style="display:flex;"><span>äº§å»ºè®®è®¾ç½®
</span></span><span style="display:flex;"><span>rename-command #é‡å‘½åä¸€äº›é«˜å±å‘½ä»¤ï¼Œç¤ºä¾‹ï¼šrename-command FLUSHALL &#34;&#34; ç¦ç”¨å‘½ä»¤
</span></span><span style="display:flex;"><span>#ç¤ºä¾‹: rename-command del magedu
</span></span><span style="display:flex;"><span>maxclients 10000 #Redisæœ€å¤§è¿æ¥å®¢æˆ·ç«¯
</span></span><span style="display:flex;"><span>maxmemory &lt;bytes&gt; #redisä½¿ç”¨çš„æœ€å¤§å†…å­˜ï¼Œå•ä½ä¸ºbyteså­—èŠ‚ï¼Œ0ä¸ºä¸é™åˆ¶ï¼Œå»ºè®®è®¾ä¸ºç‰©ç†å†…å­˜ä¸€åŠï¼Œ
</span></span><span style="display:flex;"><span>8Gå†…å­˜çš„è®¡ç®—æ–¹å¼8(G)*1024(MB)1024(KB)*1024(Kbyte)ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç¼“å†²åŒºæ˜¯ä¸è®¡ç®—åœ¨maxmemory
</span></span><span style="display:flex;"><span>å†…,ç”Ÿäº§ä¸­å¦‚æœä¸è®¾ç½®æ­¤é¡¹,å¯èƒ½ä¼šå¯¼è‡´OOM
</span></span><span style="display:flex;"><span>#maxmemory-policy noeviction æ­¤ä¸ºé»˜è®¤å€¼
</span></span><span style="display:flex;"><span># MAXMEMORY POLICYï¼šå½“è¾¾åˆ°æœ€å¤§å†…å­˜æ—¶ï¼ŒRedis å°†å¦‚ä½•é€‰æ‹©è¦åˆ é™¤çš„å†…å®¹ã€‚æ‚¨å¯ä»¥ä»ä»¥ä¸‹è¡Œä¸ºä¸­é€‰æ‹©ä¸€
</span></span><span style="display:flex;"><span>ç§ï¼š
</span></span><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span># volatile-lru -&gt; Evict ä½¿ç”¨è¿‘ä¼¼ LRUï¼Œåªæœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ã€‚
</span></span><span style="display:flex;"><span># allkeys-lru -&gt; ä½¿ç”¨è¿‘ä¼¼ LRU é©±é€ä»»ä½•é”®ã€‚
</span></span><span style="display:flex;"><span># volatile-lfu -&gt; ä½¿ç”¨è¿‘ä¼¼ LFU é©±é€ï¼Œåªæœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ã€‚
</span></span><span style="display:flex;"><span># allkeys-lfu -&gt; ä½¿ç”¨è¿‘ä¼¼ LFU é©±é€ä»»ä½•é”®ã€‚
</span></span><span style="display:flex;"><span># volatile-random -&gt; åˆ é™¤è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„éšæœºå¯†é’¥ã€‚
</span></span><span style="display:flex;"><span># allkeys-random -&gt; åˆ é™¤ä¸€ä¸ªéšæœºå¯†é’¥ï¼Œä»»ä½•å¯†é’¥ã€‚
</span></span><span style="display:flex;"><span># volatile-ttl -&gt; åˆ é™¤è¿‡æœŸæ—¶é—´æœ€è¿‘çš„keyï¼ˆæ¬¡TTLï¼‰
</span></span><span style="display:flex;"><span># noeviction -&gt; ä¸è¦é©±é€ä»»ä½•ä¸œè¥¿ï¼Œåªæ˜¯åœ¨å†™æ“ä½œæ—¶è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚
</span></span><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span># LRU è¡¨ç¤ºæœ€è¿‘æœ€å°‘ä½¿ç”¨
</span></span><span style="display:flex;"><span># LFU è¡¨ç¤ºæœ€ä¸å¸¸ç”¨
</span></span><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span># LRUã€LFU å’Œ volatile-ttl éƒ½æ˜¯ä½¿ç”¨è¿‘ä¼¼éšæœºç®—æ³•å®ç°çš„ã€‚
</span></span><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span># æ³¨æ„ï¼šä½¿ç”¨ä¸Šè¿°ä»»ä½•ä¸€ç§ç­–ç•¥ï¼Œå½“æ²¡æœ‰åˆé€‚çš„é”®ç”¨äºé©±é€æ—¶ï¼ŒRedis å°†åœ¨éœ€è¦æ›´å¤šå†…å­˜çš„å†™æ“ä½œæ—¶è¿”å›é”™
</span></span><span style="display:flex;"><span>è¯¯ã€‚è¿™äº›é€šå¸¸æ˜¯åˆ›å»ºæ–°å¯†é’¥ã€æ·»åŠ æ•°æ®æˆ–ä¿®æ”¹ç°æœ‰å¯†é’¥çš„å‘½ä»¤ã€‚ä¸€äº›ç¤ºä¾‹æ˜¯ï¼šSETã€INCRã€HSETã€LPUSHã€
</span></span><span style="display:flex;"><span>SUNIONSTOREã€SORTï¼ˆç”±äº STORE å‚æ•°ï¼‰å’Œ EXECï¼ˆå¦‚æœäº‹åŠ¡åŒ…æ‹¬ä»»ä½•éœ€è¦å†…å­˜çš„å‘½ä»¤ï¼‰ã€‚
</span></span><span style="display:flex;"><span>#MAXMEMORY POLICYï¼šå½“è¾¾åˆ°æœ€å¤§å†…å­˜æ—¶ï¼ŒRedis å°†å¦‚ä½•é€‰æ‹©è¦åˆ é™¤çš„å†…å®¹ã€‚å¯ä»¥ä»ä¸‹é¢è¡Œä¸ºä¸­è¿›è¡Œé€‰
</span></span><span style="display:flex;"><span>æ‹©ï¼š
</span></span><span style="display:flex;"><span># volatile-lru -&gt; åœ¨å…·æœ‰è¿‡æœŸé›†çš„é”®ä¸­ä½¿ç”¨è¿‘ä¼¼ LRU é©±é€ã€‚
</span></span><span style="display:flex;"><span># allkeys-lru -&gt; ä½¿ç”¨è¿‘ä¼¼ LRU é©±é€ä»»ä½•é”®ã€‚
</span></span><span style="display:flex;"><span># volatile-lfu -&gt; åœ¨å…·æœ‰è¿‡æœŸé›†çš„é”®ä¸­ä½¿ç”¨è¿‘ä¼¼ LFU é©±é€ã€‚
</span></span><span style="display:flex;"><span># allkeys-lfu -&gt; ä½¿ç”¨è¿‘ä¼¼ LFU é©±é€ä»»ä½•é”®ã€‚
</span></span><span style="display:flex;"><span># volatile-random -&gt; ä»å…·æœ‰è¿‡æœŸè®¾ç½®çš„å¯†é’¥ä¸­åˆ é™¤ä¸€ä¸ªéšæœºå¯†é’¥ã€‚
</span></span><span style="display:flex;"><span># allkeys-random -&gt; åˆ é™¤ä¸€ä¸ªéšæœºå¯†é’¥ï¼Œä»»ä½•å¯†é’¥ã€‚
</span></span><span style="display:flex;"><span># volatile-ttl -&gt; åˆ é™¤è¿‡æœŸæ—¶é—´æœ€è¿‘çš„keyï¼ˆæ¬¡TTLï¼‰
</span></span><span style="display:flex;"><span># noeviction -&gt; ä¸è¦é©±é€ä»»ä½•ä¸œè¥¿ï¼Œåªæ˜¯åœ¨å†™æ“ä½œæ—¶è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚
</span></span><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span># LRU è¡¨ç¤ºæœ€è¿‘æœ€å°‘ä½¿ç”¨
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># LFU è¡¨ç¤ºæœ€ä¸å¸¸ç”¨
</span></span><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span># LRUã€LFU å’Œ volatile-ttl å‡ä½¿ç”¨è¿‘ä¼¼å®ç°éšæœºç®—æ³•ã€‚
</span></span><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span># æ³¨æ„ï¼šä½¿ç”¨ä¸Šè¿°ä»»ä½•ä¸€ç§ç­–ç•¥ï¼ŒRedis éƒ½ä¼šåœ¨å†™å…¥æ—¶è¿”å›é”™è¯¯æ“ä½œï¼Œå½“æ²¡æœ‰åˆé€‚çš„é”®ç”¨äºé©±é€æ—¶ã€‚
</span></span><span style="display:flex;"><span>appendonly no #æ˜¯å¦å¼€å¯AOFæ—¥å¿—è®°å½•ï¼Œé»˜è®¤redisä½¿ç”¨çš„æ˜¯rdbæ–¹å¼æŒä¹…åŒ–ï¼Œè¿™ç§æ–¹å¼åœ¨è®¸å¤šåº”ç”¨ä¸­å·²ç»
</span></span><span style="display:flex;"><span>è¶³å¤Ÿç”¨äº†ï¼Œä½†æ˜¯rediså¦‚æœä¸­é€”å®•æœºï¼Œä¼šå¯¼è‡´å¯èƒ½æœ‰å‡ åˆ†é’Ÿçš„æ•°æ®ä¸¢å¤±(å–å†³äºdumpæ•°æ®çš„é—´éš”æ—¶é—´)ï¼Œæ ¹æ®
</span></span><span style="display:flex;"><span>saveæ¥ç­–ç•¥è¿›è¡ŒæŒä¹…åŒ–ï¼ŒAppend Only Fileæ˜¯å¦ä¸€ç§æŒä¹…åŒ–æ–¹å¼ï¼Œå¯ä»¥æä¾›æ›´å¥½çš„æŒä¹…åŒ–ç‰¹æ€§ï¼ŒRedisä¼š
</span></span><span style="display:flex;"><span>æŠŠæ¯æ¬¡å†™å…¥çš„æ•°æ®åœ¨æ¥æ”¶åéƒ½å†™å…¥ appendonly.aof æ–‡ä»¶ï¼Œæ¯æ¬¡å¯åŠ¨æ—¶Rediséƒ½ä¼šå…ˆæŠŠè¿™ä¸ªæ–‡ä»¶çš„æ•°æ®è¯»å…¥
</span></span><span style="display:flex;"><span>å†…å­˜é‡Œï¼Œå…ˆå¿½ç•¥RDBæ–‡ä»¶ã€‚é»˜è®¤ä¸å¯ç”¨æ­¤åŠŸèƒ½
</span></span><span style="display:flex;"><span>appendfilename &#34;appendonly.aof&#34; #æ–‡æœ¬æ–‡ä»¶AOFçš„æ–‡ä»¶åï¼Œå­˜æ”¾åœ¨diræŒ‡ä»¤æŒ‡å®šçš„ç›®å½•ä¸­
</span></span><span style="display:flex;"><span>appendfsync everysec #aofæŒä¹…åŒ–ç­–ç•¥çš„é…ç½®
</span></span><span style="display:flex;"><span>#noè¡¨ç¤ºç”±æ“ä½œç³»ç»Ÿä¿è¯æ•°æ®åŒæ­¥åˆ°ç£ç›˜,Linuxçš„é»˜è®¤fsyncç­–ç•¥æ˜¯30ç§’ï¼Œæœ€å¤šä¼šä¸¢å¤±30sçš„æ•°æ®
</span></span><span style="display:flex;"><span>#alwaysè¡¨ç¤ºæ¯æ¬¡å†™å…¥éƒ½æ‰§è¡Œfsyncï¼Œä»¥ä¿è¯æ•°æ®åŒæ­¥åˆ°ç£ç›˜,å®‰å…¨æ€§é«˜,æ€§èƒ½è¾ƒå·®
</span></span><span style="display:flex;"><span>#everysecè¡¨ç¤ºæ¯ç§’æ‰§è¡Œä¸€æ¬¡fsyncï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸¢å¤±è¿™1sæ•°æ®,æ­¤ä¸ºé»˜è®¤å€¼,ä¹Ÿç”Ÿäº§å»ºè®®å€¼
</span></span><span style="display:flex;"><span>#åŒæ—¶åœ¨æ‰§è¡Œbgrewriteaofæ“ä½œå’Œä¸»è¿›ç¨‹å†™aofæ–‡ä»¶çš„æ“ä½œï¼Œä¸¤è€…éƒ½ä¼šæ“ä½œç£ç›˜ï¼Œè€Œbgrewriteaofå¾€å¾€ä¼š
</span></span><span style="display:flex;"><span>æ¶‰åŠå¤§é‡ç£ç›˜æ“ä½œï¼Œè¿™æ ·å°±ä¼šé€ æˆä¸»è¿›ç¨‹åœ¨å†™aofæ–‡ä»¶çš„æ—¶å€™å‡ºç°é˜»å¡çš„æƒ…å½¢,ä»¥ä¸‹å‚æ•°å®ç°æ§åˆ¶
</span></span><span style="display:flex;"><span>no-appendfsync-on-rewrite no #åœ¨aof rewriteæœŸé—´,æ˜¯å¦å¯¹aofæ–°è®°å½•çš„appendæš‚ç¼“ä½¿ç”¨æ–‡ä»¶åŒæ­¥
</span></span><span style="display:flex;"><span>ç­–ç•¥,ä¸»è¦è€ƒè™‘ç£ç›˜IOå¼€æ”¯å’Œè¯·æ±‚é˜»å¡æ—¶é—´ã€‚
</span></span><span style="display:flex;"><span>#é»˜è®¤ä¸ºno,è¡¨ç¤º&#34;ä¸æš‚ç¼“&#34;,æ–°çš„aofè®°å½•ä»ç„¶ä¼šè¢«ç«‹å³åŒæ­¥åˆ°ç£ç›˜ï¼Œæ˜¯æœ€å®‰å…¨çš„æ–¹å¼ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä½†æ˜¯è¦
</span></span><span style="display:flex;"><span>å¿å—é˜»å¡çš„é—®é¢˜
</span></span><span style="display:flex;"><span>#ä¸ºyes,ç›¸å½“äºå°†appendfsyncè®¾ç½®ä¸ºnoï¼Œè¿™è¯´æ˜å¹¶æ²¡æœ‰æ‰§è¡Œç£ç›˜æ“ä½œï¼Œåªæ˜¯å†™å…¥äº†ç¼“å†²åŒºï¼Œå› æ­¤è¿™æ ·å¹¶ä¸
</span></span><span style="display:flex;"><span>ä¼šé€ æˆé˜»å¡ï¼ˆå› ä¸ºæ²¡æœ‰ç«äº‰ç£ç›˜ï¼‰ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªæ—¶å€™redisæŒ‚æ‰ï¼Œå°±ä¼šä¸¢å¤±æ•°æ®ã€‚ä¸¢å¤±å¤šå°‘æ•°æ®å‘¢ï¼ŸLinux
</span></span><span style="display:flex;"><span>çš„é»˜è®¤fsyncç­–ç•¥æ˜¯30ç§’ï¼Œæœ€å¤šä¼šä¸¢å¤±30sçš„æ•°æ®,ä½†ç”±äºyesæ€§èƒ½è¾ƒå¥½è€Œä¸”ä¼šé¿å…å‡ºç°é˜»å¡å› æ­¤æ¯”è¾ƒæ¨è
</span></span><span style="display:flex;"><span>#rewrite å³å¯¹aofæ–‡ä»¶è¿›è¡Œæ•´ç†,å°†ç©ºé—²ç©ºé—´å›æ”¶,ä»è€Œå¯ä»¥å‡å°‘æ¢å¤æ•°æ®æ—¶é—´
</span></span><span style="display:flex;"><span>auto-aof-rewrite-percentage 100 #å½“Aof logå¢é•¿è¶…è¿‡æŒ‡å®šç™¾åˆ†æ¯”ä¾‹æ—¶ï¼Œé‡å†™AOFæ–‡ä»¶ï¼Œè®¾ç½®ä¸º0è¡¨
</span></span><span style="display:flex;"><span>ç¤ºä¸è‡ªåŠ¨é‡å†™Aofæ—¥å¿—ï¼Œé‡å†™æ˜¯ä¸ºäº†ä½¿aofä½“ç§¯ä¿æŒæœ€å°ï¼Œä½†æ˜¯è¿˜å¯ä»¥ç¡®ä¿ä¿å­˜æœ€å®Œæ•´çš„æ•°æ®
</span></span><span style="display:flex;"><span>auto-aof-rewrite-min-size 64mb #è§¦å‘aof rewriteçš„æœ€å°æ–‡ä»¶å¤§å°
</span></span><span style="display:flex;"><span>aof-load-truncated yes #æ˜¯å¦åŠ è½½ç”±äºæŸäº›åŸå› å¯¼è‡´çš„æœ«å°¾å¼‚å¸¸çš„AOFæ–‡ä»¶(ä¸»è¿›ç¨‹è¢«kill/æ–­ç”µç­‰)ï¼Œ
</span></span><span style="display:flex;"><span>å»ºè®®yes
</span></span><span style="display:flex;"><span>aof-use-rdb-preamble no #redis4.0æ–°å¢RDB-AOFæ··åˆæŒä¹…åŒ–æ ¼å¼ï¼Œåœ¨å¼€å¯äº†è¿™ä¸ªåŠŸèƒ½ä¹‹åï¼ŒAOFé‡
</span></span><span style="display:flex;"><span>å†™äº§ç”Ÿçš„æ–‡ä»¶å°†åŒæ—¶åŒ…å«RDBæ ¼å¼çš„å†…å®¹å’ŒAOFæ ¼å¼çš„å†…å®¹ï¼Œå…¶ä¸­RDBæ ¼å¼çš„å†…å®¹ç”¨äºè®°å½•å·²æœ‰çš„æ•°æ®ï¼Œè€ŒAOF
</span></span><span style="display:flex;"><span>æ ¼å¼çš„å†…å®¹åˆ™ç”¨äºè®°å½•æœ€è¿‘å‘ç”Ÿäº†å˜åŒ–çš„æ•°æ®ï¼Œè¿™æ ·Rediså°±å¯ä»¥åŒæ—¶å…¼æœ‰RDBæŒä¹…åŒ–å’ŒAOFæŒä¹…åŒ–çš„ä¼˜ç‚¹ï¼ˆæ—¢
</span></span><span style="display:flex;"><span>èƒ½å¤Ÿå¿«é€Ÿåœ°ç”Ÿæˆé‡å†™æ–‡ä»¶ï¼Œä¹Ÿèƒ½å¤Ÿåœ¨å‡ºç°é—®é¢˜æ—¶ï¼Œå¿«é€Ÿåœ°è½½å…¥æ•°æ®ï¼‰,é»˜è®¤ä¸ºno,å³ä¸å¯ç”¨æ­¤åŠŸèƒ½
</span></span><span style="display:flex;"><span>lua-time-limit 5000 #luaè„šæœ¬çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’
</span></span><span style="display:flex;"><span>cluster-enabled yes #æ˜¯å¦å¼€å¯é›†ç¾¤æ¨¡å¼ï¼Œé»˜è®¤ä¸å¼€å¯,å³å•æœºæ¨¡å¼
</span></span><span style="display:flex;"><span>cluster-config-file nodes-6379.conf #ç”±nodeèŠ‚ç‚¹è‡ªåŠ¨ç”Ÿæˆçš„é›†ç¾¤é…ç½®æ–‡ä»¶åç§°
</span></span><span style="display:flex;"><span>cluster-node-timeout 15000 #é›†ç¾¤ä¸­nodeèŠ‚ç‚¹è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ms,è¶…è¿‡æ­¤æ—¶é—´ï¼Œä¼šè¸¢å‡ºé›†ç¾¤
</span></span><span style="display:flex;"><span>cluster-replica-validity-factor 10 #å•ä½ä¸ºæ¬¡,åœ¨æ‰§è¡Œæ•…éšœè½¬ç§»çš„æ—¶å€™å¯èƒ½æœ‰äº›èŠ‚ç‚¹å’Œmasteræ–­
</span></span><span style="display:flex;"><span>å¼€ä¸€æ®µæ—¶é—´å¯¼è‡´æ•°æ®æ¯”è¾ƒæ—§ï¼Œè¿™äº›èŠ‚ç‚¹å°±ä¸é€‚ç”¨äºé€‰ä¸¾ä¸ºmasterï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´çš„å°±ä¸ä¼šè¢«è¿›è¡Œæ•…éšœè½¬ç§»,ä¸
</span></span><span style="display:flex;"><span>èƒ½å½“é€‰masterï¼Œè®¡ç®—å…¬å¼ï¼š(node-timeout * replica-validity-factor) + repl-ping-
</span></span><span style="display:flex;"><span>replica-period
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>cluster-migration-barrier 1 #é›†ç¾¤è¿ç§»å±éšœï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹è‡³å°‘æ‹¥æœ‰1ä¸ªæ­£å¸¸å·¥ä½œçš„ä»èŠ‚ç‚¹ï¼Œå³å¦‚æœä¸»
</span></span><span style="display:flex;"><span>èŠ‚ç‚¹çš„slaveèŠ‚ç‚¹æ•…éšœåä¼šå°†å¤šä½™çš„ä»èŠ‚ç‚¹åˆ†é…åˆ°å½“å‰ä¸»èŠ‚ç‚¹æˆä¸ºå…¶æ–°çš„ä»èŠ‚ç‚¹ã€‚
</span></span><span style="display:flex;"><span>cluster-require-full-coverage yes #é›†ç¾¤è¯·æ±‚æ§½ä½å…¨éƒ¨è¦†ç›–ï¼Œå¦‚æœä¸€ä¸ªä¸»åº“å®•æœºä¸”æ²¡æœ‰å¤‡åº“å°±ä¼šå‡º
</span></span><span style="display:flex;"><span>ç°é›†ç¾¤æ§½ä½ä¸å…¨ï¼Œé‚£ä¹ˆyesæ—¶redisé›†ç¾¤æ§½ä½éªŒè¯ä¸å…¨,å°±ä¸å†å¯¹å¤–æä¾›æœåŠ¡(å¯¹keyèµ‹å€¼æ—¶,ä¼šå‡ºç°
</span></span><span style="display:flex;"><span>CLUSTERDOWN The cluster is downçš„æç¤º,cluster_state:fail,ä½†ping ä»PONG)ï¼Œè€Œnoåˆ™å¯ä»¥
</span></span><span style="display:flex;"><span>ç»§ç»­ä½¿ç”¨,ä½†æ˜¯ä¼šå‡ºç°æŸ¥è¯¢æ•°æ®æŸ¥ä¸åˆ°çš„æƒ…å†µ(å› ä¸ºæœ‰æ•°æ®ä¸¢å¤±)ã€‚ç”Ÿäº§å»ºè®®ä¸ºno
</span></span><span style="display:flex;"><span>cluster-replica-no-failover no #å¦‚æœä¸ºyes,æ­¤é€‰é¡¹é˜»æ­¢åœ¨ä¸»æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶å°è¯•å¯¹å…¶ä¸»æœåŠ¡å™¨è¿›
</span></span><span style="display:flex;"><span>è¡Œæ•…éšœè½¬ç§»ã€‚ ä½†æ˜¯ï¼Œä¸»æœåŠ¡å™¨ä»ç„¶å¯ä»¥æ‰§è¡Œæ‰‹åŠ¨å¼ºåˆ¶æ•…éšœè½¬ç§»ï¼Œä¸€èˆ¬ä¸ºno
</span></span><span style="display:flex;"><span>#Slow log æ˜¯ Redis ç”¨æ¥è®°å½•è¶…è¿‡æŒ‡å®šæ‰§è¡Œæ—¶é—´çš„æ—¥å¿—ç³»ç»Ÿï¼Œæ‰§è¡Œæ—¶é—´ä¸åŒ…æ‹¬ä¸å®¢æˆ·ç«¯äº¤è°ˆï¼Œå‘é€å›å¤ç­‰
</span></span><span style="display:flex;"><span>I/Oæ“ä½œï¼Œè€Œæ˜¯å®é™…æ‰§è¡Œå‘½ä»¤æ‰€éœ€çš„æ—¶é—´ï¼ˆåœ¨è¯¥é˜¶æ®µçº¿ç¨‹è¢«é˜»å¡å¹¶ä¸”ä¸èƒ½åŒæ—¶ä¸ºå…¶å®ƒè¯·æ±‚æä¾›æœåŠ¡ï¼‰,ç”±äº
</span></span><span style="display:flex;"><span>slow log ä¿å­˜åœ¨å†…å­˜é‡Œé¢ï¼Œè¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œå› æ­¤å¯æ”¾å¿ƒåœ°ä½¿ç”¨ï¼Œä¸å¿…æ‹…å¿ƒå› ä¸ºå¼€å¯ slow log è€Œå½±å“
</span></span><span style="display:flex;"><span>Redis çš„é€Ÿåº¦
</span></span><span style="display:flex;"><span>slowlog-log-slower-than 10000 #ä»¥å¾®ç§’ä¸ºå•ä½çš„æ…¢æ—¥å¿—è®°å½•ï¼Œä¸ºè´Ÿæ•°ä¼šç¦ç”¨æ…¢æ—¥å¿—ï¼Œä¸º0ä¼šè®°å½•æ¯ä¸ª
</span></span><span style="display:flex;"><span>å‘½ä»¤æ“ä½œã€‚é»˜è®¤å€¼ä¸º10ms,ä¸€èˆ¬ä¸€æ¡å‘½ä»¤æ‰§è¡Œéƒ½åœ¨å¾®ç§’çº§,ç”Ÿäº§å»ºè®®è®¾ä¸º1ms-10msä¹‹é—´
</span></span><span style="display:flex;"><span>slowlog-max-len 128 #æœ€å¤šè®°å½•å¤šå°‘æ¡æ…¢æ—¥å¿—çš„ä¿å­˜é˜Ÿåˆ—é•¿åº¦ï¼Œè¾¾åˆ°æ­¤é•¿åº¦åï¼Œè®°å½•æ–°å‘½ä»¤ä¼šå°†æœ€æ—§çš„å‘½
</span></span><span style="display:flex;"><span>ä»¤ä»å‘½ä»¤é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œä»¥æ­¤æ»šåŠ¨åˆ é™¤,å³,å…ˆè¿›å…ˆå‡º,é˜Ÿåˆ—å›ºå®šé•¿åº¦,é»˜è®¤128,å€¼åå°,ç”Ÿäº§å»ºè®®è®¾ä¸º1000ä»¥ä¸Š
</span></span></code></pre></div><p><a href="https://www.cnblogs.com/ysocean/p/9074787.html">Redisçš„é…ç½®æ–‡ä»¶ä»‹ç»</a></p>
<h2 id="config-å‘½ä»¤å®ç°åŠ¨æ€ä¿®æ”¹é…ç½®">config å‘½ä»¤å®ç°åŠ¨æ€ä¿®æ”¹é…ç½®<a hidden class="anchor" aria-hidden="true" href="#config-å‘½ä»¤å®ç°åŠ¨æ€ä¿®æ”¹é…ç½®">#</a></h2>
<p>config å‘½ä»¤ç”¨äºæŸ¥çœ‹å½“å‰redisé…ç½®ã€ä»¥åŠä¸é‡å¯redisæœåŠ¡å®ç°åŠ¨æ€æ›´æ”¹redisé…ç½®ç­‰
æ³¨æ„ï¼šä¸æ˜¯æ‰€æœ‰é…ç½®éƒ½å¯ä»¥åŠ¨æ€ä¿®æ”¹,ä¸”æ­¤æ–¹å¼æ— æ³•æŒä¹…ä¿å­˜</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>CONFIG SET parameter value
</span></span><span style="display:flex;"><span>æ—¶é—´å¤æ‚åº¦ï¼šO(1)
</span></span><span style="display:flex;"><span>CONFIG SET å‘½ä»¤å¯ä»¥åŠ¨æ€åœ°è°ƒæ•´ Redis æœåŠ¡å™¨çš„é…ç½®(configuration)è€Œæ— é¡»é‡å¯ã€‚
</span></span><span style="display:flex;"><span>å¯ä»¥ä½¿ç”¨å®ƒä¿®æ”¹é…ç½®å‚æ•°ï¼Œæˆ–è€…æ”¹å˜ Redis çš„æŒä¹…åŒ–(Persistence)æ–¹å¼ã€‚
</span></span><span style="display:flex;"><span>CONFIG SET å¯ä»¥ä¿®æ”¹çš„é…ç½®å‚æ•°å¯ä»¥ä½¿ç”¨å‘½ä»¤ CONFIG GET * æ¥åˆ—å‡ºï¼Œæ‰€æœ‰è¢« CONFIG SET ä¿®æ”¹çš„é…
</span></span><span style="display:flex;"><span>ç½®å‚æ•°éƒ½ä¼šç«‹å³ç”Ÿæ•ˆã€‚
</span></span><span style="display:flex;"><span>CONFIG GET parameter
</span></span><span style="display:flex;"><span>æ—¶é—´å¤æ‚åº¦ï¼š O(N)ï¼Œå…¶ä¸­ N ä¸ºå‘½ä»¤è¿”å›çš„é…ç½®é€‰é¡¹æ•°é‡ã€‚
</span></span><span style="display:flex;"><span>CONFIG GET å‘½ä»¤ç”¨äºå–å¾—è¿è¡Œä¸­çš„ Redis æœåŠ¡å™¨çš„é…ç½®å‚æ•°(configuration parameters)ï¼Œåœ¨
</span></span><span style="display:flex;"><span>Redis 2.4 ç‰ˆæœ¬ä¸­ï¼Œ æœ‰éƒ¨åˆ†å‚æ•°æ²¡æœ‰åŠæ³•ç”¨ CONFIG GET è®¿é—®ï¼Œä½†æ˜¯åœ¨æœ€æ–°çš„ Redis 2.6 ç‰ˆæœ¬ä¸­ï¼Œæ‰€
</span></span><span style="display:flex;"><span>æœ‰é…ç½®å‚æ•°éƒ½å·²ç»å¯ä»¥ç”¨ CONFIG GET è®¿é—®äº†ã€‚
</span></span><span style="display:flex;"><span>CONFIG GET æ¥å—å•ä¸ªå‚æ•° parameter ä½œä¸ºæœç´¢å…³é”®å­—ï¼ŒæŸ¥æ‰¾æ‰€æœ‰åŒ¹é…çš„é…ç½®å‚æ•°ï¼Œå…¶ä¸­å‚æ•°å’Œå€¼ä»¥â€œé”®-
</span></span><span style="display:flex;"><span>å€¼å¯¹â€(key-value pairs)çš„æ–¹å¼æ’åˆ—ã€‚
</span></span><span style="display:flex;"><span>æ¯”å¦‚æ‰§è¡Œ CONFIG GET s* å‘½ä»¤ï¼ŒæœåŠ¡å™¨å°±ä¼šè¿”å›æ‰€æœ‰ä»¥ s å¼€å¤´çš„é…ç½®å‚æ•°åŠå‚æ•°çš„å€¼ï¼š
</span></span></code></pre></div><h3 id="è®¾ç½®å®¢æˆ·ç«¯è¿æ¥å¯†ç ">è®¾ç½®å®¢æˆ·ç«¯è¿æ¥å¯†ç <a hidden class="anchor" aria-hidden="true" href="#è®¾ç½®å®¢æˆ·ç«¯è¿æ¥å¯†ç ">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#è®¾ç½®è¿æ¥å¯†ç 
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG SET requirepass 123456
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>#æŸ¥çœ‹è¿æ¥å¯†ç 
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG GET requirepass
</span></span><span style="display:flex;"><span>1) &#34;requirepass&#34;
</span></span><span style="display:flex;"><span>2) &#34;123456&#34;
</span></span></code></pre></div><h3 id="è·å–å½“å‰é…ç½®">è·å–å½“å‰é…ç½®<a hidden class="anchor" aria-hidden="true" href="#è·å–å½“å‰é…ç½®">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#å¥‡æ•°è¡Œä¸ºé”®ï¼Œå¶æ•°è¡Œä¸ºå€¼
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG GET *
</span></span><span style="display:flex;"><span>1) &#34;dbfilename&#34;
</span></span><span style="display:flex;"><span>2) &#34;dump.rdb&#34;
</span></span><span style="display:flex;"><span>3) &#34;requirepass&#34;
</span></span><span style="display:flex;"><span>4) &#34;&#34;
</span></span><span style="display:flex;"><span>5) &#34;masterauth&#34;
</span></span><span style="display:flex;"><span>6) &#34;&#34;
</span></span><span style="display:flex;"><span>7) &#34;cluster-announce-ip&#34;
</span></span><span style="display:flex;"><span>8) &#34;&#34;
</span></span><span style="display:flex;"><span>9) &#34;unixsocket&#34;
</span></span><span style="display:flex;"><span>10) &#34;&#34;
</span></span><span style="display:flex;"><span>11) &#34;logfile&#34;
</span></span><span style="display:flex;"><span>12) &#34;/var/log/redis/redis.log&#34;
</span></span><span style="display:flex;"><span>13) &#34;pidfile&#34;
</span></span><span style="display:flex;"><span>14) &#34;/var/run/redis_6379.pid&#34;
</span></span><span style="display:flex;"><span>15) &#34;slave-announce-ip&#34;
</span></span><span style="display:flex;"><span>16) &#34;&#34;
</span></span><span style="display:flex;"><span>17) &#34;replica-announce-ip&#34;
</span></span><span style="display:flex;"><span>18) &#34;&#34;
</span></span><span style="display:flex;"><span>19) &#34;maxmemory&#34;
</span></span><span style="display:flex;"><span>20) &#34;0&#34;
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>#æŸ¥çœ‹bind
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG GET bind
</span></span><span style="display:flex;"><span>1) &#34;bind&#34;
</span></span><span style="display:flex;"><span>2) &#34;0.0.0.0&#34;
</span></span><span style="display:flex;"><span>#Redis5.0æœ‰äº›è®¾ç½®æ— æ³•ä¿®æ”¹,Redis6.2.6ç‰ˆæœ¬æ”¯æŒä¿®æ”¹bind
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG SET bind 127.0.0.1
</span></span><span style="display:flex;"><span>(error) ERR Unsupported CONFIG parameter: bind
</span></span></code></pre></div><h3 id="è®¾ç½®redisä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡">è®¾ç½®Redisä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡<a hidden class="anchor" aria-hidden="true" href="#è®¾ç½®redisä½¿ç”¨çš„æœ€å¤§å†…å­˜é‡">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG SET maxmemory 8589934592
</span></span><span style="display:flex;"><span>OK
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; CONFIG GET maxmemory
</span></span><span style="display:flex;"><span>1) &#34;maxmemory&#34;
</span></span><span style="display:flex;"><span>2) &#34;8589934592&#34;
</span></span></code></pre></div><h3 id="æ…¢æŸ¥è¯¢">æ…¢æŸ¥è¯¢<a hidden class="anchor" aria-hidden="true" href="#æ…¢æŸ¥è¯¢">#</a></h3>
<p>èŒƒä¾‹ï¼šSLOW LOG</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>vim /etc/redis.conf
</span></span><span style="display:flex;"><span>slowlog-log-slower-than 1 #æŒ‡å®šè¶…è¿‡1uså³ä¸ºæ…¢çš„æŒ‡ä»¤ï¼Œé»˜è®¤å€¼ä¸º10000us
</span></span><span style="display:flex;"><span>slowlog-max-len 1024 #æŒ‡å®šåªä¿å­˜æœ€è¿‘çš„1024æ¡æ…¢è®°å½•ï¼Œé»˜è®¤å€¼ä¸º128
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; SLOWLOG LEN #æŸ¥çœ‹æ…¢æ—¥å¿—çš„è®°å½•æ¡æ•°
</span></span><span style="display:flex;"><span>(integer) 14
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; SLOWLOG GET [n] #æŸ¥çœ‹æ…¢æ—¥å¿—çš„næ¡è®°å½•
</span></span><span style="display:flex;"><span>1) 1) (integer) 14
</span></span><span style="display:flex;"><span>2) (integer) 1544690617
</span></span><span style="display:flex;"><span>3) (integer) 4 #ç¬¬3)è¡Œè¡¨ç¤ºæ¯æ¡æŒ‡ä»¤çš„æ‰§è¡Œæ—¶é•¿
</span></span><span style="display:flex;"><span>4) 1) &#34;slowlog&#34;
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; SLOWLOG GET 3
</span></span><span style="display:flex;"><span>1) 1) (integer) 7
</span></span><span style="display:flex;"><span>2) (integer) 1602901545
</span></span><span style="display:flex;"><span>3) (integer) 26
</span></span><span style="display:flex;"><span>4) 1) &#34;SLOWLOG&#34;
</span></span><span style="display:flex;"><span>2) &#34;get&#34;
</span></span><span style="display:flex;"><span>5) &#34;127.0.0.1:38258&#34;
</span></span><span style="display:flex;"><span>6) &#34;&#34;
</span></span><span style="display:flex;"><span>2) 1) (integer) 6
</span></span><span style="display:flex;"><span>2) (integer) 1602901540
</span></span><span style="display:flex;"><span>3) (integer) 22
</span></span><span style="display:flex;"><span>4) 1) &#34;SLOWLOG&#34;
</span></span><span style="display:flex;"><span>2) &#34;get&#34;
</span></span><span style="display:flex;"><span>3) &#34;2&#34;
</span></span><span style="display:flex;"><span>5) &#34;127.0.0.1:38258&#34;
</span></span><span style="display:flex;"><span>6) &#34;&#34;
</span></span><span style="display:flex;"><span>3) 1) (integer) 5
</span></span><span style="display:flex;"><span>2) (integer) 1602901497
</span></span><span style="display:flex;"><span>3) (integer) 22
</span></span><span style="display:flex;"><span>4) 1) &#34;SLOWLOG&#34;
</span></span><span style="display:flex;"><span>2) &#34;GET&#34;
</span></span><span style="display:flex;"><span>5) &#34;127.0.0.1:38258&#34;
</span></span><span style="display:flex;"><span>6) &#34;&#34;
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; SLOWLOG RESET #æ¸…ç©ºæ…¢æ—¥å¿—
</span></span><span style="display:flex;"><span>OK
</span></span></code></pre></div><h3 id="redisæŒä¹…åŒ–">RedisæŒä¹…åŒ–<a hidden class="anchor" aria-hidden="true" href="#redisæŒä¹…åŒ–">#</a></h3>
<p><img loading="lazy" src="/posts.images/image.assets/1670853239934.png" alt="1670853239934"  />
</p>
<h4 id="rdb">RDB<a hidden class="anchor" aria-hidden="true" href="#rdb">#</a></h4>
<p>RDB å·¥ä½œåŸç†</p>
<p><img loading="lazy" src="/posts.images/image.assets/1670853325839.png" alt="1670853325839"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1670853341364.png" alt="1670853341364"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1670853373976.png" alt="1670853373976"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1670853388030.png" alt="1670853388030"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1670853405541.png" alt="1670853405541"  />
</p>
<h4 id="é…ç½®">é…ç½®<a hidden class="anchor" aria-hidden="true" href="#é…ç½®">#</a></h4>
<p><img loading="lazy" src="/posts.images/image.assets/1670853437912.png" alt="1670853437912"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1670853466251.png" alt="1670853466251"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1670853480093.png" alt="1670853480093"  />
</p>
<h4 id="aof">AOF<a hidden class="anchor" aria-hidden="true" href="#aof">#</a></h4>
<p><img loading="lazy" src="/posts.images/image.assets/1670853532980.png" alt="1670853532980"  />
</p>
<p><img loading="lazy" src="/posts.images/image.assets/1670853557144.png" alt="1670853557144"  />
</p>


        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://xyenvy.github.io/posts/redis%E9%9B%86%E7%BE%A4%E5%92%8C%E9%AB%98%E5%8F%AF%E7%94%A8/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>Redisé›†ç¾¤å’Œé«˜å¯ç”¨</span>
  </a>
  <a class="next" href="https://xyenvy.github.io/posts/nginx/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>Nginx</span>
  </a>
</nav>

        </footer>
    </div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        2022-2023
        <a href="https://xyenvy.github.io/" style="color:#939393;">DevOpsHub</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;">é»”ICPå¤‡2022006994å·-2</a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="/img/beian.png" style="float:left;margin: 0px 5px 0px 0px;"/>
            é»”å…¬ç½‘å®‰å¤‡2022006994å·
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"DevOpsHub"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"DevOpsHub"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'ğŸ“„å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'ğŸ‘ŒğŸ»å·²å¤åˆ¶!';
            setTimeout(() => {
                copybutton.innerText = 'ğŸ“„å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"DevOpsHub"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>
</body>

</html>
