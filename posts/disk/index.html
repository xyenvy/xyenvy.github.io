<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>磁盘存储和文件系统管理 | DevOpsHub</title>
<meta name="keywords" content="Linux">
<meta name="description" content="磁盘是计算机主要的存储介质，可以存储大量的二进制数据，并且断电后也能保持数据不丢失，使用磁盘存储数据的时候我们可以将磁盘划分成我们所需要的格式来进行使用">
<meta name="author" content="">
<link rel="canonical" href="http://colorfulgz.com/posts/disk/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://colorfulgz.com/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="http://colorfulgz.com/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="http://colorfulgz.com/img/Q.gif">
<link rel="apple-touch-icon" href="http://colorfulgz.com/img/Q.gif">
<link rel="mask-icon" href="http://colorfulgz.com/img/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="磁盘存储和文件系统管理" />
<meta property="og:description" content="磁盘是计算机主要的存储介质，可以存储大量的二进制数据，并且断电后也能保持数据不丢失，使用磁盘存储数据的时候我们可以将磁盘划分成我们所需要的格式来进行使用" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://colorfulgz.com/posts/disk/" />
<meta property="og:image" content="http://colorfulgz.com/posts.images/banner/10.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-07T08:40:59+00:00" />
<meta property="article:modified_time" content="2022-08-07T08:40:59+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://colorfulgz.com/posts.images/banner/10.jpg" />
<meta name="twitter:title" content="磁盘存储和文件系统管理"/>
<meta name="twitter:description" content="磁盘是计算机主要的存储介质，可以存储大量的二进制数据，并且断电后也能保持数据不丢失，使用磁盘存储数据的时候我们可以将磁盘划分成我们所需要的格式来进行使用"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "📚文章",
          "item": "http://colorfulgz.com/posts/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "磁盘存储和文件系统管理",
      "item": "http://colorfulgz.com/posts/disk/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "磁盘存储和文件系统管理",
  "name": "磁盘存储和文件系统管理",
  "description": "磁盘是计算机主要的存储介质，可以存储大量的二进制数据，并且断电后也能保持数据不丢失，使用磁盘存储数据的时候我们可以将磁盘划分成我们所需要的格式来进行使用",
  "keywords": [
    "Linux"
  ],
  "articleBody": "磁盘管理与文件系统 前言 磁盘是计算机主要的存储介质，可以存储大量的二进制数据，并且断电后也能保持数据不丢失，使用磁盘存储数据的时候我们可以将磁盘划分成我们所需要的格式来进行使用\n1. 磁盘结构 1、硬盘的物理结构 盘片：硬盘有多个盘片，每个盘片有2面 磁头：每面有一个磁头\n2.硬盘数据结构 扇区：磁盘上的每个磁道被等分为若干个弧段，这些弧段便是硬盘的扇区。硬盘的第一个扇区，叫做引导扇区 ，盘片被分为多个扇形区域，每个扇区存放512字节的数据，是硬盘最小的存储单元 磁道：当磁盘旋转时，磁头若保持在一个位置上，则每个磁头都会在磁盘表面划出一个圆形轨迹，这些圆形轨迹就叫做磁道 柱面：在有多个盘片构成的盘组中，由不同盘片的面，但处于同一半径圆的多个磁道组成的一个圆柱面\n3、磁盘结构 硬盘存储容量 = 磁头数 x 磁道（柱面）数 x 每道扇区数 x 每扇区字节数（512字节） 可以用柱面/磁头/扇区来唯一定位磁盘上的每一个区域 磁盘的接口类型：IDE、SATA、SCSI、SAS、光纤通道 用 fdisk -l 查看分区信息\n2. 管理存储 2.1 磁盘分区 2.1.1 为什么分区 优化I/O性能 实现磁盘空间配额限制 提高修复速度 隔离系统和程序 安装多个OS 采用不同文件系统 2.1.2 分区方式 两种分区方式：MBR，GPT\nMBR分区\nMBR：Master Boot Record，1982年，使用32位表示扇区数，分区不超过2T 划分分区的单位： CentOS 5 之前按整柱面划分 CentOS 6 版本后可以按Sector划分 0磁道0扇区：512bytes 446bytes: boot loader 启动相关 64bytes：分区表，其中每16bytes标识一个分区 2bytes: 55AA，标识位 MBR分区中一块硬盘最多有4个主分区，也可以3主分区+1扩展(N个逻辑分区) MBR分区：主和扩展分区对应的1–4，/dev/sda3，逻辑分区从5开始，/dev/sda5\n问题：利用分区策略相同的另一台主机的分区表来还原和恢复当前主机破环的分区表？\nGPT分区 GPT：GUID（Globals Unique Identifiers） partition table 支持128个分区，使用64位，支持8Z（ 512Byte/block ）64Z （ 4096Byte/block） 使用128位UUID(Universally Unique Identifier) 表示磁盘和分区 GPT分区表自动备份在头和尾两份， 并有CRC校验位 UEFI (Unified Extensible Firmware Interface 统一可扩展固件接口)硬件支持GPT，使得操作系统可以 启动\nGPT分区结构分为4个区域：\nGPT头 分区表 GPT分区 备份区域 2.2 管理分区 列出块设备\nlsblk 创建分区命令\nfdisk 管理MBR分区 gdisk 管理GPT分区 parted 高级分区操作，可以是交互或非交互方式 重新设置内存中的内核分区表版本，适合于除了CentOS 6 以外的其它版本 5，7，8\npartprobe 2.2.1 添加并检测新硬盘 1、添加新硬盘使用lsblk命令显示出块设备\nroot@ubuntu200404:~# lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT loop0 7:0 0 61.9M 1 loop /snap/core20/1328 loop1 7:1 0 67.2M 1 loop /snap/lxd/21835 loop2 7:2 0 62M 1 loop /snap/core20/1587 loop3 7:3 0 43.6M 1 loop /snap/snapd/14978 loop4 7:4 0 47M 1 loop /snap/snapd/16292 loop5 7:5 0 67.8M 1 loop /snap/lxd/22753 sda 8:0 0 20G 0 disk ├─sda1 8:1 0 1M 0 part ├─sda2 8:2 0 1.5G 0 part /boot └─sda3 8:3 0 18.5G 0 part └─ubuntu--vg-ubuntu--lv 253:0 0 10G 0 lvm / sr0 11:0 1 1.2G 0 rom 发现并没有检测出来新添加的硬盘\n2、检测新硬盘\n方法1：可以重启电脑\n方法2： 重新扫描存储设备的scsi总线\n# host后面的数字不是固定的，以实际为准 root@ubuntu200404:~# echo '- - -' \u003e /sys/class/scsi_host/host32/scan 再次使用lsblk命令查看发现已经多了sda的硬盘，说明成功了\nroot@ubuntu200404:~# lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT loop0 7:0 0 61.9M 1 loop /snap/core20/1328 loop1 7:1 0 67.2M 1 loop /snap/lxd/21835 loop2 7:2 0 62M 1 loop /snap/core20/1587 loop3 7:3 0 43.6M 1 loop /snap/snapd/14978 loop4 7:4 0 47M 1 loop /snap/snapd/16292 loop5 7:5 0 67.8M 1 loop /snap/lxd/22753 sda 8:0 0 20G 0 disk ├─sda1 8:1 0 1M 0 part ├─sda2 8:2 0 1.5G 0 part /boot └─sda3 8:3 0 18.5G 0 part └─ubuntu--vg-ubuntu--lv 253:0 0 10G 0 lvm / sdb 8:16 0 20G 0 disk # 新添加的硬盘 sr0 11:0 1 1.2G 0 rom 2.2.2 partend命令 注意：parted的操作都是实时生效的，小心使用\n格式:\nparted [选项]... [设备 [命令 [参数]...]...] 范例：\nparted /dev/sdb mklabel gpt|msdos parted /dev/sdb print parted /dev/sdb mkpart primary 1 200 （默认M） parted /dev/sdb rm 1 parted -l 列出所有硬盘分区信息 2.2.3 分区工具fdisk和gdisk fdisk -l [-u] [device...] 查看分区 fdisk [device...] 管理MBR分区 gdisk [device...] 类fdisk 的GPT分区工具 # 范例： fdisk /dev/sdb 子命令：\np 分区列表 t 更改分区类型 n 创建新分区 d 删除分区 v 校验分区 u 转换单位 w 保存并退出 q 不保存并退出 查看内核是否已经识别新的分区\ncat /proc/partitions CentOS 7,8 同步分区表:\npartprobe 2.3 文件系统 2.3.1 文件系统概念 文件系统是操作系统用于明确存储设备或分区上的文件的方法和数据结构；即在存储设备上组织文件的 方法。操作系统中负责管理和存储文件信息的软件结构称为文件管理系统，简称文件系统 从系统角度来看，文件系统是对文件存储设备的空间进行组织和分配，负责文件存储并对存入的文件进 行保护和检索的系统。具体地说，它负责为用户建立文件，存入、读出、修改、转储文件，控制文件的 存取，安全控制，日志，压缩，加密等 支持的文件系统：\n/lib/modules/`uname -r`/kernel/fs 各种文件系统\n帮助：man 5 fs\n2.3.2 文件系统类型 Linux常用文件系统\next2：Extended file system 适用于那些分区容量不是太大，更新也不频繁的情况，例如 /boot 分 区 ext3：是 ext2 的改进版本，其支持日志功能，能够帮助系统从非正常关机导致的异常中恢复 ext4：是 ext 文件系统的最新版。提供了很多新的特性，包括纳秒级时间戳、创建和使用巨型文件 (16TB)、最大1EB的文件系统，以及速度的提升 xfs：SGI，支持最大8EB的文件系统 swap iso9660 光盘 btrfs（Oracle） reiserfs Windows 常用文件系统\nFAT32 NTFS exFAT Unix： FFS（fast） UFS（unix） JFS2 网络文件系统：\nNFS CIFS 集群文件系统：\nGFS2 OCFS2（oracle） 分布式文件系统：\nfastdfs ceph moosefs mogilefs glusterfs Lustre RAW：\n裸文件系统,未经处理或者未经格式化产生的文件系统 常用的文件系统特性：\nFAT32\n最多只能支持16TB的文件系统和4GB的文件 NTFS\n最多只能支持16EB的文件系统和16EB的文件 EXT3\n最多只能支持32TB的文件系统和2TB的文件，实际只能容纳2TB的文件系统和16GB的文件 Ext3目前只支持32000个子目录 Ext3文件系统使用32位空间记录块数量和 inode数量 当数据写入到Ext3文件系统中时，Ext3的数据块分配器每次只能分配一个4KB的块 EXT4：\nEXT4是Linux系统下的日志文件系统，是EXT3文件系统的后继版本 Ext4的文件系统容量达到1EB，而支持单个文件则达到16TB 理论上支持无限数量的子目录 Ext4文件系统使用64位空间记录块数量和 inode数量 Ext4的多块分配器支持一次调用分配多个数据块 修复速度更快 XFS\n根据所记录的日志在很短的时间内迅速恢复磁盘文件内容 用优化算法，日志记录对整体文件操作影响非常小 是一个全64-bit的文件系统，最大可以支持8EB的文件系统，而支持单个文件则达到8EB 能以接近裸设备I/O的性能存储数据 查前支持的文件系统：\ncat /proc/filesystems 2.3.3 文件系统的组成部分 内核中的模块：ext4, xfs, vfat Linux的虚拟文件系统：VFS 用户空间的管理工具：mkfs.ext4, mkfs.xfs,mkfs.vfat\n2.3.4 文件系统选择管理 2.3.4.1 创建文件系统 创建文件管理工具\nmkfs命令： (1) mkfs.FS_TYPE /dev/DEVICE ext4 xfs btrfs vfat (2) mkfs -t FS_TYPE /dev/DEVICE -L 'LABEL' 设定卷标 mke2fs：ext系列文件系统专用管理工具 常用选项：\n-t {ext2|ext3|ext4|xfs} 指定文件系统类型 -b {1024|2048|4096} 指定块 block 大小 -L ‘LABEL’ 设置卷标 -j 相当于 -t ext3， mkfs.ext3 = mkfs -t ext3 = mke2fs -j = mke2fs -t ext3 -i # 为数据空间中每多少个字节创建一个inode；不应该小于block大 小 -N # 指定分区中创建多少个inode -I 一个inode记录占用的磁盘空间大小，128---4096 -m # 默认5%,为管理人员预留空间占总空间的百分比 -O FEATURE[,...] 启用指定特性 -O ^FEATURE 案例：mkfs.ext4 /dev/sdb1\nroot@ubuntu200404:~# mkfs.ext4 /dev/sdb1 mke2fs 1.45.5 (07-Jan-2020) Creating filesystem with 2621440 4k blocks and 655360 inodes Filesystem UUID: a7ef4142-26e5-43dd-b9d0-24c4d09155a1 Superblock backups stored on blocks: 32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632 Allocating group tables: done Writing inode tables: done Creating journal (16384 blocks): done Writing superblocks and filesystem accounting information: done root@ubuntu200404:~# 2.3.4.2 查看和管理分区信息 blkid 可以查看块设备属性信息 格式：\nblkid [OPTION]... [DEVICE] 常用选项：\n-U UUID 根据指定的UUID来查找对应的设备 -L LABEL 根据指定的LABEL来查找对应的设备 e2label：管理ext系列文件系统的LABEL e2label DEVICE [LABEL] 范例\nroot@ubuntu200404:~# blkid /dev/sdb1 /dev/sdb1: UUID=\"a7ef4142-26e5-43dd-b9d0-24c4d09155a1\" TYPE=\"ext4\" PARTUUID=\"db60ac71-01\" root@ubuntu200404:~# 查找分区\nfindfs [options] LABEL= findfs [options] UUID= tune2fs：重新设定ext系列文件系统可调整参数的值\n-l 查看指定文件系统超级块信息；super block -L 'LABEL’ 修改卷标 -m # 修预留给管理员的空间百分比 -j 将ext2升级为ext3 -O 文件系统属性启用或禁用, -O ^has_journal -o 调整文件系统的默认挂载选项，-o ^acl -U UUID 修改UUID号 dumpe2fs：显示ext文件系统信息，将磁盘块分组管理 -h：查看超级块信息，不显示分组信息\n范例：查看ext文件系统的元数据和块组信息\nroot@ubuntu200404:~# dumpe2fs /dev/sdb1 dumpe2fs 1.45.5 (07-Jan-2020) Filesystem volume name: Last mounted on: Filesystem UUID: a7ef4142-26e5-43dd-b9d0-24c4d09155a1 Filesystem magic number: 0xEF53 Filesystem revision #: 1 (dynamic) Filesystem features: has_journal ext_attr resize_inode dir_index filetype extent 64bit flex_bg sparse_super large_file huge_file dir_nlink extra_isize metadata_csum Filesystem flags: signed_directory_hash Default mount options: user_xattr acl Filesystem state: clean Errors behavior: Continue Filesystem OS type: Linux Inode count: 655360 Block count: 2621440 Reserved block count: 131072 Free blocks: 2554687 Free inodes: 655349 First block: 0 ...... ...... ...... xfs_info：显示示挂载或已挂载的 xfs 文件系统信息\nxfs_info mountpoint|devname 范例\nxfs_info /dev/sda1 2.3.4.3 文件系统检测和修复 文件系统夹故障常发生于死机或者非正常关机之后，挂载为文件系统标记为“no clean” 注意：一定不要在挂载状态下执行下面命令修复\nfsck: File System Check\nfsck.FS_TYPE fsck -t FS_TYPE 注意：FS_TYPE 一定要与分区上已经文件类型相同\n常用选项\n-a 自动修复 -r 交互式修复错误 e2fsck：ext系列文件专用的检测修复工具\n-y 自动回答为yes -f 强制修复 -p 自动进行安全的修复文件系统问题 用法：\ne2fsck /dev/sdb2 xfs_repair：xfs文件系统专用检测修复工具 常用选项：\n-f 修复文件，而设备 -n 只检查 -d 允许修复只读的挂载设备，在单用户下修复 / 时使用，然后立即reboot 用法：\nxfs_repair /dev/sda1 2.4 挂载 挂载:将额外文件系统与根文件系统某现存的目录建立起关联关系，进而使得此目录做为其它文件访问入 口的行为 卸载:为解除此关联关系的过程 把设备关联挂载点：mount Point 挂载点下原有文件在挂载完成后会被临时隐藏，因此，挂载点目录一般为空 进程正在使用中的设备无法被卸载\n2.4.1 挂载文件系统 mount 格式\nmount [-fnrsvw] [-t vfstype] [-o options] device mountpoint device：指明要挂载的设备\n设备文件：例如:/dev/sda5 卷标：-L ‘LABEL’, 例如 -L ‘MYDATA’ UUID： -U ‘UUID’：例如 -U ‘0c50523c-43f1-45e7-85c0-a126711d406e’ 伪文件系统名称：proc, sysfs, devtmpfs, configfs mountpoint：挂载点目录必须事先存在，建议使用空目录 mount 常用命令选项\n-t fstype 指定要挂载的设备上的文件系统类型,如:ext4,xfs -r readonly，只读挂载 -w read and write, 读写挂载,此为默认设置,可省略 -n 不更新/etc/mtab，mount不可见 -a 自动挂载所有支持自动挂载的设备(定义在了/etc/fstab文件中，且挂载选项中有 auto功能) -L 'LABEL' 以卷标指定挂载设备 -U 'UUID' 以UUID指定要挂载的设备 -B, --bind 绑定目录到另一个目录上 -o options：(挂载文件系统的选项)，多个选项使用逗号分隔 async 异步模式,内存更改时,写入缓存区buffer,过一段时间再写到磁盘中，效率高，但不安全 sync 同步模式,内存更改时，同时写磁盘，安全，但效率低下 atime/noatime 包含目录和文件 diratime/nodiratime 目录的访问时间戳 auto/noauto 是否支持开机自动挂载，是否支持-a选项 exec/noexec 是否支持将文件系统上运行应用程序 dev/nodev 是否支持在此文件系统上使用设备文件 suid/nosuid 是否支持suid和sgid权限 remount 重新挂载 ro/rw 只读、读写 user/nouser 是否允许普通用户挂载此设备，/etc/fstab使用 acl/noacl 启用此文件系统上的acl功能 loop 使用loop设备 _netdev 当网络可用时才对网络资源进行挂载，如：NFS文件系统 defaults 相当于rw, suid, dev, exec, auto, nouser, async 挂载规则:\n一个挂载点同一时间只能挂载一个设备 一个挂载点同一时间挂载了多个设备，只能看到最后一个设备的数据，其它设备上的数据将被隐藏 一个设备可以同时挂载到多个挂载点 通常挂载点一般是已存在空的目录 范例:挂载案例\nroot@ubuntu200404:/data# mount /dev/sdb1 /data/mysql_mount/ root@ubuntu200404:/data# df 2.4.2 卸载文件系统 umount 卸载时：可使用设备，也可以使用挂载点\numount 设备名|挂载点 2.4.3 查看挂载情况 查看挂载\n#通过查看/etc/mtab文件显示当前已挂载的所有设备 mount #查看内核追踪到的已挂载的所有设备 cat /proc/mounts 查看挂载点情况\nfindmnt MOUNT_POINT|device 查看正在访问指定文件系统的进程\nlsof MOUNT_POINT fuser -v MOUNT_POINT 终止所有在正访问指定的文件系统的进程\nfuser -km MOUNT_POINT 2.4.4 持久挂载 将挂载保存到 /etc/fstab 中可以下次开机时，自动启用挂载 /etc/fstab格式帮助：\nman 5 fstab 每行定义一个要挂载的文件系统,，其中包括共 6 项\n要挂载的设备或伪文件系统设备文件 LABEL：LABEL=\"\" UUID：UUID=\"\" 伪文件系统名称：proc, sysfs 挂载点：必须是事先存在的目录 文件系统类型：ext4，xfs，iso9660，nfs，none 挂载选项：defaults ，acl，bind 转储频率：0：不做备份 1：每天转储 2：每隔一天转储 fsck检查的文件系统的顺序：允许的数字是0 1 2 0：不自检 ，1：首先自检；一般只有rootfs才用 2：非rootfs使用 添加新的挂载项，需要执行下面命令生效\nmount -a 范例：centos7, 8 /etc/fstab 的分区UUID错误，无法启动*\n自动进入emergency mode,输入root 密码 #cat /proc/mounts 可以查看到/ 以rw方式挂载 #vim /etc/fstab #reboot 范例：centos 6 /etc/fstab 的分区UUID错误，无法启动\n如果/etc/fstab 的挂载设备出错，比如文件系统故障，并且文件系统检测项（即第6项为非0），将导致无 法启动 自动进入emergency mode,输入root 密码 #cat /proc/mounts 可以查看到/ 以ro方式挂载，无法直接修改配置文件 #mount -o remount,rw / #vim /etc/fstab 将故障行的最后1项，即第6项修改为0，开机不检测此项挂载设备的健康性，从而忽略错误，能实现启动 范例：/etc/fstab格式\nroot@ubuntu200404:/data# cat /etc/fstab # /etc/fstab: static file system information. # # Use 'blkid' to print the universally unique identifier for a # device; this may be used with UUID= as a more robust way to name devices # that works even if disks are added and removed. See fstab(5). # # # / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation /dev/disk/by-id/dm-uuid-LVM-3aQ0WgB04ZXwNPYVAYy9ssb3Wd06E34ggUUxCcYQaVwAb0L03K40wpOxbnqqqa3f / ext4 defaults 0 1 # /boot was on /dev/sda2 during curtin installation /dev/disk/by-uuid/5e8f9763-2db8-48d0-85e2-a26d76521e2f /boot ext4 defaults 0 1 /swap.img none swap sw 0 0 root@ubuntu200404:/data# 范例：添加新的挂载点后修改/etc/fstab文件\n# /etc/fstab: static file system information. # # Use 'blkid' to print the universally unique identifier for a # device; this may be used with UUID= as a more robust way to name devices # that works even if disks are added and removed. See fstab(5). # # # / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation /dev/disk/by-id/dm-uuid-LVM-3aQ0WgB04ZXwNPYVAYy9ssb3Wd06E34ggUUxCcYQaVwAb0L03K40wpOxbnqqqa3f / ext4 defaults 0 1 # /boot was on /dev/sda2 during curtin installation /dev/disk/by-uuid/5e8f9763-2db8-48d0-85e2-a26d76521e2f /boot ext4 defaults 0 1 /swap.img none swap sw 0 0 # 添加该行后、重启系统 UUID=0e850a4a-028d-48b2-aa18-dd8b16090aa6 /data/mysql_mount ext4 defaults 0 0 2.5 处理交换文件和分区 2.5.1 swap分区 swap交换分区是系统RAM的补充，swap 分区支持虚拟内存。当没有足够的 RAM 保存系统处理的数据 时会将数据写入 swap 分区，当系统缺乏 swap 空间时，内核会因 RAM 内存耗尽而终止进程。配置过 多 swap 空间会造成存储设备处于分配状态但闲置，造成浪费，过多 swap 空间还会掩盖内存泄露 注意：为优化性能，可以将swap 分布存放，或高性能磁盘存放\n2.5.2 交换分区实现过程 创建交换分区或者文件 使用mkswap写入特殊签名 在/etc/fstab文件中添加适当的条目 使用swapon -a 激活交换空间 启用swap分区\nswapon [OPTION]... [DEVICE] 常用选项\n-a #激活所有的交换分区 -p PRIORITY #指定优先级(-1到32767之间)，值越大,优先级越高.也可在/etc/fstab文件中的第4列指 定：pri=value 范例:创建swap分区\n[root@centos8 ~]#mkswap /dev/sdc1 禁用swap分区\nswapoff [OPTION]... [DEVICE] 范例:禁用swap分区\n[root@centos8 ~]#sed -i.bak '/swap/d' /etc/fstab [root@centos8 ~]#swapoff -a 2.5.3 swap的使用策略 /proc/sys/vm/swappiness 的值决定了当内存占用达到一定的百分比时，会启用swap分区的空间 使用规则\n当内存使用率达到100-swappiness时,会启用交换分区 简单地说这个参数定义了系统对swap的使用倾向，此值越大表示越倾向于使用swap。 可以设为0，这样做并不会禁止对swap的使用，只是最大限度地降低了使用swap的可能性 范例\n#说明：CentOS7和8默认值为30，内存在使用到100-30=70%的时候，就开始出现有交换分区的使用。 [root@centos8 ~]# cat /proc/sys/vm/swappiness 2.6 磁盘常见工具 2.6.1 df 文件系统空间实际真正占用等信息的查看工具 df\ndf [OPTION]... [FILE]... 常用选项\n-H 以10为单位 -T 文件系统类型 -h human-readable -i inodes instead of blocks -P 以Posix兼容的格式输出 2.6.3 du 查看某目录总体空间实际占用状态 du\n显示指定目录下面各个子目录的大小,单位为KB\n常用选项\n-a --all 显示所有文件和目录的大小,默认只显示目录大小 -h human-readable -s summary --max-depth=# 指定最大目录层级 -x, --one-file-system #忽略不在同一个文件系统的目录 面试题\n1.df 和 du 区别?什么时候df \u003edu（空分区的时候) df 查看是文件系统的空间使用，包括元数据和数据，删除文件后，如果此文件正在使用，不会立即释放空间;du 查看是文件数据空间使用，不包括元数据，删除文件后空间立即释放。\n2.什么时候df \u003c du? 目录内挂载有其它分区时的情况\n3.当删除文件但不释放空间时,有什么不同? du 查看文件空间释放,df不释放\n3. RAID ",
  "wordCount" : "6511",
  "inLanguage": "en",
  "image":"http://colorfulgz.com/posts.images/banner/10.jpg","datePublished": "2022-08-07T08:40:59Z",
  "dateModified": "2022-08-07T08:40:59Z",
  "author":[{
    "@type": "Person",
    "name": ""
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://colorfulgz.com/posts/disk/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "DevOpsHub",
    "logo": {
      "@type": "ImageObject",
      "url": "http://colorfulgz.com/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://colorfulgz.com" accesskey="h" title="DevOpsHub (Alt + H)">
            <img src="http://colorfulgz.com/img/Q.gif" alt="logo" aria-label="logo"
                 height="35">DevOpsHub</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://colorfulgz.com/search" title="🔍 搜索 (Alt &#43; /)" accesskey=/>
                <span>🔍 搜索</span>
                </a>
            </li>
            <li>
                <a href="http://colorfulgz.com/" title="🏠 主页">
                <span>🏠 主页</span>
                </a>
            </li>
            <li>
                <a href="http://colorfulgz.com/posts" title="📚 文章">
                <span>📚 文章</span>
                </a>
            </li>
            <li>
                <a href="http://colorfulgz.com/tags" title="🧩 标签">
                <span>🧩 标签</span>
                </a>
            </li>
            <li>
                <a href="http://colorfulgz.com/archives/" title="⏱️ 时间轴">
                <span>⏱️ 时间轴</span>
                </a>
            </li>
            <li>
                <a href="http://colorfulgz.com/about" title="🙋🏻‍♂️ 关于">
                <span>🙋🏻‍♂️ 关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="http://colorfulgz.com">🏠 主页</a>&nbsp;»&nbsp;<a href="http://colorfulgz.com/posts/">📚文章</a></div>
            <h1 class="post-title">
                磁盘存储和文件系统管理
            </h1>
            <div class="post-description">
                磁盘是计算机主要的存储介质，可以存储大量的二进制数据，并且断电后也能保持数据不丢失，使用磁盘存储数据的时候我们可以将磁盘划分成我们所需要的格式来进行使用
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2022-08-07
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>6511字
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>13分钟
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="http://colorfulgz.com/tags/linux/" style="color: var(--secondary)!important;">Linux</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "http://colorfulgz.com"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="http://colorfulgz.com/posts.images/banner/10.jpg" alt="">
    
</figure><aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">文章目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e7%a3%81%e7%9b%98%e7%ae%a1%e7%90%86%e4%b8%8e%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f" aria-label="磁盘管理与文件系统">磁盘管理与文件系统</a></li>
                <li>
                    <a href="#1-%e7%a3%81%e7%9b%98%e7%bb%93%e6%9e%84" aria-label="1. 磁盘结构">1. 磁盘结构</a></li>
                <li>
                    <a href="#2-%e7%ae%a1%e7%90%86%e5%ad%98%e5%82%a8" aria-label="2. 管理存储">2. 管理存储</a></li>
                <li>
                    <a href="#21-%e7%a3%81%e7%9b%98%e5%88%86%e5%8c%ba" aria-label="2.1 磁盘分区">2.1 磁盘分区</a><ul>
                        
                <li>
                    <a href="#211-%e4%b8%ba%e4%bb%80%e4%b9%88%e5%88%86%e5%8c%ba" aria-label="2.1.1 为什么分区">2.1.1 为什么分区</a></li>
                <li>
                    <a href="#212-%e5%88%86%e5%8c%ba%e6%96%b9%e5%bc%8f" aria-label="2.1.2 分区方式">2.1.2 分区方式</a></li></ul>
                </li>
                <li>
                    <a href="#22-%e7%ae%a1%e7%90%86%e5%88%86%e5%8c%ba" aria-label="2.2 管理分区">2.2 管理分区</a><ul>
                        
                <li>
                    <a href="#221-%e6%b7%bb%e5%8a%a0%e5%b9%b6%e6%a3%80%e6%b5%8b%e6%96%b0%e7%a1%ac%e7%9b%98" aria-label="2.2.1 添加并检测新硬盘">2.2.1 添加并检测新硬盘</a></li>
                <li>
                    <a href="#222-partend%e5%91%bd%e4%bb%a4" aria-label="2.2.2 partend命令">2.2.2 partend命令</a></li>
                <li>
                    <a href="#223-%e5%88%86%e5%8c%ba%e5%b7%a5%e5%85%b7fdisk%e5%92%8cgdisk" aria-label="2.2.3 分区工具fdisk和gdisk">2.2.3 分区工具fdisk和gdisk</a></li></ul>
                </li>
                <li>
                    <a href="#23-%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f" aria-label="2.3 文件系统">2.3 文件系统</a><ul>
                        
                <li>
                    <a href="#231-%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e6%a6%82%e5%bf%b5" aria-label="2.3.1 文件系统概念">2.3.1 文件系统概念</a></li>
                <li>
                    <a href="#232-%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%b1%bb%e5%9e%8b" aria-label="2.3.2 文件系统类型">2.3.2 文件系统类型</a></li>
                <li>
                    <a href="#233-%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e7%9a%84%e7%bb%84%e6%88%90%e9%83%a8%e5%88%86" aria-label="2.3.3 文件系统的组成部分">2.3.3 文件系统的组成部分</a></li>
                <li>
                    <a href="#234-%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e9%80%89%e6%8b%a9%e7%ae%a1%e7%90%86" aria-label="2.3.4 文件系统选择管理">2.3.4 文件系统选择管理</a><ul>
                        
                <li>
                    <a href="#2341-%e5%88%9b%e5%bb%ba%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f" aria-label="2.3.4.1 创建文件系统">2.3.4.1 创建文件系统</a></li>
                <li>
                    <a href="#2342-%e6%9f%a5%e7%9c%8b%e5%92%8c%e7%ae%a1%e7%90%86%e5%88%86%e5%8c%ba%e4%bf%a1%e6%81%af" aria-label="2.3.4.2 查看和管理分区信息">2.3.4.2 查看和管理分区信息</a></li>
                <li>
                    <a href="#2343-%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f%e6%a3%80%e6%b5%8b%e5%92%8c%e4%bf%ae%e5%a4%8d" aria-label="2.3.4.3 文件系统检测和修复">2.3.4.3 文件系统检测和修复</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#24-%e6%8c%82%e8%bd%bd" aria-label="2.4 挂载">2.4 挂载</a><ul>
                        
                <li>
                    <a href="#241-%e6%8c%82%e8%bd%bd%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f-mount" aria-label="2.4.1 挂载文件系统 mount">2.4.1 挂载文件系统 mount</a></li>
                <li>
                    <a href="#242-%e5%8d%b8%e8%bd%bd%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f-umount" aria-label="2.4.2 卸载文件系统 umount">2.4.2 卸载文件系统 umount</a></li>
                <li>
                    <a href="#243-%e6%9f%a5%e7%9c%8b%e6%8c%82%e8%bd%bd%e6%83%85%e5%86%b5" aria-label="2.4.3 查看挂载情况">2.4.3 查看挂载情况</a></li>
                <li>
                    <a href="#244-%e6%8c%81%e4%b9%85%e6%8c%82%e8%bd%bd" aria-label="2.4.4 持久挂载">2.4.4 持久挂载</a></li></ul>
                </li>
                <li>
                    <a href="#25-%e5%a4%84%e7%90%86%e4%ba%a4%e6%8d%a2%e6%96%87%e4%bb%b6%e5%92%8c%e5%88%86%e5%8c%ba" aria-label="2.5 处理交换文件和分区">2.5 处理交换文件和分区</a><ul>
                        
                <li>
                    <a href="#251-swap%e5%88%86%e5%8c%ba" aria-label="2.5.1 swap分区">2.5.1 swap分区</a></li>
                <li>
                    <a href="#252-%e4%ba%a4%e6%8d%a2%e5%88%86%e5%8c%ba%e5%ae%9e%e7%8e%b0%e8%bf%87%e7%a8%8b" aria-label="2.5.2 交换分区实现过程">2.5.2 交换分区实现过程</a></li>
                <li>
                    <a href="#253-swap%e7%9a%84%e4%bd%bf%e7%94%a8%e7%ad%96%e7%95%a5" aria-label="2.5.3 swap的使用策略">2.5.3 swap的使用策略</a></li></ul>
                </li>
                <li>
                    <a href="#26-%e7%a3%81%e7%9b%98%e5%b8%b8%e8%a7%81%e5%b7%a5%e5%85%b7" aria-label="2.6 磁盘常见工具">2.6 磁盘常见工具</a><ul>
                        
                <li>
                    <a href="#261-df" aria-label="2.6.1 df">2.6.1 df</a></li>
                <li>
                    <a href="#263-du" aria-label="2.6.3 du">2.6.3 du</a></li></ul>
                </li>
                <li>
                    <a href="#3-raid" aria-label="3. RAID">3. RAID</a>
                </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h2 id="磁盘管理与文件系统">磁盘管理与文件系统<a hidden class="anchor" aria-hidden="true" href="#磁盘管理与文件系统">#</a></h2>
<p>前言
磁盘是计算机主要的存储介质，可以存储大量的二进制数据，并且断电后也能保持数据不丢失，使用磁盘存储数据的时候我们可以将磁盘划分成我们所需要的格式来进行使用</p>
<h2 id="1-磁盘结构">1. 磁盘结构<a hidden class="anchor" aria-hidden="true" href="#1-磁盘结构">#</a></h2>
<p>1、硬盘的物理结构
盘片：硬盘有多个盘片，每个盘片有2面
磁头：每面有一个磁头</p>
<p>2.硬盘数据结构
扇区：磁盘上的每个磁道被等分为若干个弧段，这些弧段便是硬盘的扇区。硬盘的第一个扇区，叫做引导扇区 ，盘片被分为多个扇形区域，每个扇区存放512字节的数据，是硬盘最小的存储单元
磁道：当磁盘旋转时，磁头若保持在一个位置上，则每个磁头都会在磁盘表面划出一个圆形轨迹，这些圆形轨迹就叫做磁道
柱面：在有多个盘片构成的盘组中，由不同盘片的面，但处于同一半径圆的多个磁道组成的一个圆柱面</p>
<p>3、磁盘结构
硬盘存储容量 = 磁头数 x 磁道（柱面）数 x 每道扇区数 x 每扇区字节数（512字节）
可以用柱面/磁头/扇区来唯一定位磁盘上的每一个区域
磁盘的接口类型：IDE、SATA、SCSI、SAS、光纤通道
用 fdisk -l 查看分区信息</p>
<h2 id="2-管理存储">2. 管理存储<a hidden class="anchor" aria-hidden="true" href="#2-管理存储">#</a></h2>
<h2 id="21-磁盘分区">2.1 磁盘分区<a hidden class="anchor" aria-hidden="true" href="#21-磁盘分区">#</a></h2>
<h3 id="211-为什么分区">2.1.1 为什么分区<a hidden class="anchor" aria-hidden="true" href="#211-为什么分区">#</a></h3>
<ul>
<li>优化I/O性能</li>
<li>实现磁盘空间配额限制</li>
<li>提高修复速度</li>
<li>隔离系统和程序</li>
<li>安装多个OS</li>
<li>采用不同文件系统</li>
</ul>
<h3 id="212-分区方式">2.1.2 分区方式<a hidden class="anchor" aria-hidden="true" href="#212-分区方式">#</a></h3>
<p>两种分区方式：MBR，GPT</p>
<p>MBR分区</p>
<p>MBR：Master Boot Record，1982年，使用32位表示扇区数，分区不超过2T
划分分区的单位：
CentOS 5 之前按整柱面划分
CentOS 6 版本后可以按Sector划分
0磁道0扇区：512bytes
446bytes: boot loader 启动相关
64bytes：分区表，其中每16bytes标识一个分区
2bytes: 55AA，标识位
MBR分区中一块硬盘最多有4个主分区，也可以3主分区+1扩展(N个逻辑分区)
MBR分区：主和扩展分区对应的1&ndash;4，/dev/sda3，逻辑分区从5开始，/dev/sda5</p>
<p>问题：利用分区策略相同的另一台主机的分区表来还原和恢复当前主机破环的分区表？</p>
<p>GPT分区
GPT：GUID（Globals Unique Identifiers） partition table 支持128个分区，使用64位，支持8Z（
512Byte/block ）64Z （ 4096Byte/block）
使用128位UUID(Universally Unique Identifier) 表示磁盘和分区 GPT分区表自动备份在头和尾两份，
并有CRC校验位
UEFI (Unified Extensible Firmware Interface 统一可扩展固件接口)硬件支持GPT，使得操作系统可以
启动</p>
<p>GPT分区结构分为4个区域：</p>
<ul>
<li>GPT头</li>
<li>分区表</li>
<li>GPT分区</li>
<li>备份区域</li>
</ul>
<h2 id="22-管理分区">2.2 管理分区<a hidden class="anchor" aria-hidden="true" href="#22-管理分区">#</a></h2>
<p>列出块设备</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>lsblk
</span></span></code></pre></div><p>创建分区命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fdisk 管理MBR分区
</span></span><span style="display:flex;"><span>gdisk 管理GPT分区
</span></span><span style="display:flex;"><span>parted 高级分区操作，可以是交互或非交互方式
</span></span></code></pre></div><p>重新设置内存中的内核分区表版本，适合于除了CentOS 6 以外的其它版本 5，7，8</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>partprobe
</span></span></code></pre></div><h3 id="221-添加并检测新硬盘">2.2.1 添加并检测新硬盘<a hidden class="anchor" aria-hidden="true" href="#221-添加并检测新硬盘">#</a></h3>
<p>1、添加新硬盘使用lsblk命令显示出块设备</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu200404:~# lsblk
</span></span><span style="display:flex;"><span>NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
</span></span><span style="display:flex;"><span>loop0                       7:0    <span style="color:#ae81ff">0</span> 61.9M  <span style="color:#ae81ff">1</span> loop /snap/core20/1328
</span></span><span style="display:flex;"><span>loop1                       7:1    <span style="color:#ae81ff">0</span> 67.2M  <span style="color:#ae81ff">1</span> loop /snap/lxd/21835
</span></span><span style="display:flex;"><span>loop2                       7:2    <span style="color:#ae81ff">0</span>   62M  <span style="color:#ae81ff">1</span> loop /snap/core20/1587
</span></span><span style="display:flex;"><span>loop3                       7:3    <span style="color:#ae81ff">0</span> 43.6M  <span style="color:#ae81ff">1</span> loop /snap/snapd/14978
</span></span><span style="display:flex;"><span>loop4                       7:4    <span style="color:#ae81ff">0</span>   47M  <span style="color:#ae81ff">1</span> loop /snap/snapd/16292
</span></span><span style="display:flex;"><span>loop5                       7:5    <span style="color:#ae81ff">0</span> 67.8M  <span style="color:#ae81ff">1</span> loop /snap/lxd/22753
</span></span><span style="display:flex;"><span>sda                         8:0    <span style="color:#ae81ff">0</span>   20G  <span style="color:#ae81ff">0</span> disk 
</span></span><span style="display:flex;"><span>├─sda1                      8:1    <span style="color:#ae81ff">0</span>    1M  <span style="color:#ae81ff">0</span> part 
</span></span><span style="display:flex;"><span>├─sda2                      8:2    <span style="color:#ae81ff">0</span>  1.5G  <span style="color:#ae81ff">0</span> part /boot
</span></span><span style="display:flex;"><span>└─sda3                      8:3    <span style="color:#ae81ff">0</span> 18.5G  <span style="color:#ae81ff">0</span> part 
</span></span><span style="display:flex;"><span>  └─ubuntu--vg-ubuntu--lv 253:0    <span style="color:#ae81ff">0</span>   10G  <span style="color:#ae81ff">0</span> lvm  /
</span></span><span style="display:flex;"><span>sr0                        11:0    <span style="color:#ae81ff">1</span>  1.2G  <span style="color:#ae81ff">0</span> rom 
</span></span></code></pre></div><p>发现并没有检测出来新添加的硬盘</p>
<p>2、检测新硬盘</p>
<p>方法1：可以重启电脑</p>
<p>方法2： 重新扫描存储设备的scsi总线</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># host后面的数字不是固定的，以实际为准</span>
</span></span><span style="display:flex;"><span>root@ubuntu200404:~# echo <span style="color:#e6db74">&#39;- - -&#39;</span> &gt; /sys/class/scsi_host/host32/scan
</span></span></code></pre></div><p>再次使用lsblk命令查看发现已经多了sda的硬盘，说明成功了</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu200404:~# lsblk
</span></span><span style="display:flex;"><span>NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
</span></span><span style="display:flex;"><span>loop0                       7:0    <span style="color:#ae81ff">0</span> 61.9M  <span style="color:#ae81ff">1</span> loop /snap/core20/1328
</span></span><span style="display:flex;"><span>loop1                       7:1    <span style="color:#ae81ff">0</span> 67.2M  <span style="color:#ae81ff">1</span> loop /snap/lxd/21835
</span></span><span style="display:flex;"><span>loop2                       7:2    <span style="color:#ae81ff">0</span>   62M  <span style="color:#ae81ff">1</span> loop /snap/core20/1587
</span></span><span style="display:flex;"><span>loop3                       7:3    <span style="color:#ae81ff">0</span> 43.6M  <span style="color:#ae81ff">1</span> loop /snap/snapd/14978
</span></span><span style="display:flex;"><span>loop4                       7:4    <span style="color:#ae81ff">0</span>   47M  <span style="color:#ae81ff">1</span> loop /snap/snapd/16292
</span></span><span style="display:flex;"><span>loop5                       7:5    <span style="color:#ae81ff">0</span> 67.8M  <span style="color:#ae81ff">1</span> loop /snap/lxd/22753
</span></span><span style="display:flex;"><span>sda                         8:0    <span style="color:#ae81ff">0</span>   20G  <span style="color:#ae81ff">0</span> disk 
</span></span><span style="display:flex;"><span>├─sda1                      8:1    <span style="color:#ae81ff">0</span>    1M  <span style="color:#ae81ff">0</span> part 
</span></span><span style="display:flex;"><span>├─sda2                      8:2    <span style="color:#ae81ff">0</span>  1.5G  <span style="color:#ae81ff">0</span> part /boot
</span></span><span style="display:flex;"><span>└─sda3                      8:3    <span style="color:#ae81ff">0</span> 18.5G  <span style="color:#ae81ff">0</span> part 
</span></span><span style="display:flex;"><span>  └─ubuntu--vg-ubuntu--lv 253:0    <span style="color:#ae81ff">0</span>   10G  <span style="color:#ae81ff">0</span> lvm  /
</span></span><span style="display:flex;"><span>sdb                         8:16   <span style="color:#ae81ff">0</span>   20G  <span style="color:#ae81ff">0</span> disk <span style="color:#75715e"># 新添加的硬盘 </span>
</span></span><span style="display:flex;"><span>sr0                        11:0    <span style="color:#ae81ff">1</span>  1.2G  <span style="color:#ae81ff">0</span> rom
</span></span></code></pre></div><h3 id="222-partend命令">2.2.2 partend命令<a hidden class="anchor" aria-hidden="true" href="#222-partend命令">#</a></h3>
<p>注意：parted的操作都是实时生效的，小心使用</p>
<p>格式:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>parted <span style="color:#f92672">[</span>选项<span style="color:#f92672">]</span>... <span style="color:#f92672">[</span>设备 <span style="color:#f92672">[</span>命令 <span style="color:#f92672">[</span>参数<span style="color:#f92672">]</span>...<span style="color:#f92672">]</span>...<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>范例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>parted /dev/sdb mklabel gpt|msdos
</span></span><span style="display:flex;"><span>parted /dev/sdb print
</span></span><span style="display:flex;"><span>parted /dev/sdb mkpart primary 1 200 （默认M）
</span></span><span style="display:flex;"><span>parted /dev/sdb rm 1
</span></span><span style="display:flex;"><span>parted -l 列出所有硬盘分区信息
</span></span></code></pre></div><h3 id="223-分区工具fdisk和gdisk">2.2.3 分区工具fdisk和gdisk<a hidden class="anchor" aria-hidden="true" href="#223-分区工具fdisk和gdisk">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fdisk -l <span style="color:#f92672">[</span>-u<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>device...<span style="color:#f92672">]</span> 查看分区
</span></span><span style="display:flex;"><span>fdisk <span style="color:#f92672">[</span>device...<span style="color:#f92672">]</span> 管理MBR分区
</span></span><span style="display:flex;"><span>gdisk <span style="color:#f92672">[</span>device...<span style="color:#f92672">]</span> 类fdisk 的GPT分区工具
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 范例：</span>
</span></span><span style="display:flex;"><span>fdisk /dev/sdb
</span></span></code></pre></div><p>子命令：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>p 分区列表
</span></span><span style="display:flex;"><span>t 更改分区类型
</span></span><span style="display:flex;"><span>n 创建新分区
</span></span><span style="display:flex;"><span>d 删除分区
</span></span><span style="display:flex;"><span>v 校验分区
</span></span><span style="display:flex;"><span>u 转换单位
</span></span><span style="display:flex;"><span>w 保存并退出
</span></span><span style="display:flex;"><span>q 不保存并退出
</span></span></code></pre></div><p>查看内核是否已经识别新的分区</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /proc/partitions
</span></span></code></pre></div><p>CentOS 7,8 同步分区表:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>partprobe
</span></span></code></pre></div><h2 id="23-文件系统">2.3 文件系统<a hidden class="anchor" aria-hidden="true" href="#23-文件系统">#</a></h2>
<h3 id="231-文件系统概念">2.3.1 文件系统概念<a hidden class="anchor" aria-hidden="true" href="#231-文件系统概念">#</a></h3>
<p>文件系统是操作系统用于明确存储设备或分区上的文件的方法和数据结构；即在存储设备上组织文件的
方法。操作系统中负责管理和存储文件信息的软件结构称为文件管理系统，简称文件系统
从系统角度来看，文件系统是对文件存储设备的空间进行组织和分配，负责文件存储并对存入的文件进
行保护和检索的系统。具体地说，它负责为用户建立文件，存入、读出、修改、转储文件，控制文件的
存取，安全控制，日志，压缩，加密等
支持的文件系统：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/lib/modules/<span style="color:#e6db74">`</span>uname -r<span style="color:#e6db74">`</span>/kernel/fs
</span></span></code></pre></div><p><a href="https://en.wikipedia.org/wiki/Comparison_of_file_systems">各种文件系统</a></p>
<p>帮助：man 5 fs</p>
<h3 id="232-文件系统类型">2.3.2 文件系统类型<a hidden class="anchor" aria-hidden="true" href="#232-文件系统类型">#</a></h3>
<p>Linux常用文件系统</p>
<ul>
<li>ext2：Extended file system 适用于那些分区容量不是太大，更新也不频繁的情况，例如 /boot 分
区</li>
<li>ext3：是 ext2 的改进版本，其支持日志功能，能够帮助系统从非正常关机导致的异常中恢复</li>
<li>ext4：是 ext 文件系统的最新版。提供了很多新的特性，包括纳秒级时间戳、创建和使用巨型文件
(16TB)、最大1EB的文件系统，以及速度的提升</li>
<li>xfs：SGI，支持最大8EB的文件系统</li>
<li>swap</li>
<li>iso9660 光盘</li>
<li>btrfs（Oracle）</li>
<li>reiserfs</li>
</ul>
<p>Windows 常用文件系统</p>
<ul>
<li>FAT32</li>
<li>NTFS</li>
<li>exFAT</li>
<li>Unix：</li>
<li>FFS（fast）</li>
<li>UFS（unix）</li>
<li>JFS2</li>
</ul>
<p>网络文件系统：</p>
<ul>
<li>NFS</li>
<li>CIFS</li>
</ul>
<p>集群文件系统：</p>
<ul>
<li>GFS2</li>
<li>OCFS2（oracle）</li>
</ul>
<p>分布式文件系统：</p>
<ul>
<li>fastdfs</li>
<li>ceph</li>
<li>moosefs</li>
<li>mogilefs</li>
<li>glusterfs</li>
<li>Lustre</li>
</ul>
<p>RAW：</p>
<p>裸文件系统,未经处理或者未经格式化产生的文件系统
常用的文件系统特性：</p>
<p>FAT32</p>
<ul>
<li>最多只能支持16TB的文件系统和4GB的文件</li>
</ul>
<p>NTFS</p>
<ul>
<li>最多只能支持16EB的文件系统和16EB的文件</li>
</ul>
<p>EXT3</p>
<ul>
<li>最多只能支持32TB的文件系统和2TB的文件，实际只能容纳2TB的文件系统和16GB的文件</li>
<li>Ext3目前只支持32000个子目录</li>
<li>Ext3文件系统使用32位空间记录块数量和 inode数量</li>
<li>当数据写入到Ext3文件系统中时，Ext3的数据块分配器每次只能分配一个4KB的块</li>
</ul>
<p>EXT4：</p>
<ul>
<li>EXT4是Linux系统下的日志文件系统，是EXT3文件系统的后继版本</li>
<li>Ext4的文件系统容量达到1EB，而支持单个文件则达到16TB</li>
<li>理论上支持无限数量的子目录</li>
<li>Ext4文件系统使用64位空间记录块数量和 inode数量</li>
<li>Ext4的多块分配器支持一次调用分配多个数据块</li>
<li>修复速度更快</li>
</ul>
<p>XFS</p>
<ul>
<li>根据所记录的日志在很短的时间内迅速恢复磁盘文件内容</li>
<li>用优化算法，日志记录对整体文件操作影响非常小</li>
<li>是一个全64-bit的文件系统，最大可以支持8EB的文件系统，而支持单个文件则达到8EB</li>
<li>能以接近裸设备I/O的性能存储数据</li>
</ul>
<p>查前支持的文件系统：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat /proc/filesystems
</span></span></code></pre></div><h3 id="233-文件系统的组成部分">2.3.3 文件系统的组成部分<a hidden class="anchor" aria-hidden="true" href="#233-文件系统的组成部分">#</a></h3>
<p>内核中的模块：ext4, xfs, vfat
Linux的虚拟文件系统：VFS
用户空间的管理工具：mkfs.ext4, mkfs.xfs,mkfs.vfat</p>
<h3 id="234-文件系统选择管理">2.3.4 文件系统选择管理<a hidden class="anchor" aria-hidden="true" href="#234-文件系统选择管理">#</a></h3>
<h4 id="2341-创建文件系统">2.3.4.1 创建文件系统<a hidden class="anchor" aria-hidden="true" href="#2341-创建文件系统">#</a></h4>
<p>创建文件管理工具</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkfs命令：
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>1<span style="color:#f92672">)</span> mkfs.FS_TYPE /dev/DEVICE
</span></span><span style="display:flex;"><span>ext4
</span></span><span style="display:flex;"><span>xfs
</span></span><span style="display:flex;"><span>btrfs
</span></span><span style="display:flex;"><span>vfat
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>2<span style="color:#f92672">)</span> mkfs -t FS_TYPE /dev/DEVICE
</span></span><span style="display:flex;"><span>-L <span style="color:#e6db74">&#39;LABEL&#39;</span> 设定卷标
</span></span><span style="display:flex;"><span>mke2fs：ext系列文件系统专用管理工具
</span></span></code></pre></div><p>常用选项：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-t <span style="color:#f92672">{</span>ext2|ext3|ext4|xfs<span style="color:#f92672">}</span> 指定文件系统类型
</span></span><span style="display:flex;"><span>-b <span style="color:#f92672">{</span>1024|2048|4096<span style="color:#f92672">}</span> 指定块 block 大小
</span></span><span style="display:flex;"><span>-L ‘LABEL’ 设置卷标
</span></span><span style="display:flex;"><span>-j 相当于 -t ext3， mkfs.ext3 <span style="color:#f92672">=</span> mkfs -t ext3 <span style="color:#f92672">=</span> mke2fs -j <span style="color:#f92672">=</span> mke2fs -t ext3
</span></span><span style="display:flex;"><span>-i <span style="color:#75715e"># 为数据空间中每多少个字节创建一个inode；不应该小于block大</span>
</span></span><span style="display:flex;"><span>小
</span></span><span style="display:flex;"><span>-N <span style="color:#75715e"># 指定分区中创建多少个inode</span>
</span></span><span style="display:flex;"><span>-I 一个inode记录占用的磁盘空间大小，128---4096
</span></span><span style="display:flex;"><span>-m <span style="color:#75715e"># 默认5%,为管理人员预留空间占总空间的百分比</span>
</span></span><span style="display:flex;"><span>-O FEATURE<span style="color:#f92672">[</span>,...<span style="color:#f92672">]</span> 启用指定特性
</span></span><span style="display:flex;"><span>-O ^FEATURE 
</span></span></code></pre></div><p>案例：mkfs.ext4 /dev/sdb1</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu200404:~# mkfs.ext4 /dev/sdb1
</span></span><span style="display:flex;"><span>mke2fs 1.45.5 <span style="color:#f92672">(</span>07-Jan-2020<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Creating filesystem with <span style="color:#ae81ff">2621440</span> 4k blocks and <span style="color:#ae81ff">655360</span> inodes
</span></span><span style="display:flex;"><span>Filesystem UUID: a7ef4142-26e5-43dd-b9d0-24c4d09155a1
</span></span><span style="display:flex;"><span>Superblock backups stored on blocks: 
</span></span><span style="display:flex;"><span>32768, 98304, 163840, 229376, 294912, 819200, 884736, <span style="color:#ae81ff">1605632</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Allocating group tables: <span style="color:#66d9ef">done</span>                            
</span></span><span style="display:flex;"><span>Writing inode tables: <span style="color:#66d9ef">done</span>                            
</span></span><span style="display:flex;"><span>Creating journal <span style="color:#f92672">(</span><span style="color:#ae81ff">16384</span> blocks<span style="color:#f92672">)</span>: <span style="color:#66d9ef">done</span>
</span></span><span style="display:flex;"><span>Writing superblocks and filesystem accounting information: <span style="color:#66d9ef">done</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root@ubuntu200404:~# 
</span></span></code></pre></div><h4 id="2342-查看和管理分区信息">2.3.4.2 查看和管理分区信息<a hidden class="anchor" aria-hidden="true" href="#2342-查看和管理分区信息">#</a></h4>
<p>blkid 可以查看块设备属性信息
格式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>blkid <span style="color:#f92672">[</span>OPTION<span style="color:#f92672">]</span>... <span style="color:#f92672">[</span>DEVICE<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>常用选项：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-U UUID 根据指定的UUID来查找对应的设备
</span></span><span style="display:flex;"><span>-L LABEL 根据指定的LABEL来查找对应的设备
</span></span><span style="display:flex;"><span>e2label：管理ext系列文件系统的LABEL
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>e2label DEVICE <span style="color:#f92672">[</span>LABEL<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>范例</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu200404:~# blkid /dev/sdb1
</span></span><span style="display:flex;"><span>/dev/sdb1: UUID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;a7ef4142-26e5-43dd-b9d0-24c4d09155a1&#34;</span> TYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ext4&#34;</span> PARTUUID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;db60ac71-01&#34;</span>
</span></span><span style="display:flex;"><span>root@ubuntu200404:~# 
</span></span></code></pre></div><p>查找分区</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>findfs <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span> LABEL<span style="color:#f92672">=</span>&lt;label&gt;
</span></span><span style="display:flex;"><span>findfs <span style="color:#f92672">[</span>options<span style="color:#f92672">]</span> UUID<span style="color:#f92672">=</span>&lt;uuid&gt;
</span></span></code></pre></div><p>tune2fs：重新设定ext系列文件系统可调整参数的值</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-l 查看指定文件系统超级块信息；super block
</span></span><span style="display:flex;"><span>-L <span style="color:#960050;background-color:#1e0010">&#39;</span>LABEL’ 修改卷标
</span></span><span style="display:flex;"><span>-m <span style="color:#75715e"># 修预留给管理员的空间百分比</span>
</span></span><span style="display:flex;"><span>-j 将ext2升级为ext3
</span></span><span style="display:flex;"><span>-O 文件系统属性启用或禁用, -O ^has_journal
</span></span><span style="display:flex;"><span>-o 调整文件系统的默认挂载选项，-o ^acl
</span></span><span style="display:flex;"><span>-U UUID 修改UUID号
</span></span></code></pre></div><p>dumpe2fs：显示ext文件系统信息，将磁盘块分组管理
-h：查看超级块信息，不显示分组信息</p>
<p>范例：查看ext文件系统的元数据和块组信息</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu200404:~# dumpe2fs /dev/sdb1
</span></span><span style="display:flex;"><span>dumpe2fs 1.45.5 <span style="color:#f92672">(</span>07-Jan-2020<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Filesystem volume name:   &lt;none&gt;
</span></span><span style="display:flex;"><span>Last mounted on:          &lt;not available&gt;
</span></span><span style="display:flex;"><span>Filesystem UUID:          a7ef4142-26e5-43dd-b9d0-24c4d09155a1
</span></span><span style="display:flex;"><span>Filesystem magic number:  0xEF53
</span></span><span style="display:flex;"><span>Filesystem revision <span style="color:#75715e">#:    1 (dynamic)</span>
</span></span><span style="display:flex;"><span>Filesystem features:      has_journal ext_attr resize_inode dir_index filetype extent 64bit flex_bg sparse_super large_file huge_file dir_nlink extra_isize metadata_csum
</span></span><span style="display:flex;"><span>Filesystem flags:         signed_directory_hash 
</span></span><span style="display:flex;"><span>Default mount options:    user_xattr acl
</span></span><span style="display:flex;"><span>Filesystem state:         clean
</span></span><span style="display:flex;"><span>Errors behavior:          Continue
</span></span><span style="display:flex;"><span>Filesystem OS type:       Linux
</span></span><span style="display:flex;"><span>Inode count:              <span style="color:#ae81ff">655360</span>
</span></span><span style="display:flex;"><span>Block count:              <span style="color:#ae81ff">2621440</span>
</span></span><span style="display:flex;"><span>Reserved block count:     <span style="color:#ae81ff">131072</span>
</span></span><span style="display:flex;"><span>Free blocks:              <span style="color:#ae81ff">2554687</span>
</span></span><span style="display:flex;"><span>Free inodes:              <span style="color:#ae81ff">655349</span>
</span></span><span style="display:flex;"><span>First block:              <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>......
</span></span><span style="display:flex;"><span>......
</span></span></code></pre></div><p>xfs_info：显示示挂载或已挂载的 xfs 文件系统信息</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>xfs_info mountpoint|devname
</span></span></code></pre></div><p>范例</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>xfs_info /dev/sda1
</span></span></code></pre></div><h4 id="2343-文件系统检测和修复">2.3.4.3 文件系统检测和修复<a hidden class="anchor" aria-hidden="true" href="#2343-文件系统检测和修复">#</a></h4>
<p>文件系统夹故障常发生于死机或者非正常关机之后，挂载为文件系统标记为“no clean”
注意：一定不要在挂载状态下执行下面命令修复</p>
<p>fsck: File System Check</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fsck.FS_TYPE
</span></span><span style="display:flex;"><span>fsck -t FS_TYPE
</span></span></code></pre></div><p>注意：FS_TYPE 一定要与分区上已经文件类型相同</p>
<p>常用选项</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-a 自动修复
</span></span><span style="display:flex;"><span>-r 交互式修复错误
</span></span></code></pre></div><p>e2fsck：ext系列文件专用的检测修复工具</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-y 自动回答为yes
</span></span><span style="display:flex;"><span>-f 强制修复
</span></span><span style="display:flex;"><span>-p 自动进行安全的修复文件系统问题
</span></span></code></pre></div><p>用法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>e2fsck /dev/sdb2
</span></span></code></pre></div><p>xfs_repair：xfs文件系统专用检测修复工具
常用选项：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-f 修复文件，而设备
</span></span><span style="display:flex;"><span>-n 只检查
</span></span><span style="display:flex;"><span>-d 允许修复只读的挂载设备，在单用户下修复 / 时使用，然后立即reboot
</span></span></code></pre></div><p>用法：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>xfs_repair /dev/sda1 
</span></span></code></pre></div><h2 id="24-挂载">2.4 挂载<a hidden class="anchor" aria-hidden="true" href="#24-挂载">#</a></h2>
<p>挂载:将额外文件系统与根文件系统某现存的目录建立起关联关系，进而使得此目录做为其它文件访问入
口的行为
卸载:为解除此关联关系的过程
把设备关联挂载点：mount Point
挂载点下原有文件在挂载完成后会被临时隐藏，因此，挂载点目录一般为空
进程正在使用中的设备无法被卸载</p>
<h3 id="241-挂载文件系统-mount">2.4.1 挂载文件系统 mount<a hidden class="anchor" aria-hidden="true" href="#241-挂载文件系统-mount">#</a></h3>
<p>格式</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mount <span style="color:#f92672">[</span>-fnrsvw<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-t vfstype<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-o options<span style="color:#f92672">]</span> device mountpoint
</span></span></code></pre></div><p>device：指明要挂载的设备</p>
<ul>
<li>设备文件：例如:/dev/sda5</li>
<li>卷标：-L &lsquo;LABEL&rsquo;, 例如 -L &lsquo;MYDATA&rsquo;</li>
<li>UUID： -U &lsquo;UUID&rsquo;：例如 -U &lsquo;0c50523c-43f1-45e7-85c0-a126711d406e&rsquo;</li>
<li>伪文件系统名称：proc, sysfs, devtmpfs, configfs</li>
</ul>
<p>mountpoint：挂载点目录必须事先存在，建议使用空目录
mount 常用命令选项</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-t fstype 指定要挂载的设备上的文件系统类型,如:ext4,xfs
</span></span><span style="display:flex;"><span>-r readonly，只读挂载
</span></span><span style="display:flex;"><span>-w read and write, 读写挂载,此为默认设置,可省略
</span></span><span style="display:flex;"><span>-n 不更新/etc/mtab，mount不可见
</span></span><span style="display:flex;"><span>-a 自动挂载所有支持自动挂载的设备<span style="color:#f92672">(</span>定义在了/etc/fstab文件中，且挂载选项中有
</span></span><span style="display:flex;"><span>auto功能<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>-L <span style="color:#e6db74">&#39;LABEL&#39;</span> 以卷标指定挂载设备
</span></span><span style="display:flex;"><span>-U <span style="color:#e6db74">&#39;UUID&#39;</span> 以UUID指定要挂载的设备
</span></span><span style="display:flex;"><span>-B, --bind 绑定目录到另一个目录上
</span></span><span style="display:flex;"><span>-o options：<span style="color:#f92672">(</span>挂载文件系统的选项<span style="color:#f92672">)</span>，多个选项使用逗号分隔
</span></span><span style="display:flex;"><span>async 异步模式,内存更改时,写入缓存区buffer,过一段时间再写到磁盘中，效率高，但不安全
</span></span><span style="display:flex;"><span>sync 同步模式,内存更改时，同时写磁盘，安全，但效率低下
</span></span><span style="display:flex;"><span>atime/noatime 包含目录和文件
</span></span><span style="display:flex;"><span>diratime/nodiratime 目录的访问时间戳
</span></span><span style="display:flex;"><span>auto/noauto 是否支持开机自动挂载，是否支持-a选项
</span></span><span style="display:flex;"><span>exec/noexec 是否支持将文件系统上运行应用程序
</span></span><span style="display:flex;"><span>dev/nodev 是否支持在此文件系统上使用设备文件
</span></span><span style="display:flex;"><span>suid/nosuid 是否支持suid和sgid权限
</span></span><span style="display:flex;"><span>remount 重新挂载
</span></span><span style="display:flex;"><span>ro/rw 只读、读写
</span></span><span style="display:flex;"><span>user/nouser 是否允许普通用户挂载此设备，/etc/fstab使用
</span></span><span style="display:flex;"><span>acl/noacl 启用此文件系统上的acl功能
</span></span><span style="display:flex;"><span>loop 使用loop设备
</span></span><span style="display:flex;"><span>_netdev 当网络可用时才对网络资源进行挂载，如：NFS文件系统
</span></span><span style="display:flex;"><span>defaults 相当于rw, suid, dev, exec, auto, nouser, async
</span></span></code></pre></div><p>挂载规则:</p>
<ul>
<li>一个挂载点同一时间只能挂载一个设备</li>
<li>一个挂载点同一时间挂载了多个设备，只能看到最后一个设备的数据，其它设备上的数据将被隐藏</li>
<li>一个设备可以同时挂载到多个挂载点</li>
<li>通常挂载点一般是已存在空的目录</li>
</ul>
<p>范例:挂载案例</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu200404:/data# mount /dev/sdb1 /data/mysql_mount/
</span></span><span style="display:flex;"><span>root@ubuntu200404:/data# df
</span></span></code></pre></div><p><img loading="lazy" src="../image.assets/1659865748687.png" alt="1659865748687"  />
</p>
<h3 id="242-卸载文件系统-umount">2.4.2 卸载文件系统 umount<a hidden class="anchor" aria-hidden="true" href="#242-卸载文件系统-umount">#</a></h3>
<p>卸载时：可使用设备，也可以使用挂载点</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>umount 设备名|挂载点
</span></span></code></pre></div><h3 id="243-查看挂载情况">2.4.3 查看挂载情况<a hidden class="anchor" aria-hidden="true" href="#243-查看挂载情况">#</a></h3>
<p>查看挂载</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#通过查看/etc/mtab文件显示当前已挂载的所有设备</span>
</span></span><span style="display:flex;"><span>mount
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看内核追踪到的已挂载的所有设备</span>
</span></span><span style="display:flex;"><span>cat /proc/mounts
</span></span></code></pre></div><p>查看挂载点情况</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>findmnt MOUNT_POINT|device
</span></span></code></pre></div><p>查看正在访问指定文件系统的进程</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>lsof MOUNT_POINT
</span></span><span style="display:flex;"><span>fuser -v MOUNT_POINT
</span></span></code></pre></div><p>终止所有在正访问指定的文件系统的进程</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>fuser -km MOUNT_POINT
</span></span></code></pre></div><h3 id="244-持久挂载">2.4.4 持久挂载<a hidden class="anchor" aria-hidden="true" href="#244-持久挂载">#</a></h3>
<p>将挂载保存到 /etc/fstab 中可以下次开机时，自动启用挂载
/etc/fstab格式帮助：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>man <span style="color:#ae81ff">5</span> fstab
</span></span></code></pre></div><p>每行定义一个要挂载的文件系统,，其中包括共 6 项</p>
<ul>
<li>要挂载的设备或伪文件系统设备文件
LABEL：LABEL=&quot;&quot;
UUID：UUID=&quot;&quot;
伪文件系统名称：proc, sysfs</li>
<li>挂载点：必须是事先存在的目录</li>
<li>文件系统类型：ext4，xfs，iso9660，nfs，none</li>
<li>挂载选项：defaults ，acl，bind</li>
<li>转储频率：0：不做备份 1：每天转储 2：每隔一天转储</li>
<li>fsck检查的文件系统的顺序：允许的数字是0 1 2
0：不自检 ，1：首先自检；一般只有rootfs才用 2：非rootfs使用</li>
</ul>
<p>添加新的挂载项，需要执行下面命令生效</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mount -a
</span></span></code></pre></div><p>范例：centos7, 8 /etc/fstab 的分区UUID错误，无法启动*</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>自动进入emergency mode,输入root 密码
</span></span><span style="display:flex;"><span><span style="color:#75715e">#cat /proc/mounts 可以查看到/ 以rw方式挂载</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#vim /etc/fstab</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#reboot</span>
</span></span></code></pre></div><p>范例：centos 6 /etc/fstab 的分区UUID错误，无法启动</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>如果/etc/fstab 的挂载设备出错，比如文件系统故障，并且文件系统检测项（即第6项为非0），将导致无
</span></span><span style="display:flex;"><span>法启动
</span></span><span style="display:flex;"><span>自动进入emergency mode,输入root 密码
</span></span><span style="display:flex;"><span><span style="color:#75715e">#cat /proc/mounts 可以查看到/ 以ro方式挂载，无法直接修改配置文件</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#mount -o remount,rw /</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#vim /etc/fstab</span>
</span></span><span style="display:flex;"><span>将故障行的最后1项，即第6项修改为0，开机不检测此项挂载设备的健康性，从而忽略错误，能实现启动
</span></span></code></pre></div><p>范例：/etc/fstab格式</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ubuntu200404:/data# cat /etc/fstab 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># /etc/fstab: static file system information.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Use &#39;blkid&#39; to print the universally unique identifier for a</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># device; this may be used with UUID= as a more robust way to name devices</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># that works even if disks are added and removed. See fstab(5).</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation</span>
</span></span><span style="display:flex;"><span>/dev/disk/by-id/dm-uuid-LVM-3aQ0WgB04ZXwNPYVAYy9ssb3Wd06E34ggUUxCcYQaVwAb0L03K40wpOxbnqqqa3f / ext4 defaults <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># /boot was on /dev/sda2 during curtin installation</span>
</span></span><span style="display:flex;"><span>/dev/disk/by-uuid/5e8f9763-2db8-48d0-85e2-a26d76521e2f /boot ext4 defaults <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>/swap.img none swap sw <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>root@ubuntu200404:/data# 
</span></span></code></pre></div><p>范例：添加新的挂载点后修改/etc/fstab文件</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># /etc/fstab: static file system information.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Use &#39;blkid&#39; to print the universally unique identifier for a</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># device; this may be used with UUID= as a more robust way to name devices</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># that works even if disks are added and removed. See fstab(5).</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># / was on /dev/ubuntu-vg/ubuntu-lv during curtin installation</span>
</span></span><span style="display:flex;"><span>/dev/disk/by-id/dm-uuid-LVM-3aQ0WgB04ZXwNPYVAYy9ssb3Wd06E34ggUUxCcYQaVwAb0L03K40wpOxbnqqqa3f / ext4 defaults <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># /boot was on /dev/sda2 during curtin installation</span>
</span></span><span style="display:flex;"><span>/dev/disk/by-uuid/5e8f9763-2db8-48d0-85e2-a26d76521e2f /boot ext4 defaults <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>/swap.img       none    swap    sw      <span style="color:#ae81ff">0</span>       <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 添加该行后、重启系统</span>
</span></span><span style="display:flex;"><span>UUID<span style="color:#f92672">=</span>0e850a4a-028d-48b2-aa18-dd8b16090aa6  /data/mysql_mount  ext4  defaults  <span style="color:#ae81ff">0</span>  <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><h2 id="25-处理交换文件和分区">2.5 处理交换文件和分区<a hidden class="anchor" aria-hidden="true" href="#25-处理交换文件和分区">#</a></h2>
<h3 id="251-swap分区">2.5.1 swap分区<a hidden class="anchor" aria-hidden="true" href="#251-swap分区">#</a></h3>
<p>swap交换分区是系统RAM的补充，swap 分区支持虚拟内存。当没有足够的 RAM 保存系统处理的数据
时会将数据写入 swap 分区，当系统缺乏 swap 空间时，内核会因 RAM 内存耗尽而终止进程。配置过
多 swap 空间会造成存储设备处于分配状态但闲置，造成浪费，过多 swap 空间还会掩盖内存泄露
注意：为优化性能，可以将swap 分布存放，或高性能磁盘存放</p>
<h3 id="252-交换分区实现过程">2.5.2 交换分区实现过程<a hidden class="anchor" aria-hidden="true" href="#252-交换分区实现过程">#</a></h3>
<ol>
<li>创建交换分区或者文件</li>
<li>使用mkswap写入特殊签名</li>
<li>在/etc/fstab文件中添加适当的条目</li>
<li>使用swapon -a 激活交换空间</li>
</ol>
<p>启用swap分区</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>swapon <span style="color:#f92672">[</span>OPTION<span style="color:#f92672">]</span>... <span style="color:#f92672">[</span>DEVICE<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>常用选项</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-a <span style="color:#75715e">#激活所有的交换分区</span>
</span></span><span style="display:flex;"><span>-p PRIORITY <span style="color:#75715e">#指定优先级(-1到32767之间)，值越大,优先级越高.也可在/etc/fstab文件中的第4列指</span>
</span></span><span style="display:flex;"><span>定：pri<span style="color:#f92672">=</span>value
</span></span></code></pre></div><p>范例:创建swap分区</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#mkswap /dev/sdc1</span>
</span></span></code></pre></div><p>禁用swap分区</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>swapoff <span style="color:#f92672">[</span>OPTION<span style="color:#f92672">]</span>... <span style="color:#f92672">[</span>DEVICE<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>范例:禁用swap分区</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#sed -i.bak &#39;/swap/d&#39; /etc/fstab</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e">#swapoff -a</span>
</span></span></code></pre></div><h3 id="253-swap的使用策略">2.5.3 swap的使用策略<a hidden class="anchor" aria-hidden="true" href="#253-swap的使用策略">#</a></h3>
<p>/proc/sys/vm/swappiness 的值决定了当内存占用达到一定的百分比时，会启用swap分区的空间
使用规则</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>当内存使用率达到100-swappiness时,会启用交换分区
</span></span><span style="display:flex;"><span>简单地说这个参数定义了系统对swap的使用倾向，此值越大表示越倾向于使用swap。
</span></span><span style="display:flex;"><span>可以设为0，这样做并不会禁止对swap的使用，只是最大限度地降低了使用swap的可能性
</span></span></code></pre></div><p>范例</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#说明：CentOS7和8默认值为30，内存在使用到100-30=70%的时候，就开始出现有交换分区的使用。</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos8 ~<span style="color:#f92672">]</span><span style="color:#75715e"># cat /proc/sys/vm/swappiness</span>
</span></span></code></pre></div><h2 id="26-磁盘常见工具">2.6 磁盘常见工具<a hidden class="anchor" aria-hidden="true" href="#26-磁盘常见工具">#</a></h2>
<h3 id="261-df">2.6.1 df<a hidden class="anchor" aria-hidden="true" href="#261-df">#</a></h3>
<p>文件系统空间实际真正占用等信息的查看工具 df</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>df <span style="color:#f92672">[</span>OPTION<span style="color:#f92672">]</span>... <span style="color:#f92672">[</span>FILE<span style="color:#f92672">]</span>...
</span></span></code></pre></div><p>常用选项</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-H 以10为单位
</span></span><span style="display:flex;"><span>-T 文件系统类型
</span></span><span style="display:flex;"><span>-h human-readable
</span></span><span style="display:flex;"><span>-i inodes instead of blocks
</span></span><span style="display:flex;"><span>-P 以Posix兼容的格式输出
</span></span></code></pre></div><h3 id="263-du">2.6.3 du<a hidden class="anchor" aria-hidden="true" href="#263-du">#</a></h3>
<p>查看某目录总体空间实际占用状态 du</p>
<p>显示指定目录下面各个子目录的大小,单位为KB</p>
<p>常用选项</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>-a --all 显示所有文件和目录的大小,默认只显示目录大小
</span></span><span style="display:flex;"><span>-h human-readable
</span></span><span style="display:flex;"><span>-s summary
</span></span><span style="display:flex;"><span>--max-depth<span style="color:#f92672">=</span><span style="color:#75715e"># 指定最大目录层级</span>
</span></span><span style="display:flex;"><span>-x, --one-file-system <span style="color:#75715e">#忽略不在同一个文件系统的目录</span>
</span></span></code></pre></div><p>面试题</p>
<p>1.df 和 du 区别?什么时候df &gt;du（空分区的时候)
df 查看是文件系统的空间使用，包括元数据和数据，删除文件后，如果此文件正在使用，不会立即释放空间;du 查看是文件数据空间使用，不包括元数据，删除文件后空间立即释放。</p>
<p>2.什么时候df &lt; du?
目录内挂载有其它分区时的情况</p>
<p>3.当删除文件但不释放空间时,有什么不同?
du 查看文件空间释放,df不释放</p>
<h2 id="3-raid">3. RAID<a hidden class="anchor" aria-hidden="true" href="#3-raid">#</a></h2>


        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="http://colorfulgz.com/posts/%E8%BD%AF%E4%BB%B6%E7%AE%A1%E7%90%86/">
    <span class="title">« 上一页</span>
    <br>
    <span>软件管理</span>
  </a>
  <a class="next" href="http://colorfulgz.com/posts/docker/">
    <span class="title">下一页 »</span>
    <br>
    <span>Docker基础详细教程</span>
  </a>
</nav>

        </footer>
    </div>

<style>
    .comments_details summary::marker {
        font-size: 20px;
        content: '👉展开评论';
        color: var(--content);
    }
    .comments_details[open] summary::marker{
        font-size: 20px;
        content: '👇关闭评论';
        color: var(--content);
    }
</style>


<div>
    <details class="comments_details">
        <summary style="cursor: pointer; margin: 50px 0 20px 0;width: 130px;">
            <span style="font-size: 20px;color: var(--content);">...</span>
        </summary>
        <div id="tcomment"></div>
    </details>
    <script src="https://cdn.staticfile.org/twikoo/1.5.8/twikoo.all.min.js">
    </script>
    <script>
        twikoo.init({
            envId:  null ,
        el: "#tcomment",
            lang: 'zh-CN',
            region:  null ,
        path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
        })
    </script>
</div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        2022-2023
        <a href="http://colorfulgz.com" style="color:#939393;">DevOpsHub</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;">黔ICP备2023014549号</a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="/img/beian.png" style="float:left;margin: 0px 5px 0px 0px;"/>
            
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"DevOpsHub"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"DevOpsHub"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = '📄复制';

        function copyingDone() {
            copybutton.innerText = '👌🏻已复制!';
            setTimeout(() => {
                copybutton.innerText = '📄复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\n————————————————\r\n' +
                    '版权声明：本文为「'+"DevOpsHub"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>
</body>

</html>
